'use strict';define("goo/entities/components/Component",[],function(){return function(){this.enabled=!0}});
define("goo/addons/box2d/components/Box2DComponent",["goo/entities/components/Component"],function(f){function d(c){this.type="Box2DComponent";this.world=this.body=null;this.mass=1;this.settings=c||{};this.shape=c.shape?c.shape:"box";this.width=c.width?c.width:1;this.height=c.height?c.height:1;this.radius=c.radius?c.radius:1;this.vertices=c.vertices?c.vertices:[0,1,2,2,0,2];this.movable=c.movable===!0?!0:!1;this.friction=c.friction?c.friction:1;this.offsetX=c.offsetX?c.offsetX:0;this.offsetY=c.offsetY?
c.offsetY:0}d.prototype=Object.create(f.prototype);return d});
define("goo/entities/systems/System",[],function(){function f(d,c){this.type=d;this.interests=c;this._activeEntities=[]}f.prototype.added=function(d){this._check(d)};f.prototype.changed=function(d){this._check(d)};f.prototype.removed=function(d){var c=this._activeEntities.indexOf(d);c!==-1&&(this._activeEntities.splice(c,1),this.deleted&&this.deleted(d))};f.prototype._check=function(d){var c=this.interests===null;if(!c&&this.interests.length<=d._components.length)for(var c=!0,a=0;a<this.interests.length;a++){var b=
this.interests[a].charAt(0).toLowerCase()+this.interests[a].substr(1);if(!d[b]){c=!1;break}}a=this._activeEntities.indexOf(d);c&&a===-1?(this._activeEntities.push(d),this.inserted&&this.inserted(d)):!c&&a!==-1&&(this._activeEntities.splice(a,1),this.deleted&&this.deleted(d))};f.prototype._process=function(d){this.process&&this.process(this._activeEntities,d)};return f});
define("goo/addons/box2d/systems/Box2DSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"Box2DSystem",["Box2DComponent","MeshDataComponent"]);this.SCALE=0.5;this.world=new Box2D.b2World(new Box2D.b2Vec2(0,-9));this.sortVertexesClockWise=function(c,a){var b=Math.atan2(c.get_y(),c.get_x()),e=Math.atan2(a.get_y(),a.get_x());return b>e?1:-1};this.createPolygonShape=function(c){for(var a=new Box2D.b2PolygonShape,b=Box2D.allocate(c.length*8,"float",Box2D.ALLOC_STACK),e=0,g=0;g<
c.length;g++)Box2D.setValue(b+e,c[g].get_x(),"float"),Box2D.setValue(b+(e+4),c[g].get_y(),"float"),e+=8;b=Box2D.wrapPointer(b,Box2D.b2Vec2);a.Set(b,c.length);return a}}d.prototype=Object.create(f.prototype);d.prototype.inserted=function(c){var a=c.physics2DComponent,b=0,e=0,g=new Box2D.b2PolygonShape;if(a.shape==="box")g.SetAsBox(a.width*this.SCALE,a.height*this.SCALE);else if(a.shape==="circle")g=new Box2D.b2CircleShape,g.set_m_radius(a.radius);else if(a.shape==="mesh"){for(var d=c.meshDataComponent.meshData.getAttributeBuffer("POSITION"),
g=0,f=[],b=1E4,i=-1E4,e=1E4,h=-1E4;g<=d.length-3;){var j=d[g],n=d[++g];n<b&&(b=n);n>i&&(i=n);j<e&&(e=j);j>h&&(h=j);++g;c.transformComponent.updateWorldTransform();j=new Box2D.b2Vec2(j,n);f.push(j)}g=this.createPolygonShape(f);b=Math.abs(i-b);e=Math.abs(h-e)}else if(a.shape==="polygon"){f=[];for(g=0;g<=a.vertices.length-2;)j=new Box2D.b2Vec2(a.vertices[g],a.vertices[++g]),f.push(j),++g;g=this.createPolygonShape(f);console.log(f)}f=new Box2D.b2FixtureDef;f.set_shape(g);f.set_density(1);f.set_friction(a.friction);
g=new Box2D.b2BodyDef;a.movable===!0&&g.set_type(Box2D.b2_dynamicBody);g.set_position(new Box2D.b2Vec2(c.transformComponent.transform.translation.x+a.offsetX,c.transformComponent.transform.translation.y+a.offsetY));g=this.world.CreateBody(g);g.CreateFixture(f);g.SetLinearDamping(0.95);g.SetAngularDamping(0.6);a.body=g;a.world=this.world;c.body=g;c.body.h=b;c.body.w=e};d.prototype.deleted=function(){};d.prototype.process=function(c,a){this.world.Step(a,2,2);for(var b=0;b<c.length;b++){var e=c[b].body.GetPosition();
c[b].transformComponent.transform.translation.y=e.get_y()-c[b].physics2DComponent.offsetY;c[b].transformComponent.transform.translation.x=e.get_x()-c[b].physics2DComponent.offsetX;c[b].transformComponent.setUpdated();c[b].transformComponent.transform.rotation.z=c[b].body.GetAngle();e.get_y()>100&&c[b].body.ApplyForce(new Box2D.b2Vec2(0,-100),c[b].body.GetPosition())}};return d});
define("goo/addons/cannon/components/CannonjsComponent",["goo/entities/components/Component"],function(f){function d(c){this.type="CannonjsComponent";this.settings=c||{};this.mass=c.mass!==void 0?c.mass:0;this.useBounds=c.useBounds!==void 0?c.useBounds:!1;this.linearDamping=c.linearDamping!==void 0?c.linearDamping:0;this.angularDamping=c.angularDamping!==void 0?c.angularDamping:0}d.prototype=Object.create(f.prototype);return d});
define("goo/math/MathUtils",[],function(){function f(){}f.DEG_TO_RAD=Math.PI/180;f.RAD_TO_DEG=180/Math.PI;f.HALF_PI=0.5*Math.PI;f.TWO_PI=2*Math.PI;f.EPSILON=1.0E-7;f.radFromDeg=function(d){return d*f.DEG_TO_RAD};f.degFromRad=function(d){return d*f.RAD_TO_DEG};f.lerp=function(d,c,a){return c===a?c:c+(a-c)*d};f.clamp=function(d,c,a){return c<a?d<c?c:d>a?a:d:d<a?a:d>c?c:d};f.moduloPositive=function(d,c){var a=d%c;a+=a<0?c:0;return a};f.scurve3=function(d){return(-2*d+3)*d*d};f.scurve5=function(d){return((6*
d-15)*d+10)*d*d*d};f.sphericalToCartesian=function(d,c,a,b){var e=d*Math.cos(a);b.x=e*Math.cos(c);b.y=d*Math.sin(a);b.z=e*Math.sin(c)};return f});
define("goo/math/Vector",["goo/math/MathUtils"],function(f){function d(c){this.data=new Float32Array(c||0)}d.prototype.setupAliases=function(c){for(var a=this,b=0;b<c.length;b++)(function(e){for(var g=0;g<c[e].length;g++)Object.defineProperty(a,c[e][g],{get:function(){return this.data[e]},set:function(b){this.data[e]=b}});Object.defineProperty(a,b,{get:function(){return this.data[e]},set:function(b){this.data[e]=b}})})(b)};d.add=function(c,a,b){var c=c.data||c,a=a.data||a,e=c.length;b||(b=new d(e));
if(a.length!==e||b.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<e;g++)b.data[g]=c[g]+a[g];return b};d.prototype.add=function(c){return d.add(this,c,this)};d.sub=function(c,a,b){var c=c.data||c,a=a.data||a,e=c.length;b||(b=new d(e));if(a.length!==e||b.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<e;g++)b.data[g]=c[g]-a[g];return b};d.prototype.sub=function(c){return d.sub(this,
c,this)};d.mul=function(c,a,b){var c=c.data||c,a=a.data||a,e=c.length;b||(b=new d(e));if(a.length!==e||b.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<e;g++)b.data[g]=c[g]*a[g];return b};d.prototype.mul=function(c){return d.mul(this,c,this)};d.div=function(c,a,b){var c=c.data||c,a=a.data||a,e=c.length;b||(b=new d(e));if(a.length!==e||b.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
for(var g=0;g<e;g++)b.data[g]=c[g]/a[g];return b};d.prototype.div=function(c){return d.div(this,c,this)};d.copy=function(c,a){var b=c.data.length;a||(a=new d(b));if(a.data.length!==b)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(c.data);return a};d.prototype.copy=function(c){return d.copy(c,this)};d.dot=function(c,a){var b=c.data||c,e=a.data||a,g=b.length;if(e.length!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
for(var d=0,f=0;f<g;f++)d+=b[f]*e[f];return d};d.prototype.dot=function(c){return d.dot(this,c)};d.apply=function(c,a,b){var e=c.rows,g=c.cols,l=a.data.length;b||(b=new d(e));if(b.data.length!==e||g!==l)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(b===a)return d.copy(d.apply(c,a),b);for(var f=0;f<g;f++)for(var i=f*e,h=0;h<e;h++){for(var j=0,n=0;n<l;n++)j+=c.data[n*c.rows+h]*a.data[n];b.data[i+h]=j}return b};d.prototype.apply=function(c){return d.apply(c,this,
this)};d.equals=function(c,a){var b=c.data.length;if(b!==a.data.length)return!1;for(var e=0;e<b;e++)if(Math.abs(c.data[e]-a.data[e])>f.EPSILON)return!1;return!0};d.prototype.equals=function(c){return d.equals(this,c)};d.distanceSquared=function(c,a){return d.sub(c,a).lengthSquared()};d.prototype.distanceSquared=function(c){return d.sub(this,c).lengthSquared()};d.distance=function(c,a){return d.sub(c,a).length()};d.prototype.distance=function(c){return d.sub(this,c).length()};d.prototype.lengthSquared=
function(){return d.dot(this,this)};d.prototype.length=function(){return Math.sqrt(d.dot(this,this))};d.prototype.invert=function(){for(var c=0;c<this.data.length;c++)this.data[c]=0-this.data[c];return this};d.prototype.normalize=function(){var c=this.length(),a=this.data.length;if(c<f.EPSILON)for(var b=0;b<a;b++)this.data[b]=0;else{c=1/c;for(b=0;b<a;b++)this.data[b]*=c}return this};d.prototype.clone=function(){return d.copy(this)};d.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]===
"object")if(arguments[0]instanceof d)this.copy(arguments[0]);else if(arguments[0].length>1)for(var c=0;c<arguments[0].length;c++)this.data[c]=arguments[0][c];else this.set(arguments[0][0]);else for(c=0;c<arguments.length;c++)this.data[c]=arguments[c];return this};d.prototype.toString=function(){var c="";c+="[";for(var a=0;a<this.data.length;a++)c+=this.data[a],c+=a!==this.data.length-1?", ":"";c+="]";return c};return d});
define("goo/math/Vector3",["goo/math/Vector"],function(f){function d(){f.call(this,3);arguments.length!==0?this.set(arguments):this.setd(0,0,0)}d.prototype=Object.create(f.prototype);d.prototype.setupAliases([["x","u","r"],["y","v","g"],["z","w","b"]]);d.ZERO=new d(0,0,0);d.ONE=new d(1,1,1);d.UNIT_X=new d(1,0,0);d.UNIT_Y=new d(0,1,0);d.UNIT_Z=new d(0,0,1);d.add=function(c,a,b){typeof c==="number"&&(c=[c,c,c]);typeof a==="number"&&(a=[a,a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==3||a.length!==
3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};b.data[0]=c[0]+a[0];b.data[1]=c[1]+a[1];b.data[2]=c[2]+a[2];return b};d.addv=function(c,a,b){b||(b=new d);b.data[0]=c.data[0]+a.data[0];b.data[1]=c.data[1]+a.data[1];b.data[2]=c.data[2]+a.data[2];return b};d.prototype.add=function(c){return d.add(this,c,this)};d.sub=function(c,a,b){typeof c==="number"&&(c=[c,c,c]);typeof a==="number"&&(a=[a,a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==3||a.length!==3)throw{name:"Illegal Arguments",
message:"The arguments are of incompatible sizes."};b.data[0]=c[0]-a[0];b.data[1]=c[1]-a[1];b.data[2]=c[2]-a[2];return b};d.subv=function(c,a,b){b||(b=new d);b.data[0]=c.data[0]-a.data[0];b.data[1]=c.data[1]-a.data[1];b.data[2]=c.data[2]-a.data[2];return b};d.prototype.sub=function(c){return d.sub(this,c,this)};d.mul=function(c,a,b){typeof c==="number"&&(c=[c,c,c]);typeof a==="number"&&(a=[a,a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
b.data[0]=c[0]*a[0];b.data[1]=c[1]*a[1];b.data[2]=c[2]*a[2];return b};d.prototype.mul=function(c){return d.mul(this,c,this)};d.div=function(c,a,b){typeof c==="number"&&(c=[c,c,c]);typeof a==="number"&&(a=[a,a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};b.data[0]=c[0]/a[0];b.data[1]=c[1]/a[1];b.data[2]=c[2]/a[2];return b};d.prototype.div=function(c){return d.div(this,c,this)};d.dot=function(c,
a){typeof c==="number"&&(c=[c,c,c]);typeof a==="number"&&(a=[a,a,a]);var b=c.data||c,e=a.data||a;if(b.length!==3||e.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var g=0;g+=b[0]*e[0];g+=b[1]*e[1];g+=b[2]*e[2];return g};d.prototype.dot=function(c){return d.dot(this,c)};d.cross=function(c,a,b){b||(b=new d);var e=a.data||a;if((c.data||c).length!==3||e.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var e=a.data[0]*
c.data[2]-a.data[2]*c.data[0],g=a.data[1]*c.data[0]-a.data[0]*c.data[1];b.data[0]=a.data[2]*c.data[1]-a.data[1]*c.data[2];b.data[1]=e;b.data[2]=g;return b};d.prototype.cross=function(c){return d.cross(this,c,this)};d.prototype.lerp=function(c,a){this.data[0]=(1-a)*this.data[0]+a*c.data[0];this.data[1]=(1-a)*this.data[1]+a*c.data[1];this.data[2]=(1-a)*this.data[2]+a*c.data[2];return this};d.prototype.setd=function(c,a,b){this.data[0]=c;this.data[1]=a;this.data[2]=b;return this};d.prototype.seta=function(c){this.data[0]=
c[0];this.data[1]=c[1];this.data[2]=c[2];return this};d.prototype.setv=function(c){this.data[0]=c.data[0];this.data[1]=c.data[1];this.data[2]=c.data[2];return this};d.prototype.add_d=function(c,a,b){this.data[0]+=c;this.data[1]+=a;this.data[2]+=b;return this};d.prototype.addv=function(c){this.data[0]+=c.data[0];this.data[1]+=c.data[1];this.data[2]+=c.data[2];return this};d.prototype.mulv=function(c){this.data[0]*=c.data[0];this.data[1]*=c.data[1];this.data[2]*=c.data[2];return this};d.prototype.muld=
function(c,a,b){this.data[0]*=c;this.data[1]*=a;this.data[2]*=b;return this};d.prototype.subv=function(c){this.data[0]-=c.data[0];this.data[1]-=c.data[1];this.data[2]-=c.data[2];return this};d.prototype.sub_d=function(c,a,b){this.data[0]-=c;this.data[1]-=a;this.data[2]-=b;return this};d.prototype.lengthSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]};return d});
define("goo/renderer/bounds/BoundingVolume",["goo/math/Vector3"],function(f){function d(){this.center=new f;this.min=new f(Infinity,Infinity,Infinity);this.max=new f(-Infinity,-Infinity,-Infinity)}d.Outside=0;d.Inside=1;d.Intersects=2;return d});
define("goo/renderer/bounds/BoundingBox",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/math/MathUtils"],function(f,d,c){function a(){d.call(this);this.zExtent=this.yExtent=this.xExtent=1;this._compVect1=new f;this._compVect2=new f;this.vec=new f}a.prototype=Object.create(d.prototype);a.prototype.computeFromPoints=function(b){var e=this.min,a=this.max,c=this.vec;e.setd(Infinity,Infinity,Infinity);a.setd(-Infinity,-Infinity,-Infinity);for(var d,f,h,j=0;j<b.length;j+=3)d=b[j+0],f=b[j+
1],h=b[j+2],e.x=d<e.x?d:e.x,e.y=f<e.y?f:e.y,e.z=h<e.z?h:e.z,a.x=d>a.x?d:a.x,a.y=f>a.y?f:a.y,a.z=h>a.z?h:a.z;c.setv(a).subv(e).div(2);this.xExtent=c.x;this.yExtent=c.y;this.zExtent=c.z;this.center.setv(a).add_d(e).div(2)};a.prototype.computeFromPrimitives=function(b,e,g,c,d){if(!(d-c<=0)){for(var f=this._compVect1.set(Infinity,Infinity,Infinity),h=this._compVect2.set(-Infinity,-Infinity,-Infinity),j=[];c<d;c++)for(var j=b.getPrimitiveVertices(g[c],e,j),n=0;n<j.length;n++)a.checkMinMax(f,h,j[n]);this.center.copy(f.add(h));
this.center.mul(0.5);this.xExtent=h.x-this.center.x;this.yExtent=h.y-this.center.y;this.zExtent=h.z-this.center.z}};a.checkMinMax=function(b,e,a){if(a.x<b.x)b.x=a.x;if(a.x>e.x)e.x=a.x;if(a.y<b.y)b.y=a.y;if(a.y>e.y)e.y=a.y;if(a.z<b.z)b.z=a.z;if(a.z>e.z)e.z=a.z};a.prototype.transform=function(b,e){e===null&&(e=new a);for(var g=[],c=0;c<8;c++)g.push(new f);this.getCorners(g);for(c=0;c<g.length;c++)b.matrix.applyPostPoint(g[c]);for(var d=g[0].x,i=g[0].y,h=g[0].z,j=d,n=i,o=h,c=1;c<g.length;c++)var q=g[c].x,
m=g[c].y,s=g[c].z,d=Math.min(d,q),i=Math.min(i,m),h=Math.min(h,s),j=Math.max(j,q),n=Math.max(n,m),o=Math.max(o,s);g=(j+d)*0.5;i=(n+i)*0.5;h=(o+h)*0.5;e.center.set(g,i,h);e.xExtent=j-g;e.yExtent=n-i;e.zExtent=o-h;return e};a.prototype.getCorners=function(b){if(!b||b.length!==8)for(var b=[],e=0;e<b.length;e++)b.push(new f);b[0].set(this.center.x+this.xExtent,this.center.y+this.yExtent,this.center.z+this.zExtent);b[1].set(this.center.x+this.xExtent,this.center.y+this.yExtent,this.center.z-this.zExtent);
b[2].set(this.center.x+this.xExtent,this.center.y-this.yExtent,this.center.z+this.zExtent);b[3].set(this.center.x+this.xExtent,this.center.y-this.yExtent,this.center.z-this.zExtent);b[4].set(this.center.x-this.xExtent,this.center.y+this.yExtent,this.center.z+this.zExtent);b[5].set(this.center.x-this.xExtent,this.center.y+this.yExtent,this.center.z-this.zExtent);b[6].set(this.center.x-this.xExtent,this.center.y-this.yExtent,this.center.z+this.zExtent);b[7].set(this.center.x-this.xExtent,this.center.y-
this.yExtent,this.center.z-this.zExtent);return b};a.prototype.whichSide=function(b){var e=Math.abs(this.xExtent*b.normal.x)+Math.abs(this.yExtent*b.normal.y)+Math.abs(this.zExtent*b.normal.z),a=b.normal.data,c=this.center.data,b=a[0]*c[0]+a[1]*c[1]+a[2]*c[2]-b.constant;return b<-e?d.Inside:b>e?d.Outside:d.Intersects};a.prototype._pseudoDistance=function(b,e){return b.normal.x*e.x+b.normal.y*e.y+b.normal.z*e.z-b.constant};a.prototype._maxAxis=function(b){return Math.max(Math.abs(b.x),Math.max(Math.abs(b.y),
Math.abs(b.z)))};a.prototype.toString=function(){var b=Math.round(this.center.x*10)/10,e=Math.round(this.center.y*10)/10,a=Math.round(this.center.z*10)/10;return"["+b+","+e+","+a+"] - ["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"};a.prototype.intersectsBoundingBox=function(b){return this.center.x+this.xExtent<b.center.x-b.xExtent||this.center.x-this.xExtent>b.center.x+b.xExtent?!1:this.center.y+this.yExtent<b.center.y-b.yExtent||this.center.y-this.yExtent>b.center.y+b.yExtent?!1:this.center.z+
this.zExtent<b.center.z-b.zExtent||this.center.z-this.zExtent>b.center.z+b.zExtent?!1:!0};a.prototype.testStaticAABBAABB=function(b,e){var a={mtvDistance:1E10,mtvAxis:new f};if(!this.testAxisStatic(f.UNIT_X,this.center.x-this.xExtent,this.center.x+this.xExtent,b.center.x-b.xExtent,b.center.x+b.xExtent,a))return!1;if(!this.testAxisStatic(f.UNIT_Y,this.center.y-this.yExtent,this.center.y+this.yExtent,b.center.y-b.yExtent,b.center.y+b.yExtent,a))return!1;if(!this.testAxisStatic(f.UNIT_Z,this.center.z-
this.zExtent,this.center.z+this.zExtent,b.center.z-b.zExtent,b.center.z+b.zExtent,a))return!1;if(e)e.isIntersecting=!0,e.normal=a.mtvAxis,e.penetration=Math.sqrt(a.mtvDistance)*1.001;return!0};a.prototype.testAxisStatic=function(b,e,a,c,d,i){var h=f.dot(b,b);if(h<1.0E-6)return!0;e=d-e;a-=c;if(e<=0||a<=0)return!1;a=e<a?e:-a;h=(new f).copy(b).mul(a/h);h=f.dot(h,h);if(h<i.mtvDistance)i.mtvDistance=h,i.mtvAxis=b;return!0};a.prototype.intersectsRay=function(b){if(isNaN(this.center.x)||isNaN(this.center.y)||
isNaN(this.center.z))return!1;var e=f.sub(b.origin,this.center,this._compVect1),b=b.direction,g=[0,Infinity],d=this.xExtent;if(d<c.ZERO_TOLERANCE&&d>=0)d=c.ZERO_TOLERANCE;var k=this.yExtent;if(k<c.ZERO_TOLERANCE&&k>=0)k=c.ZERO_TOLERANCE;var i=this.zExtent;if(i<c.ZERO_TOLERANCE&&i>=0)i=c.ZERO_TOLERANCE;return a.clip(b.x,-e.x-d,g)&&a.clip(-b.x,e.x-d,g)&&a.clip(b.y,-e.y-k,g)&&a.clip(-b.y,e.y-k,g)&&a.clip(b.z,-e.z-i,g)&&a.clip(-b.z,e.z-i,g)&&(g[0]!==0||g[1]!==Infinity)?!0:!1};a.prototype.intersectsRayWhere=
function(b){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return null;var e=f.sub(b.origin,this.center,this._compVect1),g=b.direction,d=[0,Infinity],k=this.xExtent;if(k<c.ZERO_TOLERANCE&&k>=0)k=c.ZERO_TOLERANCE;var i=this.yExtent;if(i<c.ZERO_TOLERANCE&&i>=0)i=c.ZERO_TOLERANCE;var h=this.zExtent;if(h<c.ZERO_TOLERANCE&&h>=0)h=c.ZERO_TOLERANCE;if(a.clip(g.x,-e.x-k,d)&&a.clip(-g.x,e.x-k,d)&&a.clip(g.y,-e.y-i,d)&&a.clip(-g.y,e.y-i,d)&&a.clip(g.z,-e.z-h,d)&&a.clip(-g.z,e.z-h,d)&&(d[0]!==
0||d[1]!==Infinity)){if(d[1]>d[0])return e=d,b=[(new f(b.direction)).mul(e[0]).add(b.origin),(new f(b.direction)).mul(e[1]).add(b.origin)],{distances:e,points:b};e=[d[0]];b=[(new f(b.direction)).mul(e[0]).add(b.origin)];return{distances:e,points:b}}return null};a.clip=function(b,e,a){if(b>0){if(e>b*a[1])return!1;e>b*a[0]&&(a[0]=e/b);return!0}else if(b<0){if(e>b*a[0])return!1;e>b*a[1]&&(a[1]=e/b);return!0}else return e<=0};return a});
define("goo/renderer/BufferData",[],function(){return function(f,d){this.data=f;this.target=d;this.glBuffer=null;this._dataUsage="StaticDraw";this._dataNeedsRefresh=!1}});
define("goo/renderer/Util",[],function(){function f(){}f.getByteSize=function(d){switch(d){case "Byte":return 1;case "UnsignedByte":return 1;case "Short":return 2;case "UnsignedShort":return 2;case "Int":return 4;case "HalfFloat":return 2;case "Float":return 4;case "Double":return 8;default:throw"Unknown type: "+d;}};f.checkGLError=function(d){for(var c=d.getError(),a=!1;c!==d.NO_ERROR;){a=!0;if(c===d.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");
else if(c===d.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(c===d.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(c===d.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");
else if(c===d.OUT_OF_MEMORY)throw"There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.";c=d.getError()}if(a)throw"Stopping due to error";};f.isPowerOfTwo=function(d){return(d&d-1)===0};f.nearestPowerOfTwo=function(d){return Math.pow(2,Math.ceil(Math.log(d)/Math.log(2)))};f.clone=function(d){if(d===null||typeof d!=="object")return d;if(d instanceof Uint8Array)return d;if(d instanceof Date){var c=
new Date;c.setTime(d.getTime());return c}if(d instanceof Array){for(var c=[],a=0,b=d.length;a<b;++a)c[a]=f.clone(d[a]);return c}if(d instanceof Object){c={};for(a in d)d.hasOwnProperty(a)&&(c[a]=f.clone(d[a]));return c}throw Error("Unable to copy obj! Its type isn't supported.");};return f});
define("goo/renderer/BufferUtils",[],function(){function f(){}f.createIndexBuffer=function(d,c){var a;if(c<256)a=new Uint8Array(d);else if(c<65536)a=new Uint16Array(d);else throw Error("Maximum number of vertices is 65535. Got: "+c);return a};return f});
define("goo/renderer/MeshData",["goo/renderer/BufferData","goo/renderer/Util","goo/renderer/BufferUtils","goo/math/Vector3"],function(f,d,c,a){function b(e,a,g){this.attributeMap=e;this.vertexCount=a!==void 0?a:0;this.indexCount=g!==void 0?g:0;this.primitiveCounts=[0];this.indexData=this.vertexData=null;this.dataViews={};this.indexLengths=null;this.indexModes=["Triangles"];this.type=b.MESH;this.rebuildData(this.vertexCount,this.indexCount)}function e(e){for(var b={},a=0;a<e.length;a++){var g=e[a];
if(k[g]!==void 0)b[g]=d.clone(k[g]);else throw"No default attribute named: "+g;}return b}var g=window.Uint8ClampedArray;b.MESH=0;b.SKINMESH=1;b.prototype.rebuildData=function(e,b,a){var g={},c=null;if(a){for(var d in this.attributeMap){var f=this.dataViews[d];f&&(g[d]=f)}if(this.indexData)c=this.indexData.data}this.rebuildVertexData(e);this.rebuildIndexData(b);if(a){for(d in this.attributeMap)if(e=g[d])f=this.dataViews[d],f.set(e);c&&this.indexData.data.set(c)}};b.prototype.rebuildVertexData=function(e){if(!isNaN(e))this._vertexCountStore=
this.vertexCount=e;if(this.vertexCount>0){var e=0,b;for(b in this.attributeMap){var a=this.attributeMap[b];e+=d.getByteSize(a.type)*a.count}this.vertexData=new f(new ArrayBuffer(e*this.vertexCount),"ArrayBuffer");this.generateAttributeData()}};b.prototype.rebuildIndexData=function(e){if(e!==void 0)this.indexCount=e;if(this.indexCount>0)e=c.createIndexBuffer(this.indexCount,this.vertexCount),this.indexData=new f(e,"ElementArrayBuffer")};b.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=
!0};b.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1};b.prototype.getPrimitiveCount=function(e){return e>=0&&e<this.primitiveCounts.length?this.primitiveCounts[e]:0};b.prototype.getPrimitiveVertices=function(e,g,c){var d=this.getPrimitiveCount(g);if(e>=d||e<0)throw Error("Invalid primitiveIndex '"+e+"'.  Count is "+d);d=b.getVertexCount(this.indexModes[g]);if(!c||c.length<d)c=[];for(var f=this.getAttributeBuffer(b.POSITION),l=0;l<d;l++){c[l]||(c[l]=new a);
var k=this.getIndexBuffer()?this.getIndexBuffer()[this.getVertexIndex(e,l,g)]:this.getVertexIndex(e,l,g);c[l].x=f[k*3+0];c[l].y=f[k*3+1];c[l].z=f[k*3+2]}return c};b.prototype.getVertexIndex=function(e,a,g){for(var c=0,d=0;d<g;d++)c+=this.indexLengths[d];switch(this.indexModes[g]){case "Triangles":c+=e*3+a;break;case "TriangleStrip":c+=e+a;break;case "TriangleFan":c+=a===0?0:e+a;break;case "Points":c+=e;break;case "Lines":c+=e*2+a;break;case "LineStrip":case "LineLoop":c+=e+a;break;default:return b.logger.warning("unimplemented index mode: "+
this.getIndexMode(0)),-1}return c};b.prototype.getTotalPrimitiveCount=function(){for(var e=0,b=0,a=this.primitiveCounts.length;b<a;b++)e+=this.primitiveCounts[b];return e};b.prototype.updatePrimitiveCounts=function(){var e=this.indexData?this.indexData.data.length:this.vertexCount,a=this.getSectionCount();if(this.primitiveCounts.length!==a)this.primitiveCounts=[];for(var g=0;g<a;g++){var c=b.getPrimitiveCount(this.indexModes[g],this.indexLengths?this.indexLengths[g]:e);this.primitiveCounts[g]=c}};
b.getPrimitiveCount=function(e,b){switch(e){case "Triangles":return b/3;case "TriangleFan":case "TriangleStrip":return b-2;case "Lines":return b/2;case "LineStrip":return b-1;case "LineLoop":return b;case "Points":return b}throw Error("unimplemented index mode: "+e);};b.getVertexCount=function(e){switch(e){case "Triangles":case "TriangleFan":case "TriangleStrip":return 3;case "Lines":case "LineStrip":case "LineLoop":return 2;case "Points":return 1}throw Error("unimplemented index mode: "+e);};var l=
{Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:g,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array,Double:Float64Array};b.prototype.generateAttributeData=function(){var e=this.vertexData.data,b,a=0,g;for(g in this.attributeMap){b=this.attributeMap[g];b.offset=a;var c=this.vertexCount*b.count;a+=c*d.getByteSize(b.type);var f=l[b.type];if(f)b=new f(e,b.offset,c);else throw"Unsupported DataType: "+b.type;this.dataViews[g]=b}};b.prototype.makeInterleavedData=
function(){var e=0,b=0,a;for(a in this.attributeMap){var g=this.attributeMap[a];g.offset=e;e+=g.count*d.getByteSize(g.type)}var c=new f(new ArrayBuffer(e*this.vertexCount),this.vertexData.target);c._dataUsage=this.vertexData._dataUsage;c._dataNeedsRefresh=!0;var l=new DataView(c.data);for(a in this.attributeMap){var k=this.dataViews[a],g=this.attributeMap[a];g.stride=e;for(var b=g.offset,s=g.count,p=d.getByteSize(g.type),g=this.getDataMethod(g.type),g=l[g],t=0;t<this.vertexCount;t++)for(var u=0;u<
s;u++)g.apply(l,[b+e*t+u*p,k[t*s+u],!0])}this.vertexData=c};b.prototype.getDataMethod=function(e){switch(e){case "Byte":return"setInt8";case "UnsignedByte":return"setUInt8";case "Short":return"setInt16";case "UnsignedShort":return"setUInt16";case "Int":return"setInt32";case "HalfFloat":return"setInt16";case "Float":return"setFloat32";case "Double":return"setFloat64"}};b.prototype.getAttributeBuffer=function(e){return this.dataViews[e]};b.prototype.getIndexData=function(){return this.indexData};b.prototype.getIndexBuffer=
function(){return this.indexData!==null?this.indexData.data:null};b.prototype.getIndexLengths=function(){return this.indexLengths};b.prototype.getIndexModes=function(){return this.indexModes};b.prototype.resetVertexCount=function(){this.vertexCount=this.vertexCountStore};b.POSITION="POSITION";b.NORMAL="NORMAL";b.COLOR="COLOR";b.TANGENT="TANGENT";b.TEXCOORD0="TEXCOORD0";b.TEXCOORD1="TEXCOORD1";b.TEXCOORD2="TEXCOORD2";b.TEXCOORD3="TEXCOORD3";b.WEIGHTS="WEIGHTS";b.JOINTIDS="JOINTIDS";b.createAttribute=
function(e,b,a){return{count:e,type:b,stride:0,offset:0,normalized:a!==void 0?a:!1}};var k={POSITION:b.createAttribute(3,"Float"),NORMAL:b.createAttribute(3,"Float"),COLOR:b.createAttribute(4,"Float"),TANGENT:b.createAttribute(4,"Float"),TEXCOORD0:b.createAttribute(2,"Float"),TEXCOORD1:b.createAttribute(2,"Float"),TEXCOORD2:b.createAttribute(2,"Float"),TEXCOORD3:b.createAttribute(2,"Float"),WEIGHTS:b.createAttribute(4,"Float"),JOINTIDS:b.createAttribute(4,"Short")};b.defaultMap=function(b){return b===
void 0?e(Object.keys(k)):e(b)};return b});
define("goo/renderer/bounds/BoundingSphere",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/renderer/MeshData"],function(f,d,c){function a(){d.call(this);this.radius=1;this.vec=new f}a.prototype=Object.create(d.prototype);a.prototype.constructor=a;a.prototype.computeFromPoints=function(b){var e=this.min,a=this.max,c=this.vec;e.setd(Infinity,Infinity,Infinity);a.setd(-Infinity,-Infinity,-Infinity);for(var d,f,h,j=0;j<b.length;j+=3)d=b[j+0],f=b[j+1],h=b[j+2],e.x=d<e.x?d:e.x,e.y=f<e.y?
f:e.y,e.z=h<e.z?h:e.z,a.x=d>a.x?d:a.x,a.y=f>a.y?f:a.y,a.z=h>a.z?h:a.z;e=a.addv(e).div(2);for(j=a=0;j<b.length;j+=3)c.setd(b[j],b[j+1],b[j+2]),d=c.subv(e).lengthSquared(),d>a&&(a=d);this.radius=Math.sqrt(a);this.center.setv(e)};a.prototype.computeFromPrimitives=function(b,e,a,d,k){if(!(k-d<=0)){for(var i=[],h=[],j=c.getVertexCount(b.indexModes[e]),n=0;d<k;d++)for(var h=b.getPrimitiveVertices(a[d],e,h),o=0;o<j;o++)i[n++]=(new f).set(h[o]);this.averagePoints(i)}};a.prototype.averagePoints=function(b){this.center.set(b[0]);
for(var e=1;e<b.length;e++)this.center.add(b[e]);this.center.mul(1/b.length);for(var a=0,e=0;e<b.length;e++){var c=f.sub(b[e],this.center,this.vec).lengthSquared();c>a&&(a=c)}this.radius=Math.sqrt(a)+1.0E-5};a.prototype.transform=function(b,e){e===null&&(e=new a);b.applyForward(this.center,e.center);e.radius=Math.abs(this._maxAxis(b.scale)*this.radius);return e};a.prototype.whichSide=function(b){var e=b.normal.data,a=this.center.data,b=e[0]*a[0]+e[1]*a[1]+e[2]*a[2]-b.constant;return b<-this.radius?
d.Inside:b>this.radius?d.Outside:d.Intersects};a.prototype._pseudoDistance=function(b,e){return b.normal.x*e.x+b.normal.y*e.y+b.normal.z*e.z-b.constant};a.prototype._maxAxis=function(b){return Math.max(Math.abs(b.x),Math.max(Math.abs(b.y),Math.abs(b.z)))};a.prototype.toString=function(){var b=Math.round(this.center.x*10)/10,e=Math.round(this.center.y*10)/10,a=Math.round(this.center.z*10)/10,c=Math.round(this.radius*10)/10;return"["+b+","+e+","+a+"] - "+c};a.prototype.intersectsRay=function(b){if(!this.center)return!1;
var e=(new f).copy(b.origin).sub(this.center),a=e.dot(e)-this.radius*this.radius;if(a<=0)return!0;b=b.direction.dot(e);return b>=0?!1:b*b>=a};a.prototype.intersectsRayWhere=function(b){var e=(new f).copy(b.origin).sub(this.center),a=e.dot(e)-this.radius*this.radius;if(a<=0)return e=b.direction.dot(e),a=Math.sqrt(e*e-a),e=[a-e],b=[(new f).copy(b.direction).mul(e[0]).add(b.origin)],{distances:e,points:b};e=b.direction.dot(e);if(e>=0)return null;a=e*e-a;if(a<0)return null;else if(a>=1.0E-5)return a=
Math.sqrt(a),e=[-e-a,-e+a],b=[(new f).copy(b.direction).mul(e[0]).add(b.origin),(new f).copy(b.direction).mul(e[1]).add(b.origin)],{distances:e,points:b};e=[-e];b=[(new f).copy(b.direction).mul(e[0]).add(b.origin)];return{distances:e,points:b}};return a});
define("goo/math/Matrix",["goo/math/MathUtils"],function(f){function d(c,a){this.rows=c||0;this.cols=a||0;this.data=new Float32Array(this.rows*this.cols)}d.prototype.setupAliases=function(c){for(var a=this,b=0;b<c.length;b++)(function(e){for(var g=0;g<c[e].length;g++)Object.defineProperty(a,c[e][g],{get:function(){return this.data[e]},set:function(b){this.data[e]=b}});Object.defineProperty(a,b,{get:function(){return this.data[e]},set:function(b){this.data[e]=b}})})(b)};d.add=function(c,a,b){var e=
c.rows,g=c.cols;b||(b=new d(e,g));if(a instanceof d){if(a.rows!==e||a.cols!==g||b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<c.data.length;e++)b.data[e]=c.data[e]+a.data[e]}else{if(b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<c.data.length;e++)b.data[e]=c.data[e]+a}return b};d.prototype.add=function(c){return d.add(this,c,this)};d.sub=function(c,a,b){var e=
c.rows,g=c.cols;b||(b=new d(e,g));if(a instanceof d){if(a.rows!==e||a.cols!==g||b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<c.data.length;e++)b.data[e]=c.data[e]-a.data[e]}else{if(b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<c.data.length;e++)b.data[e]=c.data[e]-a}return b};d.prototype.sub=function(c){return d.sub(this,c,this)};d.mul=function(c,a,b){var e=
c.rows,g=c.cols;b||(b=new d(e,g));if(a instanceof d){if(a.rows!==e||a.cols!==g||b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<c.data.length;e++)b.data[e]=c.data[e]*a.data[e]}else{if(b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<c.data.length;e++)b.data[e]=c.data[e]*a}return b};d.prototype.mul=function(c){return d.mul(this,c,this)};d.div=function(c,a,b){var e=
c.rows,g=c.cols;b||(b=new d(e,g));if(a instanceof d){if(a.rows!==e||a.cols!==g||b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<c.data.length;e++)b.data[e]=c.data[e]/a.data[e]}else{if(b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a=1/a;for(e=0;e<c.data.length;e++)b.data[e]=c.data[e]*a}return b};d.prototype.div=function(c){return d.div(this,c,this)};d.combine=function(c,a,
b){var e=c.rows,g=a.cols,f=c.cols=a.rows;b||(b=new d(e,g));if(c.cols!==f||a.rows!==f||b.rows!==e||b.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(b===c||b===a)return d.copy(d.combine(c,a),b);for(var k=0;k<g;k++)for(var i=k*e,h=0;h<e;h++){for(var j=0,n=0;n<f;n++)j+=c.data[n*c.rows+h]*a.data[k*a.rows+n];b.data[i+h]=j}return b};d.prototype.combine=function(c){return d.combine(this,c,this)};d.transpose=function(c,a){var b=c.cols,e=c.rows;a||(a=new d(b,
e));if(a.rows!==b||a.cols!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(a===c)return d.copy(d.transpose(c),a);for(var g=0;g<e;g++)for(var f=g*b,k=0;k<b;k++)a.data[f+k]=c.data[k*e+g];return a};d.prototype.transpose=function(){return d.transpose(this,this)};d.copy=function(c,a){var b=c.rows,e=c.cols;a||(a=new d(b,e));if(a.rows!==b||a.cols!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(c.data);return a};d.prototype.copy=
function(c){return d.copy(c,this)};d.equals=function(c,a){if(c.rows!==a.rows||c.cols!==a.cols)return!1;for(var b=0;b<c.data.length;b++)if(Math.abs(c.data[b]-a.data[b])>f.EPSILON)return!1;return!0};d.prototype.equals=function(c){return d.equals(this,c)};d.prototype.isOrthogonal=function(){for(var c=0;c<this.cols;c++)for(var a=c+1;a<this.cols;a++){for(var b=c*this.rows,e=a*this.rows,g=0,d=0;d<this.rows;d++)g+=this.data[b+d]*this.data[e+d];if(Math.abs(g)>f.EPSILON)return!1}return!0};d.prototype.isNormal=
function(){for(var c=0;c<this.cols;c++){for(var a=c*this.rows,b=0,e=0;e<this.rows;e++)b+=this.data[a+e]*this.data[a+e];if(Math.abs(b-1)>f.EPSILON)return!1}return!0};d.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};d.prototype.clone=function(){return d.copy(this)};d.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]==="object")if(arguments[0]instanceof d)this.copy(arguments[0]);else for(var c=0;c<arguments[0].length;c++)this.data[c]=arguments[0][c];
else for(c=0;c<arguments.length;c++)this.data[c]=arguments[c];return this};d.prototype.toString=function(){for(var c="",a=0;a<this.cols;a++){var b=a*this.rows;c+="[";for(var e=0;e<this.rows;e++)c+=this.data[b+e],c+=e!==this.rows-1?", ":"";c+=a!==this.cols-1?"], ":"]"}return c};return d});
define("goo/math/Matrix3x3",["goo/math/MathUtils","goo/math/Matrix","goo/math/Vector3"],function(f,d,c){function a(){d.call(this,3,3);arguments.length===0?this.setIdentity():this.set(arguments)}a.prototype=Object.create(d.prototype);a.prototype.setupAliases([["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]);a.IDENTITY=new a(1,0,0,0,1,0,0,0,1);a.add=function(b,e,c){c||(c=new a);e instanceof a?(c.e00=b.e00+e.e00,c.e10=b.e10+e.e10,c.e20=b.e20+e.e20,c.e01=b.e01+e.e01,c.e11=b.e11+
e.e11,c.e21=b.e21+e.e21,c.e02=b.e02+e.e02,c.e12=b.e12+e.e12,c.e22=b.e22+e.e22):(c.e00=b.e00+e,c.e10=b.e10+e,c.e20=b.e20+e,c.e01=b.e01+e,c.e11=b.e11+e,c.e21=b.e21+e,c.e02=b.e02+e,c.e12=b.e12+e,c.e22=b.e22+e);return c};a.prototype.add=function(b){return a.add(this,b,this)};a.sub=function(b,e,c){c||(c=new a);e instanceof a?(c.e00=b.e00-e.e00,c.e10=b.e10-e.e10,c.e20=b.e20-e.e20,c.e01=b.e01-e.e01,c.e11=b.e11-e.e11,c.e21=b.e21-e.e21,c.e02=b.e02-e.e02,c.e12=b.e12-e.e12,c.e22=b.e22-e.e22):(c.e00=b.e00-e,
c.e10=b.e10-e,c.e20=b.e20-e,c.e01=b.e01-e,c.e11=b.e11-e,c.e21=b.e21-e,c.e02=b.e02-e,c.e12=b.e12-e,c.e22=b.e22-e);return c};a.prototype.sub=function(b){return a.sub(this,b,this)};a.mul=function(b,e,c){c||(c=new a);e instanceof a?(c.e00=b.e00*e.e00,c.e10=b.e10*e.e10,c.e20=b.e20*e.e20,c.e01=b.e01*e.e01,c.e11=b.e11*e.e11,c.e21=b.e21*e.e21,c.e02=b.e02*e.e02,c.e12=b.e12*e.e12,c.e22=b.e22*e.e22):(c.e00=b.e00*e,c.e10=b.e10*e,c.e20=b.e20*e,c.e01=b.e01*e,c.e11=b.e11*e,c.e21=b.e21*e,c.e02=b.e02*e,c.e12=b.e12*
e,c.e22=b.e22*e);return c};a.prototype.mul=function(b){return a.mul(this,b,this)};a.div=function(b,e,c){c||(c=new a);e instanceof a?(c.e00=b.e00/e.e00,c.e10=b.e10/e.e10,c.e20=b.e20/e.e20,c.e01=b.e01/e.e01,c.e11=b.e11/e.e11,c.e21=b.e21/e.e21,c.e02=b.e02/e.e02,c.e12=b.e12/e.e12,c.e22=b.e22/e.e22):(e=1/e,c.e00=b.e00*e,c.e10=b.e10*e,c.e20=b.e20*e,c.e01=b.e01*e,c.e11=b.e11*e,c.e21=b.e21*e,c.e02=b.e02*e,c.e12=b.e12*e,c.e22=b.e22*e);return c};a.prototype.div=function(b){return a.div(this,b,this)};a.combine=
function(b,e,c){c||(c=new a);var d=b.data,b=d[0],f=d[3],i=d[6],h=d[1],j=d[4],n=d[7],o=d[2],q=d[5],d=d[8],m=e.data,e=m[0],s=m[3],p=m[6],t=m[1],u=m[4],w=m[7],r=m[2],v=m[5],m=m[8],z=c.data;z[0]=b*e+f*t+i*r;z[3]=b*s+f*u+i*v;z[6]=b*p+f*w+i*m;z[1]=h*e+j*t+n*r;z[4]=h*s+j*u+n*v;z[7]=h*p+j*w+n*m;z[2]=o*e+q*t+d*r;z[5]=o*s+q*u+d*v;z[8]=o*p+q*w+d*m;return c};a.prototype.combine=function(b){return a.combine(this,b,this)};a.transpose=function(b,e){e||(e=new a);var c=b.data,d=e.data;if(e===b){var f=c[3],i=c[6],
h=c[7];d[3]=c[1];d[6]=c[2];d[7]=c[5];d[1]=f;d[2]=i;d[5]=h;return e}d[0]=c[0];d[1]=c[3];d[2]=c[6];d[3]=c[1];d[4]=c[4];d[5]=c[7];d[6]=c[2];d[7]=c[5];d[8]=c[8];return e};a.prototype.transpose=function(){return a.transpose(this,this)};a.invert=function(b,e){e||(e=new a);if(e===b)return d.copy(a.invert(b),e);var c=b.determinant();if(Math.abs(c)<f.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};c=1/c;e.e00=(b.e11*b.e22-b.e12*b.e21)*c;e.e10=(b.e12*b.e20-b.e10*
b.e22)*c;e.e20=(b.e10*b.e21-b.e11*b.e20)*c;e.e01=(b.e02*b.e21-b.e01*b.e22)*c;e.e11=(b.e00*b.e22-b.e02*b.e20)*c;e.e21=(b.e01*b.e20-b.e00*b.e21)*c;e.e02=(b.e01*b.e12-b.e02*b.e11)*c;e.e12=(b.e02*b.e10-b.e00*b.e12)*c;e.e22=(b.e00*b.e11-b.e01*b.e10)*c;return e};a.prototype.invert=function(){return a.invert(this,this)};a.prototype.isOrthogonal=function(){var b;b=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21;if(Math.abs(b)>f.EPSILON)return!1;b=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22;
if(Math.abs(b)>f.EPSILON)return!1;b=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22;return Math.abs(b)>f.EPSILON?!1:!0};a.prototype.isNormal=function(){var b;b=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20;if(Math.abs(b-1)>f.EPSILON)return!1;b=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21;if(Math.abs(b-1)>f.EPSILON)return!1;b=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22;return Math.abs(b-1)>f.EPSILON?!1:!0};a.prototype.isOrthonormal=function(){return this.isOrthogonal()&&
this.isNormal()};a.prototype.determinant=function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)};a.prototype.setIdentity=function(){var b=this.data;b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return this};a.prototype.applyPost=function(b){var e=b.data,a=this.data,c=e[0],d=e[1],f=e[2];e[0]=a[0]*c+a[3]*d+a[6]*f;e[1]=a[1]*c+a[4]*d+a[7]*f;e[2]=a[2]*c+a[5]*d+a[8]*f;return b};a.prototype.applyPre=
function(b){var e=b.x,a=b.y,c=b.z;b.x=this.e00*e+this.e10*a+this.e20*c;b.y=this.e01*e+this.e11*a+this.e21*c;b.z=this.e02*e+this.e12*a+this.e22*c;return b};a.prototype.multiplyDiagonalPost=function(b,e){var a=b.data[0],c=b.data[1],d=b.data[2],f=this.data,h=e.data;h[0]=a*f[0];h[1]=a*f[1];h[2]=a*f[2];h[3]=c*f[3];h[4]=c*f[4];h[5]=c*f[5];h[6]=d*f[6];h[7]=d*f[7];h[8]=d*f[8];return e};a.prototype.fromAngles=function(b,e,a){var c=Math.cos(b),b=Math.sin(b),d=Math.cos(e),e=Math.sin(e),f=Math.cos(a),a=Math.sin(a);
this.e00=d*f;this.e01=e*b-d*a*c;this.e02=d*a*b+e*c;this.e10=a;this.e11=f*c;this.e12=-f*b;this.e20=-e*f;this.e21=e*a*c+d*b;this.e22=-e*a*b+d*c;return this};a.prototype.rotateX=function(a,e){var c=this.data,d=(e||this).data,f=Math.sin(a),i=Math.cos(a),h=c[3],j=c[4],n=c[5],o=c[6],q=c[7],m=c[8];c!==d&&(d[0]=c[0],d[1]=c[1],d[2]=c[2]);d[3]=h*i+o*f;d[4]=j*i+q*f;d[5]=n*i+m*f;d[6]=o*i-h*f;d[7]=q*i-j*f;d[8]=m*i-n*f;return d};a.prototype.rotateY=function(a,e){var c=this.data,d=(e||this).data,f=Math.sin(a),i=
Math.cos(a),h=c[0],j=c[1],n=c[2],o=c[6],q=c[7],m=c[8];c!==d&&(d[3]=c[3],d[4]=c[4],d[5]=c[5]);d[0]=h*i-o*f;d[1]=j*i-q*f;d[2]=n*i-m*f;d[6]=h*f+o*i;d[7]=j*f+q*i;d[8]=n*f+m*i;return d};a.prototype.rotateZ=function(a,e){var c=this.data,d=(e||this).data,f=Math.sin(a),i=Math.cos(a),h=c[0],j=c[1],n=c[2],o=c[3],q=c[4],m=c[5];c!==d&&(d[6]=c[6],d[7]=c[7],d[8]=c[8]);d[0]=h*i+o*f;d[1]=j*i+q*f;d[2]=n*i+m*f;d[3]=o*i-h*f;d[4]=q*i-j*f;d[5]=m*i-n*f;return d};a.prototype.toAngles=function(a){a||(a=new c);var e=this.data;
e[3]>1-f.EPSILON?(a.y=Math.atan2(e[2],e[8]),a.z=Math.PI/2,a.x=0):e[3]<-1+f.EPSILON?(a.y=Math.atan2(e[2],e[8]),a.z=-Math.PI/2,a.x=0):(a.y=Math.atan2(-e[2],e[0]),a.x=Math.atan2(-e[7],e[4]),a.z=Math.asin(e[1]));return a};a.prototype.fromAngleNormalAxis=function(a,e,c,d){var f=Math.cos(a),i=Math.sin(a),a=1-f,h=e*c*a,j=e*d*a,n=c*d*a,o=e*i,q=c*i;i*=d;this.e00=e*e*a+f;this.e01=h-i;this.e02=j+q;this.e10=h+i;this.e11=c*c*a+f;this.e12=n-o;this.e20=j-q;this.e21=n+o;this.e22=d*d*a+f;return this};a.prototype.lookAt=
function(a,e){var g=new c,d=new c,f=new c;f.copy(a).normalize();g.copy(e).normalize().cross(f).normalize();g.equals(c.ZERO)&&(f.x!==0?g.set(f.y,-f.x,0):g.set(0,f.z,-f.y));d.copy(f).cross(g).normalize();this.e00=g.x;this.e10=g.y;this.e20=g.z;this.e01=d.x;this.e11=d.y;this.e21=d.z;this.e02=f.x;this.e12=f.y;this.e22=f.z;return this};a.prototype.copyQuaternion=function(a){return a.toRotationMatrix(this)};a.prototype.copy=function(a){var e=this.data,a=a.data;e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=a[3];e[4]=
a[4];e[5]=a[5];e[6]=a[6];e[7]=a[7];e[8]=a[8];return this};a.prototype.clone=function(){var b=this.data;return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[4],b[5],b[6])};return a});
define("goo/math/Quaternion",["goo/math/Vector","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(f,d,c,a){function b(){f.call(this,4);arguments.length!==0?this.set(arguments):this.setd(0,0,0,1)}b.prototype=Object.create(f.prototype);b.prototype.setupAliases([["x"],["y"],["z"],["w"]]);b.IDENTITY=new b(0,0,0,1);b.ALLOWED_DEVIANCE=1.0E-8;b.add=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]+c.data[0];d.data[1]=a.data[1]+c.data[1];d.data[2]=a.data[2]+c.data[2];d.data[3]=a.data[3]+
c.data[3];return d};b.sub=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]-c.data[0];d.data[1]=a.data[1]-c.data[1];d.data[2]=a.data[2]-c.data[2];d.data[3]=a.data[3]-c.data[3];return d};b.mul=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]*c.data[0];d.data[1]=a.data[1]*c.data[1];d.data[2]=a.data[2]*c.data[2];d.data[3]=a.data[3]*c.data[3];return d};b.div=function(a,c,d){d||(d=new b);var f=!0;d.data[0]=(f&=c.data[0]<0||c.data[0]>0)?a.data[0]/c.data[0]:0;d.data[1]=(f&=c.data[1]<0||c.data[1]>0)?a.data[1]/
c.data[1]:0;d.data[2]=(f&=c.data[2]<0||c.data[2]>0)?a.data[2]/c.data[2]:0;d.data[3]=(f&=c.data[3]<0||c.data[3]>0)?a.data[3]/c.data[3]:0;f===!1&&console.warn("[Quaternion.div] Attempted to divide by zero!");return d};b.scalarAdd=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]+c;d.data[1]=a.data[1]+c;d.data[2]=a.data[2]+c;d.data[3]=a.data[3]+c;return d};b.scalarSub=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]-c;d.data[1]=a.data[1]-c;d.data[2]=a.data[2]-c;d.data[3]=a.data[3]-c;return d};b.scalarMul=
function(a,c,d){d||(d=new b);d.data[0]=a.data[0]*c;d.data[1]=a.data[1]*c;d.data[2]=a.data[2]*c;d.data[3]=a.data[3]*c;return d};b.scalarDiv=function(a,c,d){d||(d=new b);var f=!0,c=(f&=c<0||c>0)?1/c:0;d.data[0]=a.data[0]*c;d.data[1]=a.data[1]*c;d.data[2]=a.data[2]*c;d.data[3]=a.data[3]*c;f===!1&&console.warn("[Quaternion.scalarDiv] Attempted to divide by zero!");return d};b.slerp=function(a,b,c,d){if(c===0)return d.setv(a);else if(c===1)return d.setv(b);if(a.equals(b))return d.setv(a);var f=a.dot(b);
d.setv(b);f<0&&(d.negate(),f=-f);var b=1-c,h=c;1-f>0.1&&(f=Math.acos(f),h=1/Math.sin(f),b=Math.sin((1-c)*f)*h,h*=Math.sin(c*f));d.setd(b*a.data[0]+h*d.data[0],b*a.data[1]+h*d.data[1],b*a.data[2]+h*d.data[2],b*a.data[3]+h*d.data[3]);return d};b.prototype.negate=function(){this.x*=-1;this.y*=-1;this.z*=-1;this.w*=-1;return this};b.prototype.add=function(a){return b.add(this,a,this)};b.prototype.sub=function(a){return b.sub(this,a,this)};b.prototype.mul=function(a){return b.mul(this,a,this)};b.prototype.div=
function(a){return b.div(this,a,this)};b.prototype.scalarAdd=function(a){return b.scalarAdd(this,a,this)};b.prototype.scalarSub=function(a){return b.scalarSub(this,a,this)};b.prototype.scalarMul=function(a){return b.scalarMul(this,a,this)};b.prototype.scalarDiv=function(a){return b.scalarDiv(this,a,this)};b.prototype.slerp=function(a,c){var d=(new b).copy(a);b.slerp(this,a,c,d);this.copy(d);return this};b.prototype.fromRotationMatrix=function(a){var b=a.e00+a.e11+a.e22,c,d,f;if(b>=0){var h=Math.sqrt(b+
1);f=0.5*h;h=0.5/h;b=(a.e21-a.e12)*h;c=(a.e02-a.e20)*h;d=(a.e10-a.e01)*h}else a.e00>a.e11&&a.e00>a.e22?(h=Math.sqrt(1+a.e00-a.e11-a.e22),b=h*0.5,h=0.5/h,c=(a.e10+a.e01)*h,d=(a.e02+a.e20)*h,f=(a.e21-a.e12)*h):a.e11>a.e22?(h=Math.sqrt(1+a.e11-a.e00-a.e22),c=h*0.5,h=0.5/h,b=(a.e10+a.e01)*h,d=(a.e21+a.e12)*h,f=(a.e02-a.e20)*h):(h=Math.sqrt(1+a.e22-a.e00-a.e11),d=h*0.5,h=0.5/h,b=(a.e02+a.e20)*h,c=(a.e21+a.e12)*h,f=(a.e10-a.e01)*h);return this.set(b,c,d,f)};b.prototype.toRotationMatrix=function(a){a||(a=
new c);var b=this.magnitudeSquared(),b=b>0?2/b:0,d=this.data,f=d[0]*b,i=d[1]*b,h=d[2]*b,b=d[0]*f,j=d[0]*i,n=d[0]*h;f*=d[3];var o=d[1]*i,q=d[1]*h;i*=d[3];var m=d[2]*h,d=d[3]*h,h=a.data;h[0]=1-(o+m);h[1]=j+d;h[2]=n-i;h[3]=j-d;h[4]=1-(b+m);h[5]=q+f;h[6]=n+i;h[7]=q-f;h[8]=1-(b+o);return a};b.prototype.fromVectorToVector=function(e,c){var f=e.length()*c.length();if(Math.abs(f)>a.EPSILON){var k=new d,i=e.dot(c)/f,f=Math.acos(Math.max(-1,Math.min(i,1)));e.cross(c,k);i<0&&k.length()<a.EPSILON&&(i=Math.abs(e.x)>
Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?0:2:Math.abs(e.y)>Math.abs(e.z)?1:2,k.setValue(i,-e[(i+1)%3]),k.setValue((i+1)%3,e[i]),k.setValue((i+2)%3,0));return this.fromAngleAxis(f,k)}else return this.set(b.IDENTITY)};b.prototype.normalize=function(){var a=1/this.magnitude();return this.set(this.x*a,this.y*a,this.z*a,this.w*a)};b.prototype.magnitude=function(){var a=this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3];return a===1?1:Math.sqrt(a)};
b.prototype.magnitudeSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3]};b.prototype.fromAngleAxis=function(a,b){var c=(new d(b)).normalize();return this.fromAngleNormalAxis(a,c)};b.prototype.fromAngleNormalAxis=function(e,c){if(c.equals(d.ZERO))return this.set(b.IDENTITY);var f=0.5*e,k=a.sin(f),f=a.cos(f),i=k*c.getX(),h=k*c.getY();k*=c.getZ();return this.set(i,h,k,f)};b.prototype.toAngleAxis=function(a){var c=this.x*this.x+
this.y*this.y+this.z*this.z,d;if(Math.abs(c)<=b.ALLOWED_DEVIANCE){if(d=0,a!==null)a.x=1,a.y=0,a.z=0}else if(d=2*Math.acos(this.w),a!==null)c=1/Math.sqrt(c),a.x=this.x*c,a.y=this.y*c,a.z=this.z*c;return d};b.prototype.equals=function(a){return this===a?!0:!a instanceof b?!1:Math.abs(this.data[0]-a.data[0])<b.ALLOWED_DEVIANCE&&Math.abs(this.data[1]-a.data[1])<b.ALLOWED_DEVIANCE&&Math.abs(this.data[2]-a.data[2])<b.ALLOWED_DEVIANCE&&Math.abs(this.data[3]-a.data[3])<b.ALLOWED_DEVIANCE};b.prototype.setd=
function(a,b,c,d){this.data[0]=a;this.data[1]=b;this.data[2]=c;this.data[3]=d;return this};b.prototype.seta=function(a){this.data[0]=a[0];this.data[1]=a[1];this.data[2]=a[2];this.data[3]=a[3];return this};b.prototype.setv=function(a){this.data[0]=a.data[0];this.data[1]=a.data[1];this.data[2]=a.data[2];this.data[3]=a.data[3];return this};return b});
define("goo/shapes/Box",["goo/renderer/MeshData"],function(f){function d(c,a,b,e,d){this.xExtent=c!==void 0?c*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=b!==void 0?b*0.5:0.5;this.tileX=e||1;this.tileY=d||1;c=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]);f.call(this,c,24,36);this.rebuild()}d.prototype=Object.create(f.prototype);d.prototype.rebuild=function(){var c=this.xExtent,a=this.yExtent,b=this.zExtent,e=this.tileX,d=this.tileY,l=[-c,-a,-b,c,-a,-b,c,a,-b,-c,a,-b,c,-a,b,-c,-a,b,c,
a,b,-c,a,b],k=[];(function(a){for(var b=0;b<a.length;b++){var e=a[b]*3;k.push(l[e]);k.push(l[e+1]);k.push(l[e+2])}})([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]);this.getAttributeBuffer(f.POSITION).set(k);var i=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],h=[];(function(){for(var a=0;a<i.length/3;a++)for(var b=0;b<4;b++){var e=a*3;h.push(i[e]);h.push(i[e+1]);h.push(i[e+2])}})();this.getAttributeBuffer(f.NORMAL).set(h);c=[];for(a=0;a<6;a++)c.push(e),c.push(0),c.push(0),c.push(0),c.push(0),c.push(d),
c.push(e),c.push(d);this.getAttributeBuffer(f.TEXCOORD0).set(c);this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]);return this};return d});
define("goo/shapes/Quad",["goo/renderer/MeshData"],function(f){function d(c,a,b,e){this.xExtent=c!==void 0?c*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.tileX=b||1;this.tileY=e||1;c=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]);f.call(this,c,4,6);this.rebuild()}d.prototype=Object.create(f.prototype);d.prototype.rebuild=function(){var c=this.xExtent,a=this.yExtent,b=this.tileX,e=this.tileY;this.getAttributeBuffer(f.POSITION).set([-c,-a,0,-c,a,0,c,a,0,c,-a,0]);this.getAttributeBuffer(f.NORMAL).set([0,
0,1,0,0,1,0,0,1,0,0,1]);this.getAttributeBuffer(f.TEXCOORD0).set([0,0,0,e,b,e,b,0]);this.getIndexBuffer().set([0,3,1,1,3,2]);return this};return d});
define("goo/util/Enum",[],function(){function f(a,b){Object.getOwnPropertyNames(b).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(b,e))});return a}function d(a,b){this.name=a;b&&f(this,b);Object.freeze(this)}function c(a){arguments.length===1&&a!==null&&typeof a==="object"?Object.keys(a).forEach(function(b){this[b]=new d(b,a[b])},this):Array.prototype.forEach.call(arguments,function(a){this[a]=new d(a)},this);Object.freeze(this)}d.prototype=Object.create(null);d.prototype.constructor=
d;d.prototype.toString=function(){return"|"+this.name+"|"};Object.freeze(d.prototype);c.prototype.symbols=function(){return Object.keys(this).map(function(a){return this[a]},this)};c.prototype.contains=function(a){return!a instanceof d?!1:this[a.name]===a};return c});
define("goo/shapes/Sphere",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(f,d,c,a){function b(a,e,c,d){this.zSamples=a!==void 0?a:8;this.radialSamples=e!==void 0?e:8;this.radius=c!==void 0?c:0.5;this.textureMode=d!==void 0?d:b.TextureModes.Polar;this.viewInside=!1;a=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]);f.call(this,a,(this.zSamples-2)*(this.radialSamples+1)+2,6*(this.zSamples-2)*this.radialSamples);this.rebuild()}function e(a,b,e){a[e*3+0]=a[b*
3+0];a[e*3+1]=a[b*3+1];a[e*3+2]=a[b*3+2]}b.prototype=Object.create(f.prototype);b.prototype.rebuild=function(){for(var d=this.getAttributeBuffer(f.POSITION),l=this.getAttributeBuffer(f.NORMAL),k=this.getAttributeBuffer(f.TEXCOORD0),i=this.getIndexBuffer(),h=1/this.radialSamples,j=2/this.zSamples,n=[],o=[],q=0;q<this.radialSamples;q++){var m=a.TWO_PI*h*q;o[q]=Math.cos(m);n[q]=Math.sin(m)}n[this.radialSamples]=n[0];o[this.radialSamples]=o[0];for(var m=0,s=new c,p=new c,t=new c,u=1;u<this.zSamples-1;u++){var w=
a.HALF_PI*(-1+j*u),r=Math.sin(w),q=this.radius*r,v=p.set(0,0,0);v.z+=q;for(var z=Math.sqrt(Math.abs(this.radius*this.radius-q*q)),y,A=m,q=0;q<this.radialSamples;q++){var x=q*h;y=t.set(o[q],n[q],0);c.mul(y,z,s);d[m*3+0]=v.x+s.x;d[m*3+1]=v.y+s.y;d[m*3+2]=v.z+s.z;y=s.set(d[m*3+0],d[m*3+1],d[m*3+2]);y.normalize();this.viewInside?(l[m*3+0]=-y.x,l[m*3+1]=-y.y,l[m*3+2]=-y.z):(l[m*3+0]=y.x,l[m*3+1]=y.y,l[m*3+2]=y.z);this.textureMode===b.TextureModes.Linear?(k[m*2+0]=x,k[m*2+1]=0.5*(r+1)):this.textureMode===
b.TextureModes.Projected?(k[m*2+0]=x,k[m*2+1]=a.HALF_PI+Math.asin(r)/Math.PI):this.textureMode===b.TextureModes.Polar&&(x=(a.HALF_PI-Math.abs(w))/Math.PI,y=x*n[q]+0.5,k[m*2+0]=x*o[q]+0.5,k[m*2+1]=y);m++}e(d,A,m);e(l,A,m);this.textureMode===b.TextureModes.Linear?(k[m*2+0]=1,k[m*2+1]=0.5*(r+1)):this.textureMode===b.TextureModes.Projected?(k[m*2+0]=1,k[m*2+1]=a.INV_PI*(a.HALF_PI+Math.asin(r))):this.textureMode===b.TextureModes.Polar&&(x=(a.HALF_PI-Math.abs(w))/Math.PI,k[m*2+0]=x+0.5,k[m*2+1]=0.5);m++}d[m*
3+0]=0;d[m*3+1]=0;d[m*3+2]=-this.radius;this.viewInside?(l[m*3+0]=0,l[m*3+1]=0,l[m*3+2]=1):(l[m*3+0]=0,l[m*3+1]=0,l[m*3+2]=-1);this.textureMode===b.TextureModes.Polar?(k[m*2+0]=0.5,k[m*2+1]=0.5):(k[m*2+0]=0.5,k[m*2+1]=0);m++;d[m*3+0]=0;d[m*3+1]=0;d[m*3+2]=this.radius;this.viewInside?(l[m*3+0]=0,l[m*3+1]=0,l[m*3+2]=-1):(l[m*3+0]=0,l[m*3+1]=0,l[m*3+2]=1);this.textureMode===b.TextureModes.Polar?(k[m*2+0]=0.5,k[m*2+1]=0.5):(k[m*2+0]=0.5,k[m*2+1]=1);for(l=u=d=0;u<this.zSamples-3;u++){k=l;h=k+1;l+=this.radialSamples+
1;j=l;n=j+1;for(m=0;m<this.radialSamples;m++)this.viewInside?(i[d++]=k++,i[d++]=j,i[d++]=h,i[d++]=h++,i[d++]=j++,i[d++]=n++):(i[d++]=k++,i[d++]=h,i[d++]=j,i[d++]=h++,i[d++]=n++,i[d++]=j++)}for(m=0;m<this.radialSamples;m++)this.viewInside?(i[d++]=m,i[d++]=m+1,i[d++]=this.vertexCount-2):(i[d++]=m,i[d++]=this.vertexCount-2,i[d++]=m+1);u=(this.zSamples-3)*(this.radialSamples+1);for(m=0;m<this.radialSamples;m++)this.viewInside?(i[d++]=m+u,i[d++]=this.vertexCount-1,i[d++]=m+1+u):(i[d++]=m+u,i[d++]=m+1+
u,i[d++]=this.vertexCount-1);return this};b.TextureModes=new d("Linear","Projected","Polar");return b});
define("goo/addons/cannon/systems/CannonjsSystem","goo/entities/systems/System,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/math/Quaternion,goo/shapes/Box,goo/shapes/Quad,goo/shapes/Sphere,goo/renderer/MeshData".split(","),function(f,d,c,a,b,e,g,l){function k(b){f.call(this,"CannonjsSystem",["CannonjsComponent","TransformComponent"]);var b=b||{},e=this.world=new i.World;e.gravity.y=-9.82;e.broadphase=new i.NaiveBroadphase;this.stepFrequency=b.stepFrequency||60;this.quat=
new a}var i=window.CANNON;k.prototype=Object.create(f.prototype);k.prototype.createShape=function(a){var f=a.cannonjsComponent,k=a.transformComponent,o;if(a.meshDataComponent)if(a=a.meshDataComponent,f.useBounds)a.computeBoundFromPoints(),f=a.modelBound,f instanceof d?o=new i.Box(new i.Vec3(f.xExtent,f.yExtent,f.zExtent)):f instanceof c&&(o=new i.Sphere(f.radius));else if(o=a.meshData,o instanceof b)o=new i.Box(new i.Vec3(o.xExtent,o.yExtent,o.zExtent));else if(o instanceof g)o=new i.Sphere(o.radius);
else if(o instanceof e)o=new i.Plane;else{for(var a=[],k=[],q=o.getAttributeBuffer(l.POSITION),m=o.getIndexBuffer(),f=0;f<o.vertexCount*3;f+=3)a.push(new i.Vec3(q[f],q[f+1],q[f+2]));for(f=0;f<o.indexCount;f+=3)k.push([m[f],m[f+1],m[f+2]]);o=new i.ConvexPolyhedron(a,k)}else{a=k.children;for(f=0;f<a.length;f++)if(m=a[f].entity,k=this.createShape(m))o||(o=new i.Compound),q=m.transformComponent.transform.translation,m=m.transformComponent.transform.rotation,q=new i.Vec3(q.x,q.y,q.z),this.quat.fromRotationMatrix(m),
m=new i.Quaternion(this.quat.x,this.quat.y,this.quat.z,this.quat.w),o.addChild(k,q,m)}return o};k.prototype.inserted=function(a){var b=a.cannonjsComponent,e=a.transformComponent,c=this.createShape(a);c?(a=new i.RigidBody(b.mass,c),a.position.set(e.transform.translation.x,e.transform.translation.y,e.transform.translation.z),this.quat.fromRotationMatrix(e.transform.rotation),a.quaternion.set(this.quat.x,this.quat.y,this.quat.z,this.quat.w),b.body=a,this.world.add(a)):a.clearComponent("CannonjsComponent")};
k.prototype.deleted=function(a){(a=a.cannonjsComponent)&&this.world.remove(a.body)};k.prototype.process=function(a){this.world.step(1/this.stepFrequency);for(var b=0;b<a.length;b++){var e=a[b],c=e.cannonjsComponent,d=c.body.position;e.transformComponent.transform.translation.x=d.x;e.transformComponent.transform.translation.y=d.y;e.transformComponent.transform.translation.z=d.z;c=c.body.quaternion;this.quat.set(c.x,c.y,c.z,c.w);e.transformComponent.transform.rotation.copyQuaternion(this.quat);e.transformComponent.setUpdated()}};
return k});define("goo/addons/soundmanager2/components/SoundManager2Component",["goo/entities/components/Component"],function(f){function d(c){this.type="SoundManager2Component";this.settings=c||{};this.sounds={}}d.prototype=Object.create(f.prototype);d.prototype.addSound=function(c,a){this.sounds[c]=a};d.prototype.playSound=function(c){this.sounds[c].soundObject.play()};return d});
define("goo/addons/soundmanager2/systems/SoundManager2System",["goo/entities/systems/System"],function(f){function d(){f.call(this,"SoundManager2System",["SoundManager2Component","TransformComponent"]);this.isReady=!1;window.soundManager?window.soundManager.bind(this).setup({url:"swf",onready:function(){this.isReady=!0},ontimeout:function(){console.warn("Failed to load soundmanager")}}):console.warn("SoundManager2System: soundManager global not found")}d.prototype=Object.create(f.prototype);d.prototype.inserted=
function(c){for(var c=c.soundManager2Component,a=0;a<c.sounds.length;a++){var b=c.sounds[a],e=window.soundManager.createSound(b);b.soundObject=e}};d.prototype.deleted=function(){};d.prototype.process=function(){};return d});
define("goo/entities/components/MeshDataComponent",["goo/renderer/bounds/BoundingSphere","goo/entities/components/Component"],function(f,d){function c(a){this.type="MeshDataComponent";this.meshData=a;this.modelBound=new f;this.autoCompute=!0}c.prototype=Object.create(d.prototype);c.prototype.setModelBound=function(a,b){this.modelBound=a;this.autoCompute=b};c.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&this.modelBound!==null){var a=this.meshData.getAttributeBuffer("POSITION");
if(a!==void 0)this.modelBound.computeFromPoints(a),this.autoCompute=!1}};return c});define("goo/entities/components/MeshRendererComponent",["goo/entities/components/Component"],function(f){function d(){this.type="MeshRendererComponent";this.materials=[];this.worldBound=null;this.cullMode="Dynamic";this.receiveShadows=this.castShadows=!1}d.prototype=Object.create(f.prototype);d.prototype.updateBounds=function(c,a){this.worldBound=c.transform(a,this.worldBound)};return d});
define("goo/renderer/ShaderCall",[],function(){function f(a,b,e){this.context=a;this.location=b;if(e)switch(e){case "float":this.typeCall=this.uniform1f;break;case "bool":case "int":case "integer":case "sampler2D":case "sampler3D":case "samplerCube":this.typeCall=this.uniform1i;break;case "floatarray":this.typeCall=this.uniform1fv;break;case "intarray":this.typeCall=this.uniform1iv;break;case "vec2":this.typeCall=this.uniform2fv;break;case "vec3":this.typeCall=this.uniform3fv;break;case "vec4":this.typeCall=
this.uniform4fv;break;case "mat2":this.typeCall=this.uniformMatrix2fv;break;case "mat3":this.typeCall=this.uniformMatrix3fv;break;case "mat4":this.typeCall=this.uniformMatrix4fv;break;default:throw"Uniform type not handled: "+e;}}function d(a,b,e){for(e-=1;e>=0;e--)if(a[e]!==b[e])return!1;return!0}function c(a,b){var e=a.length;if(e!==b.length)return!1;for(var c=0;c<e;c++)if(a[c]!==b[c])return!1;return!0}f.prototype.call=function(a){this.typeCall(a)};f.prototype.uniform1f=function(a){if(this.location.value!==
a)this.context.uniform1f(this.location,a),this.location.value=a};f.prototype.uniform1fv=function(a){var b=this.location.value;if(!(b!==void 0&&c(a,b)))this.context.uniform1fv(this.location,a),this.location.value=a.slice()};f.prototype.uniform1i=function(a){if(this.location.value!==a)this.context.uniform1i(this.location,a),this.location.value=a};f.prototype.uniform1iv=function(a){var b=this.location.value;if(!(b!==void 0&&c(a,b)))this.context.uniform1iv(this.location,a),this.location.value=a.slice()};
f.prototype.uniform2f=function(a,b){var e=this.location.value;if(!(e!==void 0&&e.length===2&&e[0]===a&&e[1]===b))this.context.uniform2f(this.location,a,b),this.location.value=[a,b]};f.prototype.uniform2fv=function(a){var b=this.location.value;if(!(b!==void 0&&c(a,b)))this.context.uniform2fv(this.location,a),this.location.value=a.slice()};f.prototype.uniform2i=function(a,b){var e=this.location.value;if(!(e!==void 0&&e.length===2&&e[0]===a&&e[1]===b))this.context.uniform2i(this.location,a,b),this.location.value=
[a,b]};f.prototype.uniform2iv=function(a){var b=this.location.value;if(!(b!==void 0&&c(a,b)))this.context.uniform2iv(this.location,a),this.location.value=a.slice()};f.prototype.uniform3f=function(a,b,e){var c=this.location.value;if(!(c!==void 0&&c.length===3&&c[0]===a&&c[1]===b&&c[2]===e))this.context.uniform3f(this.location,a,b,e),this.location.value=[a,b,e]};f.prototype.uniform3fv=function(a){var b=this.location.value;if(!(b!==void 0&&c(a,b)))this.context.uniform3fv(this.location,a),this.location.value=
a.slice()};f.prototype.uniform3i=function(a,b,e){var c=this.location.value;if(!(c!==void 0&&c.length===3&&c[0]===a&&c[1]===b&&c[2]===e))this.context.uniform3i(this.location,a,b,e),this.location.value=[a,b,e]};f.prototype.uniform3iv=function(a){var b=this.location.value;if(!(b!==void 0&&c(a,b)))this.context.uniform3iv(this.location,a),this.location.value=a.slice()};f.prototype.uniform4f=function(a,b,e,c){var d=this.location.value;if(!(d!==void 0&&d.length===4&&d[0]===a&&d[1]===b&&d[2]===e&&d[3]===
c))this.context.uniform4f(this.location,a,b,e,c),this.location.value=[a,b,e,c]};f.prototype.uniform4fv=function(a){var b=this.location.value;if(!(b!==void 0&&c(a,b)))this.context.uniform4fv(this.location,a),this.location.value=a.slice()};f.prototype.uniform4i=function(a,b,e,c){var d=this.location.value;if(!(d!==void 0&&d.length===4&&d[0]===a&&d[1]===b&&d[2]===e&&d[3]===c))this.context.uniform4i(this.location,a,b,e,c),this.location.value=[a,b,e,c]};f.prototype.uniform4iv=function(a){var b=this.location.value;
if(!(b!==void 0&&c(a,b)))this.context.uniform4iv(this.location,a),this.location.value=a.slice()};f.prototype.uniformMatrix2fv=function(a,b){b=b===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(d(e.data,a.data,4))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix2fv(this.location,b,a.data)}else this.context.uniformMatrix2fv(this.location,b,a)};f.prototype.uniformMatrix3fv=function(a,b){b=b===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(d(e.data,
a.data,9))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix3fv(this.location,b,a.data)}else this.context.uniformMatrix3fv(this.location,b,a)};f.prototype.uniformMatrix4fv=function(a,b){b=b===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(d(e.data,a.data,16))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix4fv(this.location,b,a.data)}else this.context.uniformMatrix4fv(this.location,b,a)};return f});
define("goo/math/Matrix4x4",["goo/math/MathUtils","goo/math/Matrix"],function(f,d){function c(){d.call(this,4,4);arguments.length===0?this.setIdentity():this.set(arguments)}c.prototype=Object.create(d.prototype);c.prototype.setupAliases([["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]);c.IDENTITY=new c(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);c.add=function(a,b,e){e||(e=new c);b instanceof c?(e.e00=a.e00+b.e00,e.e10=a.e10+b.e10,
e.e20=a.e20+b.e20,e.e30=a.e30+b.e30,e.e01=a.e01+b.e01,e.e11=a.e11+b.e11,e.e21=a.e21+b.e21,e.e31=a.e31+b.e31,e.e02=a.e02+b.e02,e.e12=a.e12+b.e12,e.e22=a.e22+b.e22,e.e32=a.e32+b.e32,e.e03=a.e03+b.e03,e.e13=a.e13+b.e13,e.e23=a.e23+b.e23,e.e33=a.e33+b.e33):(e.e00=a.e00+b,e.e10=a.e10+b,e.e20=a.e20+b,e.e30=a.e30+b,e.e01=a.e01+b,e.e11=a.e11+b,e.e21=a.e21+b,e.e31=a.e31+b,e.e02=a.e02+b,e.e12=a.e12+b,e.e22=a.e22+b,e.e32=a.e32+b,e.e03=a.e03+b,e.e13=a.e13+b,e.e23=a.e23+b,e.e33=a.e33+b);return e};c.prototype.add=
function(a){return c.add(this,a,this)};c.sub=function(a,b,e){e||(e=new c);b instanceof c?(e.e00=a.e00-b.e00,e.e10=a.e10-b.e10,e.e20=a.e20-b.e20,e.e30=a.e30-b.e30,e.e01=a.e01-b.e01,e.e11=a.e11-b.e11,e.e21=a.e21-b.e21,e.e31=a.e31-b.e31,e.e02=a.e02-b.e02,e.e12=a.e12-b.e12,e.e22=a.e22-b.e22,e.e32=a.e32-b.e32,e.e03=a.e03-b.e03,e.e13=a.e13-b.e13,e.e23=a.e23-b.e23,e.e33=a.e33-b.e33):(e.e00=a.e00-b,e.e10=a.e10-b,e.e20=a.e20-b,e.e30=a.e30-b,e.e01=a.e01-b,e.e11=a.e11-b,e.e21=a.e21-b,e.e31=a.e31-b,e.e02=a.e02-
b,e.e12=a.e12-b,e.e22=a.e22-b,e.e32=a.e32-b,e.e03=a.e03-b,e.e13=a.e13-b,e.e23=a.e23-b,e.e33=a.e33-b);return e};c.prototype.sub=function(a){return c.sub(this,a,this)};c.mul=function(a,b,e){e||(e=new c);b instanceof c?(e.e00=a.e00*b.e00,e.e10=a.e10*b.e10,e.e20=a.e20*b.e20,e.e30=a.e30*b.e30,e.e01=a.e01*b.e01,e.e11=a.e11*b.e11,e.e21=a.e21*b.e21,e.e31=a.e31*b.e31,e.e02=a.e02*b.e02,e.e12=a.e12*b.e12,e.e22=a.e22*b.e22,e.e32=a.e32*b.e32,e.e03=a.e03*b.e03,e.e13=a.e13*b.e13,e.e23=a.e23*b.e23,e.e33=a.e33*b.e33):
(e.e00=a.e00*b,e.e10=a.e10*b,e.e20=a.e20*b,e.e30=a.e30*b,e.e01=a.e01*b,e.e11=a.e11*b,e.e21=a.e21*b,e.e31=a.e31*b,e.e02=a.e02*b,e.e12=a.e12*b,e.e22=a.e22*b,e.e32=a.e32*b,e.e03=a.e03*b,e.e13=a.e13*b,e.e23=a.e23*b,e.e33=a.e33*b);return e};c.prototype.mul=function(a){return c.mul(this,a,this)};c.div=function(a,b,e){e||(e=new c);b instanceof c?(e.e00=a.e00/b.e00,e.e10=a.e10/b.e10,e.e20=a.e20/b.e20,e.e30=a.e30/b.e30,e.e01=a.e01/b.e01,e.e11=a.e11/b.e11,e.e21=a.e21/b.e21,e.e31=a.e31/b.e31,e.e02=a.e02/b.e02,
e.e12=a.e12/b.e12,e.e22=a.e22/b.e22,e.e32=a.e32/b.e32,e.e03=a.e03/b.e03,e.e13=a.e13/b.e13,e.e23=a.e23/b.e23,e.e33=a.e33/b.e33):(b=1/b,e.e00=a.e00*b,e.e10=a.e10*b,e.e20=a.e20*b,e.e30=a.e30*b,e.e01=a.e01*b,e.e11=a.e11*b,e.e21=a.e21*b,e.e31=a.e31*b,e.e02=a.e02*b,e.e12=a.e12*b,e.e22=a.e22*b,e.e32=a.e32*b,e.e03=a.e03*b,e.e13=a.e13*b,e.e23=a.e23*b,e.e33=a.e33*b);return e};c.prototype.div=function(a){return c.div(this,a,this)};c.combine=function(a,b,e){e||(e=new c);var d=a.data,a=d[0],f=d[4],k=d[8],i=d[12],
h=d[1],j=d[5],n=d[9],o=d[13],q=d[2],m=d[6],s=d[10],p=d[14],t=d[3],u=d[7],w=d[11],d=d[15],r=b.data,b=r[0],v=r[4],z=r[8],y=r[12],A=r[1],x=r[5],D=r[9],E=r[13],C=r[2],F=r[6],G=r[10],H=r[14],I=r[3],J=r[7],K=r[11],r=r[15],B=e.data;B[0]=a*b+f*A+k*C+i*I;B[4]=a*v+f*x+k*F+i*J;B[8]=a*z+f*D+k*G+i*K;B[12]=a*y+f*E+k*H+i*r;B[1]=h*b+j*A+n*C+o*I;B[5]=h*v+j*x+n*F+o*J;B[9]=h*z+j*D+n*G+o*K;B[13]=h*y+j*E+n*H+o*r;B[2]=q*b+m*A+s*C+p*I;B[6]=q*v+m*x+s*F+p*J;B[10]=q*z+m*D+s*G+p*K;B[14]=q*y+m*E+s*H+p*r;B[3]=t*b+u*A+w*C+d*I;
B[7]=t*v+u*x+w*F+d*J;B[11]=t*z+u*D+w*G+d*K;B[15]=t*y+u*E+w*H+d*r;return e};c.prototype.combine=function(a){return c.combine(this,a,this)};c.transpose=function(a,b){b||(b=new c);var e=a.data,d=b.data;if(b===a){var f=e[4],k=e[8],i=e[12],h=e[9],j=e[13],n=e[14];d[4]=e[1];d[8]=e[2];d[12]=e[3];d[9]=e[6];d[13]=e[7];d[14]=e[11];d[1]=f;d[2]=k;d[3]=i;d[6]=h;d[7]=j;d[11]=n;return b}d[0]=e[0];d[1]=e[4];d[2]=e[8];d[3]=e[12];d[4]=e[1];d[5]=e[5];d[6]=e[9];d[7]=e[13];d[8]=e[2];d[9]=e[6];d[10]=e[10];d[11]=e[14];d[12]=
e[3];d[13]=e[7];d[14]=e[11];d[15]=e[15];return b};c.prototype.transpose=function(){return c.transpose(this,this)};c.invert=function(a,b){b||(b=new c);if(b===a)return d.copy(c.invert(a),b);var e=a.determinant();if(Math.abs(e)<f.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};var g=a.data,l=b.data,e=1/e;l[0]=(g[5]*(g[10]*g[15]-g[14]*g[11])-g[9]*(g[6]*g[15]-g[14]*g[7])+g[13]*(g[6]*g[11]-g[10]*g[7]))*e;l[1]=(g[1]*(g[14]*g[11]-g[10]*g[15])-g[9]*(g[14]*g[3]-
g[2]*g[15])+g[13]*(g[10]*g[3]-g[2]*g[11]))*e;l[2]=(g[1]*(g[6]*g[15]-g[14]*g[7])-g[5]*(g[2]*g[15]-g[14]*g[3])+g[13]*(g[2]*g[7]-g[6]*g[3]))*e;l[3]=(g[1]*(g[10]*g[7]-g[6]*g[11])-g[5]*(g[10]*g[3]-g[2]*g[11])+g[9]*(g[6]*g[3]-g[2]*g[7]))*e;l[4]=(g[4]*(g[14]*g[11]-g[10]*g[15])-g[8]*(g[14]*g[7]-g[6]*g[15])+g[12]*(g[10]*g[7]-g[6]*g[11]))*e;l[5]=(g[0]*(g[10]*g[15]-g[14]*g[11])-g[8]*(g[2]*g[15]-g[14]*g[3])+g[12]*(g[2]*g[11]-g[10]*g[3]))*e;l[6]=(g[0]*(g[14]*g[7]-g[6]*g[15])-g[4]*(g[14]*g[3]-g[2]*g[15])+g[12]*
(g[6]*g[3]-g[2]*g[7]))*e;l[7]=(g[0]*(g[6]*g[11]-g[10]*g[7])-g[4]*(g[2]*g[11]-g[10]*g[3])+g[8]*(g[2]*g[7]-g[6]*g[3]))*e;l[8]=(g[4]*(g[9]*g[15]-g[13]*g[11])-g[8]*(g[5]*g[15]-g[13]*g[7])+g[12]*(g[5]*g[11]-g[9]*g[7]))*e;l[9]=(g[0]*(g[13]*g[11]-g[9]*g[15])-g[8]*(g[13]*g[3]-g[1]*g[15])+g[12]*(g[9]*g[3]-g[1]*g[11]))*e;l[10]=(g[0]*(g[5]*g[15]-g[13]*g[7])-g[4]*(g[1]*g[15]-g[13]*g[3])+g[12]*(g[1]*g[7]-g[5]*g[3]))*e;l[11]=(g[0]*(g[9]*g[7]-g[5]*g[11])-g[4]*(g[9]*g[3]-g[1]*g[11])+g[8]*(g[5]*g[3]-g[1]*g[7]))*e;
l[12]=(g[4]*(g[13]*g[10]-g[9]*g[14])-g[8]*(g[13]*g[6]-g[5]*g[14])+g[12]*(g[9]*g[6]-g[5]*g[10]))*e;l[13]=(g[0]*(g[9]*g[14]-g[13]*g[10])-g[8]*(g[1]*g[14]-g[13]*g[2])+g[12]*(g[1]*g[10]-g[9]*g[2]))*e;l[14]=(g[0]*(g[13]*g[6]-g[5]*g[14])-g[4]*(g[13]*g[2]-g[1]*g[14])+g[12]*(g[5]*g[2]-g[1]*g[6]))*e;l[15]=(g[0]*(g[5]*g[10]-g[9]*g[6])-g[4]*(g[1]*g[10]-g[9]*g[2])+g[8]*(g[1]*g[6]-g[5]*g[2]))*e;return b};c.prototype.invert=function(){return c.invert(this,this)};c.prototype.isOrthogonal=function(){var a;a=this.e00*
this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31;if(Math.abs(a)>f.EPSILON)return!1;a=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32;if(Math.abs(a)>f.EPSILON)return!1;a=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33;if(Math.abs(a)>f.EPSILON)return!1;a=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32;if(Math.abs(a)>f.EPSILON)return!1;a=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33;if(Math.abs(a)>
f.EPSILON)return!1;a=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33;return Math.abs(a)>f.EPSILON?!1:!0};c.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30;if(Math.abs(a-1)>f.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31;if(Math.abs(a-1)>f.EPSILON)return!1;a=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32;if(Math.abs(a-1)>f.EPSILON)return!1;a=this.e03*
this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33;return Math.abs(a-1)>f.EPSILON?!1:!0};c.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};c.prototype.determinant=function(){var a=this.data;return a[0]*(a[5]*a[10]*a[15]+a[9]*a[14]*a[7]+a[13]*a[6]*a[11]-a[13]*a[10]*a[7]-a[9]*a[6]*a[15]-a[5]*a[14]*a[11])-a[4]*(a[1]*a[10]*a[15]+a[9]*a[14]*a[3]+a[13]*a[2]*a[11]-a[13]*a[10]*a[3]-a[9]*a[2]*a[15]-a[1]*a[14]*a[11])+a[8]*(a[1]*a[6]*a[15]+a[5]*a[14]*a[3]+a[13]*a[2]*
a[7]-a[13]*a[6]*a[3]-a[5]*a[2]*a[15]-a[1]*a[14]*a[7])-a[12]*(a[1]*a[6]*a[11]+a[5]*a[10]*a[3]+a[9]*a[2]*a[7]-a[9]*a[6]*a[3]-a[5]*a[2]*a[11]-a[1]*a[10]*a[7])};c.prototype.setIdentity=function(){var a=this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this};c.prototype.setRotationFromVector=function(a){var b=Math.sin(a.x),e=Math.cos(a.x),c=Math.sin(a.y),d=Math.cos(a.y),f=Math.sin(a.z),a=Math.cos(a.z);this.e00=a*d;this.e10=
f*d;this.e20=0-c;this.e01=a*c*b-f*e;this.e11=f*c*b+a*e;this.e21=d*b;this.e02=a*c*e+f*b;this.e12=f*c*e-a*b;this.e22=d*e;return this};c.prototype.setRotationFromQuaternion=function(a){var b=a.lengthSquared(),b=b>0?2/b:0,e=a.x*b,c=a.y*b,d=a.z*b,b=a.w*e,f=a.w*c,i=a.w*d;e*=a.x;var h=a.x*c,j=a.x*d;c*=a.y;var n=a.y*d,a=a.z*d;this.e00=1-c-a;this.e10=h+i;this.e20=j-f;this.e01=h-i;this.e11=1-e-a;this.e21=n+b;this.e02=j+f;this.e12=n-b;this.e22=1-e-c;return this};c.prototype.setTranslation=function(a){this.e03=
a.x;this.e13=a.y;this.e23=a.z;return this};c.prototype.getTranslation=function(a){a.x=this.e03;a.y=this.e13;a.z=this.e23;return this};c.prototype.setScale=function(a){this.e00*=a.x;this.e10*=a.y;this.e20*=a.z;this.e01*=a.x;this.e11*=a.y;this.e21*=a.z;this.e02*=a.x;this.e12*=a.y;this.e22*=a.z;return this};c.prototype.applyPre=function(a){var b=a.data[0],e=a.data[1],c=a.data[2],d=a.data[3],f=this.data;a.data[0]=f[0]*b+f[1]*e+f[2]*c+f[3]*d;a.data[1]=f[4]*b+f[5]*e+f[6]*c+f[7]*d;a.data[2]=f[8]*b+f[9]*
e+f[10]*c+f[11]*d;a.data[3]=f[12]*b+f[13]*e+f[14]*c+f[15]*d;return a};c.prototype.applyPost=function(a){var b=a.data[0],e=a.data[1],c=a.data[2],d=a.data[3],f=this.data;a.data[0]=f[0]*b+f[4]*e+f[8]*c+f[12]*d;a.data[1]=f[1]*b+f[5]*e+f[9]*c+f[13]*d;a.data[2]=f[2]*b+f[6]*e+f[10]*c+f[14]*d;a.data[3]=f[3]*b+f[7]*e+f[11]*c+f[15]*d;return a};c.prototype.applyPostPoint=function(a){var b=a.data[0],e=a.data[1],c=a.data[2],d=this.data;a.data[0]=d[0]*b+d[4]*e+d[8]*c+d[12];a.data[1]=d[1]*b+d[5]*e+d[9]*c+d[13];
a.data[2]=d[2]*b+d[6]*e+d[10]*c+d[14];return a};c.prototype.applyPostVector=function(a){var b=a.x,e=a.y,c=a.z,d=this.data;a.x=d[0]*b+d[4]*e+d[8]*c;a.y=d[1]*b+d[5]*e+d[9]*c;a.z=d[2]*b+d[6]*e+d[10]*c;a.x=this.e00*b+this.e01*e+this.e02*c;a.y=this.e10*b+this.e11*e+this.e12*c;a.z=this.e20*b+this.e21*e+this.e22*c;return a};c.prototype.copy=function(a){var b=this.data,a=a.data;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=
a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};c.prototype.clone=function(){var a=this.data;return new c(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])};return c});
define("goo/entities/Entity",[],function(){function f(c,a){this._world=c;this._components=[];Object.defineProperty(this,"id",{value:f.entityCount++,writable:!1});this.name=a!==void 0?a:"Entity_"+this.id}function d(c){return c.charAt(0).toLowerCase()+c.substr(1)}f.prototype.addToWorld=function(){this._world.addEntity(this)};f.prototype.removeFromWorld=function(){this._world.removeEntity(this)};f.prototype.setComponent=function(c){var a=this._components.indexOf(c);a===-1?this._components.push(c):this._components[a]=
c;this[d(c.type)]=c;if(c.type==="TransformComponent")c.entity=this;this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,c,"addedComponent")};f.prototype.getComponent=function(c){return this[d(c)]};f.prototype.clearComponent=function(c){var a=this[d(c)],b=this._components.indexOf(a);if(b!==-1){a=this._components[b];if(a.type==="TransformComponent")a.entity=void 0;this._components.splice(b,1)}delete this[d(c)];this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,
a,"removedComponent")};f.prototype.toString=function(){return this.name};f.entityCount=0;return f});
define("goo/entities/managers/EntityManager",[],function(){function f(){this.type="EntityManager";this._entities=[]}f.prototype.added=function(d){this._entities.indexOf(d)===-1&&this._entities.push(d)};f.prototype.removed=function(d){d=this._entities.indexOf(d);d!==-1&&this._entities.splice(d,1)};f.prototype.containsEntity=function(d){return this._entities.indexOf(d)!==-1};f.prototype.getEntityById=function(d){for(var c=0,a=this._entities.length;c<a;c++){var b=this._entities[c];if(b.id===d)return b}};
f.prototype.getEntityByName=function(d){for(var c=0,a=this._entities.length;c<a;c++){var b=this._entities[c];if(b.name===d)return b}};f.prototype.getEntities=function(){return this._entities};f.prototype.getTopEntities=function(){for(var d=[],c=0;c<this._entities.length;c++){var a=this._entities[c];a.transformComponent?a.transformComponent.parent||d.push(a):d.push(a)}return d};return f});
define("goo/math/Transform",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/Matrix4x4"],function(f,d,c){function a(){this.matrix=new c;this.translation=new f;this.rotation=new d;this.scale=new f(1,1,1);this.tmpVec=new f;this.tmpMat1=new d;this.tmpMat2=new d}a.prototype.multiply=function(a,e){c.combine(a.matrix,e.matrix,this.matrix);this.tmpMat1.data.set(a.rotation.data);this.tmpMat1.multiplyDiagonalPost(a.scale,this.tmpMat1);this.tmpMat2.data.set(e.rotation.data);this.tmpMat2.multiplyDiagonalPost(e.scale,
this.tmpMat2);d.combine(this.tmpMat1,this.tmpMat2,this.rotation);this.translation.setv(e.translation);this.tmpMat1.applyPost(this.translation).addv(a.translation);this.scale.setv(a.scale).mulv(e.scale)};a.prototype.setIdentity=function(){this.matrix.setIdentity();this.translation.setv(f.ZERO);this.rotation.setIdentity();this.scale.setv(f.ONE)};a.prototype.applyForward=function(a,e){e.setv(a);this.matrix.applyPostPoint(e);return e};a.prototype.applyForwardVector=function(a,e){e.copy(a);e.set(e.x*this.scale.x,
e.y*this.scale.y,e.z*this.scale.z);this.rotation.applyPost(e);return e};a.prototype.update=function(){var a=this.matrix.data,e=this.rotation.data,c=this.scale.data,d=this.translation.data;a[0]=c[0]*e[0];a[1]=c[0]*e[1];a[2]=c[0]*e[2];a[3]=0;a[4]=c[1]*e[3];a[5]=c[1]*e[4];a[6]=c[1]*e[5];a[7]=0;a[8]=c[2]*e[6];a[9]=c[2]*e[7];a[10]=c[2]*e[8];a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1};a.prototype.copy=function(a){this.matrix.copy(a.matrix);this.translation.setv(a.translation);this.rotation.copy(a.rotation);
this.scale.setv(a.scale)};a.prototype.setRotationXYZ=function(a,e,c){this.rotation.fromAngles(a,e,c)};a.prototype.lookAt=function(a,e){this.tmpVec.copy(this.translation).sub(a).normalize();this.rotation.lookAt(this.tmpVec,e)};a.prototype.invert=function(b){b||(b=new a);b.matrix.copy(this.matrix);b.matrix.invert();var e=b.rotation.copy(this.rotation);e.multiplyDiagonalPost(this.scale,e).invert();b.translation.copy(this.translation);b.rotation.applyPost(b.translation).invert();return b};a.prototype.toString=
function(){return""+this.matrix};return a});
define("goo/entities/components/TransformComponent",["goo/math/Transform","goo/entities/components/Component"],function(f,d){function c(){this.type="TransformComponent";this.parent=null;this.children=[];this.transform=new f;this.worldTransform=new f;this._dirty=!0;this._updated=!1}c.prototype=Object.create(d.prototype);c.prototype.setUpdated=function(){this._dirty=!0};c.prototype.attachChild=function(a){for(var b=this;b;){if(b===a){console.warn("attachChild: An object can't be added as a descendant of itself.");return}b=
b.parent}a.parent&&a.parent.detachChild(a);a.parent=this;this.children.push(a)};c.prototype.detachChild=function(a){if(a===this)console.warn("attachChild: An object can't be removed from itself.");else{var b=this.children.indexOf(a);if(b!==-1)a.parent=null,this.children.splice(b,1)}};c.prototype.updateTransform=function(){this.transform.update()};c.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform);
this._dirty=!1;this._updated=!0};return c});
define("goo/entities/World",["goo/entities/Entity","goo/entities/managers/EntityManager","goo/entities/components/TransformComponent"],function(f,d,c){function a(){this._managers=[];this._systems=[];this._addedEntities=[];this._changedEntities=[];this._removedEntities=[];this.entityManager=new d;this.setManager(this.entityManager);this.time=0;this.tpf=1}a.time=0;a.prototype.setManager=function(a){this._managers.push(a)};a.prototype.getManager=function(a){for(var e=0;e<this._managers.length;e++){var c=
this._managers[e];if(c.type===a)return c}};a.prototype.setSystem=function(a){this._systems.push(a)};a.prototype.getSystem=function(a){for(var e=0;e<this._systems.length;e++){var c=this._systems[e];if(c.type===a)return c}};a.prototype.createEntity=function(a){a=new f(this,a);a.setComponent(new c);return a};a.prototype.getEntities=function(){return this.entityManager.getEntities()};a.prototype.addEntity=function(a){this._addedEntities.push(a)};a.prototype.removeEntity=function(a){this._removedEntities.push(a)};
a.prototype.changedEntity=function(a,e,c){a={entity:a};if(e!==void 0)a.component=e;if(c!==void 0)a.eventType=c;this._changedEntities.push(a)};a.prototype.process=function(){this._check(this._addedEntities,function(a,b){a.added&&a.added(b);if(a.addedComponent)for(var e=0;e<b._components.length;e++)a.addedComponent(b,b._components[e])});this._check(this._changedEntities,function(a,b){a.changed&&a.changed(b.entity);if(b.eventType!==void 0&&a[b.eventType])a[b.eventType](b.entity,b.component)});this._check(this._removedEntities,
function(a,b){a.removed&&a.removed(b);if(a.removedComponent)for(var e=0;e<b._components.length;e++)a.removedComponent(b,b._components[e])});for(var a=0;a<this._systems.length;a++){var e=this._systems[a];e.passive||e._process(this.tpf)}};a.prototype._check=function(a,e){for(var c=0;c<a.length;c++){for(var d=a[c],f=0;f<this._managers.length;f++)e(this._managers[f],d);for(f=0;f<this._systems.length;f++)e(this._systems[f],d)}a.length=0};return a});
define("goo/renderer/RenderQueue",["goo/math/Vector3"],function(f){function d(){var c=this,a=new f;this.opaqueSorter=function(b,e){var d=b.meshRendererComponent.materials[0].shader,f=e.meshRendererComponent.materials[0].shader;return d._id===f._id?(f=b.meshRendererComponent.worldBound,d=e.meshRendererComponent.worldBound,f=a.setv(c.camera.translation).subv(f.center).lengthSquared(),d=a.setv(c.camera.translation).subv(d.center).lengthSquared(),f-d):d._id-f._id};this.transparentSorter=function(b,e){var d=
b.meshRendererComponent.worldBound,f=e.meshRendererComponent.worldBound,d=a.setv(c.camera.translation).subv(d.center).lengthSquared();return a.setv(c.camera.translation).subv(f.center).lengthSquared()-d};this.bucketSorter=function(a,e){return a-e}}d.prototype.sort=function(c,a){var b=0;this.camera=a;for(var e={},g=[],f=0;f<c.length;f++){var k=c[f];if(!k.meshRendererComponent||k.meshRendererComponent.materials.length===0)c[b]=k,b++;else{var i=k.meshRendererComponent.materials[0].getRenderQueue(),h=
e[i];h||(h=[],e[i]=h,g.push(i));h.push(k)}}g.length>1&&g.sort(this.bucketSorter);for(k=0;k<g.length;k++){f=g[k];h=e[f];f<=d.TRANSPARENT?h.sort(this.opaqueSorter):h.sort(this.transparentSorter);for(f=0;f<h.length;f++)c[b]=h[f],b++}};d.BACKGROUND=0;d.OPAQUE=1E3;d.TRANSPARENT=2E3;d.OVERLAY=3E3;return d});
define("goo/renderer/Shader",["goo/renderer/ShaderCall","goo/math/Matrix4x4","goo/math/Vector3","goo/entities/World","goo/renderer/RenderQueue"],function(f,d,c,a,b){function e(a,c){if(!c.vshader||!c.fshader)throw Error("Missing shader sources for shader: "+a);this.name=a;this.vertexSource=c.vshader;this.fragmentSource=c.fshader;this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping={};this.uniformCallMapping={};this.textureSlots=[];this.defaultCallbacks=
{};g(this.defaultCallbacks);this.currentCallbacks={};this.defines=c.defines;this.attributes=c.attributes;this.uniforms=c.uniforms;this.renderQueue=b.OPAQUE;this._id=e.id++;this.errorOnce=!1}function g(b){var c=new d;b[e.PROJECTION_MATRIX]=function(a,b){var e=b.camera.getProjectionMatrix();a.uniformMatrix4fv(e)};b[e.VIEW_MATRIX]=function(a,b){var e=b.camera.getViewMatrix();a.uniformMatrix4fv(e)};b[e.WORLD_MATRIX]=function(a,b){a.uniformMatrix4fv(b.transform!==void 0?b.transform.matrix:c)};b[e.VIEW_INVERSE_MATRIX]=
function(a,b){var e=b.camera.getViewInverseMatrix();a.uniformMatrix4fv(e)};b[e.VIEW_PROJECTION_MATRIX]=function(a,b){var e=b.camera.getViewProjectionMatrix();a.uniformMatrix4fv(e)};b[e.VIEW_PROJECTION_INVERSE_MATRIX]=function(a,b){var e=b.camera.getViewProjectionInverseMatrix();a.uniformMatrix4fv(e)};for(var g=0;g<16;g++)b[e["TEXTURE"+g]]=function(a){return function(b){b.uniform1i(a)}}(g);for(g=0;g<8;g++)b[e["LIGHT"+g]]=function(a){return function(b,e){var c=e.lights[a];c!==void 0?b.uniform3f(c.translation.x,
c.translation.y,c.translation.z):b.uniform3f(-20,20,20)}}(g);b[e.LIGHTCOUNT]=function(a,b){a.uniform1i(b.lights.length)};b[e.CAMERA]=function(a,b){var e=b.camera.translation;a.uniform3f(e.x,e.y,e.z)};b[e.NEAR_PLANE]=function(a,b){a.uniform1f(b.camera.near)};b[e.FAR_PLANE]=function(a,b){a.uniform1f(b.camera.far)};b[e.MAIN_NEAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.near)};b[e.MAIN_FAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.far)};var f=[0.1,0.1,0.1,1],k=[0,0,0,0],l=[1,1,1,1],m=[0.8,0.8,
0.8,1];b[e.AMBIENT]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.ambient:f)};b[e.EMISSIVE]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.emissive:k)};b[e.DIFFUSE]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.diffuse:l)};b[e.SPECULAR]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.specular:m)};b[e.SPECULAR_POWER]=function(a,b){var e=b.material.materialState!==
void 0?b.material.materialState.shininess:8,e=Math.max(e,1);a.uniform1f(e)};b[e.TIME]=function(b){b.uniform1f(a.time)};b[e.LIGHT_PROJECTION_MATRIX]=function(a,b){var e=b.lightCamera.getProjectionMatrix();a.uniformMatrix4fv(e)};b[e.LIGHT_VIEW_MATRIX]=function(a,b){var e=b.lightCamera.getViewMatrix();a.uniformMatrix4fv(e)};b[e.LIGHT_NEAR_PLANE]=function(a,b){a.uniform1f(b.lightCamera.near)};b[e.LIGHT_FAR_PLANE]=function(a,b){a.uniform1f(b.lightCamera.far)};b[e.RESOLUTION]=function(a,b){a.uniform2f(b.renderer.viewportWidth,
b.renderer.viewportHeight)}}var l=window.WebGLRenderingContext;e.id=0;var k=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;e.prototype.apply=function(a,b){var e=b.context,c=b.rendererRecord;this.shaderProgram===null&&(this._investigateShaders(),this.addDefines(this.defines),this.compile(b));var d=!1;if(c.usedProgram!==this.shaderProgram)e.useProgram(this.shaderProgram),c.usedProgram=this.shaderProgram,d=!0;if(this.attributes){var e=
a.meshData.attributeMap,g;for(g in this.attributes)if(c=e[this.attributes[g]]){var f=this.attributeIndexMapping[g];f!==void 0&&(d&&b.context.enableVertexAttribArray(f),b.bindVertexAttribute(f,c))}}if(this.uniforms){d=a.material.uniforms;try{for(var k in this.uniforms){var l=this.uniformCallMapping[k];if(l){var t=d[k]||this.uniforms[k];if(typeof t==="string"){var u=this.currentCallbacks[k];u&&u(l,a)}else{var w=typeof t==="function"?t(a):t;l.call(w)}}}this.errorOnce=!1}catch(r){if(this.errorOnce===
!1)console.error(r.stack),this.errorOnce=!0}}};e.prototype.rebuild=function(){this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping={};this.uniformCallMapping={};this.currentCallbacks={}};e.prototype._investigateShaders=function(){this.textureSlots=[];e.investigateShader(this.vertexSource,this);e.investigateShader(this.fragmentSource,this)};e.investigateShader=function(a,b){k.lastIndex=0;for(var e=k.exec(a);e!==null;){var c={format:e[2]},d=e[1],g=e[3];
if(e[4])if(c.format==="float")c.format="floatarray";else if(c.format==="int")c.format="intarray";"attribute"===d?b.attributeMapping[g]=c:(c.format.indexOf("sampler")===0&&b.textureSlots.push({format:c.format,name:g}),b.uniformMapping[g]=c);e=k.exec(a)}};e.prototype.compile=function(a){var a=a.context,b=this._getShader(a,l.VERTEX_SHADER,this.vertexSource),e=this._getShader(a,l.FRAGMENT_SHADER,this.fragmentSource);(b===null||e===null)&&console.error("Shader error - no shaders");this.shaderProgram=a.createProgram();
var c=a.getError();(this.shaderProgram===null||c!==l.NO_ERROR)&&console.error("Shader error: "+c+" [shader: "+this.name+"]");a.attachShader(this.shaderProgram,b);a.attachShader(this.shaderProgram,e);a.linkProgram(this.shaderProgram);a.getProgramParameter(this.shaderProgram,l.LINK_STATUS)||console.error("Could not initialise shaders: "+a.getProgramInfoLog(this.shaderProgram));for(var d in this.attributeMapping)b=a.getAttribLocation(this.shaderProgram,d),b===-1?console.warn("Attribute ["+this.attributeMapping[d]+
"/"+d+"] variable not found in shader. Probably unused and optimized away."):this.attributeIndexMapping[d]=b;for(d in this.uniformMapping)b=a.getUniformLocation(this.shaderProgram,d),b===null?console.warn("Uniform ["+d+"] variable not found in shader. Probably unused and optimized away. "+d):this.uniformCallMapping[d]=new f(a,b,this.uniformMapping[d].format);if(this.attributes){for(var g in this.attributes)a=this.attributeIndexMapping[g],a===void 0&&console.warn("No attribute found for binding: "+
g+" ["+this.name+"]["+this._id+"]");for(g in this.attributeIndexMapping)a=this.attributes[g],a===void 0&&console.warn("No binding found for attribute: "+g+" ["+this.name+"]["+this._id+"]")}if(this.uniforms){if(this.uniforms.$link){a=this.uniforms.$link instanceof Array?this.uniforms.$link:[this.uniforms.$link];for(b=0;b<a.length;b++)for(d in e=a[b],e)this.uniforms[d]=e[d];delete this.uniforms.$link}for(g in this.uniforms)a=this.uniformCallMapping[g],a===void 0&&console.warn("No uniform found for binding: "+
g+" ["+this.name+"]["+this._id+"]"),d=this.uniforms[g],this.defaultCallbacks[d]&&(this.currentCallbacks[g]=this.defaultCallbacks[d]);for(g in this.uniformCallMapping)a=this.uniforms[g],a===void 0&&console.warn("No binding found for uniform: "+g+" ["+this.name+"]["+this._id+"]")}console.log("Shader ["+this.name+"]["+this._id+"] compiled")};e.prototype._getShader=function(a,b,e){b=a.createShader(b);a.shaderSource(b,e);a.compileShader(b);return!a.getShaderParameter(b,l.COMPILE_STATUS)?(console.error("Shader ["+
this.name+"]["+this._id+"] "+a.getShaderInfoLog(b)),null):b};e.prototype.addDefines=function(a){if(a)a=this.generateDefines(a),this.vertexSource=a+"\n"+this.vertexSource,this.fragmentSource=a+"\n"+this.fragmentSource};e.prototype.generateDefines=function(a){var b=[],e;for(e in a){var c=a[e];c!==!1&&b.push("#define "+e+" "+c)}return b.join("\n")};e.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms}};
e.prototype.toString=function(){return this.name};e.PROJECTION_MATRIX="PROJECTION_MATRIX";e.VIEW_MATRIX="VIEW_MATRIX";e.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX";e.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX";e.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX";e.WORLD_MATRIX="WORLD_MATRIX";for(c=0;c<16;c++)e["TEXTURE"+c]="TEXTURE"+c;for(c=0;c<4;c++)e["LIGHT"+c]="LIGHT"+c;e.CAMERA="CAMERA";e.AMBIENT="AMBIENT";e.EMISSIVE="EMISSIVE";e.DIFFUSE="DIFFUSE";e.SPECULAR="SPECULAR";e.SPECULAR_POWER=
"SPECULAR_POWER";e.NEAR_PLANE="NEAR_PLANE";e.FAR_PLANE="FAR_PLANE";e.MAIN_NEAR_PLANE="NEAR_PLANE";e.MAIN_FAR_PLANE="FAR_PLANE";e.TIME="TIME";e.RESOLUTION="RESOLUTION";e.LIGHT_PROJECTION_MATRIX="LIGHT_PROJECTION_MATRIX";e.LIGHT_VIEW_MATRIX="LIGHT_VIEW_MATRIX";e.LIGHT_NEAR_PLANE="LIGHT_NEAR_PLANE";e.LIGHT_FAR_PLANE="LIGHT_FAR_PLANE";return e});
define("goo/renderer/Material",["goo/renderer/Shader"],function(f){function d(c){this.name=c;this.shader=null;this.uniforms={};this.textures=[];this._originalTextureCount=-1;this.materialState=void 0;this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"};this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"};this.depthState={enabled:!0,write:!0};this.offsetState={enabled:!1,factor:1,units:1};this.wireframe=!1;this.renderQueue=
null}d.prototype.getRenderQueue=function(){return this.renderQueue!==null?this.renderQueue:this.shader.renderQueue};d.prototype.setRenderQueue=function(c){this.renderQueue=c};d.store=[];d.hash=[];d.createShader=function(c,a){var b=d.store.indexOf(c);if(b!==-1)return d.hash[b];b=new f(a||"DefaultShader",c);d.store.push(c);d.hash.push(b);return b};d.clearShaderCache=function(){d.store.length=0;d.hash.length=0};d.createMaterial=function(c,a){var b=new d(a||"DefaultMaterial");b.shader=d.createShader(c);
return b};return d});
define("goo/util/rsvp",["exports"],function(f){function d(b,e){a.async(function(){b.trigger("promise:resolved",{detail:e});b.isResolved=!0;b.resolvedValue=e})}function c(b,e){a.async(function(){b.trigger("promise:failed",{detail:e});b.isRejected=!0;b.rejectedValue=e})}var a={},b=typeof window!=="undefined"?window:{},b=b.MutationObserver||b.WebKitMutationObserver;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]")a.async=function(a,b){process.nextTick(function(){a.call(b)})};else if(b){var e=
[],g=new b(function(){var a=e.slice();e=[];a.forEach(function(a){a[0].call(a[1])})}),l=document.createElement("div");g.observe(l,{attributes:!0});window.addEventListener("unload",function(){g.disconnect();g=null});a.async=function(a,b){e.push([a,b]);l.setAttribute("drainQueue","drainQueue")}}else a.async=function(a,b){setTimeout(function(){a.call(b)},1)};var k=function(a,b){this.type=a;for(var e in b)b.hasOwnProperty(e)&&(this[e]=b[e])},i=function(a,b){for(var e=0,c=a.length;e<c;e++)if(a[e][0]===
b)return e;return-1},h=function(a){var b=a._promiseCallbacks;if(!b)b=a._promiseCallbacks={};return b},b={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,e){for(var c=h(this),d,g,a=a.split(/\s+/),e=e||this;g=a.shift();)(d=c[g])||(d=c[g]=[]),i(d,b)===-1&&d.push([b,e])},off:function(a,b){for(var e=h(this),c,d,a=a.split(/\s+/);c=a.shift();)b?(c=e[c],d=i(c,b),d!==-1&&c.splice(d,1)):e[c]=[]},trigger:function(a,b){var e,c,d,g;if(e=h(this)[a])for(var f=0,i=e.length;f<
i;f++)c=e[f],d=c[0],c=c[1],typeof b!=="object"&&(b={detail:b}),g=new k(a,b),d.call(c,g)}},j=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},n=function(){},o=function(a,b,e,c){var d=typeof e==="function",g,f,h,i;if(d)try{g=e(c.detail),h=!0}catch(k){i=!0,f=k}else g=c.detail,h=!0;if(g&&typeof g.then==="function")g.then(function(a){b.resolve(a)},function(a){b.reject(a)});
else if(d&&h)b.resolve(g);else if(i)b.reject(f);else b[a](g)};j.prototype={then:function(b,e){var c=new j;this.isResolved&&a.async(function(){o("resolve",c,b,{detail:this.resolvedValue})},this);this.isRejected&&a.async(function(){o("reject",c,e,{detail:this.rejectedValue})},this);this.on("promise:resolved",function(a){o("resolve",c,b,a)});this.on("promise:failed",function(a){o("reject",c,e,a)});return c},resolve:function(a){d(this,a);this.reject=this.resolve=n},reject:function(a){c(this,a);this.reject=
this.resolve=n}};b.mixin(j.prototype);f.Promise=j;f.Event=k;f.EventTarget=b;f.all=function(a){var b,e=[],c=new j,d=a.length;d===0&&c.resolve([]);var g=function(a){return function(b){e[a]=b;--d===0&&c.resolve(e)}},f=function(a){c.reject(a)};for(b=0;b<d;b++)a[b].then(g(b),f);return c};f.configure=function(b,e){a[b]=e}});
define("goo/util/Ajax",["goo/util/rsvp"],function(f){function d(c){this._loadStack=[];this._callback=c}d.prototype.get=function(c){var a=new f.Promise,b=this._progress.bind(this),e={loaded:0,total:0,lengthComputable:!1};this._loadStack.push(e);var c=c||{},d=c.url||"",l=new XMLHttpRequest;if(c.responseType)l.responseType=c.responseType;l.open("GET",d,!0);l.onreadystatechange=function(){if(l.readyState===4)l.status>=200&&l.status<=299?(e.loaded=e.total,b(),a.resolve(l)):a.reject(l.statusText)};l.addEventListener("progress",
function(a){e.loaded=a.loaded||a.position;e.total=a.total||a.totalSize;e.lengthComputable=a.lengthComputable;b()},!1);l.send();return a};d.prototype._progress=function(){if(this._callback){for(var c={total:0,loaded:0,count:this._loadStack.length},a=0;a<this._loadStack.length;a++)c.total+=this._loadStack[a].total,c.loaded+=this._loadStack[a].loaded;this._callback(c)}};return d});
define("goo/loaders/Loader",["goo/util/rsvp","goo/util/Ajax"],function(f,d){function c(a){if(typeof a!=="undefined"&&a!==null&&typeof a!=="object")throw Error("Loader(): Argument `parameters` must be of type `object`");else if(typeof a==="undefined"||a===null)a={};this._crossOrigin=a.crossOrigin||"anonymous";this.rootPath=a.rootPath||"";this.xhr=a.xhr||new d(this._progressCallback.bind(this));this._progressCallbacks=[];this.total=0}c.prototype.load=function(a,b,e){if(typeof a==="undefined"||a===null)throw Error("Loader(): `path` was undefined/null");
var d={url:this._buildURL(a)};if(e===c.ARRAY_BUFFER)d.responseType=c.ARRAY_BUFFER;var f=this,k=this.xhr.get(d).then(function(a){return f._getDataFromSuccessfulRequest(a)}).then(function(a){return typeof b==="function"?b(a):a}).then(function(a){k.resolve(a);console.log("Loaded: "+d.url);return a}).then(null,function(a){console.error("Loader.load(): Could not retrieve data from `"+d.url+"`.\n Reason: "+a);throw Error("Loader.load(): Could not retrieve data from `"+d.url+"`.\n Reason: "+a);});return k};
c.prototype.addProgressCallback=function(a){this._progressCallbacks.push(a)};c.prototype.removeProgressCallback=function(a){for(var b=0;b<this._progressCallbacks.length;b++)if(this._progressCallbacks[b]===a){this._progressCallbacks.splice(b,1);break}};c.prototype._progressCallback=function(a){if(this.total)a.total=this.total;for(var b=0;b<this._progressCallbacks.length;b++)this._progressCallbacks[b](a)};c.prototype._getDataFromSuccessfulRequest=function(a){return a.response};c.prototype.loadImage=
function(a){var b=new f.Promise,e=new Image;e.addEventListener("load",function(){e.dataReady=!0;b.resolve(e)},!1);e.addEventListener("error",function(){b.reject("Loader.loadImage(): Couldn't load from ["+a+"]")},!1);this.load(a,function(a){for(var b=new Uint8Array(a,0,a.byteLength),a="",c=0;c<b.length;c++)a+=String.fromCharCode(b[c]);b=btoa(a);e.src=/^\x89PNG/.test(a)?"data:image/png;base64,"+b:"data:image/jpeg;base64,"+b},c.ARRAY_BUFFER);return b};c.prototype._buildURL=function(a){return this.rootPath+
a};c.ARRAY_BUFFER="arraybuffer";return c});
define("goo/math/Vector2",["goo/math/Vector"],function(f){function d(){f.call(this,2);arguments.length!==0?this.set(arguments):this.setd(0,0)}d.prototype=Object.create(f.prototype);d.prototype.setupAliases([["x","u","s"],["y","v","t"]]);d.ZERO=new d(0,0);d.ONE=new d(1,1);d.UNIT_X=new d(1,0);d.UNIT_Y=new d(0,1);d.add=function(c,a,b){typeof c==="number"&&(c=[c,c]);typeof a==="number"&&(a=[a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
b.data[0]=c[0]+a[0];b.data[1]=c[1]+a[1];return b};d.prototype.add=function(c){return d.add(this,c,this)};d.sub=function(c,a,b){typeof c==="number"&&(c=[c,c]);typeof a==="number"&&(a=[a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};b.data[0]=c[0]-a[0];b.data[1]=c[1]-a[1];return b};d.prototype.sub=function(c){return d.sub(this,c,this)};d.mul=function(c,a,b){typeof c==="number"&&(c=[c,c]);typeof a===
"number"&&(a=[a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};b.data[0]=c[0]*a[0];b.data[1]=c[1]*a[1];return b};d.prototype.mul=function(c){return d.mul(this,c,this)};d.div=function(c,a,b){typeof c==="number"&&(c=[c,c]);typeof a==="number"&&(a=[a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
b.data[0]=c[0]/a[0];b.data[1]=c[1]/a[1];return b};d.prototype.div=function(c){return d.div(this,c,this)};d.dot=function(c,a){typeof c==="number"&&(c=[c,c]);typeof a==="number"&&(a=[a,a]);var b=c.data||c,e=a.data||a;if(b.length!==2||e.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var d=0;d+=b[0]*e[0];d+=b[1]*e[1];return d};d.prototype.dot=function(c){return d.dot(this,c)};d.prototype.setd=function(c,a){this.data[0]=c;this.data[1]=a;return this};d.prototype.seta=
function(c){this.data[0]=c[0];this.data[1]=c[1];return this};d.prototype.setv=function(c){this.data[0]=c.data[0];this.data[1]=c.data[1];return this};return d});
define("goo/renderer/Texture",["goo/math/Vector2"],function(f){function d(c,a,b,e){this.glTexture=null;a=a||{};c&&this.setImage(c,a,b,e);this.wrapS=a.wrapS||"Repeat";this.wrapT=a.wrapT||"Repeat";this.magFilter=a.magFilter||"Bilinear";this.minFilter=a.minFilter||"Trilinear";this.anisotropy=a.anisotropy!==void 0?a.anisotropy:1;this.format=a.format||"RGBA";this.type=a.type||"UnsignedByte";this.variant="2D";this.offset=new f(0,0);this.repeat=new f(1,1);this.generateMipmaps=a.generateMipmaps!==void 0?
a.generateMipmaps:!0;this.premultiplyAlpha=a.premultiplyAlpha!==void 0?a.premultiplyAlpha:!1;this.flipY=a.flipY!==void 0?a.flipY:!0;this.needsUpdate=this.hasBorder=!1;this.readyCallback=this.updateCallback=null}d.prototype.checkDataReady=function(){return this.image&&this.image.dataReady||this.readyCallback!==null&&this.readyCallback()};d.prototype.checkNeedsUpdate=function(){return this.needsUpdate||this.updateCallback!==null&&this.updateCallback()};d.prototype.setImage=function(c,a,b,e){this.image=
c;var d=c instanceof Array?c[0]:c;if(d instanceof Uint8Array||d instanceof Uint16Array)if(b=b||c.width,e=e||c.height,b!==void 0&&e!==void 0)if(this.image={data:c},this.image.width=b,this.image.height=e,this.image.isData=!0,this.image.dataReady=!0,d instanceof Uint8Array)a.type="UnsignedByte";else{if(d instanceof Uint16Array)a.type="UnsignedShort4444"}else throw"Data textures need width and height";else if(c instanceof Array)this.image={data:c}};d.CUBE_FACES="PositiveX,NegativeX,PositiveY,NegativeY,PositiveZ,NegativeZ".split(",");
return d});
define("goo/loaders/dds/DdsUtils",[],function(){function f(){}f.getDdsExtension=function(d){for(var c=["","WEBKIT_","MOZ_"],a=0;a<c.length;a++){var b=d.getExtension(c[a]+"WEBGL_compressed_texture_s3tc");if(typeof b!=="undefined"&&b!==null)return b}return null};f.isSupported=function(d){return f.getDdsExtension(d)!==null};f.shiftCount=function(d){if(d===0)return 0;for(var c=0;(d&1)===0;)if(d>>=1,c++,c>32)throw"invalid mask!";return c};f.isSet=function(d,c){return(d&c)===c};f.getIntFromString=function(d){for(var c=
[],a=0;a<d.length;a++)c[a]=d.charCodeAt(a);return f.getIntFromBytes(c)};f.getIntFromBytes=function(d){var c=0;c|=(d[0]&255)<<0;d.length>1&&(c|=(d[1]&255)<<8);d.length>2&&(c|=(d[2]&255)<<16);d.length>3&&(c|=(d[3]&255)<<24);return c};f.getComponents=function(d){switch(d){case "Alpha":return 1;case "RGB":return 3;case "RGBA":return 4;case "Luminance":return 1;case "LuminanceAlpha":return 2;case "PrecompressedDXT1":return 1;case "PrecompressedDXT1A":return 1;case "PrecompressedDXT3":return 2;case "PrecompressedDXT5":return 2}return 0};
f.flipDXT=function(d,c,a,b){for(var e=new Uint8Array(d.length),c=c+3>>2,a=a+3>>2,g=f.getComponents(b)*8,l=0;l<a;l++)for(var k=a-l-1,i=0;i<c;i++){var h=(k*c+i)*g,j=(l*c+i)*g;switch(b){case "PrecompressedDXT1":case "PrecompressedDXT1A":e[h+0]=d[j+0];e[h+1]=d[j+1];e[h+2]=d[j+2];e[h+3]=d[j+3];e[h+4]=d[j+7];e[h+5]=d[j+6];e[h+6]=d[j+5];e[h+7]=d[j+4];break;case "PrecompressedDXT3":e[h+0]=d[j+6];e[h+1]=d[j+7];e[h+2]=d[j+4];e[h+3]=d[j+5];e[h+4]=d[j+2];e[h+5]=d[j+3];e[h+6]=d[j+0];e[h+7]=d[j+1];e[h+8]=d[j+8];
e[h+9]=d[j+9];e[h+10]=d[j+10];e[h+11]=d[j+11];e[h+12]=d[j+15];e[h+13]=d[j+14];e[h+14]=d[j+13];e[h+15]=d[j+12];break;case "PrecompressedDXT5":e[h+0]=d[j+0],e[h+1]=d[j+1],f.getBytesFromUInt24(e,h+5,f.flipUInt24(f.getUInt24(d,j+2))),f.getBytesFromUInt24(e,h+2,f.flipUInt24(f.getUInt24(d,j+5))),e[h+8]=d[j+8],e[h+9]=d[j+9],e[h+10]=d[j+10],e[h+11]=d[j+11],e[h+12]=d[j+15],e[h+13]=d[j+14],e[h+14]=d[j+13],e[h+15]=d[j+12]}}return e};f.getUInt24=function(d,c){var a=0;a|=(d[c+0]&255)<<0;a|=(d[c+1]&255)<<8;a|=
(d[c+2]&255)<<16;return a};f.getBytesFromUInt24=function(d,c,a){d[c+0]=a&255;d[c+1]=(a&65280)>>8;d[c+2]=(a&16711680)>>16};f.ThreeBitMask=7;f.flipUInt24=function(d){for(var c=[],a=0;a<2;a++)c.push([0,0,0,0]);c[0][0]=d&f.ThreeBitMask;d>>=3;c[0][1]=d&f.ThreeBitMask;d>>=3;c[0][2]=d&f.ThreeBitMask;d>>=3;c[0][3]=d&f.ThreeBitMask;d>>=3;c[1][0]=d&f.ThreeBitMask;d>>=3;c[1][1]=d&f.ThreeBitMask;d>>=3;c[1][2]=d&f.ThreeBitMask;d>>=3;c[1][3]=d&f.ThreeBitMask;d=0;d|=c[1][0]<<0;d|=c[1][1]<<3;d|=c[1][2]<<6;d|=c[1][3]<<
9;d|=c[0][0]<<12;d|=c[0][1]<<15;d|=c[0][2]<<18;d|=c[0][3]<<21;return d};return f});
define("goo/loaders/dds/DdsLoader",["goo/loaders/dds/DdsUtils"],function(f){function d(){this.dwABitMask=this.dwBBitMask=this.dwGBitMask=this.dwRBitMask=this.dwRGBBitCount=this.dwFourCC=this.dwFlags=this.dwSize=0}function c(){this.dwAlphaBitDepth=this.dwMipMapCount=this.dwDepth=this.dwLinearSize=this.dwWidth=this.dwHeight=this.dwFlags=this.dwSize=0;this.dwReserved1=[];this.ddpf=null;this.dwTextureStage=this.dwCaps4=this.dwCaps3=this.dwCaps2=this.dwCaps=0}function a(){this.flipVertically=!1;this.bpp=
0;this.headerDX10=this.header=null;this.mipmapByteSizes=[]}function b(){}d.HEADER_OFFSET=19;d.DDPF_ALPHAPIXELS=1;d.DDPF_ALPHA=2;d.DDPF_FOURCC=4;d.DDPF_RGB=64;d.DDPF_YUV=512;d.DDPF_LUMINANCE=131072;d.read=function(a){var b=new d;b.dwSize=a[d.HEADER_OFFSET+0];if(b.dwSize!==32)throw"invalid pixel format size: "+b.dwSize;b.dwFlags=a[d.HEADER_OFFSET+1];b.dwFourCC=a[d.HEADER_OFFSET+2];b.dwRGBBitCount=a[d.HEADER_OFFSET+3];b.dwRBitMask=a[d.HEADER_OFFSET+4];b.dwGBitMask=a[d.HEADER_OFFSET+5];b.dwBBitMask=a[d.HEADER_OFFSET+
6];b.dwABitMask=a[d.HEADER_OFFSET+7];return b};c.DDSD_CAPS=1;c.DDSD_HEIGHT=2;c.DDSD_WIDTH=4;c.DDSD_PITCH=8;c.DDSD_PIXELFORMAT=4096;c.DDSD_MIPMAPCOUNT=131072;c.DDSD_LINEARSIZE=524288;c.DDSD_DEPTH=8388608;c.DDSCAPS_COMPLEX=8;c.DDSCAPS_MIPMAP=4194304;c.DDSCAPS_TEXTURE=4096;c.DDSCAPS2_CUBEMAP=512;c.DDSCAPS2_CUBEMAP_POSITIVEX=1024;c.DDSCAPS2_CUBEMAP_NEGATIVEX=2048;c.DDSCAPS2_CUBEMAP_POSITIVEY=4096;c.DDSCAPS2_CUBEMAP_NEGATIVEY=8192;c.DDSCAPS2_CUBEMAP_POSITIVEZ=16384;c.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768;c.DDSCAPS2_VOLUME=
2097152;c.read=function(a){var b=new c;b.dwSize=a[1];if(b.dwSize!==124)throw"invalid dds header size: "+b.dwSize;b.dwFlags=a[2];b.dwHeight=a[3];b.dwWidth=a[4];b.dwLinearSize=a[5];b.dwDepth=a[6];b.dwMipMapCount=a[7];b.dwAlphaBitDepth=a[8];for(var l=0;l<b.dwReserved1.length;l++)b.dwReserved1[l]=a[9+l];b.ddpf=d.read(a);b.dwCaps=a[27];b.dwCaps2=a[28];b.dwCaps3=a[29];b.dwCaps4=a[30];b.dwTextureStage=a[31];a=1+Math.ceil(Math.log(Math.max(b.dwHeight,b.dwWidth))/Math.log(2));f.isSet(b.dwCaps,c.DDSCAPS_MIPMAP)?
f.isSet(b.dwFlags,c.DDSD_MIPMAPCOUNT)?b.dwMipMapCount!==a&&console.warn("Got "+b.dwMipMapCount+" mipmaps, expected "+a):b.dwMipMapCount=a:b.dwMipMapCount=1;return b};a.prototype.calcMipmapSizes=function(a){for(var b=this.header.dwWidth,c=this.header.dwHeight,d=0,f=0;f<this.header.dwMipMapCount;f++)d=a?~~((b+3)/4)*~~((c+3)/4)*this.bpp*2:~~(b*c*this.bpp/8),this.mipmapByteSizes.push(~~((d+3)/4)*4),b=~~(b/2)>1?~~(b/2):1,c=~~(c/2)>1?~~(c/2):1};b.updateDepth=function(a,b){if(f.isSet(b.header.dwCaps2,c.DDSCAPS2_CUBEMAP)){var d=
0;f.isSet(b.header.dwCaps2,c.DDSCAPS2_CUBEMAP_POSITIVEX)&&d++;f.isSet(b.header.dwCaps2,c.DDSCAPS2_CUBEMAP_NEGATIVEX)&&d++;f.isSet(b.header.dwCaps2,c.DDSCAPS2_CUBEMAP_POSITIVEY)&&d++;f.isSet(b.header.dwCaps2,c.DDSCAPS2_CUBEMAP_NEGATIVEY)&&d++;f.isSet(b.header.dwCaps2,c.DDSCAPS2_CUBEMAP_POSITIVEZ)&&d++;f.isSet(b.header.dwCaps2,c.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&d++;if(d!==6)throw Error("Cubemaps without all faces defined are not currently supported.");a.depth=d}else a.depth=b.header.dwDepth>0?b.header.dwDepth:
1};b.readDXT=function(a,b,c,d){d.image.isCompressed=!0;if(!c.flipVertically)return new Uint8Array(a.buffer,a.byteOffset+0,b);for(var i=c.header.dwWidth,h=c.header.dwHeight,b=new Uint8Array(b),j=0,n=0;n<c.header.dwMipMapCount;n++){for(var o=[],q=0,m=c.mipmapByteSizes[n];q<m;q++)o.push(a[q+j]);o=f.flipDXT(o,i,h,d.format);b.set(o,j);j+=o.length;i=~~(i/2)>1?~~(i/2):1;h=~~(h/2)>1?~~(h/2):1}return b};b.readUncompressed=function(a,b,c,d,i,h,j,n){for(var o=f.shiftCount(j.header.ddpf.dwRBitMask),q=f.shiftCount(j.header.ddpf.dwGBitMask),
m=f.shiftCount(j.header.ddpf.dwBBitMask),s=f.shiftCount(j.header.ddpf.dwABitMask),p=~~(j.header.ddpf.dwRGBBitCount/8),n=f.getComponents(n.format)*1,b=new Uint8Array(b),t=j.header.dwWidth,u=j.header.dwHeight,w=0,r=0,v=0,z=[],v=0;v<p;v++)z.push(0);for(var y=0;y<j.header.dwMipMapCount;y++){for(var A=0;A<u;A++)for(var x=0;x<t;x++){for(v=0;v<p;v++)z[v]=a[r++];var v=f.getIntFromBytes(z),D=(v&j.header.ddpf.dwRBitMask)>>o,E=(v&j.header.ddpf.dwGBitMask)>>q,C=(v&j.header.ddpf.dwBBitMask)>>m,v=(v&j.header.ddpf.dwABitMask)>>
s;i?b[w++]=v:d?(b[w++]=D,h&&(b[w++]=v)):c&&(b[w++]=D,b[w++]=E,b[w++]=C,h&&(b[w++]=v))}w+=t*u*n;t=~~(t/2)>1?~~(t/2):1;u=~~(u/2)>1?~~(u/2):1}return b};b.populate=function(a,c,l){var k=c.header.ddpf.dwFlags,i=f.isSet(k,d.DDPF_FOURCC),h=f.isSet(k,d.DDPF_RGB),j=f.isSet(k,d.DDPF_ALPHAPIXELS),n=f.isSet(k,d.DDPF_LUMINANCE),k=f.isSet(k,d.DDPF_ALPHA);a.type="UnsignedByte";if(i){var o=c.header.ddpf.dwFourCC;if(o===f.getIntFromString("DXT1"))c.bpp=4,a.format="PrecompressedDXT1A";else if(o===f.getIntFromString("DXT3"))c.bpp=
8,a.format="PrecompressedDXT3";else if(o===f.getIntFromString("DXT5"))c.bpp=8,a.format="PrecompressedDXT5";else if(o===f.getIntFromString("DX10"))throw Error("dxt10 LATC formats not supported currently: "+c.headerDX10.dxgiFormat);else if(o===f.getIntFromString("DXT2"))throw"DXT2 is not supported.";else if(o===f.getIntFromString("DXT4"))throw"DXT4 is not supported.";else throw"unsupported compressed dds format found ("+o+")";}else if(c.bpp=c.header.ddpf.dwRGBBitCount,h)a.format=j?"RGBA":"RGB";else if(n||
j)if(n&&j)a.format="LuminanceAlpha";else if(n)a.format="Luminance";else{if(k)a.format="Alpha"}else throw Error("unsupported uncompressed dds format found.");c.calcMipmapSizes(i);a.image.mipmapSizes=c.mipmapByteSizes;for(var q=o=0;q<c.mipmapByteSizes.length;q++)o+=c.mipmapByteSizes[q];for(var m=[],q=0;q<a.image.depth;q++)i?m.push(b.readDXT(l,o,c,a)):(h||n||k)&&m.push(b.readUncompressed(l,o,h,n,k,j,c,a));a.image.data=a.image.depth===1?m[0]:m;a.image.useArrays=!0};b.prototype.load=function(e,d,l,k,i){var h=
new Int32Array(e,k+0,32);if(h[0]!==f.getIntFromString("DDS "))throw"Not a dds file.";var j=new a;j.flipVertically=l;j.header=c.read(h);j.headerDX10=j.header.ddpf.dwFourCC===f.getIntFromString("DX10")?c.read(Int32Array.create(e,k+128,5)):null;l=d.image;if(typeof l==="undefined"||l===null)l={},d.image=l;l.width=j.header.dwWidth;l.height=j.header.dwHeight;b.updateDepth(l,j);h=128+(j.headerDX10?20:0);b.populate(d,j,new Uint8Array(e,k+h,i-h));l.bpp=j.bpp;l.dataReady=!0;d.needsUpdate=!0};b.SUPPORTS_DDS=
!1;b.prototype.isSupported=function(){return b.SUPPORTS_DDS};b.prototype.toString=function(){return"DdsLoader"};return b});
define("goo/util/SimpleResourceUtil",[],function(){function f(){}f.countdown=function(d,c,a){d[0]--;if(d[0]===0)c.onSuccess(a)};f.loadTextAsset=function(d,c,a,b,e,g){var l=new XMLHttpRequest;l.open("GET",a[c],!0);l.onreadystatechange=function(){if(l.readyState===4)if(l.status>=200&&l.status<=299)e[b[c]]=l.responseText,f.countdown(d,g,e);else g.onError(l.statusText)};l.send()};f.loadTextAssets=function(d,c,a){for(var b=[d.length],e={},g=0,l=d.length;g<l;g++)f.loadTextAsset(b,g,d,c,e,a)};f.loadBinaryAsArrayBuffer=
function(d,c){var a=new XMLHttpRequest;a.open("GET",d);a.responseType="arraybuffer";a.onload=function(){if(a.status!==404)c.onSuccess(a.response);else a.onerror(null)};a.onerror=function(){c.onError(null)};a.send()};return f});
define("goo/util/Latch",[],function(){function f(d,c){this.count=d;this.callback=c}f.prototype.countDown=function(){this.count--;this.isDone()&&this.callback&&this.callback.done?this.callback.done():this.callback&&this.callback.progress&&this.callback.progress(this.count)};f.prototype.isDone=function(){return this.count===0};return f});
define("goo/renderer/TextureCreator","goo/loaders/Loader,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/util/SimpleResourceUtil,goo/renderer/Util,goo/util/Latch".split(","),function(f,d,c,a,b,e){function g(a){a=a||{};this.verticalFlip=a.verticalFlip!==void 0?a.verticalFlip:!0;this._loader=a.loader!==void 0?a.loader:new f;this.textureLoaders={".dds":new c}}function l(a,b){return a.indexOf(b,a.length-b.length)!==-1}g.cache={};g.UNSUPPORTED_FALLBACK=".png";g.clearCache=function(){g.cache={}};g.prototype.loadTexture2D=
function(a,e){if(g.cache[a]!==void 0)return g.cache[a];var c=function(a){q.load(a,m,n.verticalFlip,0,a.byteLength);g._finishedLoading()},j=function(b){console.warn("Error loading texture: "+a+" | "+b)},n=this,o;for(o in this.textureLoaders)if(l(a.toLowerCase(),o)){var q=this.textureLoaders[o];if(!q||!q.isSupported()){a=a.substring(0,a.length-o.length);a+=g.UNSUPPORTED_FALLBACK;e=e||{};e.flipY=!1;break}var m=new d(b.clone(g.DEFAULT_TEXTURE_2D.image),e);m.image.dataReady=!1;m.a=a;g.cache[a]=m;this._loader.load(a,
null,f.ARRAY_BUFFER).then(c,j);return m}if(g.cache[a]!==void 0)return g.cache[a];var s=new d(null,e);g.cache[a]=s;this._loader.loadImage(a).then(function(a){s.setImage(a);g._finishedLoading(a)});return s};g.prototype.loadTextureVideo=function(a,e){if(g.cache[a]!==void 0)return g.cache[a];var c=document.createElement("video");c.loop=typeof e==="boolean"?e:!0;c.addEventListener("error",function(){console.warn("Couldn't load video URL ["+a+"]")},!1);var f=new d(c,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});
f.readyCallback=function(){if(c.readyState>=3){console.log("Video ready: "+c.videoWidth+", "+c.videoHeight);c.width=c.videoWidth;c.height=c.videoHeight;if(b.isPowerOfTwo(c.width)===!1||b.isPowerOfTwo(c.height)===!1)f.generateMipmaps=!1,f.minFilter="BilinearNoMipMaps";c.play();return c.dataReady=!0}return!1};f.updateCallback=function(){return!c.paused};c.crossOrigin="anonymous";c.src=a;return g.cache[a]=f};g.prototype.loadTextureWebCam=function(){var a=document.createElement("video");a.autoplay=!0;
a.loop=!0;var c=new d(a,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});c.readyCallback=function(){if(a.readyState>=3){console.log("WebCam video ready: "+a.videoWidth+", "+a.videoHeight);a.width=a.videoWidth;a.height=a.videoHeight;if(b.isPowerOfTwo(a.width)===!1||b.isPowerOfTwo(a.height)===!1)c.generateMipmaps=!1,c.minFilter="BilinearNoMipMaps";return a.dataReady=!0}return!1};c.updateCallback=function(){return!a.paused};window.URL=window.URL||window.webkitURL;navigator.getUserMedia=navigator.getUserMedia||
navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia?navigator.getUserMedia({video:!0},function(b){a.src=window.URL.createObjectURL(b)},function(a){console.warn("Unable to capture WebCam. Please reload the page.",a)}):console.warn("No support for WebCam getUserMedia found!");return c};g.prototype.loadTextureCube=function(a,b){var c=new d(null,b);c.variant="CUBE";for(var g=[],f=new e(6,{done:function(){for(var a=g[0].width,b=g[0].height,e=0;e<6;e++){var d=
g[e];if(a!==d.width||b!==d.height)c.generateMipmaps=!1,c.minFilter="BilinearNoMipMaps",console.error("Images not all the same size!")}c.setImage(g);c.image.dataReady=!0;c.image.width=a;c.image.height=b}}),l=this,q=0;q<a.length;q++)(function(b){var c=a[b];typeof c==="string"?l._loader.loadImage(c).then(function(a){g[b]=a;f.countDown()}):(g[b]=c,f.countDown())})(q);return c};g._globalCallback=null;g._finishedLoading=function(a){if(g._globalCallback)try{g._globalCallback(a)}catch(b){console.error("Error in texture callback:",
b)}};a=new Uint8Array([255,255,255,255]);g.DEFAULT_TEXTURE_2D=new d(a,null,1,1);g.DEFAULT_TEXTURE_CUBE=new d([a,a,a,a,a,a],null,1,1);g.DEFAULT_TEXTURE_CUBE.variant="CUBE";return g});
define("goo/addons/terrain/Terrain","goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/MeshData,goo/renderer/Material,goo/renderer/Shader,goo/renderer/TextureCreator".split(","),function(f,d,c,a,b,e){function g(b){var c=a.createMaterial(l),d=(new e).loadTexture2D("../resources/head_diffuse.jpg");c.textures.push(d);var g=a.createMaterial(l);g.textures.push(d);g.wireframe=!0;this.material=c;this.material2=g;c=b.createEntity();c.addToWorld();for(d=0;d<
6;d++)g=this.createClipmapLevel(b,d,d===0),c.transformComponent.attachChild(g.transformComponent)}g.prototype.createClipmapLevel=function(a,b,c){var e=a.createEntity(),d=Math.pow(2,b);e.transformComponent.transform.scale.set(d,d,1);d=(2*Math.pow(-1,b+1)+Math.pow(2,b+1))/6;b=b%2===0?d:-d;e.transformComponent.transform.translation.set(b,-b,0);e.addToWorld();this.createQuadEntity(a,e,0,0,3,3);this.createQuadEntity(a,e,3,0,3,3);this.createQuadEntity(a,e,6,0,2,3);this.createQuadEntity(a,e,8,0,3,3);this.createQuadEntity(a,
e,11,0,3,3);this.createQuadEntity(a,e,0,3,3,3);this.createQuadEntity(a,e,11,3,3,3);this.createQuadEntity(a,e,0,6,3,2);this.createQuadEntity(a,e,11,6,3,2);this.createQuadEntity(a,e,0,8,3,3);this.createQuadEntity(a,e,11,8,3,3);this.createQuadEntity(a,e,0,11,3,3);this.createQuadEntity(a,e,3,11,3,3);this.createQuadEntity(a,e,6,11,2,3);this.createQuadEntity(a,e,8,11,3,3);this.createQuadEntity(a,e,11,11,3,3);c&&this.createQuadEntity(a,e,3,4,7,7);return e};g.prototype.createQuadEntity=function(a,b,c,e,g,
l){c=this.createGrid(c,e,g,l);a=a.createEntity();b.transformComponent.attachChild(a.transformComponent);b=new f(c);a.setComponent(b);b=new d;b.materials.push(this.material2);a.setComponent(b);a.addToWorld();return a};g.prototype.createGrid=function(a,b,e,d){for(var g=c.defaultMap([c.POSITION,c.TEXCOORD0]),g=new c(g,(e+1)*(d+1),e*d*6),f=g.getAttributeBuffer(c.POSITION),l=g.getAttributeBuffer(c.TEXCOORD0),m=g.getIndexBuffer(),s=0;s<e+1;s++)for(var p=0;p<d+1;p++){var t=p*(e+1)+s;f[t*3+0]=s+a-7;f[t*3+
1]=p+b-7;f[t*3+2]=0;l[t*2+0]=(s+a)/15;l[t*2+1]=(p+b)/15}for(s=0;s<e;s++)for(p=0;p<d;p++)t=p*(e+1)+s,a=p*e+s,m[a*6+0]=t,m[a*6+1]=t+1,m[a*6+2]=t+e+1,m[a*6+3]=t+1,m[a*6+4]=t+e+1+1,m[a*6+5]=t+e+1;return g};var l={attributes:{vertexPosition:c.POSITION,vertexUV0:c.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,diffuseMap:b.TEXTURE0,time:b.TIME},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform float time;\nuniform sampler2D diffuseMap;\nvarying vec4 texCol;\nvoid main(void) {\n\ttexCol = texture2D(diffuseMap, vertexUV0 + vec2(time*0.0));\n\tfloat height = length(texCol.rgb);\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * \n\t\tvec4(vertexPosition.x,vertexPosition.y,height*5.0, 1.0);\n}",
fshader:"precision mediump float;\nvarying vec4 texCol;\nvoid main(void)\n{\n\tgl_FragColor = texCol;\n}"};return g});
define("goo/util/Handy",[],function(){function f(){}f.deepFreeze=function(d){var c,a;Object.freeze(d);for(a in d)c=d[a],d.hasOwnProperty(a)&&!(typeof c!=="object"||Object.isFrozen(c))&&f.deepFreeze(c)};f.defineProperty=function(d,c,a,b){var e=a;Object.defineProperty(d,c,{get:function(){return e},set:function(a){e=a;b(e)},configurable:!0,enumerable:!0})};f.addListener=function(d,c,a,b){var e=d[c];Object.defineProperty(d,c,{get:function(){a&&a();return e},set:function(a){e=a;b&&b(e)},configurable:!0,
enumerable:!0})};return f});
define("goo/math/Vector4",["goo/math/Vector"],function(f){function d(){f.call(this,4);arguments.length!==0?this.set(arguments):this.setd(0,0,0,0)}d.prototype=Object.create(f.prototype);d.prototype.setupAliases([["x","r"],["y","g"],["z","b"],["w","a"]]);d.ZERO=new d(0,0,0,0);d.ONE=new d(1,1,1,1);d.UNIT_X=new d(1,0,0,0);d.UNIT_Y=new d(0,1,0,0);d.UNIT_Z=new d(0,0,1,0);d.UNIT_W=new d(0,0,0,1);d.add=function(c,a,b){typeof c==="number"&&(c=[c,c,c,c]);typeof a==="number"&&(a=[a,a,a,a]);b||(b=new d);c=c.data||
c;a=a.data||a;if(c.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};b.data[0]=c[0]+a[0];b.data[1]=c[1]+a[1];b.data[2]=c[2]+a[2];b.data[3]=c[3]+a[3];return b};d.prototype.add=function(c){return d.add(this,c,this)};d.sub=function(c,a,b){typeof c==="number"&&(c=[c,c,c,c]);typeof a==="number"&&(a=[a,a,a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
b.data[0]=c[0]-a[0];b.data[1]=c[1]-a[1];b.data[2]=c[2]-a[2];b.data[3]=c[3]-a[3];return b};d.prototype.sub=function(c){return d.sub(this,c,this)};d.mul=function(c,a,b){typeof c==="number"&&(c=[c,c,c,c]);typeof a==="number"&&(a=[a,a,a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};b.data[0]=c[0]*a[0];b.data[1]=c[1]*a[1];b.data[2]=c[2]*a[2];b.data[3]=c[3]*a[3];return b};d.prototype.mul=function(c){return d.mul(this,
c,this)};d.div=function(c,a,b){typeof c==="number"&&(c=[c,c,c,c]);typeof a==="number"&&(a=[a,a,a,a]);b||(b=new d);c=c.data||c;a=a.data||a;if(c.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};b.data[0]=c[0]/a[0];b.data[1]=c[1]/a[1];b.data[2]=c[2]/a[2];b.data[3]=c[3]/a[3];return b};d.prototype.div=function(c){return d.div(this,c,this)};d.dot=function(c,a){typeof c==="number"&&(c=[c,c,c,c]);typeof a==="number"&&(a=[a,a,a,a]);var b=c.data||c,
e=a.data||a;if(b.length!==4||e.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var d=0;d+=b[0]*e[0];d+=b[1]*e[1];d+=b[2]*e[2];d+=b[3]*e[3];return d};d.prototype.dot=function(c){return d.dot(this,c)};d.prototype.lerp=function(c,a){this.x=(1-a)*this.x+a*c.x;this.y=(1-a)*this.y+a*c.y;this.z=(1-a)*this.z+a*c.z;this.w=(1-a)*this.w+a*c.w;return this};d.prototype.setd=function(c,a,b,e){this.data[0]=c;this.data[1]=a;this.data[2]=b;this.data[3]=e;return this};
d.prototype.seta=function(c){this.data[0]=c[0];this.data[1]=c[1];this.data[2]=c[2];this.data[3]=c[3];return this};d.prototype.setv=function(c){this.data[0]=c.data[0];this.data[1]=c.data[1];this.data[2]=c.data[2];this.data[3]=c.data[3];return this};return d});
define("goo/math/Plane",["goo/math/Vector3"],function(f){function d(c,a){this.normal=c!==void 0?new f(c):new f(f.UNIT_Y);this.constant=isNaN(a)?0:a}d.XZ=new d(f.UNIT_Y,0);d.XY=new d(f.UNIT_Z,0);d.YZ=new d(f.UNIT_X,0);d.prototype.pseudoDistance=function(c){return this.normal.dot(c)-this.constant};d.prototype.setPlanePoints=function(c,a,b){this.normal.set(a).subtractLocal(c);this.normal.crossLocal(b.x-c.x,b.y-c.y,b.z-c.z).normalizeLocal();this.constant=this.normal.dot(c);return this};d.prototype.reflectVector=
function(c,a){var b=a;b===null&&(b=new f);var e=this.normal.dot(c)*2;b.set(c).subtractLocal(this.normal.x*e,this.normal.y*e,this.normal.z*e);return b};return d});
define("goo/math/Ray",["goo/math/Vector3","goo/math/MathUtils"],function(f,d){function c(a,b){this.origin=a||new f;this.direction=b||(new f).copy(f.UNIT_Z)}c.prototype.intersects=function(a,b,c){if(a.length===3)return this.intersectsTriangle(a[0],a[1],a[2],b,c);else if(a.length===4)return this.intersectsTriangle(a[0],a[1],a[2],b,c)||this.intersectsTriangle(a[0],a[2],a[3],b,c);return!1};c.prototype.intersectsTriangle=function(a,b,c,g,l){var k=(new f).set(this.origin).sub(a),b=(new f).set(b).sub(a),
a=(new f).set(c).sub(a),i=(new f).set(b).cross(a),c=this.direction.dot(i),h;if(c>d.EPSILON)h=1;else if(c<-d.EPSILON)h=-1,c=-c;else return!1;var a=h*this.direction.dot(f.cross(k,a,a)),j=!1;if(a>=0&&(b=h*this.direction.dot(b.cross(k)),b>=0&&a+b<=c&&(k=-h*k.dot(i),k>=0))){if(!l)return!0;c=1/c;k*=c;g?l.set(k,a*c,b*c):l.copy(this.origin).add(this.direction.x*k,this.direction.y*k,this.direction.z*k);j=!0}return j};c.prototype.getDistanceToPrimitive=function(a){var b=new f;return this.intersects(a,!1,b)?
this.origin.distance(b.x,b.y,b.z):Infinity};c.prototype.intersectsPlane=function(a,b){var c=a.normal,d=c.dot(this.direction);if(Math.abs(d)<1.0E-5)return!1;c=(-c.dot(this.origin)+a.constant)/d;if(c<1.0E-5)return!1;b!==null&&b.set(this.direction).multiplyLocal(c).addLocal(this.origin);return!0};c.prototype.distanceSquared=function(a,b){var c=new f;c.set(a).subtractLocal(this.origin);var d=this.direction.dot(c);d>0?(c.set(this.direction).multiplyLocal(d),c.addLocal(this.origin)):c.set(this.origin);
b!==null&&b.set(c);a.subtract(c,c);return c.lengthSquared()};return c});
define("goo/renderer/Camera","goo/util/Handy,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/math/Plane,goo/math/MathUtils,goo/math/Ray,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/renderer/bounds/BoundingVolume".split(","),function(f,d,c,a,b,e,g,l,k,i){function h(e,g,i,l){this.translation=new d(0,0,0);this._left=new d(-1,0,0);this._up=new d(0,1,0);this._direction=new d(0,0,-1);f.defineProperty(this,"this._depthRangeNear",0,function(){this._depthRangeDirty=!0});
f.defineProperty(this,"this._depthRangeFar",1,function(){this._depthRangeDirty=!0});this._depthRangeDirty=!0;this._frustumNear=1;this._frustumFar=2;this._frustumLeft=-0.5;this._frustumTop=this._frustumRight=0.5;this._frustumBottom=-0.5;this._coeffLeft=[];this._coeffRight=[];this._coeffBottom=[];this._coeffTop=[];this._viewPortLeft=0;this._viewPortTop=this._viewPortRight=1;this._viewPortBottom=0;this._planeQuantity=6;this._worldPlane=[];for(var k=0;k<h.FRUSTUM_PLANES;k++)this._worldPlane[k]=new b;
this._newDirection=new d;this.projectionMode=h.Perspective;this._updateInverseMVPMatrix=this._updateMVPMatrix=this._updatePMatrix=this._updateInverseMVMatrix=this._updateMVMatrix=!0;this.modelView=new a;this.modelViewInverse=new a;this.projection=new a;this.modelViewProjection=new a;this.modelViewProjectionInverse=new a;this._viewPortDirty=this._depthRangeDirty=!0;this._planeState=0;this._clipPlane=new c;this._qCalc=new c;this._corners=[];for(k=0;k<8;k++)this._corners.push(new d);this._extents=new d;
this.vNearPlaneCenter=new d;this.vFarPlaneCenter=new d;this.direction=new d;this.left=new d;this.up=new d;this.planeNormal=new d;this.setFrustumPerspective(e,g,i,l);this.onFrameChange()}h.LEFT_PLANE=0;h.RIGHT_PLANE=1;h.BOTTOM_PLANE=2;h.TOP_PLANE=3;h.FAR_PLANE=4;h.NEAR_PLANE=5;h.FRUSTUM_PLANES=6;h.Perspective=0;h.Parallel=1;h.Custom=2;h.Outside=0;h.Inside=1;h.Intersects=2;h.prototype.normalize=function(){this._left.normalize();this._up.normalize();this._direction.normalize();this.onFrameChange()};
h.prototype.setFrustumPerspective=function(a,b,c,d){if(a!==void 0&&a!==null)this.fov=a;if(b!==void 0&&b!==null)this.aspect=b;if(c!==void 0&&c!==null)this.near=c;if(d!==void 0&&d!==null)this.far=d;if(this.fov!==void 0)a=Math.tan(this.fov*e.DEG_TO_RAD*0.5)*this.near,b=a*this.aspect,this._frustumLeft=-b,this._frustumRight=b,this._frustumBottom=-a,this._frustumTop=a,this._frustumNear=this.near,this._frustumFar=this.far,this.onFrustumChange()};h.prototype.setFrustum=function(a,b,c,e,d,g){this.near=this._frustumNear=
a;this.far=this._frustumFar=b;this._frustumLeft=c;this._frustumRight=e;this._frustumTop=d;this._frustumBottom=g;this.onFrustumChange()};h.prototype.copy=function(a){this.translation.setv(a.translation);this._left.setv(a._left);this._up.setv(a._up);this._direction.setv(a._direction);this.fov=a.fov;this.aspect=a.aspect;this.near=a.near;this.far=a.far;this._frustumLeft=a._frustumLeft;this._frustumRight=a._frustumRight;this._frustumBottom=a._frustumBottom;this._frustumTop=a._frustumTop;this._frustumNear=
a._frustumNear;this._frustumFar=a._frustumFar;this.projectionMode=a.projectionMode;this._depthRangeDirty=!0;this.onFrustumChange();this.onFrameChange()};h.prototype.setFrame=function(a,b,c,e){this._left.copy(b);this._up.copy(c);this._direction.copy(e);this.translation.copy(a);this.onFrameChange()};h.prototype.lookAt=function(a,b){this._newDirection.copy(a).sub(this.translation).normalize();this._newDirection.equals(this._direction)||(this._direction.copy(this._newDirection),this._up.copy(b).normalize(),
this._up.equals(d.ZERO)&&this._up.copy(d.UNIT_Y),this._left.copy(this._up).cross(this._direction).normalize(),this._left.equals(d.ZERO)&&(this._direction.x!==0?this._left.set(this._direction.y,-this._direction.x,0):this._left.set(0,this._direction.z,-this._direction.y)),this._up.copy(this._direction).cross(this._left).normalize(),this.onFrameChange())};h.prototype.makeDirty=function(){this._viewPortDirty=this._depthRangeDirty=!0};h.prototype.update=function(){this._depthRangeDirty=!0;this.onFrustumChange();
this.onFrameChange()};h.prototype.setViewPort=function(){console.warn("Camera.setViewPort() not implemented.")};h.prototype.contains=function(a){if(!a)return h.Inside;for(var b=h.Inside,c=h.FRUSTUM_PLANES-1;c>=0;c--)switch(a.whichSide(this._worldPlane[c])){case i.Inside:return h.Outside;case i.Intersects:b=h.Intersects}return b};h.prototype.onFrustumChange=function(){if(this.projectionMode===h.Perspective){var a=this._frustumNear*this._frustumNear,b=this._frustumRight*this._frustumRight,c=this._frustumBottom*
this._frustumBottom,e=this._frustumTop*this._frustumTop,d=1/Math.sqrt(a+this._frustumLeft*this._frustumLeft);this._coeffLeft[0]=this._frustumNear*d;this._coeffLeft[1]=-this._frustumLeft*d;d=1/Math.sqrt(a+b);this._coeffRight[0]=-this._frustumNear*d;this._coeffRight[1]=this._frustumRight*d;d=1/Math.sqrt(a+c);this._coeffBottom[0]=this._frustumNear*d;this._coeffBottom[1]=-this._frustumBottom*d;d=1/Math.sqrt(a+e);this._coeffTop[0]=-this._frustumNear*d;this._coeffTop[1]=this._frustumTop*d}else this.projectionMode===
h.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft[0]=-1,this._coeffLeft[1]=0,this._coeffRight[0]=1):(this._coeffLeft[0]=1,this._coeffLeft[1]=0,this._coeffRight[0]=-1),this._coeffRight[1]=0,this._frustumTop>this._frustumBottom?(this._coeffBottom[0]=-1,this._coeffBottom[1]=0,this._coeffTop[0]=1):(this._coeffBottom[0]=1,this._coeffBottom[1]=0,this._coeffTop[0]=-1),this._coeffTop[1]=0);this._updateInverseMVPMatrix=this._updateInverseMVMatrix=this._updateMVPMatrix=this._updatePMatrix=
!0};h.prototype.onFrameChange=function(){var a=this._direction.dot(this.translation),b=this.planeNormal;b.x=this._left.x*this._coeffLeft[0];b.y=this._left.y*this._coeffLeft[0];b.z=this._left.z*this._coeffLeft[0];b.add([this._direction.x*this._coeffLeft[1],this._direction.y*this._coeffLeft[1],this._direction.z*this._coeffLeft[1]]);this._worldPlane[h.LEFT_PLANE].normal.copy(b);this._worldPlane[h.LEFT_PLANE].constant=this.translation.dot(b);b.x=this._left.x*this._coeffRight[0];b.y=this._left.y*this._coeffRight[0];
b.z=this._left.z*this._coeffRight[0];b.add([this._direction.x*this._coeffRight[1],this._direction.y*this._coeffRight[1],this._direction.z*this._coeffRight[1]]);this._worldPlane[h.RIGHT_PLANE].normal.copy(b);this._worldPlane[h.RIGHT_PLANE].constant=this.translation.dot(b);b.x=this._up.x*this._coeffBottom[0];b.y=this._up.y*this._coeffBottom[0];b.z=this._up.z*this._coeffBottom[0];b.add([this._direction.x*this._coeffBottom[1],this._direction.y*this._coeffBottom[1],this._direction.z*this._coeffBottom[1]]);
this._worldPlane[h.BOTTOM_PLANE].normal.copy(b);this._worldPlane[h.BOTTOM_PLANE].constant=this.translation.dot(b);b.x=this._up.x*this._coeffTop[0];b.y=this._up.y*this._coeffTop[0];b.z=this._up.z*this._coeffTop[0];b.add([this._direction.x*this._coeffTop[1],this._direction.y*this._coeffTop[1],this._direction.z*this._coeffTop[1]]);this._worldPlane[h.TOP_PLANE].normal.copy(b);this._worldPlane[h.TOP_PLANE].constant=this.translation.dot(b);if(this.projectionMode===h.Parallel)this._frustumRight>this._frustumLeft?
(this._worldPlane[h.LEFT_PLANE].constant=this._worldPlane[h.LEFT_PLANE].contant+this._frustumLeft,this._worldPlane[h.RIGHT_PLANE].constant=this._worldPlane[h.RIGHT_PLANE].contant-this._frustumRight):(this._worldPlane[h.LEFT_PLANE].constant=this._worldPlane[h.LEFT_PLANE].contant-this._frustumLeft,this._worldPlane[h.RIGHT_PLANE].constant=this._worldPlane[h.RIGHT_PLANE].contant+this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[h.TOP_PLANE].constant=this._worldPlane[h.TOP_PLANE].contant+
this._frustumTop,this._worldPlane[h.BOTTOM_PLANE].constant=this._worldPlane[h.BOTTOM_PLANE].contant-this._frustumBottom):(this._worldPlane[h.TOP_PLANE].constant=this._worldPlane[h.TOP_PLANE].contant-this._frustumTop,this._worldPlane[h.BOTTOM_PLANE].constant=this._worldPlane[h.BOTTOM_PLANE].contant+this._frustumBottom);b.copy(this._direction).invert();this._worldPlane[h.FAR_PLANE].normal.copy(b);this._worldPlane[h.FAR_PLANE].constant=-(a+this._frustumFar);this._worldPlane[h.NEAR_PLANE].normal.copy(this._direction);
this._worldPlane[h.NEAR_PLANE].constant=a+this._frustumNear;this._updateInverseMVPMatrix=this._updateInverseMVMatrix=this._updateMVPMatrix=this._updateMVMatrix=!0};h.prototype.updateProjectionMatrix=function(){if(this.projectionMode===h.Parallel){this.projection.setIdentity();var a=this.projection.data;a[0]=2/(this._frustumRight-this._frustumLeft);a[5]=2/(this._frustumTop-this._frustumBottom);a[10]=-2/(this._frustumFar-this._frustumNear);a[12]=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-
this._frustumLeft);a[13]=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom);a[14]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear)}else if(this.projectionMode===h.Perspective)this.projection.setIdentity(),a=this.projection.data,a[0]=2*this._frustumNear/(this._frustumRight-this._frustumLeft),a[5]=2*this._frustumNear/(this._frustumTop-this._frustumBottom),a[8]=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),a[9]=(this._frustumTop+
this._frustumBottom)/(this._frustumTop-this._frustumBottom),a[10]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),a[11]=-1,a[14]=-(2*this._frustumFar*this._frustumNear)/(this._frustumFar-this._frustumNear),a[15]=0};h.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var a=this.modelView.data;a[0]=-this._left.x;a[4]=-this._left.y;a[8]=-this._left.z;a[1]=this._up.x;a[5]=this._up.y;a[9]=this._up.z;a[2]=-this._direction.x;a[6]=-this._direction.y;a[10]=
-this._direction.z;a[12]=this._left.dot(this.translation);a[13]=-this._up.dot(this.translation);a[14]=this._direction.dot(this.translation)};h.prototype.getPickRay=function(a,b,c,e,f){f||(f=new g);var h=new d,i=new d;this.getWorldCoordinates(a,e-b,c,e,0,h);this.getWorldCoordinates(a,e-b,c,e,0.3,i).sub(h).normalize();f.origin.copy(h);f.direction.copy(i);return f};h.prototype.getWorldCoordinates=function(a,b,e,g,f,h){h||(h=new d);this.checkInverseModelViewProjection();var i=new c;i.set((a/e-this._viewPortLeft)/
(this._viewPortRight-this._viewPortLeft)*2-1,(b/g-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom)*2-1,f*2-1,1);this.modelViewProjectionInverse.applyPost(i);i.mul(1/i.w);h.x=i.x;h.y=i.y;h.z=i.z;return h};h.prototype.getScreenCoordinates=function(a,b,c,e){e=this.getNormalizedDeviceCoordinates(a,e);e.x=(e.x+1)*(this._viewPortRight-this._viewPortLeft)/2*b;e.y=(e.y+1)*(this._viewPortTop-this._viewPortBottom)/2*c;e.z=(e.z+1)/2;return e};h.prototype.getFrustumCoordinates=function(a,b){b=this.getNormalizedDeviceCoordinates(a,
b);b.x=(b.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft;b.y=(b.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom;b.z=(b.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear;return b};h.prototype.getNormalizedDeviceCoordinates=function(a,b){b||(b=new d);this.checkModelViewProjection();var e=new c;e.set(a.x,a.y,a.z,1);this.modelViewProjection.applyPost(e);e.mul(1/e.w);b.x=e.x;b.y=e.y;b.z=e.z;return b};h.prototype.checkModelView=function(){if(this._updateMVMatrix)this.updateModelViewMatrix(),
this._updateMVMatrix=!1};h.prototype.checkProjection=function(){if(this._updatePMatrix)this.updateProjectionMatrix(),this._updatePMatrix=!1};h.prototype.checkModelViewProjection=function(){if(this._updateMVPMatrix)this.checkModelView(),this.checkProjection(),this.modelViewProjection.copy(this.getProjectionMatrix()).combine(this.getViewMatrix()),this._updateMVPMatrix=!1};h.prototype.checkInverseModelView=function(){if(this._updateInverseMVMatrix)this.checkModelView(),a.invert(this.modelView,this.modelViewInverse),
this._updateInverseMVMatrix=!1};h.prototype.checkInverseModelViewProjection=function(){if(this._updateInverseMVPMatrix)this.checkModelViewProjection(),a.invert(this.modelViewProjection,this.modelViewProjectionInverse),this._updateInverseMVPMatrix=!1};h.prototype.getViewMatrix=function(){this.checkModelView();return this.modelView};h.prototype.getProjectionMatrix=function(){this.checkProjection();return this.projection};h.prototype.getViewProjectionMatrix=function(){this.checkModelViewProjection();
return this.modelViewProjection};h.prototype.getViewInverseMatrix=function(){this.checkInverseModelView();return this.modelViewInverse};h.prototype.getViewProjectionInverseMatrix=function(){this.checkInverseModelViewProjection();return this.modelViewProjectionInverse};h.prototype.pack=function(a){for(var b=a.center,e=this._corners,d=this._extents,g=0;g<e.length;g++)e[g].set(b);a instanceof l?d.setd(a.xExtent,a.yExtent,a.zExtent):a instanceof k&&d.setd(a.radius,a.radius,a.radius);e[0].add_d(d.x,d.y,
d.z);e[1].add_d(d.x,-d.y,d.z);e[2].add_d(d.x,d.y,-d.z);e[3].add_d(d.x,-d.y,-d.z);e[4].add_d(-d.x,d.y,d.z);e[5].add_d(-d.x,-d.y,d.z);e[6].add_d(-d.x,d.y,-d.z);e[7].add_d(-d.x,-d.y,-d.z);for(var d=this.getViewMatrix(),a=Number.MAX_VALUE,b=-Number.MAX_VALUE,f=new c,g=0;g<e.length;g++)f.setd(e[g].x,e[g].y,e[g].z,1),d.applyPre(f),a=Math.min(-f.z,a),b=Math.max(-f.z,b);a=Math.min(Math.max(this._frustumNear,a),this._frustumFar);b=Math.max(a,Math.min(this._frustumFar,b));e=a/this._frustumNear;this._frustumLeft*=
e;this._frustumRight*=e;this._frustumTop*=e;this._frustumBottom*=e;this._frustumNear=a;this._frustumFar=b};h.prototype.calculateFrustumCorners=function(a,b){var a=a!==void 0?a:this._frustumNear,b=b!==void 0?b:this._frustumFar,c=(this._frustumTop-this._frustumBottom)*a*0.5/this._frustumNear,e=(this._frustumRight-this._frustumLeft)*a*0.5/this._frustumNear,d=(this._frustumTop-this._frustumBottom)*b*0.5/this._frustumNear,g=(this._frustumRight-this._frustumLeft)*b*0.5/this._frustumNear;this.projectionMode===
h.Parallel&&(c=(this._frustumTop-this._frustumBottom)*0.5,e=(this._frustumRight-this._frustumLeft)*0.5,d=(this._frustumTop-this._frustumBottom)*0.5,g=(this._frustumRight-this._frustumLeft)*0.5);var f=this.vNearPlaneCenter,i=this.vFarPlaneCenter,l=this.direction,k=this.left,v=this.up;l.setv(this._direction).mul(a);f.setv(this.translation).addv(l);l.setv(this._direction).mul(b);i.setv(this.translation).addv(l);k.setv(this._left).mul(e);v.setv(this._up).mul(c);this._corners[0].setv(f).subv(k).subv(v);
this._corners[1].setv(f).addv(k).subv(v);this._corners[2].setv(f).addv(k).addv(v);this._corners[3].setv(f).subv(k).addv(v);k.setv(this._left).mul(g);v.setv(this._up).mul(d);this._corners[4].setv(i).subv(k).subv(v);this._corners[5].setv(i).addv(k).subv(v);this._corners[6].setv(i).addv(k).addv(v);this._corners[7].setv(i).subv(k).addv(v);return this._corners};var j=function(a){if(a>0)return 1;else if(a<0)return-1;return 0};h.prototype.setToObliqueMatrix=function(a,b){var b=b||0,e=this._clipPlane.setv(a);
this.getViewMatrix().applyPost(e);e.w=this.translation.y*a.y+b;this._updatePMatrix=!0;var d=this.getProjectionMatrix();this._qCalc.setd((j(e.x)+d[8])/d[0],(j(e.y)+d[9])/d[5],-1,(1+d[10])/d[14]);e.mul(2/c.dot(e,this._qCalc));d[2]=e.x;d[6]=e.y;d[10]=e.z+1;d[14]=e.w;this._updateInverseMVPMatrix=this._updateMVPMatrix=!0};return h});
define("goo/renderer/pass/RenderTarget",["goo/math/Vector2"],function(f){function d(c,a,b){this._glFrameBuffer=this._glRenderBuffer=this.glTexture=null;this.width=c;this.height=a;b=b||{};this.wrapS=b.wrapS!==void 0?b.wrapS:"EdgeClamp";this.wrapT=b.wrapT!==void 0?b.wrapT:"EdgeClamp";this.magFilter=b.magFilter!==void 0?b.magFilter:"Bilinear";this.minFilter=b.minFilter!==void 0?b.minFilter:"BilinearNoMipMaps";this.anisotropy=b.anisotropy!==void 0?b.anisotropy:1;this.offset=new f(0,0);this.repeat=new f(1,
1);this.format=b.format!==void 0?b.format:"RGBA";this.type=b.type!==void 0?b.type:"UnsignedByte";this.variant="2D";this.depthBuffer=b.depthBuffer!==void 0?b.depthBuffer:!0;this.stencilBuffer=b.stencilBuffer!==void 0?b.stencilBuffer:!0;this.generateMipmaps=!1}d.prototype.clone=function(){var c=new d(this.width,this.height);c.wrapS=this.wrapS;c.wrapT=this.wrapT;c.magFilter=this.magFilter;c.anisotropy=this.anisotropy;c.minFilter=this.minFilter;c.offset.copy(this.offset);c.repeat.copy(this.repeat);c.format=
this.format;c.type=this.type;c.variant=this.variant;c.depthBuffer=this.depthBuffer;c.stencilBuffer=this.stencilBuffer;c.generateMipmaps=this.generateMipmaps;return c};return d});
define("goo/renderer/shaders/ShaderFragment",[],function(){function f(){}f.noisecommon="vec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}";f.noise2d=[f.noisecommon,"float snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}"].join("\n");
f.noise3d=[f.noisecommon,"vec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat snoise(vec3 v) {\n\tconst vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i  = floor(v + dot(v, C.yyy) );\n\tvec3 x0 =   v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min( g.xyz, l.zxy );\n\tvec3 i2 = max( g.xyz, l.zxy );\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i); \n\tvec4 p = permute( permute( permute( \n         i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n       + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n       + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3  ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\tvec4 x = x_ *ns.x + ns.yyyy;\n\tvec4 y = y_ *ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4( x.xy, y.xy );\n\tvec4 b1 = vec4( x.zw, y.zw );\n\tvec4 s0 = floor(b0)*2.0 + 1.0;\n\tvec4 s1 = floor(b1)*2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\tvec3 p0 = vec3(a0.xy,h.x);\n\tvec3 p1 = vec3(a0.zw,h.y);\n\tvec3 p2 = vec3(a1.xy,h.z);\n\tvec3 p3 = vec3(a1.zw,h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );\n}"].join("\n");
f.methods={packDepth:"vec4 packDepth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = fract( depth * bit_shift );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}",unpackDepth:"float unpackDepth( const in vec4 rgba_depth ) {\n\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\tfloat depth = dot( rgba_depth, bit_shift );\n\treturn depth;\n}"};
return f});
define("goo/renderer/shaders/ShaderLib",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/entities/World"],function(f,d,c,a){function b(){}b.screenCopy={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};b.copy=
{attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,opacity:1,diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);\n}"};
b.copyPure={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,opacity:1,diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 col = texture2D(diffuseMap, texCoord0);\n\tgl_FragColor = vec4(col.rgb, col.a * opacity);\n}"};
b.simple={attributes:{vertexPosition:f.POSITION},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nvoid main(void)\n{\n\tgl_FragColor = vec4(1.0);\n}"};b.simpleColored={attributes:{vertexPosition:f.POSITION},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,
worldMatrix:d.WORLD_MATRIX,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform vec3 color;\nvoid main(void)\n{\n\tgl_FragColor = vec4(color, 1.0);\n}"};b.simpleLit={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,
cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,materialAmbient:d.AMBIENT,materialDiffuse:d.DIFFUSE,materialSpecular:d.SPECULAR,materialSpecularPower:d.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * worldPos;\n\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvoid main(void)\n{\n\tvec4 final_color = materialAmbient;\n\tvec3 N = normalize(normal);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( max(dot(R, E), 0.0), materialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t\tfinal_color = clamp(final_color, vec4(0.0), vec4(1.0));\n\t}\n\tgl_FragColor = vec4(final_color.rgb, 1.0);\n}"};
b.textured={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};
b.texturedLit={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,diffuseMap:d.TEXTURE0,materialAmbient:d.AMBIENT,materialDiffuse:d.DIFFUSE,materialSpecular:d.SPECULAR,materialSpecularPower:d.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * worldPos;\n\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\ttexCoord0 = vertexUV0;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision highp float;\nuniform sampler2D diffuseMap;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n\tvec4 final_color = materialAmbient;\n\tvec3 N = normalize(normal);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( clamp(dot(R, E), 0.0, 1.0), materialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t}\n\tgl_FragColor = vec4(texCol.rgb * final_color.rgb, texCol.a);\n}"};
b.texturedNormalAOLit={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL,vertexTangent:f.TANGENT,vertexUV0:f.TEXCOORD0,vertexUV1:f.TEXCOORD1,vertexUV2:f.TEXCOORD2},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,diffuseMap:d.TEXTURE0,normalMap:d.TEXTURE1,aoMap:d.TEXTURE2,materialAmbient:d.AMBIENT,materialDiffuse:d.DIFFUSE,materialSpecular:d.SPECULAR,materialSpecularPower:d.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec4 vertexTangent;\nattribute vec2 vertexUV0;\nattribute vec2 vertexUV1;\nattribute vec2 vertexUV2;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 binormal;\nvarying vec3 tangent;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec2 texCoord2;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * worldPos;\n\tnormal = normalize((worldMatrix * vec4(vertexNormal, 0.0)).xyz);\n\ttangent = normalize((worldMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);\n\tbinormal = cross(normal, tangent) * vec3(vertexTangent.w);\n\ttexCoord0 = vertexUV0;\n\ttexCoord1 = vertexUV1;\n\ttexCoord2 = vertexUV2;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform sampler2D normalMap;\nuniform sampler2D aoMap;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 binormal;\nvarying vec3 tangent;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec2 texCoord2;\nvoid main(void)\n{\n\tmat3 tangentToWorld = mat3(tangent,\n\t\t\t\t\t\t\t\tbinormal,\n\t\t\t\t\t\t\t\tnormal);\n\tvec4 texCol = texture2D(diffuseMap, texCoord1);\n\tvec4 final_color = materialAmbient;\n\tvec3 tangentNormal = texture2D(normalMap, texCoord0).xyz * vec3(2.0) - vec3(1.0);\n\tvec3 worldNormal = (tangentToWorld * tangentNormal);\n\tvec3 N = normalize(worldNormal);\n\tvec4 aoCol = texture2D(aoMap, texCoord2);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( max(dot(R, E), 0.0),\n\t\t\t\t\t\tmaterialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t}\n\tgl_FragColor = vec4(texCol.rgb * aoCol.rgb * final_color.rgb, texCol.a);\n}"};
b.convolution={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:f.POSITION,uv:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:0,uImageIncrement:[0.001953125,0],cKernel:[]},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cKernel[ KERNEL_SIZE_INT ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvec2 imageCoord = vUv;\n\tvec4 sum = vec4( 0.0 );\n\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\timageCoord += uImageIncrement;\n\t}\n\tgl_FragColor = sum;\n}",buildKernel:function(a){var b,c,d,f,h=2*Math.ceil(a*3)+1;h>25&&(h=25);f=(h-1)*0.5;c=Array(h);for(b=
d=0;b<h;++b)c[b]=Math.exp(-((b-f)*(b-f))/(2*a*a)),d+=c[b];for(b=0;b<h;++b)c[b]/=d;return c}};b.showDepth={attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,near:d.NEAR_PLANE,far:d.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform float near;\nuniform float far;\nvoid main(void)\n{\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat d = 1.0 - smoothstep( near, far, depth );\n\tgl_FragColor = vec4(d);\n}"};b.showNormals={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\nvNormal = vec3(viewMatrix * worldMatrix * vec4(vertexNormal, 0.0)); //normalMatrix * vertexNormal;\ngl_Position = projectionMatrix * mvPosition;\n}",
fshader:"precision mediump float;\nuniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"};b.bokehShader={attributes:{position:f.POSITION,uv:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tColor:0,tDepth:1,focus:1,aspect:1,aperture:0.025,maxblur:1},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"};
b.particles={attributes:{vertexPosition:f.POSITION,vertexColor:f.COLOR,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void) {\n    texCoord0 = vertexUV0;\n    color = vertexColor;\n\t gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n   if (color.a == 0.0 || texCol.a == 0.0) discard;\n\telse gl_FragColor = texCol * color;\n}"};b.sepia={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,amount:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nvec3 c = color.rgb;\ncolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\ncolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\ncolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\ngl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"};
b.dotscreen={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,tSize:[256,256],center:[0.5,0.5],angle:1.57,scale:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\nfloat s = sin( angle ), c = cos( angle );\nvec2 tex = vUv * tSize - center;\nvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\nreturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nfloat average = ( color.r + color.g + color.b ) / 3.0;\ngl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"};
b.vignette={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,offset:1,darkness:1.5},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\ngl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"};b.film={attributes:b.copy.attributes,uniforms:{tDiffuse:0,time:function(){return a.time},nIntensity:0.5,sIntensity:0.5,sCount:1024,grayscale:0,$link:b.copy.uniforms},vshader:b.copy.vshader,
fshader:"precision mediump float;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 texCoord0;\nvoid main() {\n\tvec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );\n\tfloat x = texCoord0.x * texCoord0.y * time * 1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\n\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\n\tvec2 sc = vec2( sin( texCoord0.y * sCount ), cos( texCoord0.y * sCount ) );\n\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\n\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\n\tif( grayscale ) {\n\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n\t}\n\tgl_FragColor = vec4( cResult, cTextureScreen.a );\n}"};
b.bleachbypass={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 base = texture2D( tDiffuse, vUv );\nvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\nfloat lum = dot( lumCoeff, base.rgb );\nvec3 blend = vec3( lum );\nfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\nvec3 result1 = 2.0 * base.rgb * blend;\nvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\nvec3 newColor = mix( result1, result2, L );\nfloat A2 = opacity * base.a;\nvec3 mixRGB = A2 * newColor.rgb;\nmixRGB += ( ( 1.0 - A2 ) * base.rgb );\ngl_FragColor = vec4( mixRGB, base.a );\n}"};
b.horizontalTiltShift={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,h:0.0078125,r:0.5},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat hh = h * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x,            vUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"};
b.colorify={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v * color, texel.w );\n}"};b.normalmap={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,heightMap:d.TEXTURE0,resolution:[512,512],
height:0.05},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\nfloat val = texture2D( heightMap, vUv ).x;\nfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\nfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\ngl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"};
b.ssao={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,tDepth:d.TEXTURE1,size:[512,512],cameraNear:d.MAIN_NEAR_PLANE,cameraFar:d.MAIN_FAR_PLANE,fogNear:d.MAIN_NEAR_PLANE,fogFar:d.MAIN_FAR_PLANE,fogEnabled:0,onlyAO:1,aoClamp:0.3,lumInfluence:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogEnabled;\nuniform bool onlyAO;\nuniform vec2 size;\nuniform float aoClamp;\nuniform float lumInfluence;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nfloat width = size.x;\nfloat height = size.y;\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nconst int samples = 16;\nconst float radius = 4.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0003;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\nconst vec3 onlyAOColor = vec3( 1.0, 1.0, 1.0 );\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( width / 2.0 ) );\nfloat gg = fract( coord.t * ( height / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat doFog() {\nfloat zdepth = unpackDepth( texture2D( tDepth, vUv ) );\nfloat depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );\nreturn smoothstep( fogNear, fogFar, depth );\n}\nfloat readDepth( const in vec2 coord ) {\nreturn cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat pw;\nfloat ph;\nfloat ao;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\npw = cos( l ) * r;\nph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nif ( fogEnabled ) {\nao = mix( ao, 1.0, doFog() );\n}\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"};
b.skinning={defines:{JOINT_COUNT:56,WEIGHTS:4},attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0,vertexWeights:f.WEIGHTS,vertexJointIDs:f.JOINTIDS},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,diffuseMap:d.TEXTURE0,jointPalette:function(a){var a=a.meshData,b=a.currentPose;if(b!==null){var b=b._matrixPalette,c=a.paletteMap.length*16,d=a.store;if(!d)d=new Float32Array(c),a.store=d;for(var f=0;f<a.paletteMap.length;f++)for(var c=b[a.paletteMap[f]],h=0;h<
4;h++)for(var j=0;j<4;j++)d[f*16+h*4+j]=c.data[j*4+h];return d}}},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nattribute vec4 vertexWeights;\nattribute vec4 vertexJointIDs;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 jointPalette[JOINT_COUNT];\nvarying vec2 texCoord0;\nvoid main(void) {\n\tmat4 mat = mat4(0.0);\n\tmat += jointPalette[int(vertexJointIDs.x)] * vertexWeights.x;\n\tmat += jointPalette[int(vertexJointIDs.y)] * vertexWeights.y;\n\tmat += jointPalette[int(vertexJointIDs.z)] * vertexWeights.z;\n\tmat += jointPalette[int(vertexJointIDs.w)] * vertexWeights.w;\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * mat * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};b.rgbshift={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,amount:0.005,angle:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float amount;\nuniform float angle;\nvarying vec2 vUv;\nvoid main() {\nvec2 offset = amount * vec2( cos(angle), sin(angle));\nvec4 cr = texture2D(tDiffuse, vUv + offset);\nvec4 cga = texture2D(tDiffuse, vUv);\nvec4 cb = texture2D(tDiffuse, vUv - offset);\ngl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n}"};b.brightnesscontrast={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,
worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,brightness:0,contrast:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float brightness;\nuniform float contrast;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb += brightness;\nif (contrast > 0.0) {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n} else {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n}\n}"};
b.luminosity={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v, v, v, texel.w );\n}"};
b.point={attributes:{vertexPosition:f.POSITION,vertexColor:f.COLOR},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,pointSize:2},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform float pointSize;\nvarying vec4 color;\nvoid main(void) {\n\tcolor = vertexColor;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_PointSize = pointSize;\n}",fshader:"precision mediump float;\nvarying vec4 color;\nvoid main(void)\n{\n\tgl_FragColor = color;\n}"};
b.toon={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,HighlightColour:[0.9,0.8,0.7,1],MidColour:[0.65,0.55,0.45,1],ShadowColour:[0.4,0.3,0.2,1],HighlightSize:0.2,ShadowSize:0.01,OutlineWidth:0.15},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 N;\nvarying vec3 V;\nvarying vec3 L;\nvoid main()\n{\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tN = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tL = lightPosition - worldPos.xyz;\n\tV = cameraPosition - worldPos.xyz;\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n}",
fshader:"precision mediump float;\nuniform vec4 HighlightColour;\nuniform vec4 MidColour;\nuniform vec4 ShadowColour;\nuniform float HighlightSize;\nuniform float ShadowSize;\nuniform float OutlineWidth;\nvarying vec3 N;\nvarying vec3 L;\nvarying vec3 V;\nvoid main()\n{\n\tvec3 n = normalize(N);\n\tvec3 l = normalize(L);\n\tvec3 v = normalize(V);\n    float lambert = dot(l,n);\n    vec4 colour = MidColour;\n    if (lambert > 1.0 - HighlightSize) colour = HighlightColour;\n    if (lambert < ShadowSize) colour = ShadowColour;\n    if (dot(n,v) < OutlineWidth) colour = vec4(0.0,0.0,0.0,1.0);\n    gl_FragColor = colour;\n}"};
b.differenceOfGaussians={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,gaussBlurredImage1:d.TEXTURE0,gaussBlurredImage2:d.TEXTURE1,originalImage:d.TEXTURE2,threshold:0.01},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D gaussBlurredImage1;\nuniform sampler2D gaussBlurredImage2;\nuniform sampler2D originalImage;\nuniform float threshold;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 blur1 = texture2D(gaussBlurredImage1, texCoord0);\n\tvec4 blur2 = texture2D(gaussBlurredImage2, texCoord0);\n\tvec4 originalColor = texture2D(originalImage, texCoord0);\n\tvec3 col = clamp(blur1.rgb - blur2.rgb, 0.0, 1.0);\n\tfloat value = (col.r + col.g + col.b) / 3.0;\n\tvalue = step(threshold, value);\n\tvec3 outputColor = mix(originalColor.rgb, vec3(value), value);\n\tgl_FragColor = vec4(outputColor, 1.0);\n}"};
b.downsample={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\n}"};
b.boxfilter={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,viewport:[128,128]},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform vec2 viewport;\nvarying vec2 vUv;\nvoid main() {\nvec3 result = vec3(0.0);\nfor(int x=-1; x<=1; x++) {\n\tfor(int y=-1; y<=1; y++) {\n\t\tresult += texture2D(tDiffuse, vUv + vec2(x, y) / viewport).rgb;\n\t}\n}\ngl_FragColor = vec4(result / vec3(9.0), 1.0);\n}"};b.lightDepth={attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraFar:d.LIGHT_FAR_PLANE},
vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec3 worldPosition;\nvoid main(void) {\n\tvec4 viewpos = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tworldPosition = viewpos.xyz;\n\tgl_Position = projectionMatrix * viewpos;\n}",fshader:"precision mediump float;\nuniform mat4 viewMatrix;\nuniform float cameraFar;\nvarying vec3 worldPosition;\nvoid main(void)\n{\n\tfloat depth = clamp(length(worldPosition) / cameraFar, 0.0, 1.0);\n\tgl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\n}"};
b.packDepth={attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,farPlane:d.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",fshader:["precision mediump float;\nuniform float farPlane;",
c.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(length(vPosition), farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")};return b});
define("goo/entities/EventHandler",[],function(){function f(){}f.listeners=[];f.dispatch=function(){if(arguments.length===0)throw Error("Event needs to specify a callback as first argument");for(var d=arguments[0],c=Array.prototype.slice.call(arguments,1),a=0;a<f.listeners.length;a++){var b=f.listeners[a];b[d]&&b[d].apply(null,c)}};f.addListener=function(d){f.listeners.indexOf(d)===-1&&f.listeners.push(d)};f.removeListener=function(d){d=f.listeners.indexOf(d);d!==-1&&f.listeners.splice(d,1)};return f});
define("goo/addons/water/FlatWaterRenderer","goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/Camera,goo/math/Plane,goo/renderer/pass/RenderTarget,goo/math/Vector3,goo/math/Vector4,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/shaders/ShaderLib,goo/entities/EventHandler,goo/renderer/shaders/ShaderFragment".split(","),function(f,d,c,a,b,e,g,l,k,i,h,j){function n(d,f){this.camera=d;f=f||{};this.useRefraction=f.useRefraction!==void 0?f.useRefraction:!0;this.waterCamera=new c(45,
1,0.1,2E3);this.renderList=[];this.waterPlane=new a;var i=window.innerWidth/(f.divider||2),t=window.innerHeight/(f.divider||2);this.reflectionTarget=new b(i,t);if(this.useRefraction)this.refractionTarget=new b(i,t),this.depthTarget=new b(i,t);i=l.createMaterial(o,"WaterMaterial");i.shader.defines.REFRACTION=this.useRefraction;i.cullState.enabled=!1;t=f.normalsUrl||"../resources/water/waternormals3.png";i.textures[0]=(new k).loadTexture2D(t);i.textures[1]=this.reflectionTarget;if(this.useRefraction)i.textures[2]=
this.refractionTarget,i.textures[3]=this.depthTarget;this.waterMaterial=i;this.followCam=!0;this.calcVect=new e;this.camReflectDir=new e;this.camReflectUp=new e;this.camReflectLeft=new e;this.camLocation=new e;this.camReflectPos=new e;this.offset=new e;this.clipPlane=new g;this.waterEntity=null;this.depthMaterial=l.createMaterial(q,"depth");var j=this;this.camera=null;this.lights=[];h.addListener({setCurrentCamera:function(a){j.camera=a},setLights:function(a){j.lights=a}})}n.prototype.process=function(a,
b,c){var e=this.camera,d=this.waterPlane;this.waterCamera.copy(e);d.constant=this.waterEntity.transformComponent.transform.translation.y;var f=e.translation.y>d.constant;this.waterEntity.skip=!0;if(f){if(this.useRefraction)c.process(this.waterCamera,b,this.renderList),this.clipPlane.setd(d.normal.x,-d.normal.y,d.normal.z,d.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),a.overrideMaterial=this.depthMaterial,a.render(this.renderList,this.waterCamera,this.lights,this.depthTarget,!0),a.overrideMaterial=
null,a.render(this.renderList,this.waterCamera,this.lights,this.refractionTarget,!0);var g=this.calcVect,h=this.camReflectDir,i=this.camReflectUp,l=this.camReflectLeft,k=this.camLocation,j=this.camReflectPos;k.set(e.translation);var n=d.pseudoDistance(k);g.set(d.normal).mul(n*2);j.set(k.sub(g));k.set(e.translation).add(e._direction);n=d.pseudoDistance(k);g.set(d.normal).mul(n*2);h.set(k.sub(g)).sub(j).normalize();k.set(e.translation).add(e._up);n=d.pseudoDistance(k);g.set(d.normal).mul(n*2);i.set(k.sub(g)).sub(j).normalize();
l.set(i).cross(h).normalize();this.waterCamera.translation.set(j);this.waterCamera._direction.set(h);this.waterCamera._up.set(i);this.waterCamera._left.set(l);this.waterCamera.normalize();this.waterCamera.update();if(this.skybox&&this.followCam)g=this.skybox.transformComponent.worldTransform,g.translation.setv(j),g.update()}this.waterMaterial.shader.uniforms.abovewater=f;c.process(this.waterCamera,b,this.renderList);a.setRenderTarget(this.reflectionTarget);a.clear();if(this.skybox)if(this.skybox instanceof
Array){this.clipPlane.setd(d.normal.x,d.normal.y,d.normal.z,d.constant);this.waterCamera.setToObliqueMatrix(this.clipPlane,10);for(b=0;b<this.skybox.length;b++)a.render(this.skybox[b],this.waterCamera,this.lights,this.reflectionTarget,!1),this.skybox[b].skip=!0}else a.render(this.skybox,this.waterCamera,this.lights,this.reflectionTarget,!1),this.skybox.skip=!0;this.clipPlane.setd(d.normal.x,d.normal.y,d.normal.z,d.constant);this.waterCamera.setToObliqueMatrix(this.clipPlane);a.render(this.renderList,
this.waterCamera,this.lights,this.reflectionTarget,!1);this.waterEntity.skip=!1;if(this.skybox)if(this.skybox instanceof Array)for(b=0;b<this.skybox.length;b++)this.skybox[b].skip=!1;else this.skybox.skip=!1;if(f&&this.skybox&&this.followCam)a=e.translation,g=this.skybox.transformComponent.worldTransform,g.translation.setv(a).addv(this.offset),g.update(),this.waterCamera._updatePMatrix=!0};n.prototype.setSkyBox=function(a){this.skybox=a;if(a.meshRendererComponent)this.skybox.meshRendererComponent.materials[0].depthState.enabled=
!1,this.skybox.meshRendererComponent.materials[0].renderQueue=0,this.skybox.meshRendererComponent.cullMode="Never"};n.prototype.setWaterEntity=function(a){this.waterEntity=a;this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial};var o={defines:{REFRACTION:!1},attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,normalMap:d.TEXTURE0,reflection:d.TEXTURE1,
refraction:d.TEXTURE2,depthmap:d.TEXTURE3,vertexTangent:[1,0,0,1],waterColor:[0.0625,0.0625,0.0625],abovewater:!0,fogColor:[1,1,1],sunDirection:[0.66,0.66,0.33],sunColor:[1,1,0.5],sunShininess:100,sunSpecPower:4,fogStart:0,fogScale:2E3,timeMultiplier:1,time:d.TIME,distortionMultiplier:0.025,fresnelPow:2,normalMultiplier:3,fresnelMultiplier:1,waterScale:5,doFog:!0,resolution:d.RESOLUTION},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform vec4 vertexTangent;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform float waterScale;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvoid main(void) {\n\tworldPos = (worldMatrix * vec4(vertexPosition, 1.0)).xyz;\n\ttexCoord0 = worldPos.xz * waterScale;\n\tmat3 normalMatrix = mat3(worldMatrix);\n\tvec3 n = normalize(normalMatrix * vec3(vertexNormal.x, vertexNormal.y, -vertexNormal.z));\n\tvec3 t = normalize(normalMatrix * vertexTangent.xyz);\n\tvec3 b = cross(n, t) * vertexTangent.w;\n\tmat3 rotMat = mat3(t, b, n);\n\tvec3 eyeDir = worldPos - cameraPosition;\n\teyeVec = eyeDir * rotMat;\n\tviewCoords = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewCoords;\n}",
fshader:["precision highp float;\nuniform sampler2D normalMap;\nuniform sampler2D reflection;\n#ifdef REFRACTION\nuniform sampler2D refraction;\nuniform sampler2D depthmap;\n#endif\nuniform vec3 waterColor;\nuniform bool abovewater;\nuniform vec3 fogColor;\nuniform float fogStart;\nuniform float fogScale;\nuniform vec3 sunDirection;\nuniform float time;\nuniform float timeMultiplier;\nuniform float distortionMultiplier;\nuniform float fresnelPow;\nuniform vec3 sunColor;\nuniform float sunShininess;\nuniform float sunSpecPower;\nuniform float normalMultiplier;\nuniform float fresnelMultiplier;\nuniform bool doFog;\nuniform vec2 resolution;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvec4 getNoise(vec2 uv) {\n\tfloat t = time * timeMultiplier;\n    vec2 uv0 = (uv/vec2(123.0)) + vec2(t/17.0, t/29.0);\n    vec2 uv1 = (uv/vec2(167.0)) - vec2(t/-19.0, t/31.0);\n    vec2 uv2 = uv/vec2(827.0, 983.0) + vec2(t/51.0, t/47.0);\n    vec2 uv3 = uv/vec2(991.0, 877.0) - vec2(t/59.0, t/-63.0);\n    vec4 noise = (texture2D(normalMap, uv0)*0.25) +\n                 (texture2D(normalMap, uv1)*0.25) +\n                 (texture2D(normalMap, uv2)*0.75) +\n                 (texture2D(normalMap, uv3)*1.0);\n    return noise/2.25-0.48;\n}\nvoid sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, const float shiny, const float spec, inout vec3 specularColor){\n    vec3 reflection = normalize(reflect(-sunDirection, surfaceNormal));\n    float direction = max(0.0, dot(normalize(eyeDirection), reflection));\n    specularColor += pow(direction, shiny) * spec * sunColor;\n}",
j.methods.unpackDepth,"void main(void)\n{\n\tfloat fogDist = clamp((viewCoords.z-fogStart)/fogScale,0.0,1.0);\n\tvec2 normCoords = texCoord0;\n\tvec4 noise = getNoise(normCoords);\n\tvec3 normalVector = normalize(noise.xyz * vec3(normalMultiplier, normalMultiplier, 1.0));\n\tvec3 localView = normalize(eyeVec);\n\tfloat fresnel = dot(normalize(normalVector * vec3(fresnelMultiplier, fresnelMultiplier, 1.0)), localView);\n\tif ( abovewater == false ) {\n\t\tfresnel = -fresnel;\n\t}\n\tfresnel *= 1.0 - fogDist;\n\tfloat fresnelTerm = 1.0 - fresnel;\n\tfresnelTerm = pow(fresnelTerm, fresnelPow);\n\tfresnelTerm = clamp(fresnelTerm, 0.0, 1.0);\n\tfresnelTerm = fresnelTerm * 0.95 + 0.05;\n\tvec2 projCoord = viewCoords.xy / viewCoords.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tprojCoord.y -= 1.0 / resolution.y;\n#ifdef REFRACTION\n\tfloat depthUnpack = unpackDepth(texture2D(depthmap, projCoord));\n\tif (depthUnpack > 0.5) {depthUnpack = 0.0;}\n\tfloat depth2 = clamp(depthUnpack * 400.0, 0.0, 1.0);\n\tvec2 projCoordRefr = vec2(projCoord);\n\tprojCoordRefr += (normalVector.xy * distortionMultiplier) * (depth2);\n\tprojCoordRefr = clamp(projCoordRefr, 0.001, 0.999);\n\tdepthUnpack = unpackDepth(texture2D(depthmap, projCoordRefr));\n\tfloat depth = clamp(depthUnpack * 40.0, 0.8, 1.0);\n#else\n#endif\n\tprojCoord += (normalVector.xy * distortionMultiplier);\n\tprojCoord = clamp(projCoord, 0.001, 0.999);\n\tif ( abovewater == true ) {\n\t\tprojCoord.x = 1.0 - projCoord.x;\n\t}\n\tvec4 waterColorX = vec4(waterColor, 1.0);\n\tvec4 reflectionColor = texture2D(reflection, projCoord);\n\tif ( abovewater == false ) {\n\t\treflectionColor *= vec4(0.8,0.9,1.0,1.0);\n\t\tvec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);\n\t\tgl_FragColor = mix(endColor,waterColorX,fogDist);\n\t}\n\telse {\n\t\tvec3 specular = vec3(0.0);\n\t    sunLight(normalVector, localView, sunShininess, sunSpecPower, specular);\n\t\tvec4 endColor = waterColorX;\n#ifdef REFRACTION\n\t\tvec4 refractionColor = texture2D(refraction, projCoordRefr) * vec4(0.6);\n\t\tendColor = mix(refractionColor, waterColorX, depth);\n#endif\n\t\tendColor = mix(endColor, reflectionColor, fresnelTerm);\n\t\tif (doFog) {\n\t\t\tgl_FragColor = (vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist)) * (1.0-fogDist) + vec4(fogColor, 1.0) * fogDist;\n\t\t} else {\n\t\t\tgl_FragColor = vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist);\n\t\t}\n\t}\n}"].join("\n")},
q={attributes:{vertexPosition:f.POSITION},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,farPlane:d.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * vPosition;\n}",fshader:["precision highp float;\nuniform float farPlane;",j.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = abs(vPosition.y) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")};
return n});
define("goo/shapes/Torus",["goo/renderer/MeshData","goo/math/Vector3","goo/math/MathUtils"],function(f,d,c){function a(a,b,c,d){this._circleSamples=a!==void 0?a:8;this._radialSamples=b!==void 0?b:8;this._tubeRadius=c!==void 0?c:1;this._centerRadius=d!==void 0?d:2;this.viewInside=!1;a=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]);f.call(this,a,(this._circleSamples+1)*(this._radialSamples+1),6*this._circleSamples*this._radialSamples);this.rebuild()}function b(a,b,c){a[c*3+0]=a[b*3+0];a[c*3+1]=a[b*
3+1];a[c*3+2]=a[b*3+2]}a.prototype=Object.create(f.prototype);a.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(f.POSITION),g=this.getAttributeBuffer(f.NORMAL),l=this.getAttributeBuffer(f.TEXCOORD0),k=this.getIndexBuffer(),i=1/this._circleSamples,h=1/this._radialSamples,j=0,n=new d,o=new d,q=new d,m=0;m<this._circleSamples;m++){var s=m*i,p=c.TWO_PI*s,t=Math.cos(p),p=Math.sin(p);n.set(t,p,0);d.mul(n,this._centerRadius,o);t=j;for(p=0;p<this._radialSamples;p++){var u=p*h,w=c.TWO_PI*u,
r=Math.cos(w),w=Math.sin(w);q.copy(n).mul(r);q.z+=w;q.normalize();this.viewInside?(g[j*3+0]=-q.x,g[j*3+1]=-q.y,g[j*3+2]=-q.z):(g[j*3+0]=q.x,g[j*3+1]=q.y,g[j*3+2]=q.z);q.mul(this._tubeRadius).add(o);a[j*3+0]=q.x;a[j*3+1]=q.y;a[j*3+2]=q.z;l[j*2+0]=u;l[j*2+1]=s;j++}b(a,t,j);b(g,t,j);l[j*2+0]=1;l[j*2+1]=s;j++}for(m=0;m<=this._radialSamples;m++,j++)b(a,m,j),b(g,m,j),i=l,h=m,n=j,i[n*2+0]=i[h*2+0],i[n*2+1]=i[h*2+1],l[j*2+1]=1;for(m=g=a=0;m<this._circleSamples;m++){l=g;i=l+1;g+=this._radialSamples+1;h=g;
n=h+1;for(j=0;j<this._radialSamples;j++)this.viewInside?(k[a++]=l++,k[a++]=i,k[a++]=h,k[a++]=i++,k[a++]=n++,k[a++]=h++):(k[a++]=l++,k[a++]=h,k[a++]=i,k[a++]=i++,k[a++]=h++,k[a++]=n++)}return this};return a});
define("goo/shapes/ShapeCreator",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Torus"],function(f,d,c,a){function b(){}b.createQuad=function(a,b,c,f){return new d(a,b,c,f)};b.createBox=function(a,b,c,d,i){return new f(a,b,c,d,i)};b.createSphere=function(a,b,d,f){return new c(a,b,d,f)};b.createTorus=function(b,c,d,f){return new a(b,c,d,f)};return b});
define("goo/renderer/pass/FullscreenUtil",["goo/shapes/ShapeCreator","goo/renderer/Camera","goo/math/Vector3"],function(f,d,c){function a(){}var b=new d;b.projectionMode=d.Parallel;b.setFrustum(-1,1,-1,1,1,-1);b._left.copy(c.UNIT_X).invert();b._up.copy(c.UNIT_Y);b._direction.copy(c.UNIT_Z);b.onFrameChange();a.camera=b;a.quad=f.createQuad(2,2);return a});
define("goo/renderer/pass/FullscreenPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(f,d,c){function a(a){this.material=f.createMaterial(a||c.simple);this.useReadBuffer=!0;this.renderToScreen=!1;this.renderable={meshData:d.quad,materials:[this.material]};this.enabled=!0;this.clear=!1;this.needsSwap=!0}a.prototype.render=function(a,c,f){this.useReadBuffer&&(this.material.textures[0]=f);this.renderToScreen?a.render(this.renderable,d.camera,
[],null,this.clear):a.render(this.renderable,d.camera,[],c,this.clear)};return a});
define("goo/addons/water/ProjectedGridWaterRenderer","goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/Camera,goo/math/Plane,goo/renderer/pass/RenderTarget,goo/renderer/pass/FullscreenPass,goo/math/Vector3,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/shaders/ShaderLib,goo/renderer/shaders/ShaderFragment".split(","),function(f,d,c,a,b,e,g,l,k,i,h){function j(d,h){this.camera=d;this.waterCamera=new c(45,1,0.1,2E3);this.renderList=[];this.waterPlane=new a;var h=h||{},j=window.innerWidth/
(h.divider||4),p=window.innerHeight/(h.divider||4);this.renderTarget=new b(j,p);j=window.innerWidth/(h.divider||1);p=window.innerHeight/(h.divider||1);this.heightTarget=new b(j,p,{type:"Float"});this.normalTarget=new b(j,p,{});this.fullscreenPass=new e(i.normalmap);this.fullscreenPass.material.shader.uniforms.resolution=[j,p];j=this.waterMaterial=l.createMaterial(n,"WaterMaterial");j.cullState.enabled=!1;j.textures[0]=(new k).loadTexture2D("../resources/water/waternormals3.png");j.textures[1]=this.renderTarget;
j.textures[2]=this.heightTarget;j.textures[3]=this.normalTarget;j=this.materialWire=l.createMaterial(i.simple,"mat");j.wireframe=!0;j.wireframeColor=[0,0,0];this.calcVect=new g;this.camReflectDir=new g;this.camReflectUp=new g;this.camReflectLeft=new g;this.camLocation=new g;this.camReflectPos=new g;this.waterEntity=null;j=this.projData=new f(f.defaultMap([f.POSITION]),4,6);j.getAttributeBuffer(f.POSITION).set([0,0,0,1,0,0,1,1,0,0,1,0]);j.getIndexBuffer().set([1,3,0,2,3,1]);p=l.createMaterial(o,"mat");
p.textures[0]=(new k).loadTexture2D("../resources/water/uniformclouds.jpg");this.projRenderable={meshData:j,materials:[p]}}j.prototype.updateHelper=function(a,b,c,e){var d=this.projData.getAttributeBuffer(f.POSITION);d[0]=a.x/a.w;d[1]=0;d[2]=a.z/a.w;d[3]=b.x/b.w;d[4]=0;d[5]=b.z/b.w;d[6]=c.x/c.w;d[7]=0;d[8]=c.z/c.w;d[9]=e.x/e.w;d[10]=0;d[11]=e.z/e.w;this.projData.setVertexDataUpdated()};j.prototype.process=function(a,b,c){var e=this.camera,d=this.waterEntity.meshDataComponent.meshData;d.update(this.camera);
this.waterMaterial.shader.uniforms.intersectBottomLeft=[d.intersectBottomLeft.x,d.intersectBottomLeft.y,d.intersectBottomLeft.z,d.intersectBottomLeft.w];this.waterMaterial.shader.uniforms.intersectBottomRight=[d.intersectBottomRight.x,d.intersectBottomRight.y,d.intersectBottomRight.z,d.intersectBottomRight.w];this.waterMaterial.shader.uniforms.intersectTopLeft=[d.intersectTopLeft.x,d.intersectTopLeft.y,d.intersectTopLeft.z,d.intersectTopLeft.w];this.waterMaterial.shader.uniforms.intersectTopRight=
[d.intersectTopRight.x,d.intersectTopRight.y,d.intersectTopRight.z,d.intersectTopRight.w];this.updateHelper(d.intersectBottomLeft,d.intersectBottomRight,d.intersectTopRight,d.intersectTopLeft);a.render(this.projRenderable,e,[],this.heightTarget,!0);this.fullscreenPass.render(a,this.normalTarget,this.heightTarget,0);var f=this.waterPlane;this.waterCamera.copy(e);f.constant=this.waterEntity.transformComponent.transform.translation.y;if(d=e.translation.y>f.constant){var g=this.calcVect,h=this.camReflectDir,
i=this.camReflectUp,l=this.camReflectLeft,k=this.camLocation,j=this.camReflectPos;k.set(e.translation);var n=f.pseudoDistance(k);g.set(f.normal).mul(n*2);j.set(k.sub(g));k.set(e.translation).add(e._direction);n=f.pseudoDistance(k);g.set(f.normal).mul(n*2);h.set(k.sub(g)).sub(j).normalize();k.set(e.translation).add(e._up);n=f.pseudoDistance(k);g.set(f.normal).mul(n*2);i.set(k.sub(g)).sub(j).normalize();l.set(i).cross(h).normalize();this.waterCamera.translation.set(j);this.waterCamera._direction.set(h);
this.waterCamera._up.set(i);this.waterCamera._left.set(l);this.waterCamera.normalize();this.waterCamera.update();if(this.skybox)f=this.skybox.transformComponent.worldTransform,f.translation.setv(j),f.update()}this.waterMaterial.shader.uniforms.abovewater=d;this.waterEntity.skip=!0;this.renderList.length=0;c.process(this.waterCamera,b,this.renderList);a.render(this.renderList,this.waterCamera,[],this.renderTarget,!0);this.waterEntity.skip=!1;if(d&&this.skybox)a=e.translation,f=this.skybox.transformComponent.worldTransform,
f.translation.setv(a),f.update()};j.prototype.setSkyBox=function(a){this.skybox=a};j.prototype.setWaterEntity=function(a){this.waterEntity=a;this.waterEntity.meshRendererComponent.cullMode="Never";this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial;a=this.waterEntity.meshDataComponent.meshData;this.waterMaterial.shader.uniforms.density=[a.densityX,a.densityY]};var n={attributes:{vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,
cameraPosition:d.CAMERA,normalMap:d.TEXTURE0,reflection:d.TEXTURE1,bump:d.TEXTURE2,normalMapCoarse:d.TEXTURE3,vertexNormal:[0,-1,0],vertexTangent:[1,0,0,1],waterColor:[15,15,15],abovewater:!0,fogColor:[1,1,1,1],sunDirection:[0.66,-0.1,0.66],coarseStrength:0.25,detailStrength:2,fogStart:0,camNear:d.NEAR_PLANE,camFar:d.FAR_PLANE,time:d.TIME,intersectBottomLeft:[0,0,0,0],intersectTopLeft:[0,0,0,0],intersectTopRight:[0,0,0,0],intersectBottomRight:[0,0,0,0],grid:!1,heightMultiplier:50,density:[1,1]},vshader:"attribute vec2 vertexUV0;\nuniform vec3 vertexNormal;\nuniform vec4 vertexTangent;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform float time;\nuniform vec3 sunDirection;\nuniform float coarseStrength;\nuniform float heightMultiplier;\nuniform sampler2D bump;\nuniform vec4 intersectBottomLeft;\nuniform vec4 intersectTopLeft;\nuniform vec4 intersectTopRight;\nuniform vec4 intersectBottomRight;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec3 eyeVec;\nvarying vec3 sunDir;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvarying vec3 normal;\nvoid main(void) {\n\tvec4 pointTop = mix(intersectTopLeft, intersectTopRight, vertexUV0.x);\n\tvec4 pointBottom = mix(intersectBottomLeft, intersectBottomRight, vertexUV0.x);\n\tvec4 pointFinal = mix(pointTop, pointBottom, 1.0 - vertexUV0.y);\n\tpointFinal.xz /= pointFinal.w;\n\tpointFinal.y = 0.0;\n\tvec4 screenpos = projectionMatrix * viewMatrix * worldMatrix * vec4(pointFinal.xyz, 1.0);\n\tvec2 projCoord = screenpos.xy / screenpos.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tfloat height = texture2D(bump, projCoord).x;\n\tpointFinal.y = height * heightMultiplier;\n\ttexCoord1 = vertexUV0;\n\tvec4 pos = worldMatrix * vec4(pointFinal.xyz, 1.0);\n\tworldPos = pos.xyz;\n\ttexCoord0 = worldPos.xz * 2.0;\n\tmat3 normalMatrix = mat3(worldMatrix);\n vec3 n = normalize(normalMatrix * vertexNormal);\n\tvec3 t = normalize(normalMatrix * vertexTangent.xyz);\n\tvec3 b = cross(n, t) * vertexTangent.w;\n\tmat3 rotMat = mat3(t, b, n);\n\tvec3 eyeDir = worldPos - cameraPosition;\n\teyeVec = eyeDir * rotMat;\n\tsunDir = sunDirection * rotMat;\n\tviewCoords = projectionMatrix * viewMatrix * pos;\n\tgl_Position = viewCoords;\n}",
fshader:"precision highp float;\nuniform sampler2D normalMap;\nuniform sampler2D reflection;\nuniform sampler2D normalMapCoarse;\nuniform vec3 waterColor;\nuniform bool abovewater;\nuniform vec4 fogColor;\nuniform float time;\nuniform bool grid;\nuniform vec2 density;\nuniform float camNear;\nuniform float camFar;\nuniform float fogStart;\nuniform float coarseStrength;\nuniform float detailStrength;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec3 eyeVec;\nvarying vec3 sunDir;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvarying vec3 normal;\nconst vec3 sunColor = vec3(1.0, 0.96, 0.96);\nvec4 getNoise(vec2 uv) {\n    vec2 uv0 = (uv/123.0)+vec2(time/17.0, time/29.0);\n    vec2 uv1 = uv/127.0-vec2(time/-19.0, time/31.0);\n    vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(time/51.0, time/47.0);\n    vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(time/59.0, time/-63.0);\n    vec4 noise = (texture2D(normalMap, uv0)) +\n                 (texture2D(normalMap, uv1)) +\n                 (texture2D(normalMap, uv2)*3.0) +\n                 (texture2D(normalMap, uv3)*3.0);\n    return noise/4.0-1.0;\n}\nvoid sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse,\n              inout vec3 diffuseColor, inout vec3 specularColor){\n    vec3 reflection = normalize(reflect(-sunDir, surfaceNormal));\n    float direction = max(0.0, dot(eyeDirection, reflection));\n    specularColor += pow(direction, shiny)*sunColor*spec;\n    diffuseColor += max(dot(sunDir, surfaceNormal),0.0)*sunColor*diffuse;\n}\nvoid main(void)\n{\n\tvec2 projCoord = viewCoords.xy / viewCoords.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tfloat fs = camFar * fogStart;\n\tfloat fogDist = clamp(max(viewCoords.z - fs, 0.0)/(camFar - camNear - fs), 0.0, 1.0);\n\tvec3 coarseNormal = texture2D(normalMapCoarse, projCoord).xyz * 2.0 - 1.0;\n\tvec2 normCoords = texCoord0;\n\tvec4 noise = getNoise(normCoords);\n\tvec3 normalVector = normalize(noise.xyz * vec3(1.8 * detailStrength, 1.8 * detailStrength, 1.0) + coarseNormal.xyz * vec3(1.8 * coarseStrength, 1.8 * coarseStrength, 1.0));\n\tvec3 localView = normalize(eyeVec);\n\tfloat fresnel = dot(normalize(normalVector*vec3(1.0, 1.0, 1.0)), localView);\n\tif ( abovewater == false ) {\n\t\tfresnel = -fresnel;\n\t}\n\tfloat fresnelTerm = 1.0 - fresnel;\n\tfresnelTerm *= fresnelTerm;\n\tfresnelTerm *= fresnelTerm;\n\tfresnelTerm = fresnelTerm * 0.95 + 0.05;\n\tif ( abovewater == true ) {\n\t\tprojCoord.x = 1.0 - projCoord.x;\n\t}\n\tprojCoord += (normalVector.xy * 0.05);\n\tprojCoord = clamp(projCoord, 0.001, 0.999);\n vec4 waterColorX = vec4(waterColor / 255.0, 1.0);\n\tvec4 reflectionColor = texture2D(reflection, projCoord);\n\tif ( abovewater == false ) {\n\t\treflectionColor *= vec4(0.8,0.9,1.0,1.0);\n\t\tvec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);\n\t\tgl_FragColor = mix(endColor,waterColorX,fogDist);\n\t}\n\telse {\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular = vec3(0.0);\n\t    sunLight(normalVector, localView, 100.0, 2.0, 0.4, diffuse, specular);\n\t\tvec4 endColor = mix(waterColorX,reflectionColor,fresnelTerm);\n\t\tgl_FragColor = mix(vec4(diffuse*0.0 + specular, 1.0) + mix(endColor,reflectionColor,fogDist), fogColor, fogDist);\n\t}\n\tif (grid) {\n\t\tvec2 low = abs(fract(texCoord1*density)-0.5);\n\t\tfloat dist = 1.0 - step(min(low.x, low.y), 0.05);\n\t\tgl_FragColor *= vec4(dist);\n\t}\n}"},
o={attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,time:d.TIME},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 worldPos;\nvarying vec4 viewCoords;\nvoid main(void) {\n\tworldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tviewCoords = viewMatrix * worldPos;\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n}",
fshader:["precision mediump float;\nuniform float time;\nvarying vec4 worldPos;\nvarying vec4 viewCoords;",h.noise3d,"vec4 getNoise(sampler2D map, vec2 uv) {\n    vec2 uv0 = (uv/223.0)+vec2(time/17.0, time/29.0);\n    vec2 uv1 = uv/327.0-vec2(time/-19.0, time/31.0);\n    vec2 uv2 = uv/vec2(697.0, 983.0)+vec2(time/151.0, time/147.0);\n    vec2 uv3 = uv/vec2(791.0, 877.0)-vec2(time/259.0, time/263.0);\n    vec4 noise = (texture2D(map, uv0)*0.0) +\n                 (texture2D(map, uv1)*0.0) +\n                 (texture2D(map, uv2)*0.0) +\n                 (texture2D(map, uv3)*10.0);\n    return noise/5.0-1.0;\n}\nvoid main(void)\n{\n\tfloat fogDist = clamp(-viewCoords.z / 1000.0, 0.0, 1.0);\n\tgl_FragColor = vec4((snoise(vec3(worldPos.xz * 0.008, time * 0.4))+snoise(vec3(worldPos.xz * 0.02, time * 0.8))*0.5)/10.0);\n}"].join("\n")};
return j});define("goo/animation/state/AbstractFiniteState",[],function(){function f(){this._globalStartTime=0;this._lastOwner=null}f.prototype.resetClips=function(d,c){this._globalStartTime=isNaN(c)?d.getCurrentGlobalTime():c};return f});
define("goo/animation/state/SteadyState",["goo/animation/state/AbstractFiniteState"],function(f){function d(c){f.call(this);this._name=c;this._transitions={};this._sourceTree=this._endTransition=null}d.prototype=Object.create(f.prototype);d.prototype.doTransition=function(c,a){var b=this._transitions[c];return b?b.doTransition(this,a):null};d.prototype.update=function(c,a){if(!this._sourceTree.setTime(c,a._manager)){var b=this._lastOwner;if(this._endTransition!==null){var e=this._endTransition.doTransition(this,
a);e&&(e.resetClips(a.getManager()),e.update(c,a));this!==e&&b.replaceState(this,e)}}};d.prototype.postUpdate=function(c){if(!this._sourceTree.isActive(c._manager))c=this._lastOwner,this._endTransition===null&&c.replaceState(this,null)};d.prototype.getCurrentSourceData=function(c){return this._sourceTree.getSourceData(c)};d.prototype.resetClips=function(c,a){f.prototype.resetClips.call(this,c,a);this._sourceTree.resetClips(c,this._globalStartTime)};return d});
define("goo/animation/layer/AnimationLayer",["goo/animation/state/SteadyState"],function(f){function d(c){this._name=c;this._steadyStates={};this._layerBlender=this._manager=this._currentState=null;this._transitions={}}d.BASE_LAYER_NAME="-BASE_LAYER-";d.prototype.doTransition=function(c){var a=this._currentState;if(a instanceof f){var b=a.doTransition(c,this);b||((c=this._transitions[c])||(c=this._transitions["*"]),c&&(b=c.doTransition(a,this)));if(b&&b!==a)return this.setCurrentState(b,!1),!0}else if(!a&&
((c=this._transitions[c])||(c=this._transitions["*"]),c))return this.setCurrentState(c.doTransition(a,this),!0),!0;return!1};d.prototype.setCurrentState=function(c,a){if(this._currentState=c)c._lastOwner=this,a&&c.resetClips(this._manager)};d.prototype.setCurrentStateByName=function(c,a){if(c){var b=this._steadyStates[c];if(b)return this.setCurrentState(b,a),!0;else console.warn("unable to find SteadyState named: "+c)}return!1};d.prototype.getCurrentSourceData=function(){return this._layerBlender!==
null?this._layerBlender.getBlendedSourceData(this._manager):this._currentState!==null?this._currentState.getCurrentSourceData(this._manager):null};d.prototype.updateLayerBlending=function(c){if(this._layerBlender)this._layerBlender._layerA=c,this._layerBlender._layerB=this};d.prototype.clearCurrentState=function(){this.setCurrentState(null,!1)};d.prototype.replaceState=function(c,a){this._currentState===c&&this.setCurrentState(a,!1)};return d});
define("goo/animation/clip/AnimationClipInstance",[],function(){function f(){this._active=!0;this._loopCount=0;this._timeScale=1;this._prevUnscaledClockTime=this._prevClockTime=this._startTime=0;this._clipStateObjects={};this._animationListeners=[]}f.prototype.setTimeScale=function(d,c){if(this._active&&this._timeScale!==d)if(this._timeScale!==0&&d!==0){var a=c.globalTime,b=a-this._startTime;b*=this._timeScale;b/=d;this._startTime=a-b}else if(this._timeScale===0)a=c.globalTime,this._startTime=a-this._prevUnscaledClockTime;
this._timeScale=d};f.prototype.getApplyTo=function(d){var c=d._channelName,a=this._clipStateObjects[c];a||(a=d.createStateDataObject(),this._clipStateObjects[c]=a);return a};f.prototype.fireAnimationFinished=function(){for(var d=0,c=this._animationListeners.length;d<c;d++)this._animationListeners[d].animationFinished(this)};return f});
define("goo/animation/AnimationManager",["goo/animation/layer/AnimationLayer","goo/animation/clip/AnimationClipInstance"],function(f,d){function c(a){this.globalTime=0;this._layers=[];this._applier=null;this._clipInstances={};this._updateRate=1/60;this._lastUpdate=0;var b=new f(f.BASE_LAYER_NAME);b._manager=this;this._layers.push(b);this._applyToPoses=[];a&&this._applyToPoses.push(a);this._valuesStore={}}c.prototype.update=function(a){this.globalTime+=a;a=this.globalTime;if(this._updateRate!==0){if(a-
this._lastUpdate<this._updateRate)return;this._lastUpdate=a-(a-this._lastUpdate)%this._updateRate}for(var b=0,c=this._layers.length;b<c;b++){var d=this._layers[b],f=d._currentState;f&&f.update(a,d)}b=0;for(c=this._applyToPoses.length;b<c;b++)this._applier.applyTo(this._applyToPoses[b],this);this._entityManager&&this._applier.apply(this._entityManager,this);b=0;for(c=this._layers.length;b<c;b++)d=this._layers[b],(f=d._currentState)&&f.postUpdate(d)};c.prototype.getClipInstance=function(a){var b=this._clipInstances[a];
if(!b)b=new d,b._startTime=this.globalTime,this._clipInstances[a]=b;return b};c.prototype.getCurrentSourceData=function(){for(var a=0,b=this._layers.length-1;a<b;a++)this._layers[a+1].updateLayerBlending(this._layers[a]);return this._layers[this._layers.length-1].getCurrentSourceData()};c.prototype.getCurrentGlobalTime=function(){return this.globalTime};c.prototype.resetClipInstance=function(a,b){var c=this.getClipInstance(a);if(c)c._startTime=b,c._active=!0};c.prototype.getBaseAnimationLayer=function(){return this._layers[0]};
c.prototype.findAnimationLayer=function(a){for(var b=0,c=this._layers.length;b<c;b++){var d=this._layers[b];if(a===d._name)return d}return null};c.prototype.addAnimationLayer=function(a){this._layers.push(a);a._manager=this;return this._layers.length-1};return c});define("goo/animation/Joint",["goo/math/Transform"],function(f){function d(c){this._name=c;this._parentIndex=this._index=0;this._inverseBindPose=new f}d.NO_PARENT=-32768;return d});
define("goo/animation/Skeleton",["goo/animation/Joint"],function(f){function d(c,a){this._name=c;this._joints=a}d.prototype.copy=function(){for(var c=this._name,a=this._joints,b=[],e=0,g=a.length;e<g;e++){var l=a[e],k=new f(l._name);k._index=l._index;k._parentIndex=l._parentIndex;k._inverseBindPose.copy(l._inverseBindPose);k._inverseBindPose.update();b[e]=k}return new d(c,b)};return d});
define("goo/animation/SkeletonPose",["goo/math/Transform","goo/animation/Joint","goo/math/Matrix4x4"],function(f,d,c){function a(a){this._skeleton=a;this._localTransforms=[];this._globalTransforms=[];this._matrixPalette=[];this._poseListeners=[];for(var a=this._skeleton._joints.length,e=0;e<a;e++)this._localTransforms[e]=new f;for(e=0;e<a;e++)this._globalTransforms[e]=new f;for(e=0;e<a;e++)this._matrixPalette[e]=new c;this.setToBindPose()}a.prototype.setToBindPose=function(){for(var a=new f,c=0;c<
this._localTransforms.length;c++){this._localTransforms[c].copy(this._skeleton._joints[c]._inverseBindPose);this._localTransforms[c].invert(this._localTransforms[c]);var g=this._skeleton._joints[c]._parentIndex;g!==d.NO_PARENT&&(a.multiply(this._skeleton._joints[g]._inverseBindPose,this._localTransforms[c]),this._localTransforms[c].copy(a))}this.updateTransforms()};a.prototype.updateTransforms=function(){for(var a=this._skeleton._joints.length,e=0;e<a;e++){var f=e,l=this._skeleton._joints[f]._parentIndex;
l!==d.NO_PARENT?this._globalTransforms[f].multiply(this._globalTransforms[l],this._localTransforms[f]):this._globalTransforms[f].copy(this._localTransforms[f]);c.combine(this._globalTransforms[f].matrix,this._skeleton._joints[f]._inverseBindPose.matrix,this._matrixPalette[f]);this._matrixPalette[f].transpose()}this.firePoseUpdated()};a.prototype.firePoseUpdated=function(){for(var a=this._poseListeners.length;--a>=0;)this._poseListeners[a].poseUpdated(this)};return a});
define("goo/animation/blendtree/AbstractTwoPartSource",[],function(){return function(f,d,c){this._sourceA=f?f:null;this._sourceB=d?d:null;this._blendKey=c?c:null}});
define("goo/animation/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(f,d){function c(a){this._rotation=(new f).copy(a?a._rotation:f.IDENTITY);this._scale=(new d).copy(a?a._scale:d.ONE);this._translation=(new d).copy(a?a._translation:d.ZERO)}c.prototype.applyTo=function(a){a.setIdentity();a.rotation.copyQuaternion(this._rotation);a.scale.data.set(this._scale.data);a.translation.data.set(this._translation.data);a.update()};c.prototype.set=function(a){this._rotation.copy(a._rotation);
this._scale.copy(a._scale);this._translation.copy(a._translation)};c.prototype.blend=function(a,b,e){var e=e?e:new c,d=0,l=0,k=0,i=0,h=0,j=0,n,o;o=1-b;n=this._translation;i+=n.x*o;h+=n.y*o;j+=n.z*o;n=this._scale;d+=n.x*o;l+=n.y*o;k+=n.z*o;o=b;n=a._translation;i+=n.x*o;h+=n.y*o;j+=n.z*o;n=a._scale;d+=n.x*o;l+=n.y*o;k+=n.z*o;e._scale.set(d,l,k);e._translation.set(i,h,j);f.slerp(this._rotation,a._rotation,o,e._rotation);return e};return c});
define("goo/animation/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animation/clip/TransformData","goo/animation/blendtree/AbstractTwoPartSource"],function(f,d,c){function a(a,e,d){c.call(this,a,e,d)}a.prototype=Object.create(c.prototype);a.prototype.getSourceData=function(b){var c=this._sourceA?this._sourceA.getSourceData(b):null,d=this._sourceB?this._sourceB.getSourceData(b):null;return a.combineSourceData(c,d,b._valuesStore[this._blendKey])};a.prototype.setTime=function(a,c){var d=!1;
this._sourceA&&(d=d||this._sourceA.setTime(a,c));this._sourceB&&(d=d||this._sourceB.setTime(a,c));return d};a.prototype.resetClips=function(a,c){this._sourceA&&this._sourceA.resetClips(a,c);this._sourceB&&this._sourceB.resetClips(a,c)};a.prototype.isActive=function(a){var c=!1;this._sourceA&&(c=c||this._sourceA.isActive(a));this._sourceB&&(c=c||this._sourceB.isActive(a));return c};a.combineSourceData=function(b,c,f,l){if(c){if(!b)return c}else return b;var l=l?l:{},k;for(k in b){var i=b[k],h=c[k];
isNaN(i)?l[k]=i instanceof d?h?i.blend(h,f,l[k]):i:i:a.blendFloatValues(l,k,f,i,h)}for(k in c)l[k]||(l[k]=c[k]);return l};a.blendFloatValues=function(a,c,d,l,k){a[c]=isNaN(k)?l:f.lerp(d,l[0],k[0])};return a});
define("goo/animation/blendtree/ClipSource",["goo/math/MathUtils"],function(f){function d(c,a){this._clip=c;a.getClipInstance(c)}d.prototype.setTime=function(c,a){var b=a.getClipInstance(this._clip),e;if(b._active){b._timeScale!==0?(b._prevUnscaledClockTime=c-b._startTime,e=b._timeScale*b._prevUnscaledClockTime,b._prevClockTime=e):e=b._prevClockTime;var d=this._clip._maxTime;if(d===-1)return!1;if(d!==0&&(b._loopCount===-1||b._loopCount>1&&d*b._loopCount>=Math.abs(e)?e<0?e=d+e%d:e%=d:e<0&&(e=d+e),
e>d||e<0))e=f.clamp(e,0,d),b.fireAnimationFinished(),b._active=!1;this._clip.update(e,b)}return b._active};d.prototype.resetClips=function(c,a){c.resetClipInstance(this._clip,a)};d.prototype.isActive=function(c){return c.getClipInstance(this._clip)._active&&this._clip._maxTime!==-1};d.prototype.getSourceData=function(c){return c.getClipInstance(this._clip)._clipStateObjects};return d});
define("goo/animation/clip/AbstractAnimationChannel",[],function(){function f(d,c){this._channelName=d;this._times=c instanceof Array&&c.length?c.slice(0):[]}f.prototype.getSampleCount=function(){return this._times.length};f.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0};f.prototype.updateSample=function(d,c){if(this._times.length){var a=this._times.length-1;if(d<0||this._times.length===1)this.setCurrentSample(0,0,c);else if(d>=this._times[a])this.setCurrentSample(a,
0,c);else{for(var b=a=0;b<this._times.length-1;b++)this._times[b]<d&&(a=b);this.setCurrentSample(a,(d-this._times[a])/(this._times[a+1]-this._times[a]),c)}}};return f});
define("goo/animation/clip/TransformChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TransformData","goo/math/Quaternion","goo/math/Vector3"],function(f,d,c,a){function b(b,d,l,k,i){f.call(this,b,d);if(l.length/4!==d.length||k.length/3!==d.length||i.length/3!==d.length)throw Error("All provided arrays must be the same length (accounting for type)! Channel: "+b);this._rotations=l.slice(0);this._translations=k.slice(0);this._scales=i.slice(0);this.tmpVec=new a;this.tmpQuat=
new c;this.tmpQuat2=new c}b.prototype=Object.create(f.prototype);b.prototype.createStateDataObject=function(){return new d};b.prototype.setCurrentSample=function(a,b,d){var f=a*4,i=a*3,h=(a+1)*4,a=(a+1)*3;b===0?(d._rotation.data[0]=this._rotations[f+0],d._rotation.data[1]=this._rotations[f+1],d._rotation.data[2]=this._rotations[f+2],d._rotation.data[3]=this._rotations[f+3],d._translation.data[0]=this._translations[i+0],d._translation.data[1]=this._translations[i+1],d._translation.data[2]=this._translations[i+
2],d._scale.data[0]=this._scales[i+0],d._scale.data[1]=this._scales[i+1],d._scale.data[2]=this._scales[i+2]):b===1?(d._rotation.data[0]=this._rotations[h+0],d._rotation.data[1]=this._rotations[h+1],d._rotation.data[2]=this._rotations[h+2],d._rotation.data[3]=this._rotations[h+3],d._translation.data[0]=this._translations[a+0],d._translation.data[1]=this._translations[a+1],d._translation.data[2]=this._translations[a+2],d._scale.data[0]=this._scales[a+0],d._scale.data[1]=this._scales[a+1],d._scale.data[2]=
this._scales[a+2]):(d._rotation.data[0]=this._rotations[f+0],d._rotation.data[1]=this._rotations[f+1],d._rotation.data[2]=this._rotations[f+2],d._rotation.data[3]=this._rotations[f+3],this.tmpQuat.data[0]=this._rotations[h+0],this.tmpQuat.data[1]=this._rotations[h+1],this.tmpQuat.data[2]=this._rotations[h+2],this.tmpQuat.data[3]=this._rotations[h+3],d._rotation.equals(this.tmpQuat)||(c.slerp(d._rotation,this.tmpQuat,b,this.tmpQuat2),d._rotation.setv(this.tmpQuat2)),d._translation.data[0]=this._translations[i+
0],d._translation.data[1]=this._translations[i+1],d._translation.data[2]=this._translations[i+2],this.tmpVec.data[0]=this._translations[a+0],this.tmpVec.data[1]=this._translations[a+1],this.tmpVec.data[2]=this._translations[a+2],d._translation.equals(this.tmpVec)||d._translation.lerp(this.tmpVec,b),d._scale.data[0]=this._scales[i+0],d._scale.data[1]=this._scales[i+1],d._scale.data[2]=this._scales[i+2],this.tmpVec.data[0]=this._scales[a+0],this.tmpVec.data[1]=this._scales[a+1],this.tmpVec.data[2]=
this._scales[a+2],d._scale.equals(this.tmpVec)||d._scale.lerp(this.tmpVec,b))};b.prototype.getTransformData=function(a,b){var c=b?b:new d;c.setRotation(this._rotations[a]);c.setScale(this._scales[a]);c.setTranslation(this._translations[a]);return c};return b});
define("goo/animation/clip/JointData",["goo/animation/clip/TransformData"],function(f){function d(c){f.call(this,c);this._jointIndex=c?c._jointIndex:0}d.prototype=Object.create(f.prototype);d.prototype.set=function(c){f.prototype.set.call(this,c);this._jointIndex=c._jointIndex};d.prototype.blend=function(c,a,b){if(b){if(b instanceof d)b._jointIndex=this._jointIndex}else b=new d,b._jointIndex=this._jointIndex;return f.prototype.blend.call(this,c,a,b)};return d});
define("goo/animation/clip/JointChannel",["goo/animation/clip/TransformChannel","goo/animation/clip/JointData"],function(f,d){function c(a,b,e,d,l,k){f.call(this,c.JOINT_CHANNEL_NAME+b,e,d,l,k);this._jointName=a;this._jointIndex=b}c.prototype=Object.create(f.prototype);c.JOINT_CHANNEL_NAME="_jnt";c.prototype.createStateDataObject=function(){return new d};c.prototype.setCurrentSample=function(a,b,c){f.prototype.setCurrentSample.call(this,a,b,c);c._jointIndex=this._jointIndex};c.prototype.getJointData=
function(a,b){var c=b?b:new d;f.prototype.getTransformData.call(this,a,c);c._jointIndex=this._jointIndex;return c};return c});
define("goo/animation/blendtree/ExclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(f,d){function c(a,b){d.call(this,a,b);this._disabledChannels={}}c.prototype=Object.create(d.prototype);c.prototype.clearDisabled=function(){this._disabledChannels={}};c.prototype.addDisabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._disabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._disabledChannels[arguments[a]]=
!0};c.prototype.addDisabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var b=f.JOINT_CHANNEL_NAME+arguments[0][a];this._disabledChannels[b]=!0}else for(a=0;a<arguments.length;a++)b=f.JOINT_CHANNEL_NAME+arguments[a],this._disabledChannels[b]=!0};c.prototype.getSourceData=function(a){var a=d.prototype.getSourceData.call(this,a),b={},c;for(c in a)this._disabledChannels[c]||(b[c]=a[c]);return b};return c});
define("goo/animation/blendtree/FrozenClipSource",[],function(){function f(d,c){this._source=d;this._time=c}f.prototype.getSourceData=function(d){return this._source.getSourceData(d)};f.prototype.resetClips=function(d){this._source.resetClips(d,0)};f.prototype.setTime=function(d,c){this._source.setTime(this._time,c);return!0};f.prototype.isActive=function(){return!0};return f});
define("goo/animation/blendtree/InclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(f,d){function c(a,b){d.call(this,a,b);this._enabledChannels={}}c.prototype=Object.create(d.prototype);c.prototype.clearEnabled=function(){this._enabledChannels={}};c.prototype.addEnabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._enabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._enabledChannels[arguments[a]]=
!0};c.prototype.addEnabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var b=f.JOINT_CHANNEL_NAME+arguments[0][a];this._enabledChannels[b]=!0}else for(a=0;a<arguments.length;a++)b=f.JOINT_CHANNEL_NAME+arguments[a],this._enabledChannels[b]=!0};c.prototype.getSourceData=function(a){var a=d.prototype.getSourceData.call(this,a),b={},c;for(c in this._enabledChannels)this._enabledChannels[c]&&(b[c]=a[c]);return b};return c});
define("goo/animation/blendtree/ManagedTransformSource",["goo/animation/clip/JointChannel","goo/animation/clip/JointData"],function(f,d){function c(a){this._sourceName=a?a:null;this._data={}}c.prototype.resetClips=function(){};c.prototype.setTime=function(){return!0};c.prototype.isActive=function(){return!0};c.prototype.setJointTransformData=function(a,b){var c=f.JOINT_CHANNEL_NAME+a;this._data[c]?this._data[c].set(b):this._data[c]=new d(b)};c.prototype.setJointTranslation=function(a,b){var c=f.JOINT_CHANNEL_NAME+
a;if(this._data[c])this._data[c]._translation.set(b);else{var g=new d;g._jointIndex=a;g._translation.set(b);this._data[c]=g}};c.prototype.setJointScale=function(a,b){var c=f.JOINT_CHANNEL_NAME+a;if(this._data[c])this._data[c]._scale.set(b);else{var g=new d;g._jointIndex=a;g._scale.set(b);this._data[c]=g}};c.prototype.setJointRotation=function(a,b){var c=f.JOINT_CHANNEL_NAME+a;if(this._data[c])this._data[c]._rotation.set(b);else{var g=new d;g._jointIndex=a;g._rotation.set(b);this._data[c]=g}};c.prototype.initJointsByName=
function(a,b,c){for(var g=0,l=c.length;g<l;g++){var k=a._skeleton.findJointByName(c[g]),i=new d;i._jointIndex=k;this.setJointTransformData(k,b.findChannelByName(f.JOINT_CHANNEL_NAME+k).getJointData(0,i))}};c.prototype.initJointsById=function(a,b){for(var c=0,g=b.length;c<g;c++){var l=b[c],k=new d;k._jointIndex=l;this.setJointTransformData(l,a.findChannelByName(f.JOINT_CHANNEL_NAME+l).getJointData(0,k))}};return c});
define("goo/animation/clip/TriggerData",[],function(){function f(){this._currentTriggers=[];this._currentIndex=-1;this._armed=!1}f.prototype.getCurrentTrigger=function(){return this._currentTriggers.length===0?null:this._currentTriggers[this._currentTriggers.size()-1]};f.prototype.arm=function(d,c){if(c===null||c.length===0)this._currentTriggers.length=0,this._armed=!1;else if(d!==this._currentIndex){for(var a=this._currentTriggers.length=0,b=c.length;a<b;a++)this._currentTriggers.push(c[a]);this._armed=
!0}this._currentIndex=d};return f});
define("goo/animation/blendtree/SimpleAnimationApplier",["goo/animation/clip/JointData","goo/animation/clip/TransformData","goo/animation/clip/TriggerData"],function(f,d,c){function a(){this._triggerCallbacks={}}a.prototype.apply=function(a,c){if(a){var g=c.getCurrentSourceData();if(g)for(var l in g){var k=g[l];if(k instanceof d&&!(k instanceof f)){var i=a.getEntityByName(l);i&&i.transformComponent&&k.applyTo(i.transformComponent.transform)}}}};a.prototype.applyTo=function(a,e){var d=e.getCurrentSourceData();
if(d){for(var l in d){var k=d[l];if(k instanceof f)k._jointIndex>=0&&k.applyTo(a._localTransforms[k._jointIndex]);else if(k instanceof c&&k.isArmed()){for(var i=0,h=k._currentTriggers.length;i<h;i++)for(var j=this._triggerCallbacks[k._currentTriggers[i]],n=0,o=j.length;n<o;n++)j[n](a,e);k.setArmed(!1)}}a.updateTransforms()}};return a});
define("goo/animation/clip/AnimationClip",[],function(){function f(d,c){this._name=d;this._channels=c||[];this._maxTime=-1;this.updateMaxTimeIndex()}f.prototype.update=function(d,c){for(var a=0,b=this._channels.length;a<b;++a){var e=this._channels[a],f=c.getApplyTo(e);e.updateSample(d,f)}};f.prototype.addChannel=function(d){this._channels.push(d);this.updateMaxTimeIndex()};f.prototype.removeChannel=function(d){d=this._channels.indexOf(d);return d>=0?(this._channels.splice(d,1),this.updateMaxTimeIndex(),
!0):!1};f.prototype.findChannelByName=function(d){for(var c=0,a=this._channels.length;c<a;++c){var b=this._channels[c];if(d===b._channelName)return b}return null};f.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;for(var d,c=0;c<this._channels.length;c++)if(d=this._channels[c].getMaxTime(),d>this._maxTime)this._maxTime=d};f.prototype.toString=function(){return this._name+this._channels.length};return f});
define("goo/animation/clip/TriggerChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TriggerData"],function(f,d){function c(a,b,c){f.call(this,a,b);this._keys=c?c.slice(0):null}c.prototype=Object.create(f.prototype);c.prototype.createStateDataObject=function(){return new d};c.prototype.setCurrentSample=function(a,b,c){a=b!==1?a:a+1;c.arm(a,[this._keys[a]])};return c});
define("goo/animation/clip/GuaranteedTriggerChannel",["goo/animation/clip/TriggerChannel"],function(f){function d(c,a,b){f.call(this,c,a,b)}d.prototype=Object.create(f.prototype);d.prototype.setCurrentSample=function(c,a,b){var e=b.getCurrentIndex(),c=a!==1?c:c+1;if(e===c)b.arm(c,this._keys[c]);else{a=[];for(e+=1;e<=c;e++)this._keys[e]||a.push(this._keys[e]);b.arm(c,a)}};return d});
define("goo/animation/clip/InterpolatedFloatChannel",["goo/animation/clip/AbstractAnimationChannel","goo/math/MathUtils"],function(f,d){function c(a,b,c){f.call(this,a,b);this._values=c?c.slice(0):null}c.prototype=Object.create(f.prototype);c.prototype.createStateDataObject=function(){return[0]};c.prototype.setCurrentSample=function(a,b,c){c[0]=d.lerp(b,this._values[a],this._values[a+1])};return c});
define("goo/animation/layer/LayerLERPBlender",["goo/animation/blendtree/BinaryLERPSource"],function(f){function d(){this._layerB=this._layerA=this._blendKey=null}d.prototype.getBlendedSourceData=function(c){var a=this._layerA.getCurrentSourceData(),b=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData(c):null;return f.combineSourceData(a,b,c._valuesStore[this._blendKey])};return d});
define("goo/animation/state/AbstractTransitionState",["goo/animation/state/AbstractFiniteState"],function(f){function d(c){f.call(this);this._targetState=c;this._endWindow=this._startWindow=-1}d.prototype=Object.create(f.prototype);d.prototype.doTransition=function(c,a){return!a._currentState?null:this.isInTimeWindow(a._manager.getCurrentGlobalTime()-a._currentState._globalStartTime)?this.getTransitionState(c,a):null};d.prototype.isInTimeWindow=function(c){return this._startWindow<=0?this._endWindow<=
0?!0:c<=this._endWindow:this._endWindow<=0?c>=this._startWindow:this._startWindow<=this._endWindow?this._startWindow<=c&&c<=this._endWindow:c>=this._startWindow||c<=this._endWindow};d.prototype.getTransitionState=function(){return null};return d});define("goo/animation/state/StateBlendType",["goo/util/Enum"],function(f){return new f("Linear","SCurve3","SCurve5")});
define("goo/animation/state/AbstractTwoStateLerpTransition",["goo/animation/state/AbstractTransitionState","goo/animation/state/StateBlendType","goo/animation/blendtree/BinaryLERPSource","goo/math/MathUtils"],function(f,d,c,a){function b(a,b,c){f.call(this,a);this._fadeTime=b;this._type=c;this._start=this._percent=0;this._sourceData=this._stateB=this._stateA=null}b.prototype=Object.create(f.prototype);b.prototype.setStateA=function(a){if(a===this)throw Error("Can not set state A to self.");this._stateA=
a;if(this._stateA!==null)this._stateA._lastOwner=this;if(this._sourceData)this._sourceData={}};b.prototype.setStateB=function(a){if(a===this)throw Error("Can not set state B to self.");this._stateB=a;if(this._stateB!==null)this._stateB._lastOwner=this;if(this._sourceData)this._sourceData={}};b.prototype.update=function(b){b-=this._start;if(b>this._fadeTime)this._lastOwner.replaceState(this,this._stateB);else switch(b/=this._fadeTime,this._blendType){case d.SCurve3:this._percent=a.scurve3(b);break;
case d.SCurve5:this._percent=a.scurve5(b);break;case d.Linear:this._percent=b;break;default:this._percent=b}};b.prototype.getCurrentSourceData=function(a){var b=this._stateA?this._stateA.getCurrentSourceData(a):null,a=this._stateB?this._stateB.getCurrentSourceData(a):null;if(!this._sourceData)this._sourceData={};return c.combineSourceData(b,a,this._percent,this._sourceData)};b.prototype.getCurrentSourceData=function(a){var b=this._stateA?this._stateA.getCurrentSourceData(a):null,a=this._stateB?this._stateB.getCurrentSourceData(a):
null;if(!this._sourceData)this._sourceData={};return c.combineSourceData(b,a,this._percent,this._sourceData)};b.prototype.replaceState=function(a,b){if(b!==null)if(this._stateA===a)this._stateA=b;else if(this._stateB===a)this._stateB=b};return b});
define("goo/animation/state/FadeTransitionState",["goo/animation/state/AbstractTwoStateLerpTransition"],function(f){function d(c,a,b){f.call(this,c,a,b)}d.prototype=Object.create(f.prototype);d.prototype.update=function(c,a){f.prototype.update.call(this,c,a);this._stateA!==null&&this._stateA.update(c,a);this._stateB!==null&&this._stateB.update(c,a)};d.prototype.getTransitionState=function(c,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(c);this.setStateB(a._steadyStates[this._targetState]);
if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._start);return this};d.prototype.postUpdate=function(c){this._stateA!==null&&this._stateA.postUpdate(c);this._stateB!==null&&this._stateB.postUpdate(c)};return d});
define("goo/animation/state/FrozenTransitionState",["goo/animation/state/AbstractTwoStateLerpTransition"],function(f){function d(c,a,b){f.call(this,c,a,b)}d.prototype=Object.create(f.prototype);d.prototype.update=function(c,a){f.prototype.update.call(this,c,a);this._stateB!==null&&this._stateB.update(c,a)};d.prototype.getTransitionState=function(c,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(c);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,
this._start);return this};d.prototype.postUpdate=function(c){this._stateB!==null&&this._stateB.postUpdate(c)};return d});define("goo/animation/state/IgnoreTransitionState",["goo/animation/state/AbstractTransitionState"],function(f){function d(){f.call(this,null)}d.prototype=Object.create(f.prototype);d.prototype.update=function(){};d.prototype.getTransitionState=function(c){return c};d.prototype.getCurrentSourceData=function(){return null};d.prototype.postUpdate=function(){};return d});
define("goo/animation/state/ImmediateTransitionState",["goo/animation/state/AbstractTransitionState"],function(f){function d(c){f.call(this,c)}d.prototype=Object.create(f.prototype);d.prototype.getTransitionState=function(c,a){var b=a._steadyStates[this._targetState];if(!b)return null;b.resetClips(a._manager);return b};d.prototype.update=function(){};d.prototype.getCurrentSourceData=function(){return{}};d.prototype.postUpdate=function(){};return d});
define("goo/animation/state/SyncFadeTransitionState",["goo/animation/state/FadeTransitionState"],function(f){function d(c,a,b){f.call(this,c,a,b)}d.prototype=Object.create(f.prototype);d.prototype.getTransitionState=function(c,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(c);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._stateA._globalStartTime);return this};return d});
define("goo/animation/state/loader/OutputStore",[],function(){function f(){this._attachments=[];this._usedClipSources={}}f.prototype.findAttachmentPoint=function(d){for(var c=0,a=this._attachments.length;c<a;c++){var b=this._attachments[c];if(d===b.getName())return b}return null};return f});
define("goo/entities/components/CSSTransformComponent",["goo/entities/components/Component"],function(f){function d(c){f.call(this);this.type="CSSTransformComponent";this.domElement=c}d.prototype=Object.create(f.prototype);return d});
define("goo/entities/EntityUtils",["goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CSSTransformComponent"],function(f,d,c,a){function b(){}function e(a,b,k){for(var i=a.createEntity(b.name),h=0;h<b._components.length;h++){var j=b._components[h];if(j instanceof f)i.transformComponent.transform.copy(j.transform);else if(j instanceof d){var n=new d(j.meshData);n.modelBound=new j.modelBound.constructor;
i.setComponent(n)}else if(j instanceof c){for(var o=new c,n=0;n<j.materials.length;n++)o.materials.push(j.materials[n]);i.setComponent(o)}else i.setComponent(j);for(n=0;n<b.transformComponent.children.length;n++)j=e(a,b.transformComponent.children[n].entity,k),i.transformComponent.attachChild(j.transformComponent)}k.callback&&k.callback(i);return i}b.clone=function(a,b,c){c=c||{};c.shareData=c.shareData||!0;c.shareMaterial=c.shareMaterial||!0;c.cloneHierarchy=c.cloneHierarchy||!0;return e(a,b,c)};
b.traverse=function(a,c){c&&c(a);for(var e=0;e<a.transformComponent.children.length;e++)b.traverse(a.transformComponent.children[e].entity,c)};b.updateWorldTransform=function(a){a.updateWorldTransform();for(var c=0;c<a.children.length;c++)b.updateWorldTransform(a.children[c])};b.createTypicalEntity=function(a,b){var e=a.createEntity(),f=new d(b);e.setComponent(f);f=new c;e.setComponent(f);return e};b.createDOMEntity=function(b,c){var e=b.createEntity();e.setComponent(new a(c));return e};return b});
define("goo/entities/systems/TransformSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"TransformSystem",["TransformComponent"])}d.prototype=Object.create(f.prototype);d.prototype.process=function(c){var a,b;for(a=0;a<c.length;a++)b=c[a].transformComponent,b._updated=!1,b._dirty&&b.updateTransform();for(a=0;a<c.length;a++)b=c[a].transformComponent,b._dirty&&this.updateWorldTransform(b)};d.prototype.updateWorldTransform=function(c){c.updateWorldTransform();for(var a=0;a<
c.children.length;a++)this.updateWorldTransform(c.children[a])};return d});define("goo/renderer/SimplePartitioner",["goo/renderer/Camera"],function(f){function d(){}d.prototype.added=function(){};d.prototype.removed=function(){};d.prototype.process=function(c,a,b){for(var e=0,d=0;d<a.length;d++){var l=a[d];if(!l.skip)l.meshRendererComponent.cullMode==="Never"?(b[e++]=l,l.isVisible=!0):c.contains(l.meshRendererComponent.worldBound)!==f.Outside?(b[e++]=l,l.isVisible=!0):l.isVisible=!1}b.length=e};return d});
define("goo/entities/systems/RenderSystem",["goo/entities/systems/System","goo/entities/EventHandler","goo/renderer/SimplePartitioner"],function(f,d,c){function a(){f.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]);this.entities=[];this.renderList=[];this.partitioner=new c;this.preRenderers=[];this.composers=[];this.doRender=!0;this.camera=null;this.lights=[];this.currentTpf=0;var a=this;d.addListener({setCurrentCamera:function(c){a.camera=c},setLights:function(c){a.lights=
c}})}a.prototype=Object.create(f.prototype);a.prototype.inserted=function(a){this.partitioner&&this.partitioner.added(a)};a.prototype.deleted=function(a){this.partitioner&&this.partitioner.removed(a)};a.prototype.process=function(a,c){this.entities=a;this.currentTpf=c};a.prototype.render=function(a){a.checkResize(this.camera);if(this.doRender&&this.camera){for(var c=0;c<this.preRenderers.length;c++)this.preRenderers[c].process(a,this.entities,this.partitioner);this.partitioner.process(this.camera,
this.entities,this.renderList);if(this.composers.length>0)for(c=0;c<this.composers.length;c++)this.composers[c].render(a,this.currentTpf);else a.render(this.renderList,this.camera,this.lights)}};return a});
define("goo/renderer/RendererRecord",[],function(){function f(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}};this.currentFrameBuffer=null;this.clippingTestEnabled=this.clippingTestValid=!1;this.clips=[];this.enabledTextures=0;this.texturesValid=!1;this.currentTextureArraysUnit=0;this.textureRecord=[];this.usedProgram=null;this.boundAttributes=[];this.depthRecord={};this.cullRecord={};this.blendRecord={};this.offsetRecord={}}f.prototype.invalidateBuffer=
function(d){this.currentBuffer[d].buffer=null;this.currentBuffer[d].valid=!1};return f});
define("goo/renderer/shadow/ShadowHandler","goo/math/Vector3,goo/renderer/pass/FullscreenPass,goo/renderer/Camera,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/renderer/pass/RenderTarget,goo/math/Vector4".split(","),function(f,d,c,a,b,e,g){function l(){this.shadowY=this.shadowX=512;this.nearZ=1;this.farZ=1E3;this.lightCam=new c(55,1,this.nearZ,this.farZ);this.currentState="Perspective";this.depthMaterial=a.createMaterial(b.lightDepth,"depthMaterial");this.depthMaterial.cullState.cullFace=
"Front";this.shadowTarget=new e(this.shadowX,this.shadowY,{type:"Float"});this.shadowTargetDown=new e(this.shadowX/2,this.shadowY/2,{type:"Float"});this.shadowTargetDown2=new e(this.shadowX/4,this.shadowY/4,{type:"Float"});this.shadowResult=this.shadowBlurred=new e(this.shadowX/4,this.shadowY/4,{type:"Float"});this.fullscreenPass=new d;this.downsample=a.createShader(b.downsample,"downsample");this.boxfilter=a.createShader(b.boxfilter,"boxfilter");this.boxfilter.uniforms.viewport=[this.shadowX/4,this.shadowY/
4];this.oldClearColor=new g(0,0,0,0);this.shadowClearColor=new g(1,1,1,1)}l.prototype.checkShadowRendering=function(a,b,e,d){for(e=a.shadowCount=0;e<d.length;e++){var g=d[e];if(g.shadowCaster){var l=this.lightCam;l.translation.copy(g.translation);g.shadowSettings.projection==="Perspective"&&l.lookAt(f.ZERO,f.UNIT_Y);if(this.currentState!==g.shadowSettings.projection)if(this.currentState=g.shadowSettings.projection,g.shadowSettings.projection==="Perspective")l.setFrustumPerspective(g.shadowSettings.fov,
1,g.shadowSettings.near,g.shadowSettings.far);else if(g.shadowSettings.projection==="Parallel"){var q=g.shadowSettings.size;l.setFrustum(g.shadowSettings.near,g.shadowSettings.far,-q,q,q,-q);l.projectionMode=c.Parallel;l.update()}l.onFrameChange();this.oldClearColor.copy(a.clearColor);a.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a);a.overrideMaterial=this.depthMaterial;a.render(b,l,[],this.shadowTarget,!0,!0);a.overrideMaterial=null;
switch(g.shadowSettings.type){case "Blur":this.fullscreenPass.material.shader=this.downsample;this.fullscreenPass.render(a,this.shadowTargetDown,this.shadowTarget,0);this.fullscreenPass.render(a,this.shadowTargetDown2,this.shadowTargetDown,0);this.fullscreenPass.material.shader=this.boxfilter;this.fullscreenPass.render(a,this.shadowBlurred,this.shadowTargetDown2,0);this.shadowResult=this.shadowBlurred;break;case "None":this.shadowResult=this.shadowTarget;break;default:this.shadowResult=this.shadowBlurred}a.setClearColor(this.oldClearColor.r,
this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a);a.shadowCount++}}};return l});
define("goo/renderer/Renderer","goo/renderer/RendererRecord,goo/renderer/Util,goo/renderer/TextureCreator,goo/renderer/pass/RenderTarget,goo/math/Vector4,goo/entities/Entity,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/renderer/MeshData,goo/renderer/Material,goo/math/Transform,goo/renderer/RenderQueue,goo/renderer/shaders/ShaderLib,goo/renderer/shadow/ShadowHandler".split(","),function(f,d,c,a,b,e,g,l,k,i,h,j,n,o,q){function m(a){var a=a||{},c=a.canvas;if(c===void 0)c=
document.createElement("canvas"),c.width=500,c.height=500;this.domElement=c;this._alpha=a.alpha!==void 0?a.alpha:!1;this._premultipliedAlpha=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0;this._antialias=a.antialias!==void 0?a.antialias:!1;this._stencil=a.stencil!==void 0?a.stencil:!1;this._preserveDrawingBuffer=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1;this._onError=a.onError;var e={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,
preserveDrawingBuffer:this._preserveDrawingBuffer};this.context=null;try{if(this.context=c.getContext("experimental-webgl",e),!this.context)this.context=c.getContext("webgl",e)}catch(d){}if(!this.context)throw"WebGL is not supported! (Could not create WebGL context)";if(a.debug){var g=new XMLHttpRequest;g.open("GET","../lib/webgl-debug.js",!1);g.onreadystatechange=function(){g.readyState===4&&g.status>=200&&g.status<=299&&window.eval.call(window,g.responseText)};g.send(null);typeof window.WebGLDebugUtils===
"undefined"?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),a.validate?(console.log('Running with "undefined arguments" validation.'),this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),s)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))}this.rendererRecord=new f;this.glExtensionCompressedTextureS3TC=l.SUPPORTS_DDS=
k.isSupported(this.context);this.glExtensionTextureFloat=this.context.getExtension("OES_texture_float");this.glExtensionStandardDerivatives=this.context.getExtension("OES_standard_derivatives");this.glExtensionTextureFilterAnisotropic=this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic");this.glExtensionDepthTexture=this.context.getExtension("WEBGL_depth_texture")||
this.context.getExtension("WEBKIT_WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture");this.glExtensionTextureFloat||console.log("Float textures not supported.");this.glExtensionStandardDerivatives||console.log("Standard derivatives not supported.");this.glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported.");this.glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported.");this.glExtensionDepthTexture||console.log("Depth textures not supported.");
this.capabilities={maxTexSize:this.context.getParameter(p.MAX_TEXTURE_SIZE),maxCubeSize:this.context.getParameter(p.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderbufferSize:this.context.getParameter(p.MAX_RENDERBUFFER_SIZE),vertexUnits:this.context.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS),fragmentUnits:this.context.getParameter(p.MAX_TEXTURE_IMAGE_UNITS),combinedUnits:this.context.getParameter(p.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.context.getParameter(p.MAX_VERTEX_ATTRIBS),maxVertexShader:this.context.getParameter(p.MAX_VERTEX_UNIFORM_VECTORS),
maxFragmentShader:this.context.getParameter(p.MAX_FRAGMENT_UNIFORM_VECTORS),maxVaryingVectors:this.context.getParameter(p.MAX_VARYING_VECTORS)};this.downScale=a.downScale||1;this.clearColor=new b;this.setClearColor(0.3,0.3,0.3,1);this.context.clearDepth(1);this.context.clearStencil(0);this.context.stencilMask(0);this.context.enable(p.DEPTH_TEST);this.context.depthFunc(p.LEQUAL);this.currentHeight=this.currentWidth=this.viewportHeight=this.viewportWidth=this.viewportY=this.viewportX=0;this.overrideMaterial=
null;this.renderQueue=new n;this.info={calls:0,vertices:0,indices:0,reset:function(){this.indices=this.vertices=this.calls=0},toString:function(){return"Calls: "+this.calls+" Vertices: "+this.vertices+" Indices: "+this.indices}};this.shadowCount=0;this.shadowHandler=null}function s(a,b){for(var c=0;c<b.length;++c)b[c]===void 0&&console.error("undefined passed to gl."+a+"("+window.WebGLDebugUtils.glFunctionArgsToString(a,b)+")")}var p=window.WebGLRenderingContext;m.prototype.onDebugError=function(a,
b,c){for(var a="WebGL error "+window.WebGLDebugUtils.glEnumToString(a)+" in "+b+"(",e=0;e<c.length;++e)a+=(e===0?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(b,e,c[e]);a+=")";console.error(a);this._onError&&this._onError(a)};m.mainCamera=null;m.prototype.checkResize=function(a){var b=this.domElement.offsetWidth/this.downScale,c=this.domElement.offsetHeight/this.downScale;(b!==this.domElement.width||c!==this.domElement.height)&&this.setSize(b,c);b=this.domElement.width/this.domElement.height;
if(a&&a.aspect!==b)a.aspect=b,a.setFrustumPerspective(),a.onFrameChange()};m.prototype.setSize=function(a,b){this.domElement.width=a;this.domElement.height=b;this.setViewport(0,0,a,b)};m.prototype.setViewport=function(a,b,c,e){this.viewportX=a!==void 0?a:0;this.viewportY=b!==void 0?b:0;this.viewportWidth=c!==void 0?c:this.domElement.width;this.viewportHeight=e!==void 0?e:this.domElement.height;this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight)};m.prototype.setClearColor=
function(a,b,c,e){this.clearColor.set(a,b,c,e);this.context.clearColor(a,b,c,e)};m.prototype.bindData=function(a){var b=a.glBuffer;if(b!==null){if(this.setBoundBuffer(b,a.target),a._dataNeedsRefresh)this.context.bufferSubData(this.getGLBufferTarget(a.target),0,a.data),a._dataNeedsRefresh=!1}else b=this.context.createBuffer(),a.glBuffer=b,this.rendererRecord.invalidateBuffer(a.target),this.setBoundBuffer(b,a.target),this.context.bufferData(this.getGLBufferTarget(a.target),a.data,this.getGLBufferUsage(a._dataUsage))};
m.prototype.render=function(a,b,c,e,d,f){if(b){if(m.mainCamera===null)m.mainCamera=b;if(!f)if(this.shadowHandler)this.shadowHandler.checkShadowRendering(this,a,b,c);else for(f=0;f<c.length;f++)if(c[f].shadowCaster){this.shadowHandler=new q;break}this.setRenderTarget(e);d===void 0||d===null||d===!0?this.clear():typeof d==="object"&&this.clear(d.color,d.depth,d.stencil);c={camera:b,mainCamera:m.mainCamera,lights:c,lightCamera:this.shadowHandler?this.shadowHandler.lightCam:null,renderer:this};if(Array.isArray(a)){this.renderQueue.sort(a,
b);for(f=0;f<a.length;f++)this.fillRenderInfo(a[f],c),this.renderMesh(c)}else this.fillRenderInfo(a,c),this.renderMesh(c)}};m.prototype.fillRenderInfo=function(a,b){a instanceof e?(b.meshData=a.meshDataComponent.meshData,b.materials=a.meshRendererComponent.materials,b.transform=a.particleComponent?j.IDENTITY:a.transformComponent.worldTransform):(b.meshData=a.meshData,b.materials=a.materials,b.transform=a.transform)};m.prototype.renderMesh=function(a){var b=a.meshData;if(!(b.vertexData===null||b.vertexData!==
null&&b.vertexData.data.byteLength===0||b.indexData!==null&&b.indexData.data.byteLength===0)){this.bindData(b.vertexData);var c=a.materials;this.overrideMaterial!==null&&(c=[this.overrideMaterial]);for(var e=!1,d=b,f=0;f<c.length;f++){var g=c[f];if(g.shader){if(g._originalTextureCount===-1)g._originalTextureCount=g.textures.length;if(this.shadowCount>0)g.textures[g._originalTextureCount]=this.shadowHandler.shadowResult;if(g.wireframe&&!e){if(!b.wireframeData)b.wireframeData=this.buildWireframeData(b);
b=b.wireframeData;this.bindData(b.vertexData);if(!g.wireframeMaterial)g.wireframeMaterial=this.buildWireframeMaterial(g);g=g.wireframeMaterial;e=!0}else!g.wireframe&&e&&(b=d,this.bindData(b.vertexData),e=!1);a.material=g;g.shader.apply(a,this);this.updateDepthTest(g);this.updateCulling(g);this.updateBlending(g);this.updateOffset(g);this.updateTextures(g);b.getIndexBuffer()!==null?(this.bindData(b.getIndexData()),b.getIndexLengths()!==null?this.drawElementsVBO(b.getIndexBuffer(),b.getIndexModes(),
b.getIndexLengths()):this.drawElementsVBO(b.getIndexBuffer(),b.getIndexModes(),[b.getIndexBuffer().length])):b.getIndexLengths()!==null?this.drawArraysVBO(b.getIndexModes(),b.getIndexLengths()):this.drawArraysVBO(b.getIndexModes(),[b.vertexCount]);this.info.calls++;this.info.vertices+=b.vertexCount;this.info.indices+=b.indexCount}}}};m.prototype.readPixels=function(a,b,c,e,d){this.context.readPixels(a,b,c,e,p.RGBA,p.UNSIGNED_BYTE,d)};m.prototype.drawElementsVBO=function(a,b,c){for(var e=0,d=0,f=0;f<
c.length;f++){var g=c[f],h=this.getGLIndexMode(b[d]),i=this.getGLArrayType(a),k=this.getGLByteSize(a);this.context.drawElements(h,g,i,e*k);e+=g;d<b.length-1&&d++}};m.prototype.drawArraysVBO=function(a,b){for(var c=0,e=0,d=0;d<b.length;d++){var f=b[d];this.context.drawArrays(this.getGLIndexMode(a[e]),c,f);c+=f;e<a.length-1&&e++}};m.prototype.buildWireframeData=function(a){var b=d.clone(a.attributeMap),b=new i(b,0,0);b.vertexData=a.vertexData;b.dataViews=a.dataViews;b.attributeMap=a.attributeMap;b.vertexCount=
b._vertexCountStore=a.vertexCount;b.rebuildIndexData(a.indexCount*2);for(var c=a.getIndexBuffer(),e=b.getIndexBuffer(),f=0;f<a.indexCount;f++){var g=c[f*3+0],h=c[f*3+1],k=c[f*3+2];e[f*6+0]=g;e[f*6+1]=h;e[f*6+2]=h;e[f*6+3]=k;e[f*6+4]=k;e[f*6+5]=g}b.indexModes[0]="Lines";return b};m.prototype.buildWireframeMaterial=function(a){var b=h.createMaterial(o.simpleColored,"Wireframe");b.uniforms.color=a.wireframeColor||[1,1,1];return b};m.prototype.updateDepthTest=function(a){var b=this.rendererRecord.depthRecord,
a=a.depthState;if(b.enabled!==a.enabled)a.enabled?this.context.enable(p.DEPTH_TEST):this.context.disable(p.DEPTH_TEST),b.enabled=a.enabled;if(b.write!==a.write)a.write?this.context.depthMask(!0):this.context.depthMask(!1),b.write=a.write};m.prototype.updateCulling=function(a){var b=this.rendererRecord.cullRecord,c=a.cullState.cullFace,e=a.cullState.frontFace,a=a.cullState.enabled;if(b.enabled!==a)a?this.context.enable(p.CULL_FACE):this.context.disable(p.CULL_FACE),b.enabled=a;if(b.cullFace!==c)this.context.cullFace(c===
"Front"?p.FRONT:c==="Back"?p.BACK:p.FRONT_AND_BACK),b.cullFace=c;if(b.frontFace!==e){switch(e){case "CCW":this.context.frontFace(p.CCW);break;case "CW":this.context.frontFace(p.CW)}b.frontFace=e}};m.prototype.updateTextures=function(b){for(var e=this.context,f=0;f<b.shader.textureSlots.length;f++){var g=b.textures[f];if(g===void 0||g instanceof a===!1&&(g.image===void 0||g.checkDataReady()===!1))if(b.shader.textureSlots[f].format==="sampler2D")g=c.DEFAULT_TEXTURE_2D;else if(b.shader.textureSlots[f].format===
"samplerCube")g=c.DEFAULT_TEXTURE_CUBE;var h=this.rendererRecord.textureRecord[f];h===void 0&&(h=this.rendererRecord.textureRecord[f]={});g.glTexture===null?(g.glTexture=e.createTexture(),this.updateTexture(e,g,f,h)):g instanceof a===!1&&g.checkNeedsUpdate()?(this.updateTexture(e,g,f,h),g.needsUpdate=!1):this.bindTexture(e,g,f,h);h=g.image!==void 0?g.image:g;h=d.isPowerOfTwo(h.width)&&d.isPowerOfTwo(h.height);this.updateTextureParameters(g,h)}};m.prototype.updateTextureParameters=function(a,b){var c=
this.context,e=a.textureRecord;if(e===void 0)e={},a.textureRecord=e;if(e.magFilter!==a.magFilter){var d=this.getGLType(a.variant);c.texParameteri(d,p.TEXTURE_MAG_FILTER,this.getGLMagFilter(a.magFilter));e.magFilter=a.magFilter}var f=b?a.minFilter:this.getFilterFallback(a.minFilter);if(e.minFilter!==f)d=this.getGLType(a.variant),c.texParameteri(d,p.TEXTURE_MIN_FILTER,this.getGLMinFilter(f)),e.minFilter=f;f=b?a.wrapS:"EdgeClamp";if(e.wrapS!==f){var d=this.getGLType(a.variant),g=this.getGLWrap(f,c);
c.texParameteri(d,p.TEXTURE_WRAP_S,g);e.wrapS=f}f=b?a.wrapT:"EdgeClamp";if(e.wrapT!==f)d=this.getGLType(a.variant),g=this.getGLWrap(f,c),c.texParameteri(d,p.TEXTURE_WRAP_T,g),e.wrapT=f};m.prototype.bindTexture=function(a,b,c,e){if(e.boundTexture===void 0||b.glTexture!==void 0&&e.boundTexture!==b.glTexture)a.activeTexture(p.TEXTURE0+c),a.bindTexture(this.getGLType(b.variant),b.glTexture),e.boundTexture=b.glTexture};m.prototype.getGLType=function(a){switch(a){case "2D":return p.TEXTURE_2D;case "CUBE":return p.TEXTURE_CUBE_MAP}throw"invalid texture type: "+
a;};m.prototype.loadCompressedTexture=function(a,b,c,e){var d=c.image.mipmapSizes,f=0,g=0,h=c.image.width,i=c.image.height,l=k.getDdsExtension(a),j=l.COMPRESSED_RGBA_S3TC_DXT5_EXT;if(c.format==="PrecompressedDXT1")j=l.COMPRESSED_RGB_S3TC_DXT1_EXT;else if(c.format==="PrecompressedDXT1A")j=l.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if(c.format==="PrecompressedDXT3")j=l.COMPRESSED_RGBA_S3TC_DXT3_EXT;else if(c.format==="PrecompressedDXT5")j=l.COMPRESSED_RGBA_S3TC_DXT5_EXT;else throw Error("Unhandled compression format: "+
e.getDataFormat().name());if(typeof d==="undefined"||d===null)e instanceof Uint8Array?a.compressedTexImage2D(b,0,j,h,i,0,e):a.compressedTexImage2D(b,0,j,h,i,0,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));else{c.generateMipmaps=!1;for(l=0;l<d.length;l++)g=d[l],a.compressedTexImage2D(b,l,j,h,i,0,new Uint8Array(e.buffer,e.byteOffset+f,g)),h=~~(h/2)>1?~~(h/2):1,i=~~(i/2)>1?~~(i/2):1,f+=g;e=1+Math.ceil(Math.log(Math.max(c.image.height,c.image.width))/Math.log(2));f=d[d.length-1];if(d.length<e)for(l=
d.length;l<e;l++)f=~~((h+3)/4)*~~((i+3)/4)*c.image.bpp*2,a.compressedTexImage2D(b,l,j,h,i,0,new Uint8Array(f)),h=~~(h/2)>1?~~(h/2):1,i=~~(i/2)>1?~~(i/2):1}};m.prototype.updateTexture=function(a,b,c,e){this.bindTexture(a,b,c,e);a.pixelStorei(p.UNPACK_ALIGNMENT,1);a.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,b.flipY);c=b.image;if(b.variant==="2D")if(c){if(b.generateMipmaps||c.width>this.capabilities.maxTexSize||c.height>this.capabilities.maxTexSize)this.checkRescale(b,c,c.width,c.height,this.capabilities.maxTexSize),
c=b.image;c.isData===!0?c.isCompressed?this.loadCompressedTexture(a,p.TEXTURE_2D,b,c.data):a.texImage2D(p.TEXTURE_2D,0,this.getGLInternalFormat(b.format),c.width,c.height,b.hasBorder?1:0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),c.data):a.texImage2D(p.TEXTURE_2D,0,this.getGLInternalFormat(b.format),this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),c);b.generateMipmaps&&!c.isCompressed&&a.generateMipmap(p.TEXTURE_2D)}else a.texImage2D(p.TEXTURE_2D,0,this.getGLInternalFormat(b.format),
b.width,b.height,0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),null);else if(b.variant==="CUBE"){if(c&&(b.generateMipmaps||c.width>this.capabilities.maxCubeSize||c.height>this.capabilities.maxCubeSize)){for(e=0;e<g.CUBE_FACES.length;e++)this.checkRescale(b,c.data[e],c.width,c.height,this.capabilities.maxCubeSize);c=b.image}for(e=0;e<g.CUBE_FACES.length;e++){var d=g.CUBE_FACES[e];c?c.isData===!0?c.isCompressed?this.loadCompressedTexture(a,this.getGLCubeMapFace(d),b,c.data[e]):
a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(b.format),c.width,c.height,b.hasBorder?1:0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),c.data[e]):a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(b.format),this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),c.data[e]):a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(b.format),b.width,b.height,0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),null)}c&&
b.generateMipmaps&&!c.isCompressed&&a.generateMipmap(p.TEXTURE_CUBE_MAP)}};m.prototype.checkRescale=function(a,b,c,e,f){var g=d.nearestPowerOfTwo(c),h=d.nearestPowerOfTwo(e),g=Math.min(g,f),h=Math.min(h,f);if(c!==g||e!==h)f=document.createElement("canvas"),f.width=g,f.height=h,f.getContext("2d").drawImage(b,0,0,c,e,0,0,g,h),document.body.appendChild(f),f.dataReady=!0,a.image=f,f.parentNode.removeChild(f)};m.prototype.getGLWrap=function(a){switch(a){case "Repeat":return p.REPEAT;case "MirroredRepeat":return p.MIRRORED_REPEAT;
case "EdgeClamp":return p.CLAMP_TO_EDGE}throw"invalid WrapMode type: "+a;};m.prototype.getGLInternalFormat=function(a){switch(a){case "RGBA":return p.RGBA;case "RGB":return p.RGB;case "Alpha":return p.ALPHA;case "Luminance":return p.LUMINANCE;case "LuminanceAlpha":return p.LUMINANCE_ALPHA;default:throw"Unsupported format: "+a;}};m.prototype.getGLPixelDataType=function(a){switch(a){case "UnsignedByte":return p.UNSIGNED_BYTE;case "UnsignedShort565":return p.UNSIGNED_SHORT_5_6_5;case "UnsignedShort4444":return p.UNSIGNED_SHORT_4_4_4_4;
case "UnsignedShort5551":return p.UNSIGNED_SHORT_5_5_5_1;case "Float":return p.FLOAT;default:throw"Unsupported type: "+a;}};m.prototype.getFilterFallback=function(a){switch(a){case "NearestNeighborNoMipMaps":case "NearestNeighborNearestMipMap":case "NearestNeighborLinearMipMap":return"NearestNeighborNoMipMaps";case "BilinearNoMipMaps":case "Trilinear":case "BilinearNearestMipMap":return"BilinearNoMipMaps";default:return"NearestNeighborNoMipMaps"}};m.prototype.getGLMagFilter=function(a){switch(a){case "Bilinear":return p.LINEAR;
case "NearestNeighbor":return p.NEAREST}throw"invalid MagnificationFilter type: "+a;};m.prototype.getGLMinFilter=function(a){switch(a){case "BilinearNoMipMaps":return p.LINEAR;case "Trilinear":return p.LINEAR_MIPMAP_LINEAR;case "BilinearNearestMipMap":return p.LINEAR_MIPMAP_NEAREST;case "NearestNeighborNoMipMaps":return p.NEAREST;case "NearestNeighborNearestMipMap":return p.NEAREST_MIPMAP_NEAREST;case "NearestNeighborLinearMipMap":return p.NEAREST_MIPMAP_LINEAR}throw"invalid MinificationFilter type: "+
a;};m.prototype.getGLBufferTarget=function(a){return a==="ElementArrayBuffer"?p.ELEMENT_ARRAY_BUFFER:p.ARRAY_BUFFER};m.prototype.getGLArrayType=function(a){if(a instanceof Uint8Array)return p.UNSIGNED_BYTE;else if(a instanceof Uint16Array)return p.UNSIGNED_SHORT;else if(a instanceof Uint32Array)return p.UNSIGNED_INT;else if(a instanceof Int8Array)return p.UNSIGNED_BYTE;else if(a instanceof Int16Array)return p.UNSIGNED_SHORT;else if(a instanceof Int32Array)return p.UNSIGNED_INT;return null};m.prototype.getGLByteSize=
function(a){if(!(a instanceof Uint8Array))if(a instanceof Uint16Array)return 2;else if(a instanceof Uint32Array)return 4;else if(!(a instanceof Int8Array))if(a instanceof Int16Array)return 2;else if(a instanceof Int32Array)return 4;return 1};m.prototype.getGLCubeMapFace=function(a){switch(a){case "PositiveX":return p.TEXTURE_CUBE_MAP_POSITIVE_X;case "NegativeX":return p.TEXTURE_CUBE_MAP_NEGATIVE_X;case "PositiveY":return p.TEXTURE_CUBE_MAP_POSITIVE_Y;case "NegativeY":return p.TEXTURE_CUBE_MAP_NEGATIVE_Y;
case "PositiveZ":return p.TEXTURE_CUBE_MAP_POSITIVE_Z;case "NegativeZ":return p.TEXTURE_CUBE_MAP_NEGATIVE_Z}throw"Invalid cubemap face: "+a;};m.prototype.getGLBufferUsage=function(a){var b=p.STATIC_DRAW;switch(a){case "StaticDraw":b=p.STATIC_DRAW;break;case "DynamicDraw":b=p.DYNAMIC_DRAW;break;case "StreamDraw":b=p.STREAM_DRAW}return b};m.prototype.getGLIndexMode=function(a){var b=p.TRIANGLES;switch(a){case "Triangles":b=p.TRIANGLES;break;case "TriangleStrip":b=p.TRIANGLE_STRIP;break;case "TriangleFan":b=
p.TRIANGLE_FAN;break;case "Lines":b=p.LINES;break;case "LineStrip":b=p.LINE_STRIP;break;case "LineLoop":b=p.LINE_LOOP;break;case "Points":b=p.POINTS}return b};m.prototype.updateBlending=function(a){var b=this.rendererRecord.blendRecord,c=this.context,e=a.blendState.blending;if(e!==b.blending)e==="NoBlending"?c.disable(p.BLEND):e==="AdditiveBlending"?(c.enable(p.BLEND),c.blendEquation(p.FUNC_ADD),c.blendFunc(p.SRC_ALPHA,p.ONE)):e==="SubtractiveBlending"?(c.enable(p.BLEND),c.blendEquation(p.FUNC_ADD),
c.blendFunc(p.ZERO,p.ONE_MINUS_SRC_COLOR)):e==="MultiplyBlending"?(c.enable(p.BLEND),c.blendEquation(p.FUNC_ADD),c.blendFunc(p.DST_COLOR,p.ONE_MINUS_SRC_ALPHA)):e==="AlphaBlending"?(c.enable(p.BLEND),c.blendEquation(p.FUNC_ADD),c.blendFunc(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA)):e==="CustomBlending"?c.enable(p.BLEND):(c.enable(p.BLEND),c.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),c.blendFuncSeparate(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA)),b.blending=e;if(e==="CustomBlending"){var e=
a.blendState.blendEquation,d=a.blendState.blendSrc,a=a.blendState.blendDst;if(e!==b.blendEquation)c.blendEquation(this.getGLBlendParam(e)),b.blendEquation=e;if(d!==b.blendSrc||a!==b.blendDst)c.blendFunc(this.getGLBlendParam(d),this.getGLBlendParam(a)),b.blendSrc=d,b.blendDst=a}else b.blendEquation=null,b.blendSrc=null,b.blendDst=null};m.prototype.updateOffset=function(a){var b=this.rendererRecord.offsetRecord,c=this.context,e=a.offsetState.enabled,d=a.offsetState.factor,a=a.offsetState.units;if(b.enabled!==
e)e?c.enable(p.POLYGON_OFFSET_FILL):c.disable(p.POLYGON_OFFSET_FILL),b.enabled=e;if(e&&(b.factor!==d||b.units!==a))c.polygonOffset(d,a),b.factor=d,b.units=a};m.prototype.setBoundBuffer=function(a,b){var c=this.rendererRecord.currentBuffer[b];if(!c.valid||c.buffer!==a)this.context.bindBuffer(this.getGLBufferTarget(b),a),c.buffer=a,c.valid=!0};m.prototype.bindVertexAttribute=function(a,b){this.context.vertexAttribPointer(a,b.count,this.getGLDataType(b.type),b.normalized,b.stride,b.offset)};m.prototype.getGLDataType=
function(a){switch(a){case "Float":case "HalfFloat":case "Double":return p.FLOAT;case "Byte":return p.BYTE;case "UnsignedByte":return p.UNSIGNED_BYTE;case "Short":return p.SHORT;case "UnsignedShort":return p.UNSIGNED_SHORT;case "Int":return p.INT;case "UnsignedInt":return p.UNSIGNED_INT;default:throw"Unknown datatype: "+a;}};m.prototype.getGLBlendParam=function(a){switch(a){case "AddEquation":return p.FUNC_ADD;case "SubtractEquation":return p.FUNC_SUBTRACT;case "ReverseSubtractEquation":return p.FUNC_REVERSE_SUBTRACT;
case "ZeroFactor":return p.ZERO;case "OneFactor":return p.ONE;case "SrcColorFactor":return p.SRC_COLOR;case "OneMinusSrcColorFactor":return p.ONE_MINUS_SRC_COLOR;case "SrcAlphaFactor":return p.SRC_ALPHA;case "OneMinusSrcAlphaFactor":return p.ONE_MINUS_SRC_ALPHA;case "DstAlphaFactor":return p.DST_ALPHA;case "OneMinusDstAlphaFactor":return p.ONE_MINUS_DST_ALPHA;case "DstColorFactor":return p.DST_COLOR;case "OneMinusDstColorFactor":return p.ONE_MINUS_DST_COLOR;case "SrcAlphaSaturateFactor":return p.SRC_ALPHA_SATURATE;
default:throw"Unknown blend param: "+a;}};m.prototype.clear=function(a,b,c){var e=0;if(a===void 0||a)e|=p.COLOR_BUFFER_BIT;if(b===void 0||b)e|=p.DEPTH_BUFFER_BIT;if(c===void 0||c)e|=p.STENCIL_BUFFER_BIT;this.context.clear(e)};m.prototype.flush=function(){this.context.flush()};m.prototype.finish=function(){this.context.finish()};m.prototype.setupFrameBuffer=function(a,b,c){this.context.bindFramebuffer(p.FRAMEBUFFER,a);this.context.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,c,b.glTexture,
0)};m.prototype.setupRenderBuffer=function(a,b){this.context.bindRenderbuffer(p.RENDERBUFFER,a);b.depthBuffer&&!b.stencilBuffer?(this.context.renderbufferStorage(p.RENDERBUFFER,p.DEPTH_COMPONENT16,b.width,b.height),this.context.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(this.context.renderbufferStorage(p.RENDERBUFFER,p.DEPTH_STENCIL,b.width,b.height),this.context.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,
a)):this.context.renderbufferStorage(p.RENDERBUFFER,p.RGBA4,b.width,b.height)};m.prototype.setRenderTarget=function(a){if(a&&!a._glFrameBuffer){if(a.depthBuffer===void 0)a.depthBuffer=!0;if(a.stencilBuffer===void 0)a.stencilBuffer=!0;a.glTexture=this.context.createTexture();var b=d.isPowerOfTwo(a.width)&&d.isPowerOfTwo(a.height),c=this.getGLInternalFormat(a.format),e=this.getGLDataType(a.type);a._glFrameBuffer=this.context.createFramebuffer();a._glRenderBuffer=this.context.createRenderbuffer();this.context.bindTexture(p.TEXTURE_2D,
a.glTexture);this.updateTextureParameters(a,b);this.context.texImage2D(p.TEXTURE_2D,0,c,a.width,a.height,0,c,e,null);this.setupFrameBuffer(a._glFrameBuffer,a,p.TEXTURE_2D);this.setupRenderBuffer(a._glRenderBuffer,a);a.generateMipmaps&&b&&this.context.generateMipmap(p.TEXTURE_2D);this.context.bindTexture(p.TEXTURE_2D,null);this.context.bindRenderbuffer(p.RENDERBUFFER,null);this.context.bindFramebuffer(p.FRAMEBUFFER,null)}var f;a?(b=a._glFrameBuffer,c=a.width,a=a.height,f=e=0):(b=null,c=this.viewportWidth,
a=this.viewportHeight,e=this.viewportX,f=this.viewportY);if(b!==this.rendererRecord.currentFrameBuffer)this.context.bindFramebuffer(p.FRAMEBUFFER,b),this.context.viewport(e,f,c,a),this.rendererRecord.currentFrameBuffer=b;this.currentWidth=c;this.currentHeight=a};m.prototype.updateRenderTargetMipmap=function(a){this.context.bindTexture(p.TEXTURE_2D,a.glTexture);this.context.generateMipmap(p.TEXTURE_2D);this.context.bindTexture(p.TEXTURE_2D,null)};m.prototype._deallocateMeshData=function(){};m.prototype._deallocateTexture=
function(){};m.prototype._deallocateRenderTarget=function(){};m.prototype._deallocateShader=function(){};return m});
define("goo/entities/systems/BoundingUpdateSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"])}d.prototype=Object.create(f.prototype);d.prototype.process=function(c){for(var a=0;a<c.length;a++){var b=c[a],e=b.meshDataComponent,d=b.transformComponent,b=b.meshRendererComponent;e.autoCompute?(e.computeBoundFromPoints(),b.updateBounds(e.modelBound,d.worldTransform)):d._updated&&b.updateBounds(e.modelBound,
d.worldTransform)}};return d});define("goo/entities/systems/ScriptSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"ScriptSystem",["ScriptComponent"])}d.prototype=Object.create(f.prototype);d.prototype.process=function(c,a){for(var b=0;b<c.length;b++)c[b].scriptComponent.run(c[b],a)};return d});
define("goo/entities/systems/LightingSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"LightingSystem",["LightComponent"])}d.prototype=Object.create(f.prototype);d.prototype.process=function(c){for(var a=0;a<c.length;a++){var b=c[a],e=b.transformComponent,b=b.lightComponent;e._updated&&b.light.translation.copy(e.transform.translation)}};return d});
define("goo/entities/managers/LightManager",["goo/entities/EventHandler"],function(f){function d(){this.type="LightManager";this.lights=[]}d.prototype.addedComponent=function(c,a){a.type==="LightComponent"&&this.lights.indexOf(a.light)===-1&&(this.lights.push(a.light),f.dispatch("setLights",this.lights))};d.prototype.removedComponent=function(c,a){if(a.type==="LightComponent"){var b=this.lights.indexOf(a.light);b!==-1&&(this.lights.splice(b,1),f.dispatch("setLights",this.lights))}};return d});
define("goo/entities/systems/CameraSystem",["goo/entities/systems/System","goo/entities/EventHandler","goo/renderer/Renderer"],function(f,d,c){function a(){f.call(this,"CameraSystem",["TransformComponent","CameraComponent"]);this.mainCamera=null}a.prototype=Object.create(f.prototype);a.prototype.findMainCamera=function(){for(var a=null,e=0;e<this._activeEntities.length;e++){var f=this._activeEntities[e].cameraComponent;if(!a||f.isMain)a=f.camera}d.dispatch("setCurrentCamera",a);c.mainCamera=a};a.prototype.inserted=
function(){this.findMainCamera()};a.prototype.deleted=function(){this.findMainCamera()};a.prototype.process=function(a){for(var c=0;c<a.length;c++){var d=a[c],f=d.transformComponent,d=d.cameraComponent;f._updated&&d.updateCamera(f.worldTransform)}};return a});
define("goo/entities/systems/ParticlesSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]);this.passive=!1}d.prototype=Object.create(f.prototype);d.prototype.process=function(c,a){if(!(a>1))for(var b=0,e=c.length;b<e;b++){var d=c[b],f=d.particleComponent;if(f&&f.enabled)try{this.updateParticles(d,f,a)}catch(k){console.log(k.stack)}}};d.prototype.updateParticles=function(c,
a,b){for(var e=0,d=-1,f,k=!1,i=!1;e<a.particleCount;){for(;f===void 0;)if(d++,a.emitters.length>d){f=a.emitters[d];if(f.influences.length)for(var h=0,j=f.influences.length;h<j;h++)f.influences[h].prepare(c,f);if(f.enabled){if(f.totalParticlesToSpawn!==0)f.particlesWaitingToRelease+=f.releaseRatePerSecond*b,f.particlesWaitingToRelease=Math.max(f.particlesWaitingToRelease,0),i=!0;f.particlesWaitingToRelease<1&&(f=void 0)}else f=void 0}else f=null;var n=a.particles[e];if(n.alive&&n.emitter&&n.emitter.influences.length){h=
0;for(j=n.emitter.influences.length;h<j;h++)n.emitter.influences[h].enabled&&n.emitter.influences[h].apply(b,n,e)}n.alive&&(n.update(b,c),i=k=!0);if(!n.alive&&f&&(f.particlesWaitingToRelease--,f.totalParticlesToSpawn>=1&&f.totalParticlesToSpawn--,n.respawnParticle(f),f.getEmissionPoint(n,c),f.getEmissionVelocity(n,c),f.particlesWaitingToRelease<1||f.totalParticlesToSpawn===0))f=void 0;e++}if(k)a.meshData.vertexData._dataNeedsRefresh=!0,c.meshDataComponent.autoCompute=!0;if(!i)a.enabled=!1};return d});
define("goo/util/Stats",[],function(){return function(){var f=Date.now(),d=f,c=f,a=0,b=Infinity,e=0,g=0,l=Infinity,k=0,i=0,h=0,j=document.createElement("div");j.id="stats";j.addEventListener("mousedown",function(a){a.preventDefault();w(++h%2)},!1);j.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var n=document.createElement("div");n.id="fps";n.style.cssText=
"padding:0 0 3px 3px;text-align:left;background-color:#002";j.appendChild(n);var o=document.createElement("div");o.id="fpsText";o.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";o.innerHTML="FPS";n.appendChild(o);var q=document.createElement("div");q.id="fpsGraph";q.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(n.appendChild(q);q.children.length<74;){var m=document.createElement("span");m.style.cssText=
"width:1px;height:30px;float:left;background-color:#113";q.appendChild(m)}var s=document.createElement("div");s.id="ms";s.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";j.appendChild(s);var p=document.createElement("div");p.id="msText";p.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";p.innerHTML="MS";s.appendChild(p);var t=document.createElement("div");t.id="msGraph";t.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";
for(s.appendChild(t);t.children.length<74;)m=document.createElement("span"),m.style.cssText="width:1px;height:30px;float:left;background-color:#131",t.appendChild(m);m=document.createElement("div");m.id="info";m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200";j.appendChild(m);var u=document.createElement("div");u.id="infoText";u.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";u.innerHTML="INFO";m.appendChild(u);
var w=function(a){h=a;switch(h){case 0:n.style.display="block";s.style.display="none";break;case 1:n.style.display="none",s.style.display="block"}};this.domElement=j;this.setMode=w;this.begin=function(){f=Date.now()};this.end=function(h){var j=Date.now();if(j>c+100){a=j-f;b=Math.min(b,a);e=Math.max(e,a);p.textContent=a+" MS ("+b+"-"+e+")";var m=Math.min(30,30-a/200*30);t.appendChild(t.firstChild).style.height=m+"px";c=j;if(h)u.innerHTML="Calls: "+h.calls+"<br>Vertices: "+h.vertices+"<br>Indices: "+
h.indices}i++;if(j>d+1E3)g=Math.round(i*1E3/(j-d)),l=Math.min(l,g),k=Math.max(k,g),o.textContent=g+" FPS ("+l+"-"+k+")",h=Math.min(30,30-g/(Math.min(500,k)+10)*30),q.appendChild(q.firstChild).style.height=h+"px",d=j,i=0;return j};this.update=function(a){f=this.end(a)}}});
define("goo/entities/systems/CSSTransformSystem",["goo/entities/systems/System","goo/renderer/Renderer","goo/math/Matrix4x4","goo/math/MathUtils","goo/math/Vector3"],function(f,d,c,a,b){function e(a){f.call(this,"CSSTransformSystem",["TransformComponent","CSSTransformComponent"]);this.renderer=a;this.viewDom=document.querySelector("#view");this.containerDom=document.querySelector("#cam1");this.containerDom2=document.querySelector("#cam2");this.tmpMatrix=new c;this.tmpMatrix2=new c;this.tmpVector=
new b}e.prototype=Object.create(f.prototype);var g=function(a){return Math.abs(a)<1.0E-6?0:a},l=["","-webkit-","-moz-","-ms-","-o-"],k=function(a,b,c){for(var e=0;e<l.length;e++)a.style[l[e]+b]=c},i=function(a){a=a.data;return"matrix3d("+g(a[0])+","+g(-a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(-a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+","+g(-a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(-a[13])+","+g(a[14])+","+g(a[15])+")"};e.prototype.process=function(c){if(c.length!==0){var e=d.mainCamera,
f=0.5/Math.tan(a.DEG_TO_RAD*e.fov*0.5)*this.renderer.domElement.offsetHeight;k(this.viewDom,"perspective",f+"px");this.tmpMatrix.copy(e.getViewInverseMatrix());this.tmpMatrix2.copy(this.tmpMatrix);this.tmpMatrix.invert();this.tmpMatrix.setTranslation(new b(0,0,f));var g=i(this.tmpMatrix);k(this.containerDom,"transform",g);this.tmpMatrix2.e03=-this.tmpMatrix2.e03;this.tmpMatrix2.e23=-this.tmpMatrix2.e23;this.tmpMatrix2.setRotationFromVector(new b(0,0,0));g=i(this.tmpMatrix2);k(this.containerDom2,"transform",
g);for(e=0;e<c.length;e++)g=c[e],f=g.getComponent("CSSTransformComponent").domElement,g="translate3d(-50%,-50%,0) "+i(g.transformComponent.worldTransform.matrix)+" scale3d(1,-1,1)",k(f,"transform",g),f.parentNode!==this.containerDom2&&this.containerDom2.appendChild(f)}};return e});
define("goo/util/GameUtils",[],function(){function f(){}f.supported={fullscreen:!0,pointerLock:!0};f.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()};f.togglePointerLock=function(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()};
f.initAllShims=function(d){this.initAnimationShims();this.initFullscreenShims(d);this.initPointerLockShims(d)};f.initAnimationShims=function(){for(var d=0,c=["ms","moz","webkit","o"],a=0;a<c.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"];if(window.requestAnimationFrame===void 0)window.requestAnimationFrame=function(a){var c=Date.now(),
f=Math.max(0,16-(c-d)),l=window.setTimeout(function(){a(c+f)},f);d=c+f;return l};if(window.cancelAnimationFrame===void 0)window.cancelAnimationFrame=function(a){clearTimeout(a)}};f.initFullscreenShims=function(d){function c(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenchange",!0,!1,null);document.dispatchEvent(a)}function a(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenerror",!0,!1,null);document.dispatchEvent(a)}var d=d||window,b=(d.HTMLElement||
d.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var e=function(){if("webkitIsFullScreen"in document)return function(){return document.webkitFullscreenEnabled};if("mozFullScreenEnabled"in document)return function(){return document.mozFullScreenEnabled};f.supported.fullscreen=!1;return function(){return!1}}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:e})}document.hasOwnProperty("fullscreenElement")||(e=function(){for(var a=
["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],b=function(b){return function(){return document[a[b]]}},c=0;c<a.length;c++)if(a[c]in document)return b(c);return function(){return null}}(),Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:e}));document.addEventListener("webkitfullscreenchange",c,!1);document.addEventListener("mozfullscreenchange",c,!1);document.addEventListener("webkitfullscreenerror",a,!1);document.addEventListener("mozfullscreenerror",
a,!1);if(!b.requestFullScreen)b.requestFullScreen=function(){return b.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(d.Element.ALLOW_KEYBOARD_INPUT)}:b.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}();if(!document.cancelFullScreen)document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}()};f.initPointerLockShims=function(d){function c(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockchange",
!0,!1,null);document.dispatchEvent(a)}function a(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockerror",!0,!1,null);document.dispatchEvent(a)}var d=d||window,b=(d.HTMLElement||d.Element).prototype,d=d.MouseEvent.prototype;"movementX"in d||Object.defineProperty(d,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}});"movementY"in d||Object.defineProperty(d,"movementY",{enumerable:!0,configurable:!1,writeable:!1,
get:function(){return this.webkitMovementY||this.mozMovementY||0}});if(!navigator.pointer)navigator.pointer=navigator.webkitPointer||navigator.mozPointer;document.addEventListener("webkitpointerlockchange",c,!1);document.addEventListener("webkitpointerlocklost",c,!1);document.addEventListener("mozpointerlockchange",c,!1);document.addEventListener("mozpointerlocklost",c,!1);document.addEventListener("webkitpointerlockerror",a,!1);document.addEventListener("mozpointerlockerror",a,!1);document.hasOwnProperty("pointerLockElement")||
(d=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}(),Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:d}));if(!b.requestPointerLock)b.requestPointerLock=function(){if(b.webkitRequestPointerLock)return function(){this.webkitRequestPointerLock()};if(b.mozRequestPointerLock)return function(){this.mozRequestPointerLock()};
if(navigator.pointer)return function(){navigator.pointer.lock(this,c,a)};f.supported.pointerLock=!1;return function(){}}();if(!document.exitPointerLock)document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}()};return f});
define("goo/entities/GooRunner","goo/entities/World,goo/entities/systems/TransformSystem,goo/entities/systems/RenderSystem,goo/renderer/Renderer,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/LightingSystem,goo/entities/managers/LightManager,goo/entities/systems/CameraSystem,goo/entities/systems/ParticlesSystem,goo/util/Stats,goo/entities/systems/CSSTransformSystem,goo/util/GameUtils".split(","),function(f,d,c,a,b,e,g,l,k,i,h,j,n){function o(o){o=
o||{};this.world=new f;this.renderer=new a(o);this.world.setManager(new l);this.world.setSystem(new e);this.world.setSystem(new d);this.world.setSystem(new k);this.world.setSystem(new j(this.renderer));this.world.setSystem(new i);this.world.setSystem(new b);this.world.setSystem(new g);var m=this.renderSystem=new c;this.world.setSystem(m);this.doRender=!0;n.initAllShims();if(o.showStats)this.stats=new h,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top=
"10px",document.body.appendChild(this.stats.domElement);this.callbacks=[];this.callbacksPreProcess=[];this.callbacksPreRender=[];var s=this;this.start=-1;this.run=function(a){try{if(s.start<0)s.start=a;s.world.tpf=(a-s.start)/1E3;s.world.time+=s.world.tpf;f.time=s.world.time;s.start=a;if(s.world.tpf<0)s.world.time=0,s.world.tpf=0,f.time=0;else if(!(s.world.tpf>0.5)){for(a=0;a<s.callbacksPreProcess.length;a++)s.callbacksPreProcess[a](s.world.tpf);s.world.process();for(a=0;a<s.callbacksPreRender.length;a++)s.callbacksPreRender[a](s.world.tpf);
s.renderer.info.reset();s.doRender&&m.render(s.renderer);for(a=0;a<s.callbacks.length;a++)s.callbacks[a](s.world.tpf);s.stats&&s.stats.update(s.renderer.info)}s.animationId=window.requestAnimationFrame(s.run)}catch(b){b instanceof Error?console.error(b.stack):console.error(b)}};this.animationId=-1;o.manuallyStartGameLoop||this.startGameLoop(this.run);var p=!1;document.onkeyup=function(a){a.which===17&&(p=!1)};document.onkeydown=function(a){a.which===17?p=!0:a.which===32&&p?n.toggleFullScreen():a.which===
13&&p&&n.togglePointerLock()}}o.prototype.startGameLoop=function(){this.start=-1;this.animationId=window.requestAnimationFrame(this.run)};o.prototype.stopGameLoop=function(){window.cancelAnimationFrame(this.animationId)};return o});
define("goo/entities/components/CameraComponent",["goo/entities/components/Component","goo/math/Vector3"],function(f,d){function c(a){this.type="CameraComponent";this.camera=a;this.leftVec=new d(-1,0,0);this.upVec=new d(0,1,0);this.dirVec=new d(0,0,-1)}c.prototype=Object.create(f.prototype);c.prototype.setUpVector=function(a){a===0?(this.leftVec.setd(0,-1,0),this.upVec.setd(1,0,0),this.dirVec.setd(0,0,-1)):a===2?(this.leftVec.setd(-1,0,0),this.upVec.setd(0,0,1),this.dirVec.setd(0,-1,0)):(this.leftVec.setd(-1,
0,0),this.upVec.setd(0,1,0),this.dirVec.setd(0,0,-1))};c.prototype.updateCamera=function(a){this.camera._left.setv(this.leftVec);a.matrix.applyPostVector(this.camera._left);this.camera._up.setv(this.upVec);a.matrix.applyPostVector(this.camera._up);this.camera._direction.setv(this.dirVec);a.matrix.applyPostVector(this.camera._direction);a.matrix.getTranslation(this.camera.translation);this.camera.update()};return c});
define("goo/entities/components/LightComponent",["goo/entities/components/Component"],function(f){function d(c){this.type="LightComponent";this.light=c}d.prototype=Object.create(f.prototype);return d});
define("goo/particles/ParticleUtils",["goo/math/Vector3"],function(f){function d(){}d.getRandomVelocityOffY=function(c,a,b,e,f){a+=Math.random()*(b-a);b=Math.PI*2*Math.random();c.x=Math.cos(b)*Math.sin(a);c.y=Math.cos(a);c.z=Math.sin(b)*Math.sin(a);f&&d.applyEntityTransformVector(c,f);c.mul(e);return c};d.randomPointInCube=function(c,a,b,e,d){c.x=Math.random()*2*a-a+(d?d.x:0);c.y=Math.random()*2*b-b+(d?d.y:0);c.z=Math.random()*2*e-e+(d?d.z:0);return c};d.createConstantForce=function(c){var a=new f(c);
return{enabled:!0,prepare:function(){},apply:function(b,c){c.velocity.x+=a.x*b;c.velocity.y+=a.y*b;c.velocity.z+=a.z*b}}};d.applyEntityTransformPoint=function(c,a){return!a.transformComponent||!a.transformComponent.worldTransform?c:a.transformComponent.worldTransform.applyForward(c,c)};d.applyEntityTransformVector=function(c,a){return!a.transformComponent||!a.transformComponent.worldTransform?c:a.transformComponent.worldTransform.applyForwardVector(c,c)};d.applyTimeline=function(c,a){for(var b=c.age,
e=c.lifeSpan,d=0,f=0,k=0,i=0,h=e,j=e,n=e,o=e,q=0,m=0,s=null,p=null,t=null,u=null,w=null,r=null,v=null,z=null,y=null,m=0,A=a.length;m<A;m++){var x=a[m];q+=(x.timeOffset?x.timeOffset:0)*e;r===null&&(q>b?x.color!==void 0&&(h=q,r=x):x.color!==void 0&&(d=q,s=x));v===null&&(q>b?x.mass!==void 0&&(j=q,v=x):x.mass!==void 0&&(f=q,p=x));q<=b&&x.uvIndex!==void 0&&(w=x);z===null&&(q>b?x.size!==void 0&&(n=q,z=x):x.size!==void 0&&(k=q,t=x));y===null&&(q>b?x.spin!==void 0&&(o=q,y=x):x.spin!==void 0&&(i=q,u=x))}m=
(b-d)/(h-d);e=s!==null?s.color:[1,1,1,1];r=r!==null?r.color:e;c.color.data[0]=(1-m)*e[0]+m*r[0];c.color.data[1]=(1-m)*e[1]+m*r[1];c.color.data[2]=(1-m)*e[2]+m*r[2];c.color.data[3]=(1-m)*e[3]+m*r[3];m=(b-f)/(j-f);e=p!==null?p.mass:1;r=v!==null?v.mass:e;c.mass=(1-m)*e+m*r;c.uvIndex=w!==null?w.uvIndex:0;m=(b-k)/(n-k);e=t!==null?t.size:1;r=z!==null?z.size:e;c.size=(1-m)*e+m*r;m=(b-i)/(o-i);e=u!==null?u.spin:0;r=y!==null?y.spin:e;c.spin=(1-m)*e+m*r};return d});
define("goo/particles/Particle",["goo/particles/ParticleUtils","goo/math/Vector","goo/math/Vector3","goo/math/Vector4","goo/renderer/MeshData"],function(f,d,c,a,b){function e(b,e){this.alive=!1;this.position=new c;this.velocity=new c;this.lifeSpan=0;this.parent=b;this.age=0;this.index=e;this.color=new a(1,0,0,1);this.spin=this.size=0;this.mass=1;this.emitter=null;this.uvIndex=0;this.lastUVIndex=-1;this.bbX=new c;this.bbY=new c;this.lastColor=new a}var g=new c;e.prototype.respawnParticle=function(a){this.emitter=
a;this.lifeSpan=a.nextParticleLifeSpan();this.alive=!0;this.age=0};e.prototype.update=function(a,e){if(this.alive)if(this.age+=a,this.age>this.lifeSpan)this.kill();else{this.position.add_d(this.velocity.x*a,this.velocity.y*a,this.velocity.z*a);f.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline);if(!d.equals(this.lastColor,this.color)){var i=this.parent.meshData.getAttributeBuffer(b.COLOR);i.set(this.color.data,this.index*16+0);i.set(this.color.data,
this.index*16+4);i.set(this.color.data,this.index*16+8);i.set(this.color.data,this.index*16+12);this.lastColor.setv(this.color)}this.emitter&&this.emitter.getParticleBillboardVectors(this,e);if(this.spin===0)this.bbX.muld(this.size,this.size,this.size),this.bbY.muld(this.size,this.size,this.size);else{var i=Math.cos(this.spin)*this.size,h=Math.sin(this.spin)*this.size,j=this.bbY.x,n=this.bbY.y,o=this.bbY.z;this.bbY.setv(this.bbX);this.bbX.muld(i,i,i).add_d(j*h,n*h,o*h);this.bbY.muld(-h,-h,-h).add_d(j*
i,n*i,o*i)}i=this.parent.meshData.getAttributeBuffer(b.POSITION);c.subv(this.position,this.bbX,g).subv(this.bbY);i.set(g.data,this.index*12+0);c.subv(this.position,this.bbX,g).addv(this.bbY);i.set(g.data,this.index*12+3);c.addv(this.position,this.bbX,g).addv(this.bbY);i.set(g.data,this.index*12+6);c.addv(this.position,this.bbX,g).subv(this.bbY);i.set(g.data,this.index*12+9);if(this.lastUVIndex!==this.uvIndex)i=this.parent.meshData.getAttributeBuffer(b.TEXCOORD0),h=this.uvIndex%this.parent.uRange/
this.parent.uRange,j=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,n=1/this.parent.uRange,o=1/this.parent.vRange,i.set([h+n,j-o],this.index*8+0),i.set([h+n,j],this.index*8+2),i.set([h,j],this.index*8+4),i.set([h,j-o],this.index*8+6),this.lastUVIndex=this.uvIndex}};e.prototype.kill=function(){this.alive=!1;var a=this.parent.meshData.getAttributeBuffer(b.POSITION),c=a.subarray(this.index*12,this.index*12+3);a.set(c,this.index*12+3);a.set(c,this.index*12+6);a.set(c,this.index*12+9)};
return e});
define("goo/particles/ParticleEmitter",["goo/particles/ParticleUtils","goo/renderer/Renderer"],function(f,d){function c(a){a=a||{};this.totalParticlesToSpawn=!isNaN(a.totalParticlesToSpawn)?a.totalParticlesToSpawn:-1;this.maxLifetime=!isNaN(a.maxLifetime)?a.maxLifetime:3;this.minLifetime=!isNaN(a.minLifetime)?a.minLifetime:2;this.timeline=a.timeline?a.timeline:void 0;this.influences=a.influences?a.influences:[];this.getEmissionPoint=a.getEmissionPoint?a.getEmissionPoint:function(a,c){var d=a.position;
d.setd(0,0,0);return f.applyEntityTransformPoint(d,c)};this.getEmissionVelocity=a.getEmissionVelocity?a.getEmissionVelocity:function(a,c){var d=a.velocity;d.setd(0,1,0);return f.applyEntityTransformVector(d,c)};this.getParticleBillboardVectors=a.getParticleBillboardVectors?a.getParticleBillboardVectors:c.CAMERA_BILLBOARD_FUNC;this.releaseRatePerSecond=!isNaN(a.releaseRatePerSecond)?a.releaseRatePerSecond:10;this.particlesWaitingToRelease=0;this.enabled=a.enabled!==void 0?a.enabled===!0:!0}c.CAMERA_BILLBOARD_FUNC=
function(a){var b=d.mainCamera;a.bbX.setv(b._left);a.bbY.setv(b._up)};c.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()};return c});
define("goo/entities/components/ParticleComponent",["goo/entities/components/Component","goo/particles/Particle","goo/particles/ParticleEmitter","goo/renderer/MeshData"],function(f,d,c,a){function b(a){this.type="ParticleComponent";f.call(this);a=a||{};this.emitters=[];if(a.emitters)for(var b=0,d=a.emitters.length;b<d;b++)this.emitters.push(new c(a.emitters[b]));this.timeline=a.timeline?a.timeline:[];this.uRange=isNaN(a.uRange)?1:a.uRange;this.vRange=isNaN(a.vRange)?1:a.vRange;this.recreateParticles(isNaN(a.particleCount)?
100:a.particleCount);this.enabled=!0}b.prototype=Object.create(f.prototype);b.prototype.generateMeshData=function(){var b=a.defaultMap([a.POSITION,a.COLOR,a.TEXCOORD0]);this.meshData=new a(b,this.particleCount*4,this.particleCount*6);for(var b=this.meshData.getAttributeBuffer(a.TEXCOORD0),c=this.meshData.getIndexBuffer(),d=0,f=this.particleCount;d<f;d++)b.set([1,0],d*8+0),b.set([1,1],d*8+2),b.set([0,1],d*8+4),b.set([0,0],d*8+6),c.set([d*4+0,d*4+3,d*4+1,d*4+1,d*4+3,d*4+2],d*6)};b.prototype.recreateParticles=
function(a){this.particleCount=a;this.particles=[];for(a=0;a<this.particleCount;a++)this.particles[a]=new d(this,a);this.generateMeshData()};return b});
define("goo/entities/components/ScriptComponent",["goo/entities/components/Component"],function(f){function d(c){this.type="ScriptComponent";this.scripts=c instanceof Array?c:c?[c]:[]}d.prototype=Object.create(f.prototype);d.prototype.run=function(c,a){for(var b,e=0,d=this.scripts.length;e<d;e++)(b=this.scripts[e])&&b.run&&(b.enabled===void 0||b.enabled)&&b.run(c,a)};return d});
define("goo/entities/managers/DebugManager",[],function(){function f(){this.type="DebugManager";this._entities={}}f.prototype.added=function(d){this._entities[d.id]=d};f.prototype.removed=function(d){delete this._entities[d.id]};f.prototype.getEntities=function(){var d=[],c;for(c in this._entities)d.push(this._entities[c]);return d};return f});
define("goo/entities/systems/PickingSystem",["goo/entities/systems/System"],function(f){function d(c){f.call(this,"PickingSystem",["MeshRendererComponent","TransformComponent"]);this.passive=!0;this.onPick=this.pickRay=null;c=c||{};this.setPickLogic(c.pickLogic||null)}d.prototype=Object.create(f.prototype);d.prototype.setPickLogic=function(c){(this.pickLogic=c)&&this.interests.indexOf("MeshDataComponent")===-1&&this.interests.push("MeshDataComponent")};d.prototype.inserted=function(c){this.pickLogic&&
this.pickLogic.added(c)};d.prototype.deleted=function(c){this.pickLogic&&this.pickLogic.removed(c)};d.prototype.process=function(c){if(this.pickRay&&this.onPick){for(var a=[],b=0;b<c.length;b++){var e=c[b],d=e.meshRendererComponent;this.pickLogic?(d=this.pickLogic.getPickResult(this.pickRay,e))&&d.distances&&d.distances.length&&a.push({entity:e,intersection:d}):d.worldBound&&(d=d.worldBound.intersectsRayWhere(this.pickRay))&&d.distances.length&&a.push({entity:e,intersection:d})}a.sort(function(a,
b){return a.intersection.distances[0]-b.intersection.distances[0]});this.onPick(a)}};return d});
define("goo/loaders/JsonUtils","goo/renderer/BufferUtils,goo/math/Transform,goo/math/Matrix3x3,goo/math/Matrix4x4,goo/math/Vector3,goo/math/Quaternion,goo/animation/blendtree/ClipSource,goo/animation/layer/AnimationLayer,goo/animation/state/SteadyState,goo/animation/state/FadeTransitionState,goo/animation/state/FrozenTransitionState,goo/animation/state/IgnoreTransitionState,goo/animation/state/ImmediateTransitionState,goo/animation/state/SyncFadeTransitionState,goo/animation/state/StateBlendType,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/ExclusiveClipSource,goo/animation/blendtree/FrozenClipSource,goo/animation/blendtree/InclusiveClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/layer/LayerLERPBlender".split(","),function(f,
d,c,a,b,e,g,l,k,i,h,j,n,o,q,m,s,p,t,u,w){function r(){}r.fillAttributeBufferFromCompressedString=function(a,b,c,d,e){var b=b.getAttributeBuffer(c),c=d.length,f=a.length/d.length,g,h,i,k,j;for(j=0;j<c;j++)if(d[j]===0)return;for(j=0;j<c;j++)for(k=g=0;k<f;k++)h=a.charCodeAt(k+j*f),i=k*c+j,g+=r.unzip(h),b[i]=(g+e[j])*d[j]};r.fillAttributeBuffer=function(a,b,c){b=b.getAttributeBuffer(c);for(c=0;c<a.length;c++)b[c]=a[c]};r.getIntBuffer=function(a,b){var c=f.createIndexBuffer(a.length,b);c.set(a);return c};
r.rewrap=function(a){a%=61404;a<0&&(a+=61404);return a};r.getIntBufferFromCompressedString=function(a,b){for(var c=0,d=f.createIndexBuffer(a.length,b),e=0;e<a.length;++e){var g=a.charCodeAt(e),c=g=c+r.unzip(g);d[e]=this.rewrap(g)}return d};r.unzip=function(a){a>=57344&&(a-=2048);a-=35;return a>>1^-(a&1)};r.parseTransform=function(a){var b=new d;b.translation=r.parseVector3(a.Translation);b.scale=r.parseVector3(a.Scale);b.rotation=r.parseMatrix3(a.Rotation);return b};r.parseTransformQuat=function(a){var b=
new d;b.translation=r.parseVector3(a.Translation);b.scale=r.parseVector3(a.Scale);b.rotation=r.parseQuaternion(a.Rotation).toRotationMatrix();return b};r.parseTransformMatrix=function(a){var b=new d;b.matrix=r.parseMatrix4(a.Matrix);return b};r.parseMatrix3=function(a){var b=new c;b.e00=a[0];b.e01=a[1];b.e02=a[2];b.e10=a[3];b.e11=a[4];b.e12=a[5];b.e20=a[6];b.e21=a[7];b.e22=a[8];return b};r.parseMatrix4=function(b){var c=new a;c.e00=b[0];c.e01=b[1];c.e02=b[2];c.e03=b[3];c.e10=b[4];c.e11=b[5];c.e12=
b[6];c.e13=b[7];c.e20=b[8];c.e21=b[9];c.e22=b[10];c.e23=b[11];c.e30=b[12];c.e31=b[13];c.e32=b[14];c.e33=b[15];return c};r.parseQuaternion=function(a){var b=new e;b.x=a[0];b.y=a[1];b.z=a[2];b.w=a[3];return b};r.parseVector3=function(a){return new b(a[0],a[1],a[2])};r.parseAnimationLayers=function(a,b,c,d,e){var e=e.Layers,f;for(f in e){var g;"DEFAULT"===f?g=a.getBaseAnimationLayer():(g=new l(f),a.addAnimationLayer(g));var h=e[f];r.parseLayerProperties(a,g,h);if(h.States)for(var i=h.States,k=0,j=i.length;k<
j;k++)r.parseSteadyState(i[k],c,d,a,g);if(h.Transitions){var h=h.Transitions,m;for(m in h)g._transitions[m]=r.parseTransitionState(h[m],c,d,a)}}if(b!==null)b.onSuccess(d)};r.parseSteadyState=function(a,b,c,d,e){var f=new k(a.Name?a.Name:"unknown");if(a.Clip){var h=a.Clip,i=b[h.Name],j=new g(i,d);f._sourceTree=j;c._usedClipSources[j._clip._name]=j;r.populateClipSource(j,i,h,d)}else if(a.Tree)f._sourceTree=r.parseTreeSource(a.Tree,b,c,d);if(a.EndTransition)f._endTransition=r.parseTransitionState(a.EndTransition,
b,c,d);if(a.Transitions){var h=a.Transitions,l;for(l in h)f._transitions[l]=r.parseTransitionState(h[l],b,c,d)}a.Default&&e.setCurrentState(f,!0);e._steadyStates[f._name]=f};r.parseTransitionState=function(a){var b=a[2];if("fade"===b)b=new i(a[3],a[4],q[a[5]]);else if("syncfade"===b)b=new o(a[3],a[4],q[a[5]]);else if("frozen"===b)b=new h(a[3],a[4],q[a[5]]);else if("immediate"===b)b=new n(a[3]);else if("ignore"===b)b=new j;else return null;isNaN(a[0])||b.setStartWindow(a[0]);isNaN(a[1])||b.setEndWindow(a[1]);
return b};r.parseTreeSource=function(a,b,c,d){if(a.Clip){var a=a.Clip,b=b[a.Name],e=new g(b,d);c._usedClipSources[e._clip._name]=e;r.populateClipSource(e,b,a,d);return e}else if(a.InclusiveClip){a=a.InclusiveClip;b=b[a.Name];e=new t(b,d);c._usedClipSources[e._clip._name]=e;r.populateClipSource(e,b,a,d);a.Channels&&e.addEnabledChannels(a.Channels);if(a.JointNames){var d=d.getSkeletonPose(0).getSkeleton(),b=a.JointNames,f;for(f in b)e.addEnabledJoints(d.findJointByName(f))}a.Joints&&e.addEnabledJoints(a.Joints);
return e}else if(a.ExclusiveClip)return a=a.ExclusiveClip,b=b[a.Name],e=new s(b,d),c._usedClipSources[e._clip._name]=e,r.populateClipSource(e,b,a,d),a.Channels&&e.addDisabledChannels(a.Channels),a.Joints&&e.addDisabledJoints(a.Joints),e;else if(a.Lerp){a=a.Lerp;e=r.parseTreeSource(a.ChildA,b,c,d);f=r.parseTreeSource(a.ChildB,b,c,d);e=new m(e,f);if(a.BlendKey)e._blendKey=a.BlendKey,d._valuesStore[e._blendKey]=isNaN(a.BlendWeight)?0:a.BlendWeight;return e}else if(a.Managed){a=a.Managed;e=new u;if(a.InitFromClip)a=
a.InitFromClip,e._sourceName=a.Clip,b=b[e._sourceName],a.JointNames&&e.initJointsByName(d._applyToPoses[0],b,a.JointNames),a.JointIds&&e.initJointsById(b,a.JointIds);return e}else if(a.Frozen)return a=a.Frozen,d=r.parseTreeSource(a.Child,b,c,d),new p(d,isNaN(a.Time)?0:a.Time);console.warn("no known source type found.");return null};r.populateClipSource=function(a,b,c,e){if(c.TimeScale!==void 0)e.getClipInstance(b)._timeScale=isNaN(c.TimeScale)?1:c.TimeScale;if(c.LoopCount!==void 0)e.getClipInstance(b)._loopCount=
isNaN(c.LoopCount)?1:c.LoopCount;if(c.Active!==void 0)e.getClipInstance(b)._active=c.Active===!0};r.parseLayerProperties=function(a,b,c){if(c.BlendType){var e=null;if("lerp"===c.BlendType)e=new w,b._layerBlender=e;if(e!==null&&c.BlendKey)e._blendKey=c.BlendKey,a._valuesStore[e._blendKey]=isNaN(c.BlendWeight)?0:c.BlendWeight}};r.parseChannelTimes=function(a,b){var c=a.Times;if(c)if(b){var e=a.TimeOffsetScale;return r.parseFloatArrayFromCompressedString(c,[e[1]],[e[0]])}else return c;return null};r.parseFloatLERPValues=
function(a,b){var c=a.IFCValues;if(c)if(b){var e=a.IFCOffsetScale;return r.parseFloatArrayFromCompressedString(c,[e[1]],[e[0]])}else return c;return null};r.parseRotationSamples=function(a,b,c){return(a=a.RotationSamples)?c?(b=1-(b+1>>1),c=1/-b,r.parseFloatArrayFromCompressedString(a,[c,c,c,c],[b,b,b,b])):r.parseQuaternionSamples(a):null};r.parseTranslationSamples=function(a,b,c){var e=a.UniformTranslation;if(e){e===void 0&&console.log("asdf");for(var a=e[0],c=e[1],e=e[2],d=[],f=0;f<b;f++)d[f*3+0]=
a,d[f*3+1]=c,d[f*3+2]=e;return d}return(b=a.TranslationSamples)?c?(a=a.TranslationOffsetScale,c=a[3],r.parseFloatArrayFromCompressedString(b,[c,c,c],[a[0],a[1],a[2]])):r.parseVector3Samples(b):null};r.parseScaleSamples=function(a,b,c){var e=a.UniformScale;if(e){for(var a=e,c=a[0],e=a[1],a=a[2],d=[],f=0;f<b;f++)d[f*3+0]=c,d[f*3+1]=e,d[f*3+2]=a;return d}return(b=a.ScaleSamples)?c?(a=a.ScaleOffsetScale,c=a[0],e=a[1],d=a[2],a=a[3],r.parseFloatArrayFromCompressedString(b,[a,a,a],[c,e,d])):r.parseVector3Samples(b):
null};r.parseQuaternionSamples=function(a){if(!a)return null;for(var b=[],c=new e,d=0,f=a.length;d<f;d++){var g=a[d];if(g==="*")b[d*4+0]=c.x,b[d*4+1]=c.y,b[d*4+2]=c.z,b[d*4+3]=c.w;else if(g instanceof Array&&g.length===4)c.set(g[0],g[1],g[2],g[3]),b[d*4+0]=c.x,b[d*4+1]=c.y,b[d*4+2]=c.z,b[d*4+3]=c.w}return b};r.parseVector3Samples=function(a){if(!a)return null;for(var c=[],e=new b,d=0,f=a.length;d<f;d++){var g=a[d];if(g==="*")c[d*3+0]=e.x,c[d*3+1]=e.y,c[d*3+2]=e.z;else if(g instanceof Array&&g.length===
3)e.set(g[0],g[1],g[2]),c[d*3+0]=e.x,c[d*3+1]=e.y,c[d*3+2]=e.z}return c};r.parseFloatArrayFromCompressedString=function(a,b,c){var e=[],d=b.length,f=a.length/b.length,g,h,i,k,j;for(j=0;j<d;j++)for(k=g=0;k<f;k++)h=a.charCodeAt(k+j*f),i=k*d+j,g+=r.unzip(h),e[i]=(g+c[j])*b[j];return e};return r});
define("goo/loaders/AnimationLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/animation/state/loader/OutputStore,goo/animation/AnimationManager,goo/animation/blendtree/SimpleAnimationApplier,goo/loaders/JsonUtils,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/state/SteadyState,goo/animation/blendtree/ClipSource".split(","),function(f,
d,c,a,b,e,g,l,k,i,h,j,n,o,q,m){function s(a){if(typeof a==="undefined"||a===null)throw Error("AnimationTreeLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof e)||a.loader===null)throw Error("AnimationTreeLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}s.prototype.load=function(a,b,c){if(this._cache[a]&&this._cache[a][b._skeleton._name])return this._cache[a][b._skeleton.name];var e=new l(b);
e._applier=new k;var d=s.prototype._loadAnimation.bind(this),f=s.prototype._parseAnimation.bind(this,c),c=s.prototype._setupDefaultAnimation.bind(this,e,c),d=d(a).then(f).then(c);this._cache[a]||(this._cache[a]={});return this._cache[a][b._skeleton._name]=d};s.prototype._loadAnimation=function(a){return this._loader.load(a)};s.prototype._parseAnimation=function(a,b){typeof b==="string"&&(b=JSON.parse(b));var c,e,d=new h(a);(c=b.UseCompression||!1)&&(e=b.CompressedRange||32767);if(b.Channels)for(var f=
b.Channels,g=0,k=f.length;g<k;g++){var l=f[g],m=l.Type,a=l.Name,q=i.parseChannelTimes(l,c);if("Joint"===m)var m=l.JointName,s=l.JointIndex,C=i.parseRotationSamples(l,e,c),F=i.parseTranslationSamples(l,q.length,c),l=i.parseScaleSamples(l,q.length,c),q=new j(m,s,q,C,F,l);else if("Transform"===m)C=i.parseRotationSamples(l,e,c),F=i.parseTranslationSamples(l,q.length,c),l=i.parseScaleSamples(l,q.length,c),q=new n(a,q,C,F,l);else if("FloatLERP"===m)q=new o(a,q,i.parseFloatLERPValues(l,c));else{console.warn("Unhandled channel type: "+
m);continue}d.addChannel(q)}return d};s.prototype._setupDefaultAnimation=function(a,b,c){var e=new q(b),d=new m(c,a);e._sourceTree=d;a._layers[0]._steadyStates[e._name]=e;a.getClipInstance(c)._loopCount=-1;a.getClipInstance(c)._timeScale=1;a._layers[0].setCurrentStateByName(b,!0);return a};return s});
define("goo/loaders/AnimationTreeLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/animation/state/loader/OutputStore,goo/animation/AnimationManager,goo/animation/blendtree/SimpleAnimationApplier,goo/loaders/JsonUtils,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/loaders/AnimationLoader".split(","),function(f,
d,c,a,b,e,g,l,k,i,h,j,n,o,q){function m(a){if(typeof a==="undefined"||a===null)throw Error("AnimationTreeLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof e)||a.loader===null)throw Error("AnimationTreeLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={};this._animationLoader=new q({loader:this._loader})}m.prototype.load=function(a,b,c){if(this._cache[a]&&this._cache[a][b._skeleton._name])return this._cache[a][b._skeleton._name];
var e=new l(b);e._applier=new k;var d=a.match(/.*\//),d=d.length===1?d[0]:"",f=m.prototype._loadTree.bind(this),h=m.prototype._parseTree.bind(this),d=m.prototype._loadAndParseAnimations.bind(this,d),i=m.prototype._parseAnimationLayers.bind(this),c=m.prototype._setupDefaultAnimation.bind(this,c),j,f=f(a).then(function(a){return j=a}).then(h).then(d).then(function(a){var b=new g;return i(e,a,b,j)}).then(c);this._cache[a]||(this._cache[a]={});return this._cache[a][b._skeleton._name]=f};m.prototype._loadTree=
function(a){return this._loader.load(a)};m.prototype._parseTree=function(a){typeof a==="string"&&(a=JSON.parse(a));return!a.Clips||!a.Layers?!1:a.Clips};m.prototype._loadAndParseAnimations=function(a,b){function c(a){h[a._name]=a}for(var e=q.prototype._loadAnimation.bind(this),d,g=[],h={},i=0,k=b.length;i<k;i++)d=q.prototype._parseAnimation.bind(this,b[i].Name),g.push(e(a+b[i].URL).then(d).then(c));return f.all(g).then(function(){return h})};m.prototype._parseAnimationLayers=function(a,b,c,e){var d=
new f.Promise;i.parseAnimationLayers(a,{onSuccess:function(){d.resolve(a)},onError:function(a){d.reject(a)}},b,c,e);return d};m.prototype._setupDefaultAnimation=function(a,b){a&&b.getBaseAnimationLayer().setCurrentStateByName(a,!0);return b};return m});
define("goo/loaders/BundleLoader",["goo/loaders/Loader","goo/util/rsvp","goo/renderer/Util"],function(f,d,c){function a(a){f.call(this,a);this._bundle={}}a.prototype=Object.create(f.prototype);a.prototype.load=function(a,e,g){if(this._bundle[a]){var g=new d.Promise,a=c.clone(this._bundle[a]),l=g.then(function(a){return typeof e==="function"?e(a):a});g.resolve(a);return l}return f.prototype.load.call(this,a,e,g)};a.prototype.loadBundle=function(b){var c=a.prototype._parse.bind(this);return f.prototype.load.call(this,
b,c)};a.prototype._parse=function(a){this._bundle=JSON.parse(a)};return a});
define("goo/loaders/ShaderLoader",["goo/util/rsvp","goo/renderer/MeshData","goo/renderer/Shader","goo/loaders/Loader"],function(f,d,c,a){function b(b){if(typeof b==="undefined"||b===null)throw Error("ShaderLoader(): Argument `parameters` was undefined/null");if(typeof b.loader==="undefined"||!(b.loader instanceof a)||b.loader===null)throw Error("ShaderLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=b.loader;this._cache={}}b.prototype.load=function(a){var b=this._parse.bind(this),
c=this._loader.load(a,function(a){return b(a)});return this._cache[a]=c};b.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var b=[];if(a&&a.attributes&&a.uniforms){var d={attributes:a.attributes,uniforms:a.uniforms},k;for(k in d.uniforms){var i=d.uniforms[k];if(typeof i==="string"&&(i=i.match(/^function\s?\(([^\)]+)\)\s*\{(.*)}$/))&&i.length===3){var h=i[1].replace(" ","").split(",");d.uniforms[k]=new Function(h,i[2])}}if(a.defines)d.defines=a.defines}else d=this._getDefaultShaderDefinition();
a&&a.vshaderRef&&a.fshaderRef&&(k=this._loader.load(a.vshaderRef).then(function(a){return d.vshader=a}),b.push(k),k=this._loader.load(a.fshaderRef).then(function(a){return d.fshader=a}),b.push(k));return b.length===0?(k=new f.Promise,k.reject("Shader definition `"+a+"` does not seem to contain any shader data."),k):f.all(b).then(function(){return new c(a.name,d)})};b.prototype._getDefaultShaderDefinition=function(){return{attributes:{vertexPosition:d.POSITION,vertexNormal:d.NORMAL,vertexUV0:d.TEXCOORD0},
uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,lightPosition:c.LIGHT0,diffuseMap:c.TEXTURE0,materialAmbient:c.AMBIENT,materialDiffuse:c.DIFFUSE,materialSpecular:c.SPECULAR,materialSpecularPower:c.SPECULAR_POWER}}};return b});
define("goo/loaders/MaterialLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/loaders/ShaderLoader,goo/renderer/shaders/ShaderLib".split(","),function(f,d,c,a,b,e,g,l){function k(a){if(typeof a==="undefined"||a===null)throw Error("MaterialLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof e)||a.loader===null)throw Error("MaterialLoader(): Argument `parameters.loader` was invalid/undefined/null");
this._loader=a.loader;this._cache={};this._shaderLoader=new g({loader:this._loader})}k.prototype.load=function(a){if(this._cache[a])return this._cache[a];var c=this,d=this._loader.load(a,function(a){return c._parse(a)}).then(null,function(){return b.createMaterial(l.texturedLit,"DefaultShader")});return this._cache[a]=d};k.prototype._parse=function(c){function d(b,c){typeof c==="string"&&(c=JSON.parse(c));s[b]=(new a({loader:e._loader})).loadTexture2D(c.url)}typeof c==="string"&&(c=JSON.parse(c));
var e=this,g=[],k,q=this._getDefaultMaterialState(),m={},s=[],p=c.name||"DefaultMaterial";if(c){var t;(t=c.shaderRef)?t=this._shaderLoader.load(t).then(function(a){return k=a}):(t=new f.Promise,t.then(function(a){return k=a}),t.resolve(b.createShader(l.texturedLit),"DefaultShader"));g.push(t);if(c.uniforms)for(var u in c.uniforms)m[u]=c.uniforms[u];if(c.textureRefs&&c.textureRefs.length)for(u=0;u<c.textureRefs.length;u++)t=d.bind(null,u),t=this._loader.load(c.textureRefs[u]).then(t),g.push(t)}return g.length===
0?(t=new f.Promise,t.reject("Material definition `"+c+"` does not seem to contain a shader definition."),t):f.all(g).then(function(){var a=new b(p);a.shader=k;a.textures=s;a.materialState=q;a.uniforms=m;if(c){var d=function(a,b){if(b)for(var c in b)a[c]=b[c]};d(a.cullState,c.cullState);d(a.blendState,c.blendState);d(a.depthState,c.depthState);d(a.offsetState,c.offsetState);if(typeof c.renderQueue==="number"&&c.renderQueue>-1)a.renderQueue=c.renderQueue;if(typeof c.wireframe==="boolean")a.wireframe=
c.wireframe}return a})};k.prototype._getDefaultMaterialState=function(){return{ambient:[0.1,0.1,0.1,1],emissive:[0,0,0,0],diffuse:[1,1,1,1],specular:[0.8,0.8,0.8,1],shininess:16}};return k});
define("goo/loaders/SkeletonLoader",["goo/animation/Skeleton","goo/animation/SkeletonPose","goo/animation/Joint","goo/loaders/Loader","goo/loaders/JsonUtils"],function(f,d,c,a,b){function e(a){if(typeof a==="undefined"||a===null)throw Error("SkeletonLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||a.loader===null)throw Error("SkeletonLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}e.prototype.load=function(a){if(this._cache[a])return this._cache[a];
var b=e.prototype._loadSkeleton.bind(this),c=e.prototype._parseSkeleton.bind(this),d=e.prototype._createSkeletonPose.bind(this),b=b(a).then(c).then(d);return this._cache[a]=b};e.prototype._loadSkeleton=function(a){return this._loader.load(a)};e.prototype._parseSkeleton=function(a){typeof a==="string"&&(a=JSON.parse(a));for(var d=a.Name,a=a.Joints,e=[],i=0,h=a.length;i<h;i++){var j=a[i],n=new c(j.Name);n._index=Math.round(j.Index);n._parentIndex=Math.round(j.ParentIndex);j.InverseBindPose.Matrix?n._inverseBindPose.copy(b.parseTransformMatrix(j.InverseBindPose)):
(j.InverseBindPose.Rotation.length===4?n._inverseBindPose.copy(b.parseTransformQuat(j.InverseBindPose)):n._inverseBindPose.copy(b.parseTransform(j.InverseBindPose)),n._inverseBindPose.update());e[i]=n}return new f(d,e)};e.prototype._createSkeletonPose=function(a){a=new d(a);a.setToBindPose();return a};return e});
define("goo/loaders/MeshLoader",["goo/util/rsvp","goo/loaders/JsonUtils","goo/renderer/MeshData","goo/loaders/SkeletonLoader"],function(f,d,c,a){function b(b){if(typeof b==="undefined"||b===null)throw Error("MeshLoader(): Argument `parameters` was undefined/null");if(typeof b.loader==="undefined"||b.loader===null)throw Error("MeshLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=b.loader;this._skeletonLoader=new a({loader:this._loader});this._cache={}}b.prototype.load=
function(a){if(this._cache[a])return this._cache[a];var b=this,c=this._loader.load(a,function(a){return b._parse(a)});return this._cache[a]=c};b.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var b=new f.Promise;try{if(Object.keys(a).length===0)return b.reject("Empty meshdata"),b;if(a.compression)this.useCompression=a.compression.compressed||!1,this.compressedVertsRange=a.compression.compressedVertsRange||16383,this.compressedColorsRange=a.compression.compressedColorsRange||255,
this.compressedUnitVectorRange=a.compression.compressedUnitVectorRange||1023;var d=a.type==="SkinnedMesh"?"SkinnedMesh":"Mesh",k;a.type==="SkinnedMesh"?(k=this._parseMeshData(a.data||a,4,d),k.type=c.SKINMESH):(k=this._parseMeshData(a.data||a,0,d),k.type=c.MESH);a.pose?b=this._skeletonLoader.load(a.pose).then(function(a){k.currentPose=a;return k}):b.resolve(k)}catch(i){b.reject(i)}return b};b.prototype._parseMeshData=function(a,b,f){var k=a.vertexCount;if(k===0)return null;var i=a.indexLengths?a.indexLengths[0]:
a.indices?a.indices.length:0,h={};if(a.vertices)h.POSITION=c.createAttribute(3,"Float");if(a.normals)h.NORMAL=c.createAttribute(3,"Float");if(a.tangents)h.TANGENT=c.createAttribute(4,"Float");if(a.colors)h.COLOR=c.createAttribute(4,"Float");if(b>0&&a.weights)h.WEIGHTS=c.createAttribute(4,"Float");if(b>0&&a.joints)h.JOINTIDS=c.createAttribute(4,"Short");if(a.textureCoords)for(var j in a.textureCoords)h["TEXCOORD"+j]=c.createAttribute(2,"Float");i=new c(h,k,i);if(a.vertices)this.useCompression?(j=a.vertexOffsets,
d.fillAttributeBufferFromCompressedString(a.vertices,i,c.POSITION,[a.vertexScale,a.vertexScale,a.vertexScale],[j.xOffset,j.yOffset,j.zOffset])):d.fillAttributeBuffer(a.vertices,i,c.POSITION);b>0&&a.weights&&(this.useCompression?(h=1/this.compressedVertsRange,d.fillAttributeBufferFromCompressedString(a.weights,i,c.WEIGHTS,[h],[0])):d.fillAttributeBuffer(a.weights,i,c.WEIGHTS));a.normals&&(this.useCompression?(j=1-(this.compressedUnitVectorRange+1>>1),h=1/-j,d.fillAttributeBufferFromCompressedString(a.normals,
i,c.NORMAL,[h,h,h],[j,j,j])):d.fillAttributeBuffer(a.normals,i,c.NORMAL));a.tangents&&(this.useCompression?(j=1-(this.compressedUnitVectorRange+1>>1),h=1/-j,d.fillAttributeBufferFromCompressedString(a.tangents,i,c.TANGENT,[h,h,h,h],[j,j,j,j])):d.fillAttributeBuffer(a.tangents,i,c.TANGENT));a.colors&&(this.useCompression?(j=0,h=255/(this.compressedColorsRange+1),d.fillAttributeBufferFromCompressedString(a.colors,i,c.COLOR,[h,h,h,h],[j,j,j,j])):d.fillAttributeBuffer(a.colors,i,c.COLOR));if(a.textureCoords)if(h=
a.textureCoords,this.useCompression)for(j=0;j<h.length;j++){var n=h[j];d.fillAttributeBufferFromCompressedString(n.UVs,i,"TEXCOORD"+j,n.UVScales,n.UVOffsets)}else for(j=0;j<h.length;j++)d.fillAttributeBuffer(h[j],i,"TEXCOORD"+j);if(b>0&&a.joints)if(h=i.getAttributeBuffer(c.JOINTIDS),n=this.useCompression?d.getIntBufferFromCompressedString(a.joints,32767):d.getIntBuffer(a.joints,32767),f==="SkinnedMesh"){var f=[],o=0;j=0;for(var q=n.length;j<q;j++){var m=n[j];f[m]===void 0&&(f[m]=o++);h.set([f[m]],
j)}j=[];for(m=0;m<f.length;m++)o=f[m],o!==void 0&&(j[o]=m);i.paletteMap=j;i.weightsPerVertex=b}else{j=0;for(q=n.capacity();j<q;j++)h.putCast(j,n.get(j))}a.indices&&(this.useCompression?i.getIndexBuffer().set(d.getIntBufferFromCompressedString(a.indices,k)):i.getIndexBuffer().set(d.getIntBuffer(a.indices,k)));if(a.indexModes)if(b=a.indexModes,b.length===1)i.indexModes[0]=b[0];else{k=[];for(j=0;j<b.length;j++)k[j]=b[j];i.indexModes=k}if(a.indexLengths){b=a.indexLengths;k=[];for(j=0;j<b.length;j++)k[j]=
b[j];i.indexLengths=k}if(a.boundingBox)i.boundingBox=a.boundingBox;return i};return b});
define("goo/loaders/EntityLoader","goo/entities/Entity,goo/renderer/Camera,goo/entities/components/CameraComponent,goo/entities/components/TransformComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/MeshDataComponent,goo/renderer/MeshData,goo/math/Vector3,goo/math/MathUtils,goo/renderer/bounds/BoundingBox,goo/util/rsvp,goo/loaders/MaterialLoader,goo/loaders/MeshLoader,goo/loaders/Loader".split(","),function(f,d,c,a,b,e,g,l,k,i,h,j,n,o){function q(a){if(typeof a==="undefined"||
a===null)throw Error("EntityLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof o)||a.loader===null)throw Error("EntityLoader(): Argument `parameters.loader` was invalid/undefined/null");if(typeof a.world==="undefined"||a.world===null)throw Error("EntityLoader(): Argument `parameters.world` was undefined/null");this._loader=a.loader;this._world=a.world;this._cache={};this._materialLoader=new j({loader:this._loader});this._meshLoader=new n({loader:this._loader})}
q.prototype.load=function(a){if(this._cache[a])return this._cache[a];var b=this._loader.load(a,function(b){return this._parse(b,a)}.bind(this));return this._cache[a]=b};q.prototype._parse=function(a,b){typeof a==="string"&&(a=JSON.parse(a));var c=[],d=[],e=this;if(a.components){var i;(i=a.components.transform)&&d.push(this._getTransformComponent(i));(i=a.components.camera)&&d.push(this._getCameraComponent(i));if(i=a.components.meshRenderer)i=this._getMeshRendererComponent(i).then(function(a){d.push(a);
return a}),c.push(i);if(i=a.components.meshData)i=this._getMeshDataComponent(i).then(function(a){d.push(a);return a}),c.push(i)}return d.length===0&&c.length===0?(i=new h.Promise,i.reject("Entity definition `"+a+"` does not seem to contain any components."),i):h.all(c).then(function(){var c=new f(e._world,a.name);c.ref=b;for(var h in d)d[h].type==="TransformComponent"&&c.clearComponent("transformComponent"),c.setComponent(d[h]);if(c.meshDataComponent&&c.meshDataComponent.meshData.type===g.SKINMESH&&
c.meshRendererComponent&&c.meshRendererComponent.materials.length){var i=c.meshRendererComponent.materials,k;h=0;for(var j=i.length;h<j;h++)if((k=i[h].shader.defines)&&k.JOINT_COUNT!==void 0&&k.WEIGHTS!==void 0)k.JOINT_COUNT=c.meshDataComponent.meshData.paletteMap.length,k.WEIGHTS=c.meshDataComponent.meshData.weightsPerVertex}return c})};q.prototype._getTransformComponent=function(b){var c=new a;c.transform.translation.set(b.translation);c.transform.scale.set(b.scale);c.transform.rotation.fromAngles(k.radFromDeg(b.rotation[0]),
k.radFromDeg(b.rotation[1]),k.radFromDeg(b.rotation[2]));(b=b.parentRef)&&this.load(b).then(function(a){a.transformComponent.attachChild(c);return a});return c};q.prototype._getCameraComponent=function(a){a=new d(a.fov||45,a.aspect||1,a.near||1,a.far||100);return new c(a)};q.prototype._getMeshRendererComponent=function(a){var c=[],d=this._materialLoader,e;for(e in a)if(e==="materialRefs")for(var f in a[e]){var g=d.load(a[e][f]);c.push(g)}return h.all(c).then(function(c){var d=new b,e;for(e in a)d.hasOwnProperty(e)&&
e!=="materials"&&(d[e]=a[e]);for(var f in c)d.materials.push(c[f]);return d})};q.prototype._getMeshDataComponent=function(a){var b=[],c=this._meshLoader,d;for(d in a)if(d==="meshRef"){var f=c.load(a[d]);b.push(f)}return h.all(b).then(function(a){var b=new e(a[0]);if(a[0].boundingBox){var c=a[0].boundingBox.min,d=a[0].boundingBox.max,a=[d[0]-c[0],d[1]-c[1],d[2]-c[2]],c=[(d[0]+c[0])*0.5,(d[1]+c[1])*0.5,(d[2]+c[2])*0.5],d=new i;d.xExtent=a[0];d.yExtent=a[1];d.zExtent=a[2];d.center.seta(c);b.modelBound=
d;b.autoCompute=!1}return b})};return q});define("goo/util/URLTools",[],function(){function f(){}f.getDirectory=function(d){var c=/.*\//.exec(d);return!c?d+"/":c[0]};return f});
define("goo/loaders/JSONImporter","goo/renderer/MeshData,goo/loaders/JsonUtils,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/TextureCreator,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/state/loader/OutputStore,goo/util/URLTools,goo/util/SimpleResourceUtil,goo/renderer/shaders/ShaderLib,goo/renderer/Shader".split(","),function(f,
d,c,a,b,e,g,l,k,i,h,j,n,o,q,m,s,p){function t(a){this.world=a;this.materials={};this.skeletonMap={};this.poseMap={};this.slotUnitMap={diffuse:0,normal:1,ao:2,occlusion:3,specular:3};this.loadedEntities=[];this.baseTextureDir=""}function u(){this.materialName="not set";this.technique=this.profile=null;this.textureReferences={};this.textureFileNames={};this.textureMinificationFilters={};this.textureFlipSettings={};this.usesTransparency=!1;this.materialState={};this.connectedMeshes=[]}t.prototype.load=
function(a,b,c,d){var e=new XMLHttpRequest;if(typeof b==="undefined"||b===null)b=q.getDirectory(a);e.open("GET",a,!0);var f=this;e.onreadystatechange=function(){if(e.readyState===4)if(e.status>=200&&e.status<=299){var a=f.parse(e.responseText,b,d);c.onSuccess(a)}else c.onError(e.statusText)};e.send()};t.prototype.parse=function(a,b,c){this.baseTextureDir=b||"";this.loadedEntities=[];this.shaderExtractor=c;a=JSON.parse(a);if(this.useCompression=a.UseCompression||!1)this.compressedVertsRange=a.CompressedVertsRange||
16383,this.compressedColorsRange=a.CompressedColorsRange||255,this.compressedUnitVectorRange=a.CompressedUnitVectorRange||1023;this._parseMaterials(a.Materials);a.Skeletons&&this.parseSkeletons(a.Skeletons);a.SkeletonPoses&&this.parseSkeletonPoses(a.SkeletonPoses);this._parseSpatial(a.Scene);delete this.shaderExtractor;return this.loadedEntities};t.prototype._parseSpatial=function(b){var e=b.Type,g=b.Name===null?"null":b.Name,h=this.world.createEntity();h.name=g;this.loadedEntities.push(h);if(e===
"Node"){if(b.Children)for(var i in b.Children)e=this._parseSpatial(b.Children[i]),e!==null&&h.transformComponent.attachChild(e.transformComponent)}else if(e==="Mesh"){i=this._parseMeshData(b.MeshData,0,h,e);if(i===null)return null;i.type=f.MESH;h.setComponent(new c(i));e=new a;h.setComponent(e);this._parseMaterial(b,h)}else if(e==="SkinnedMesh"){i=this._parseMeshData(b.MeshData,4,h,e);if(i===null)return null;i.type=f.SKINMESH;h.setComponent(new c(i));e=new a;h.setComponent(e);this._parseMaterial(b,
h);if(b.Pose)i.currentPose=this.poseMap[b.Pose]}else return;b=d.parseTransform(b.Transform);h.transformComponent.transform=b;return h};t.prototype.parseSkeletons=function(a){for(var b=0,c=a.length;b<c;b++){for(var e=a[b],f=e.ref,h=e.Name,e=e.Joints,i=[],k=0,j=e.length;k<j;k++){var m=e[k],n=new g(m.Name);n._index=Math.round(m.Index);n._parentIndex=Math.round(m.ParentIndex);n._inverseBindPose.copy(d.parseTransform(m.InverseBindPose));n._inverseBindPose.update();i[k]=n}h=new l(h,i);this.skeletonMap[f]=
h}};t.prototype.parseSkeletonPoses=function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.ref,d=new k(this.skeletonMap[d.Skeleton]);d.setToBindPose();this.poseMap[e]=d}};t.prototype._parseMeshData=function(a,b,c,e){var g=a.VertexCount;if(g===0)return null;var c=a.IndexLengths?a.IndexLengths[0]:a.Indices?a.Indices.length:0,h={};if(a.Vertices)h.POSITION=f.createAttribute(3,"Float");if(a.Normals)h.NORMAL=f.createAttribute(3,"Float");if(a.Tangents)h.TANGENT=f.createAttribute(4,"Float");if(a.Colors)h.COLOR=
f.createAttribute(4,"Float");if(b>0&&a.Weights)h.WEIGHTS=f.createAttribute(4,"Float");if(b>0&&a.Joints)h.JOINTIDS=f.createAttribute(4,"Short");if(a.TextureCoords)for(var i in a.TextureCoords)h["TEXCOORD"+i]=f.createAttribute(2,"Float");c=new f(h,g,c);if(a.Vertices)this.useCompression?(i=a.VertexOffsets,d.fillAttributeBufferFromCompressedString(a.Vertices,c,f.POSITION,[a.VertexScale,a.VertexScale,a.VertexScale],[i.xOffset,i.yOffset,i.zOffset])):d.fillAttributeBuffer(a.Vertices,c,f.POSITION);a.Weights&&
(this.useCompression?(h=1/this.compressedVertsRange,d.fillAttributeBufferFromCompressedString(a.Weights,c,f.WEIGHTS,[h],[0])):d.fillAttributeBuffer(a.Weights,c,f.WEIGHTS));a.Normals&&(this.useCompression?(i=1-(this.compressedUnitVectorRange+1>>1),h=1/-i,d.fillAttributeBufferFromCompressedString(a.Normals,c,f.NORMAL,[h,h,h],[i,i,i])):d.fillAttributeBuffer(a.Normals,c,f.NORMAL));a.Tangents&&(this.useCompression?(i=1-(this.compressedUnitVectorRange+1>>1),h=1/-i,d.fillAttributeBufferFromCompressedString(a.Tangents,
c,f.TANGENT,[h,h,h,h],[i,i,i,i])):d.fillAttributeBuffer(a.Tangents,c,f.TANGENT));a.Colors&&(this.useCompression?(i=0,h=255/(this.compressedColorsRange+1),d.fillAttributeBufferFromCompressedString(a.Colors,c,f.COLOR,[h,h,h,h],[i,i,i,i])):d.fillAttributeBuffer(a.Colors,c,f.COLOR));if(a.TextureCoords)if(h=a.TextureCoords,this.useCompression)for(i=0;i<h.length;i++){var k=h[i];d.fillAttributeBufferFromCompressedString(k.UVs,c,"TEXCOORD"+i,k.UVScales,k.UVOffsets)}else for(i=0;i<h.length;i++)d.fillAttributeBuffer(h[i],
c,"TEXCOORD"+i);if(a.Joints)if(h=c.getAttributeBuffer(f.JOINTIDS),k=this.useCompression?d.getIntBufferFromCompressedString(a.Joints,32767):d.getIntBuffer(a.Joints,32767),e==="SkinnedMesh"){var e=[],j=0;i=0;for(var l=k.length;i<l;i++){var m=k[i];e[m]===void 0&&(e[m]=j++);h.set([e[m]],i)}i=[];for(m=0;m<e.length;m++)j=e[m],j!==void 0&&(i[j]=m);c.paletteMap=i;c.weightsPerVertex=b}else{i=0;for(l=k.capacity();i<l;i++)h.putCast(i,k.get(i))}a.Indices&&(this.useCompression?c.getIndexBuffer().set(d.getIntBufferFromCompressedString(a.Indices,
g)):c.getIndexBuffer().set(d.getIntBuffer(a.Indices,g)));if(a.IndexModes)if(b=a.IndexModes,b.length===1)c.indexModes[0]=b[0];else{g=[];for(i=0;i<b.length;i++)g[i]=b[i];c.indexModes=g}if(a.IndexLengths){a=a.IndexLengths;b=[];for(i=0;i<a.length;i++)b[i]=a[i];c.indexLengths=b}return c};t.prototype._parseMaterials=function(a){if(a)for(var b=0,c=a.length;b<c;b++){var d=a[b];if(d!==null){var e=new u;e.materialName=d.MaterialName;e.profile=d.Profile;e.technique=d.Technique;e.usesTransparency=d.UsesTransparency;
e.materialState=this._parseMaterialstate(d);if(d.TextureEntries)for(var d=d.TextureEntries,f=0,g=d.length;f<g;f++){var h=d[f],i=h.Slot,k=h.TextureReference||null,j=h.TextureSource||null,l=h.MinificationFilter||null,m="Trilinear";if(l!==null)try{m="minificationFilterStr"}catch(n){console.warn("Bad texture minification filter: "+l)}h=h.Flip!==void 0?h.Flip:!0;e.textureReferences[i]=k;e.textureFileNames[i]=j;e.textureMinificationFilters[i]=m;e.textureFlipSettings[i]=h}this.materials[e.materialName]=
e}}};t.prototype._parseMaterial=function(a,c){if(a.Material){var d=this.materials[a.Material];if(d!==void 0){var f=c.meshRendererComponent,g=c.meshDataComponent.meshData.attributeMap,h=null;if(this.shaderExtractor)if(g=this.shaderExtractor(g,d),g instanceof b)h=g;else if(g instanceof p)h=new b(d.materialName),h.shader=g;else throw Error("The extractor should return a Material or a Shader");else h=b.createMaterial(g.NORMAL&&g.TANGENT&&g.TEXCOORD0&&g.TEXCOORD1&&g.TEXCOORD2&&d.textureFileNames.diffuse&&
d.textureFileNames.normal&&d.textureFileNames.ao?s.texturedNormalAOLit:g.NORMAL&&g.TEXCOORD0&&d.textureFileNames.diffuse?s.texturedLit:g.TEXCOORD0&&d.textureFileNames.diffuse?s.textured:s.simple,d.materialName);f.materials[0]=h;h.materialState=d.materialState;for(var i in this.slotUnitMap)d.textureFileNames[i]!==void 0&&(f=d.textureFileNames[i],f=(new e).loadTexture2D(this.baseTextureDir+f),h.textures[this.slotUnitMap[i]]=f)}}};t.prototype._parseMaterialstate=function(a){var b={};b.ambient=this._parseColor(a.AmbientColor);
b.diffuse=this._parseColor(a.DiffuseColor);b.emissive=this._parseColor(a.EmissiveColor);b.specular=this._parseColor(a.SpecularColor);b.shininess=a.Shininess;return b};t.prototype._parseColor=function(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})*$/i.exec(a))?[parseInt(a[1],16)/255,parseInt(a[2],16)/255,parseInt(a[3],16)/255,a[4]!==void 0?parseInt(a[4],16)/255:1]:null};t.prototype.importAnimationTree=function(a,b,c){return this.importAnimationTreeFromJSON(a,JSON.parse(b),c)};t.prototype.importAnimationTreeFromJSON=
function(a,b,c){var e=new o;if(!b.Clips||!b.Layers){if(c)c.onSuccess(e)}else{for(var f=b.Clips,g=[],h=[],i=0,k=f.length;i<k;i++){var j=f[i];g.push(j.Name);h.push(j.URL)}m.loadTextAssets(h,g,{onSuccess:function(f){for(var h={},i=0,k=g.length;i<k;i++){var j=(new t).importAnimation(f[g[i]],g[i]);h[j._name]=j}d.parseAnimationLayers(a,c,h,e,b)},onError:function(a){console.warn("failed loading tree clips: "+a);if(c)c.onError(a)}})}};t.prototype.importAnimation=function(a,b){var c=new i(b),e=JSON.parse(a);
if(this.useCompression=e.UseCompression||!1)this.compressedAnimRange=e.CompressedRange||32767;if(e.Channels)for(var e=e.Channels,f=0,g=e.length;f<g;f++){var k=e[f],l=k.Type,m=k.Name,o=d.parseChannelTimes(k,this.useCompression);if("Joint"===l)var m=k.JointName,q=k.JointIndex,l=d.parseRotationSamples(k,this.compressedAnimRange,this.useCompression),p=d.parseTranslationSamples(k,o.length,this.useCompression),k=d.parseScaleSamples(k,o.length,this.useCompression),o=new h(m,q,o,l,p,k);else if("Transform"===
l)l=d.parseRotationSamples(k,this.compressedAnimRange,this.useCompression),p=d.parseTranslationSamples(k,o.length,this.useCompression),k=d.parseScaleSamples(k,o.length,this.useCompression),o=new j(m,o,l,p,k);else if("FloatLERP"===l)o=new n(m,o,d.parseFloatLERPValues(k,this.useCompression));else{console.warn("Unhandled channel type: "+l);continue}c.addChannel(o)}return c};return t});
define("goo/loaders/SceneLoader",["goo/loaders/Loader","goo/loaders/EntityLoader","goo/util/rsvp"],function(f,d,c){function a(a){if(typeof a==="undefined"||a===null)throw Error("SceneLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof f)||a.loader===null)throw Error("SceneLoader(): Argument `parameters.loader` was invalid/undefined/null");if(typeof a.world==="undefined"||a.world===null)throw Error("SceneLoader(): Argument `parameters.world` was undefined/null");
this._loader=a.loader;this._world=a.world}a.prototype.load=function(a){var c=this;return this._loader.load(a,function(d){return c._parse(d,a)})};a.prototype._parse=function(a,e){typeof a==="string"&&(a=JSON.parse(a));var f=[];if(a&&a.entityRefs&&a.entityRefs.length){var l=new d({world:this._world,loader:this._loader}),k;for(k in a.entityRefs){var i=l.load(a.entityRefs[k]);f.push(i)}}if(f.length===0)return i=new c.Promise,i.reject("Can't find anything to load at "+e),i;this.globals=a.globals;return c.all(f).then(function(a){return a})};
a.prototype._buildWorld=function(a){for(var c in a)a[c].addToWorld();this._world.process();return this._world};return a});
define("goo/loaders/ScriptLoader",["goo/util/rsvp","goo/loaders/Loader"],function(f,d){function c(a){if(typeof a==="undefined"||a===null)throw Error("ScriptLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof d)||a.loader===null)throw Error("ScriptLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}c.prototype.load=function(a,b){if(this._cache[a])return this._cache[a].then(function(a){return new a(b)});
var c=this._parse.bind(this),d=this._loader.load(a,function(a){return c(a)});this._cache[a]=d;return d.then(function(a){return new a(b)})};c.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));return this._loadScript(a.jsRef)};c.prototype._loadScript=function(a){var b=new f.Promise;require([this._loader.rootPath+a],function(a){b.resolve(a)});return b};return c});
define("goo/math/Matrix2x2",["goo/math/MathUtils","goo/math/Matrix"],function(f,d){function c(){d.call(this,2,2);arguments.length===0?this.setIdentity():this.set(arguments)}c.prototype=Object.create(d.prototype);c.prototype.setupAliases([["e00"],["e10"],["e01"],["e11"]]);c.IDENTITY=new c(1,0,0,1);c.add=function(a,b,d){d||(d=new c);b instanceof c?(d.e00=a.e00+b.e00,d.e10=a.e10+b.e10,d.e01=a.e01+b.e01,d.e11=a.e11+b.e11):(d.e00=a.e00+b,d.e10=a.e10+b,d.e01=a.e01+b,d.e11=a.e11+b);return d};c.prototype.add=
function(a){return c.add(this,a,this)};c.sub=function(a,b,d){d||(d=new c);b instanceof c?(d.e00=a.e00-b.e00,d.e10=a.e10-b.e10,d.e01=a.e01-b.e01,d.e11=a.e11-b.e11):(d.e00=a.e00-b,d.e10=a.e10-b,d.e01=a.e01-b,d.e11=a.e11-b);return d};c.prototype.sub=function(a){return c.sub(this,a,this)};c.mul=function(a,b,d){d||(d=new c);b instanceof c?(d.e00=a.e00*b.e00,d.e10=a.e10*b.e10,d.e01=a.e01*b.e01,d.e11=a.e11*b.e11):(d.e00=a.e00*b,d.e10=a.e10*b,d.e01=a.e01*b,d.e11=a.e11*b);return d};c.prototype.mul=function(a){return c.mul(this,
a,this)};c.div=function(a,b,d){d||(d=new c);b instanceof c?(d.e00=a.e00/b.e00,d.e10=a.e10/b.e10,d.e01=a.e01/b.e01,d.e11=a.e11/b.e11):(b=1/b,d.e00=a.e00*b,d.e10=a.e10*b,d.e01=a.e01*b,d.e11=a.e11*b);return d};c.prototype.div=function(a){return c.div(this,a,this)};c.combine=function(a,b,e){e||(e=new c);if(e===a||e===b)return d.copy(c.combine(a,b),e);e.e00=a.e00*b.e00+a.e01*b.e10;e.e10=a.e10*b.e00+a.e11*b.e10;e.e01=a.e00*b.e01+a.e01*b.e11;e.e11=a.e10*b.e01+a.e11*b.e11;return e};c.prototype.combine=function(a){return c.combine(this,
a,this)};c.transpose=function(a,b){b||(b=new c);if(b===a)return d.copy(c.transpose(a),b);b.e00=a.e00;b.e10=a.e01;b.e01=a.e10;b.e11=a.e11;return b};c.prototype.transpose=function(){return c.transpose(this,this)};c.invert=function(a,b){b||(b=new c);if(b===a)return d.copy(c.invert(a),b);var e=a.determinant();if(Math.abs(e)<f.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};e=1/e;b.e00=a.e11*e;b.e10=0-a.e10*e;b.e01=0-a.e01*e;b.e11=a.e00*e;return b};c.prototype.invert=
function(){return c.invert(this,this)};c.prototype.isOrthogonal=function(){return Math.abs(this.e00*this.e01+this.e10*this.e11)>f.EPSILON?!1:!0};c.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10;if(Math.abs(a-1)>f.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11;return Math.abs(a-1)>f.EPSILON?!1:!0};c.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};c.prototype.determinant=function(){return this.e00*this.e11-this.e01*this.e10};c.prototype.setIdentity=
function(){this.set(c.IDENTITY)};return c});
define("goo/math/Versor",["goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Vector"],function(f,d,c){function a(){c.call(this,4);this.set(arguments.length!==0?arguments:[0,0,0,1])}a.prototype=Object.create(c.prototype);a.prototype.setupAliases([["x"],["y"],["z"],["w"]]);a.IDENTITY=new a(0,0,0,1);a.combine=function(b,d,f){f||(f=new a);if(f===b||f===d)return c.copy(a.combine(b,d),f);f.data[0]=b.data[3]*d.data[0]+d.data[3]*b.data[0]+d.data[2]*b.data[1]-d.data[1]*b.data[2];f.data[1]=b.data[3]*d.data[1]+
d.data[3]*b.data[1]+d.data[0]*b.data[2]-d.data[2]*b.data[0];f.data[2]=b.data[3]*d.data[2]+d.data[3]*b.data[2]+d.data[1]*b.data[0]-d.data[0]*b.data[1];f.data[3]=b.data[3]*d.data[3]-(b.data[0]*d.data[0]+b.data[1]*d.data[1]+b.data[2]*d.data[2]);return f};a.prototype.combine=function(b){return a.combine(this,b,this)};a.invert=function(b,c){c||(c=new a);c.data[0]=0-b.data[0];c.data[1]=0-b.data[1];c.data[2]=0-b.data[2];c.data[3]=b.data[3];return c};a.prototype.invert=function(){return a.invert(this,this)};
a.fromAngleAxis=function(b,c,d){var f=Math.sin(b*0.5),b=Math.cos(b*0.5);d||(d=new a);c.normalize();d.data[0]=c.data[0]*f;d.data[1]=c.data[1]*f;d.data[2]=c.data[2]*f;d.data[3]=b;return d};a.prototype.fromAngleAxis=function(b,c){return a.fromAngleAxis(b,c,this)};a.fromAngleNormalAxis=function(b,c,d){var f=Math.sin(b*0.5),b=Math.cos(b*0.5);d||(d=new a);d.data[0]=c.data[0]*f;d.data[1]=c.data[1]*f;d.data[2]=c.data[2]*f;d.data[3]=b;return d};a.prototype.fromAngleNormalAxis=function(b,c){return a.fromAngleNormalAxis(b,
c,this)};a.toMatrix3x3=function(a,c){c||(c=new f);var d=2*a.data[0]*a.data[0],l=2*a.data[1]*a.data[1],k=2*a.data[2]*a.data[2],i=2*a.data[0]*a.data[1],h=2*a.data[0]*a.data[2],j=2*a.data[1]*a.data[2],n=2*a.data[0]*a.data[3],o=2*a.data[1]*a.data[3],q=2*a.data[2]*a.data[3];c.e00=1-(l+k);c.e10=i+q;c.e20=h-o;c.e01=i-q;c.e11=1-(d+k);c.e21=j+n;c.e02=h+o;c.e12=j-n;c.e22=1-(d+l);return c};a.prototype.toMatrix3x3=function(b){return a.toMatrix3x3(this,b)};a.toMatrix4x4=function(a,c){c||(c=new d);var f=2*a.data[0]*
a.data[0],l=2*a.data[1]*a.data[1],k=2*a.data[2]*a.data[2],i=2*a.data[0]*a.data[1],h=2*a.data[0]*a.data[2],j=2*a.data[1]*a.data[2],n=2*a.data[0]*a.data[3],o=2*a.data[1]*a.data[3],q=2*a.data[2]*a.data[3];c.e00=1-(l+k);c.e10=i+q;c.e20=h-o;c.e30=0;c.e01=i-q;c.e11=1-(f+k);c.e21=j+n;c.e31=0;c.e02=h+o;c.e12=j-n;c.e22=1-(f+l);c.e32=0;c.e03=0;c.e13=0;c.e23=0;c.e33=1;return c};a.prototype.toMatrix4x4=function(b){return a.toMatrix4x4(this,b)};return a});
define("goo/math/Transformation",["goo/math/Matrix4x4","goo/math/Vector","goo/math/Vector3","goo/math/Versor"],function(f,d,c,a){function b(b,d,l){this.translation=b||new c(0,0,0);this.rotation=d||new a(1,0,0,0);this.scale=l||new c(1,1,1);this.parentFromChild=new f;this.childFromParent=new f;this.doUpdate=!0}b.prototype.parentFromChildNormal=function(a,b){this.doUpdate&&this.update();b||(b=new c);if(b===a)return d.copy(this.parentFromChildNormal(a),b);b.x=this.childFromParent.e00*a.x+this.childFromParent.e10*
a.y+this.childFromParent.e20*a.z;b.y=this.childFromParent.e01*a.x+this.childFromParent.e11*a.y+this.childFromParent.e21*a.z;b.z=this.childFromParent.e02*a.x+this.childFromParent.e12*a.y+this.childFromParent.e22*a.z;return b};b.prototype.childFromParentNormal=function(a,b){this.doUpdate&&this.update();b||(b=new c);if(b===a)return d.copy(this.childFromParentNormal(a),b);b.x=this.parentFromChild.e00*a.x+this.parentFromChild.e10*a.y+this.parentFromChild.e20*a.z;b.y=this.parentFromChild.e01*a.x+this.parentFromChild.e11*
a.y+this.parentFromChild.e21*a.z;b.z=this.parentFromChild.e02*a.x+this.parentFromChild.e12*a.y+this.parentFromChild.e22*a.z;return b};b.prototype.parentFromChildVector=function(a,b){this.doUpdate&&this.update();b||(b=new c);if(b===a)return d.copy(this.parentFromChildVector(a),b);b.x=this.parentFromChild.e00*a.x+this.parentFromChild.e01*a.y+this.parentFromChild.e02*a.z;b.y=this.parentFromChild.e10*a.x+this.parentFromChild.e11*a.y+this.parentFromChild.e12*a.z;b.z=this.parentFromChild.e20*a.x+this.parentFromChild.e21*
a.y+this.parentFromChild.e22*a.z;return b};b.prototype.childFromParentVector=function(a,b){this.doUpdate&&this.update();b||(b=new c);if(b===a)return d.copy(this.childFromParentVector(a),b);b.x=this.childFromParent.e00*a.x+this.childFromParent.e01*a.y+this.childFromParent.e02*a.z;b.y=this.childFromParent.e10*a.x+this.childFromParent.e11*a.y+this.childFromParent.e12*a.z;b.z=this.childFromParent.e20*a.x+this.childFromParent.e21*a.y+this.childFromParent.e22*a.z;return b};b.prototype.parentFromChildVertex=
function(a,b){this.doUpdate&&this.update();b||(b=new c);if(b===a)return d.copy(this.parentFromChildVertex(a),b);b.x=this.parentFromChild.e00*a.x+this.parentFromChild.e01*a.y+this.parentFromChild.e02*a.z+this.parentFromChild.e03;b.y=this.parentFromChild.e10*a.x+this.parentFromChild.e11*a.y+this.parentFromChild.e12*a.z+this.parentFromChild.e13;b.z=this.parentFromChild.e20*a.x+this.parentFromChild.e21*a.y+this.parentFromChild.e22*a.z+this.parentFromChild.e23;return b};b.prototype.childFromParentVertex=
function(a,b){this.doUpdate&&this.update();b||(b=new c);if(b===a)return d.copy(this.childFromParentVertex(a),b);b.x=this.childFromParent.e00*a.x+this.childFromParent.e01*a.y+this.childFromParent.e02*a.z+this.childFromParent.e03;b.y=this.childFromParent.e10*a.x+this.childFromParent.e11*a.y+this.childFromParent.e12*a.z+this.childFromParent.e13;b.z=this.childFromParent.e20*a.x+this.childFromParent.e21*a.y+this.childFromParent.e22*a.z+this.childFromParent.e23;return b};b.prototype.update=function(){if(this.doUpdate){var a=
this.rotation.toMatrix3x3();this.parentFromChild.e00=a.e00*this.scale.x;this.parentFromChild.e10=a.e10*this.scale.x;this.parentFromChild.e20=a.e20*this.scale.x;this.parentFromChild.e30=0;this.parentFromChild.e01=a.e01*this.scale.y;this.parentFromChild.e11=a.e11*this.scale.y;this.parentFromChild.e21=a.e21*this.scale.y;this.parentFromChild.e31=0;this.parentFromChild.e02=a.e02*this.scale.z;this.parentFromChild.e12=a.e12*this.scale.z;this.parentFromChild.e22=a.e22*this.scale.z;this.parentFromChild.e32=
0;this.parentFromChild.e03=this.translation.x;this.parentFromChild.e13=this.translation.y;this.parentFromChild.e23=this.translation.z;this.parentFromChild.e33=1;this.childFromParent.e00=a.e00/this.scale.x;this.childFromParent.e10=a.e01/this.scale.y;this.childFromParent.e20=a.e02/this.scale.z;this.childFromParent.e30=0;this.childFromParent.e01=a.e10/this.scale.x;this.childFromParent.e11=a.e11/this.scale.y;this.childFromParent.e21=a.e12/this.scale.z;this.childFromParent.e31=0;this.childFromParent.e02=
a.e20/this.scale.x;this.childFromParent.e12=a.e21/this.scale.y;this.childFromParent.e22=a.e22/this.scale.z;this.childFromParent.e32=0;this.childFromParent.e03=0-(a.e00*this.translation.x+a.e10*this.translation.y+a.e20*this.translation.z)/this.scale.x;this.childFromParent.e13=0-(a.e01*this.translation.x+a.e11*this.translation.y+a.e21*this.translation.z)/this.scale.y;this.childFromParent.e23=0-(a.e02*this.translation.x+a.e12*this.translation.y+a.e22*this.translation.z)/this.scale.z;this.childFromParent.e33=
1;this.doUpdate=!1;return this}};return b});
define("goo/noise/Noise",["goo/math/MathUtils"],function(f){function d(){}d.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,
82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5];d.split=
function(c){var a=Math.floor(c),c=f.scurve5(c-a);return{i0:a+0,i1:a+1,f0:1-c,f1:0+c}};d.fractal1d=function(c,a,b,d,f,l){for(var k=0,i=1,h=0,j=0;j<b;j++)k+=i*l.evaluate1d(c,a),h+=i,i*=d,c*=f;return k/h};d.fractal2d=function(c,a,b,d,f,l,k){for(var i=0,h=1,j=0,n=0;n<d;n++)i+=h*k.evaluate2d(c,a,b),j+=h,h*=f,c*=l,a*=l;return i/j};d.fractal3d=function(c,a,b,d,f,l,k,i){for(var h=0,j=1,n=0,o=0;o<f;o++)h+=j*i.evaluate3d(c,a,b,d),n+=j,j*=l,c*=k,a*=k,b*=k;return h/n};d.fractal4d=function(c,a,b,d,f,l,k,i,h){for(var j=
0,n=1,o=0,q=0;q<l;q++)j+=n*h.evaluate4d(c,a,b,d,f),o+=n,n*=k,c*=i,a*=i,b*=i,d*=i;return j/o};return d});
define("goo/noise/ValueNoise",["goo/noise/Noise"],function(f){function d(){f.call(this)}d.prototype=Object.create(f.prototype);d.sources=[0,1/15,2/15,0.2,4/15,5/15,0.4,7/15,8/15,0.6,10/15,11/15,0.8,13/15,14/15,1];d.evaluate1d=function(c,a){var b=f.split(c/a),e=f.shifter[b.i1&255]&15,g=0;g+=b.f0*d.sources[f.shifter[b.i0&255]&15];g+=b.f1*d.sources[e];return g};d.evaluate2d=function(c,a,b){var c=f.split(c/b),a=f.split(a/b),b=f.shifter[f.shifter[a.i0&255]+c.i1&255]&15,e=f.shifter[f.shifter[a.i1&255]+
c.i0&255]&15,g=f.shifter[f.shifter[a.i1&255]+c.i1&255]&15,l=0;l+=a.f0*c.f0*d.sources[f.shifter[f.shifter[a.i0&255]+c.i0&255]&15];l+=a.f0*c.f1*d.sources[b];l+=a.f1*c.f0*d.sources[e];l+=a.f1*c.f1*d.sources[g];return l};d.evaluate3d=function(c,a,b,e){var c=f.split(c/e),a=f.split(a/e),b=f.split(b/e),e=f.shifter[f.shifter[f.shifter[b.i0&255]+a.i0&255]+c.i1&255]&15,g=f.shifter[f.shifter[f.shifter[b.i0&255]+a.i1&255]+c.i0&255]&15,l=f.shifter[f.shifter[f.shifter[b.i0&255]+a.i1&255]+c.i1&255]&15,k=f.shifter[f.shifter[f.shifter[b.i1&
255]+a.i0&255]+c.i0&255]&15,i=f.shifter[f.shifter[f.shifter[b.i1&255]+a.i0&255]+c.i1&255]&15,h=f.shifter[f.shifter[f.shifter[b.i1&255]+a.i1&255]+c.i0&255]&15,j=f.shifter[f.shifter[f.shifter[b.i1&255]+a.i1&255]+c.i1&255]&15,n=0;n+=b.f0*a.f0*c.f0*d.sources[f.shifter[f.shifter[f.shifter[b.i0&255]+a.i0&255]+c.i0&255]&15];n+=b.f0*a.f0*c.f1*d.sources[e];n+=b.f0*a.f1*c.f0*d.sources[g];n+=b.f0*a.f1*c.f1*d.sources[l];n+=b.f1*a.f0*c.f0*d.sources[k];n+=b.f1*a.f0*c.f1*d.sources[i];n+=b.f1*a.f1*c.f0*d.sources[h];
n+=b.f1*a.f1*c.f1*d.sources[j];return n};d.evaluate4d=function(c,a,b,e,g){var c=f.split(c/g),a=f.split(a/g),b=f.split(b/g),e=f.split(e/g),g=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+b.i0&255]+a.i0&255]+c.i1&255]&15,l=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+b.i0&255]+a.i1&255]+c.i0&255]&15,k=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+b.i0&255]+a.i1&255]+c.i1&255]&15,i=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+b.i1&255]+a.i0&255]+c.i0&255]&15,h=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&
255]+b.i1&255]+a.i0&255]+c.i1&255]&15,j=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+b.i1&255]+a.i1&255]+c.i0&255]&15,n=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+b.i1&255]+a.i1&255]+c.i1&255]&15,o=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+b.i0&255]+a.i0&255]+c.i0&255]&15,q=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+b.i0&255]+a.i0&255]+c.i1&255]&15,m=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+b.i0&255]+a.i1&255]+c.i0&255]&15,s=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&
255]+b.i0&255]+a.i1&255]+c.i1&255]&15,p=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+b.i1&255]+a.i0&255]+c.i0&255]&15,t=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+b.i1&255]+a.i0&255]+c.i1&255]&15,u=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+b.i1&255]+a.i1&255]+c.i0&255]&15,w=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+b.i1&255]+a.i1&255]+c.i1&255]&15,r=0;r+=e.f0*b.f0*a.f0*c.f0*d.sources[f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+b.i0&255]+a.i0&255]+c.i0&255]&15];r+=
e.f0*b.f0*a.f0*c.f1*d.sources[g];r+=e.f0*b.f0*a.f1*c.f0*d.sources[l];r+=e.f0*b.f0*a.f1*c.f1*d.sources[k];r+=e.f0*b.f1*a.f0*c.f0*d.sources[i];r+=e.f0*b.f1*a.f0*c.f1*d.sources[h];r+=e.f0*b.f1*a.f1*c.f0*d.sources[j];r+=e.f0*b.f1*a.f1*c.f1*d.sources[n];r+=e.f1*b.f0*a.f0*c.f0*d.sources[o];r+=e.f1*b.f0*a.f0*c.f1*d.sources[q];r+=e.f1*b.f0*a.f1*c.f0*d.sources[m];r+=e.f1*b.f0*a.f1*c.f1*d.sources[s];r+=e.f1*b.f1*a.f0*c.f0*d.sources[p];r+=e.f1*b.f1*a.f0*c.f1*d.sources[t];r+=e.f1*b.f1*a.f1*c.f0*d.sources[u];
r+=e.f1*b.f1*a.f1*c.f1*d.sources[w];return r};return d});define("goo/particles/ParticleInfluence",[],function(){return function(f){f=f||{};this.prepare=f.prepare?f.prepare:function(){};this.apply=f.apply?f.apply:function(){};this.enabled=f.enabled!==void 0?f.enabled===!0:!0}});
define("goo/picking/BoundingTree",["goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/math/Vector3"],function(f,d,c){function a(b){this.worldBound=this.localBound=this.rightTree=this.leftTree=null;this.boundType=b?b:a.BOUNDTYPE_BOX}a.BOUNDTYPE_SPHERE="sphere";a.BOUNDTYPE_BOX="box";a.MAX_PRIMITIVES_PER_LEAF=16;a.prototype.construct=function(a){if(!a.meshRendererComponent||!a.meshDataComponent||!a.transformComponent)console.warn("Entity missing required components for boundingtree construction: ",
a);else{var c=a.meshDataComponent.meshData;c.updatePrimitiveCounts();if(c.getSectionCount()===1){this.primitiveIndices=[];for(var d=0,c=c.getPrimitiveCount(0);d<c;d++)this.primitiveIndices.push(d);this.createTree(a,0,0,this.primitiveIndices.length)}else this.split(a,0,c.getSectionCount())}};a.prototype.createTree=function(b,c,d,f){var k=b.meshDataComponent.meshData;this.section=c;this.start=d;this.end=f;if(this.primitiveIndices&&(this.createBounds(),this.localBound.computeFromPrimitives(k,c,this.primitiveIndices,
d,f),!(f-d+1<=a.MAX_PRIMITIVES_PER_LEAF))){if(!this.leftTree)this.leftTree=new a(this.boundType);this.leftTree.primitiveIndices=this.primitiveIndices;this.leftTree.createTree(b,c,d,(d+f)/2);if(!this.rightTree)this.rightTree=new a(this.boundType);this.rightTree.primitiveIndices=this.primitiveIndices;this.rightTree.createTree(b,c,(d+f)/2,f)}};a.prototype.createBounds=function(){switch(this.boundType){case a.BOUNDTYPE_BOX:this.localBound=new f;this.worldBound=new f;break;case a.BOUNDTYPE_SPHERE:this.localBound=
new d,this.worldBound=new d}};a.prototype.findPick=function(a,d,f){f||(f={});var l=d.transformComponent.worldTransform;this.localBound.transform(l,this.worldBound);if(!this.worldBound.intersectsRay(a))return f;this.leftTree&&this.leftTree.findPick(a,d,f);if(this.rightTree)this.rightTree.findPick(a,d,f);else if(!this.leftTree)for(var d=d.meshDataComponent.meshData,k=null,i=this.start;i<this.end;i++){for(var k=d.getPrimitiveVertices(this.primitiveIndices[i],this.section,k),h=0;h<k.length;h++)l.matrix.applyPostPoint(k[h]);
h=new c;if(a.intersects(k,!1,h))f.distances=f.distances||[],f.distances.push(a.origin.distance(h)),f.points=f.points||[],f.points.push(h)}return f};return a});
define("goo/picking/PrimitivePickLogic",["goo/picking/BoundingTree"],function(f){function d(){}d.prototype.getPickResult=function(c,a){var b=a.meshDataComponent.meshData.__boundingTree;return!b?null:b.findPick(c,a,{})};d.prototype.added=function(c){c.meshDataComponent.meshData.__boundingTree=new f;c.meshDataComponent.meshData.__boundingTree.construct(c)};d.prototype.removed=function(c){c.meshDataComponent.meshData.__boundingTree=null};return d});
define("goo/renderer/light/Light",["goo/math/Vector3","goo/math/Vector4"],function(f,d){return function(){this.translation=new f;this.color=new d(1,1,1,1);this.intensity=1;this.shadowCaster=!1;this.shadowSettings={type:"Blur",projection:"Perspective",fov:55,size:100,near:1,far:1E3}}});define("goo/renderer/light/DirectionalLight",["goo/math/Vector3","goo/renderer/light/Light"],function(f,d){function c(){d.call(this);this.direction=new f}c.prototype=Object.create(d.prototype);return c});
define("goo/renderer/light/PointLight",["goo/math/Vector3","goo/renderer/light/Light"],function(f,d){function c(){d.call(this);this.direction=new f;this.range=100}c.prototype=Object.create(d.prototype);return c});define("goo/renderer/light/SpotLight",["goo/math/Vector3","goo/renderer/light/Light"],function(f,d){function c(){d.call(this);this.direction=new f;this.spotAngle=45}c.prototype=Object.create(d.prototype);return c});
define("goo/renderer/pass/BlurPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(f,d,c,a,b){function e(g){g=g||{};this.target=g.target!==void 0?g.target:null;var l=g.strength!==void 0?g.strength:1,k=g.kernelSize!==void 0?g.kernelSize:25,i=g.sigma!==void 0?g.sigma:4,h=g.sizeX!==void 0?g.sizeX:256,g=g.sizeY!==void 0?g.sizeY:256;this.renderTargetX=new c(h,g);this.renderTargetY=new c(h,g);this.renderable=
{meshData:d.quad,materials:[]};this.copyShader=a.clone(b.copyPure);this.copyShader.uniforms.opacity=l;this.copyMaterial=f.createMaterial(this.copyShader);this.convolutionShader=a.clone(b.convolution);this.convolutionShader.defines={KERNEL_SIZE_FLOAT:k.toFixed(1),KERNEL_SIZE_INT:k.toFixed(0)};this.convolutionShader.uniforms.uImageIncrement=e.blurX;this.convolutionShader.uniforms.cKernel=this.convolutionShader.buildKernel(i);this.convolutionMaterial=f.createMaterial(this.convolutionShader);this.enabled=
!0;this.needsSwap=this.clear=!1}e.prototype.render=function(a,b,c){this.renderable.materials[0]=this.convolutionMaterial;this.convolutionMaterial.textures[0]=c;this.convolutionShader.uniforms.uImageIncrement=e.blurX;a.render(this.renderable,d.camera,[],this.renderTargetX,!0);this.convolutionMaterial.textures[0]=this.renderTargetX;this.convolutionShader.uniforms.uImageIncrement=e.blurY;a.render(this.renderable,d.camera,[],this.renderTargetY,!0);this.renderable.materials[0]=this.copyMaterial;this.copyMaterial.textures[0]=
this.renderTargetY;this.target!==null?a.render(this.renderable,d.camera,[],this.target,this.clear):a.render(this.renderable,d.camera,[],c,this.clear)};e.blurX=[0.001953125,0];e.blurY=[0,0.001953125];return e});define("goo/renderer/pass/BloomPass",["goo/renderer/pass/BlurPass"],function(f){function d(c){f.call(this,c);this.copyMaterial.blendState.blending="AdditiveBlending"}d.prototype=Object.create(f.prototype);return d});
define("goo/renderer/pass/Composer",["goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/renderer/shaders/ShaderLib"],function(f,d,c){function a(a){this.renderTarget1=a;if(this.renderTarget1===void 0)this.renderTarget1=new f(window.innerWidth||1,window.innerHeight||1);this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=new d(c.copy)}a.prototype.swapBuffers=function(){var a=this.readBuffer;
this.readBuffer=this.writeBuffer;this.writeBuffer=a};a.prototype.addPass=function(a){this.passes.push(a)};a.prototype.render=function(a,c){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var d,f,k=this.passes.length;for(f=0;f<k;f++)d=this.passes[f],d.enabled&&(d.render(a,this.writeBuffer,this.readBuffer,c,!1),d.needsSwap&&this.swapBuffers())};return a});
define("goo/renderer/pass/RenderPass",["goo/renderer/Renderer","goo/math/Vector4"],function(f,d){function c(a){this.renderList=a;this.clearColor=new d(0,0,0,0);this.oldClearColor=new d;this.renderToScreen=!1;this.overrideMaterial=null;this.clear=this.enabled=!0;this.needsSwap=!1}c.prototype.render=function(a,b,c){this.clearColor&&(this.oldClearColor.setv(a.clearColor),a.setClearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a));a.overrideMaterial=this.overrideMaterial;
this.renderToScreen?a.render(this.renderList,f.mainCamera,[]):a.render(this.renderList,f.mainCamera,[],c,this.clear);a.overrideMaterial=null;this.clearColor&&a.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)};return c});
define("goo/renderer/pass/DepthPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass".split(","),function(f,d,c,a,b,e,g,l){function k(a,b){this.depthPass=new e(a);this.depthPass.overrideMaterial=f.createMaterial(i);this.blurTarget=new d(256,256);this.blurPass=new l({target:this.blurTarget});this.outPass=new g(b||h);this.outPass.useReadBuffer=
!1;this.depthTarget=new d(window.innerWidth||1,window.innerHeight||1);this.enabled=!0;this.clear=!1;this.needsSwap=!0}k.prototype.render=function(a,b,c,d){this.depthPass.render(a,null,this.depthTarget,d);this.blurPass.render(a,b,c,d);this.outPass.material.textures[0]=this.depthTarget;this.outPass.material.textures[1]=c;this.outPass.material.textures[2]=this.blurTarget;this.outPass.render(a,b,c,d)};var i={attributes:{vertexPosition:c.POSITION},uniforms:{viewMatrix:a.VIEW_MATRIX,projectionMatrix:a.PROJECTION_MATRIX,
worldMatrix:a.WORLD_MATRIX,farPlane:a.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",fshader:["precision mediump float;\nuniform float farPlane;",b.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(length(vPosition), farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")},
h={attributes:{vertexPosition:c.POSITION,vertexUV0:c.TEXCOORD0},uniforms:{viewMatrix:a.VIEW_MATRIX,projectionMatrix:a.PROJECTION_MATRIX,worldMatrix:a.WORLD_MATRIX,depthMap:a.TEXTURE0,diffuseMap:a.TEXTURE1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:["precision mediump float;\nuniform sampler2D depthMap;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;",b.methods.unpackDepth,"void main(void)\n{\n\tvec4 depthCol = texture2D(depthMap, texCoord0);\n\tvec4 diffuseCol = texture2D(diffuseMap, texCoord0);\n\tfloat depth = unpackDepth(depthCol);\n\tgl_FragColor = diffuseCol * vec4(depth);\n}"].join("\n")};return k});
define("goo/renderer/pass/DoGPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(f,d,c,a,b){function e(e){e=e||{};this.target=e.target!==void 0?e.target:null;var l=e.width!==void 0?e.width:512,k=e.height!==void 0?e.height:512,i=e.sigma!==void 0?e.sigma:0.6,e=e.threshold!==void 0?e.threshold:0.005;i>2.5&&(i=2.5);this.renderTargetX=new c(l,k);this.gaussian1=new c(l,k);this.gaussian2=new c(l,
k);this.renderable={meshData:d.quad,materials:[]};this.convolutionShader1=a.clone(b.convolution);this.convolutionShader2=a.clone(b.convolution);this.differenceShader=a.clone(b.differenceOfGaussians);this.differenceShader.uniforms.threshold=e;this.differenceMaterial=f.createMaterial(this.differenceShader);var e=this.convolutionShader1.buildKernel(i),i=this.convolutionShader2.buildKernel(1.6*i),h=e.length;this.convolutionShader1.defines={KERNEL_SIZE_FLOAT:h.toFixed(1),KERNEL_SIZE_INT:h.toFixed(0)};
h=i.length;this.convolutionShader2.defines={KERNEL_SIZE_FLOAT:h.toFixed(1),KERNEL_SIZE_INT:h.toFixed(0)};this.convolutionShader1.uniforms.cKernel=e;this.convolutionShader2.uniforms.cKernel=i;this.blurX=[0.5/l,0];this.blurY=[0,0.5/k];this.convolutionMaterial1=f.createMaterial(this.convolutionShader1);this.convolutionMaterial2=f.createMaterial(this.convolutionShader2);this.enabled=!0;this.needsSwap=this.clear=!1}e.prototype.render=function(a,b,c){this.renderable.materials[0]=this.convolutionMaterial1;
this.convolutionMaterial1.textures[0]=c;this.convolutionShader1.uniforms.uImageIncrement=this.blurX;a.render(this.renderable,d.camera,[],this.renderTargetX,!0);this.convolutionMaterial1.textures[0]=this.renderTargetX;this.convolutionShader1.uniforms.uImageIncrement=this.blurY;a.render(this.renderable,d.camera,[],this.gaussian1,!0);this.renderable.materials[0]=this.convolutionMaterial2;this.convolutionMaterial2.textures[0]=c;this.convolutionShader2.uniforms.uImageIncrement=this.blurX;a.render(this.renderable,
d.camera,[],this.renderTargetX,!0);this.convolutionMaterial2.textures[0]=this.renderTargetX;this.convolutionShader2.uniforms.uImageIncrement=this.blurY;a.render(this.renderable,d.camera,[],this.gaussian2,!0);this.renderable.materials[0]=this.differenceMaterial;this.differenceMaterial.textures[0]=this.gaussian1;this.differenceMaterial.textures[1]=this.gaussian2;this.differenceMaterial.textures[2]=c;this.target!==null?a.render(this.renderable,d.camera,[],this.target,this.clear):a.render(this.renderable,
d.camera,[],c,this.clear)};return e});
define("goo/renderer/pass/NesPass",["goo/renderer/TextureCreator","goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(f,d,c,a){function b(a){this.material=d.createMaterial(e);this.renderToScreen=!1;this.renderable={meshData:c.quad,materials:[this.material]};this.mapping=(new f).loadTexture2D(a);this.mapping.minFilter="NearestNeighborNoMipMaps";this.mapping.magFilter="NearestNeighbor";this.mapping.generateMipmaps=!1;this.enabled=!0;this.clear=!1;this.needsSwap=
!0}b.prototype.render=function(a,b,d){this.material.textures[0]=d;this.material.textures[1]=this.mapping;this.renderToScreen?a.render(this.renderable,c.camera,[],null,this.clear):a.render(this.renderable,c.camera,[],b,this.clear)};var e={attributes:a.copy.attributes,uniforms:{diffuse:0,mapping:1,$link:a.copy.uniforms},vshader:a.copy.vshader,fshader:"precision mediump float;\nuniform sampler2D diffuse;\nuniform sampler2D mapping;\nvarying vec2 texCoord0;\nvoid main() {\n\tvec4 texCol = texture2D( diffuse, texCoord0 );\n\tfloat r = floor(texCol.r * 31.0);\n\tfloat g = floor(texCol.g * 31.0);\n\tfloat b = floor(texCol.b * 31.0);\n\tvec4 texPalette = texture2D( mapping, vec2((r * 32.0 + g)/1024.0, b / 32.0) );\n\tgl_FragColor = vec4( texPalette.rgb, 1.0 );\n}"};
return b});
define("goo/renderer/pass/SSAOPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/Util,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass,goo/renderer/shaders/ShaderLib".split(","),function(f,d,c,a,b,e,g,l,k,i){function h(a){this.depthPass=new g(a);this.depthPass.clearColor.set(1,1,1,1);this.depthPass.overrideMaterial=f.createMaterial(j);var a=window.innerWidth/4,
b=window.innerHeight/4,e=c.clone(i.ssao);e.uniforms.size=[a,b];this.outPass=new l(e);this.outPass.useReadBuffer=!1;this.blurPass=new k({sizeX:a,sizeY:b});this.depthTarget=new d(a,b,{magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"});this.enabled=!0;this.clear=!1;this.needsSwap=!0}h.prototype.render=function(a,b,c,d){this.depthPass.render(a,null,this.depthTarget,d);this.outPass.material.textures[0]=c;this.outPass.material.textures[1]=this.depthTarget;this.outPass.render(a,b,c,d)};var j=
{attributes:{vertexPosition:a.POSITION},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:["precision mediump float;",e.methods.packDepth,"void main(void) {\n\tgl_FragColor = packDepth(gl_FragCoord.z);\n}"].join("\n")};
return h});define("goo/renderer/shaders/ShaderBuilder",[],function(){return function(){}});
define("goo/scripts/BasicControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(f,d){function c(a){this.domElement=a===void 0?document:a.domElement||a;this.name="BasicControlScript";this.movementSpeed=10;this.rollSpeed=2;this.movementSpeedMultiplier=1;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new f(0,0,0);this.rotationVector=new f(0,0,0);this.multiplier=new f(1,1,1);this.rotationMatrix=
new d;this.tmpVec=new f;this.handleEvent=function(a){if(typeof this[a.type]==="function")this[a.type](a)};this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;
break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=
0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};var b,c;this.mousedown=function(a){this.domElement!==document&&this.domElement.focus();a.preventDefault();a=a.touches&&a.touches.length===1?a.touches[0]:a;this.mouseDownX=a.pageX;this.mouseDownY=a.pageY;
this.mouseStatus=1;b=this.mousemove.bind(this);c=this.mouseup.bind(this);document.addEventListener("mousemove",b,!1);document.addEventListener("mouseup",c,!1);document.addEventListener("touchmove",b,!1);document.addEventListener("touchend",c,!1)};this.mousemove=function(a){if(this.mouseStatus>0)a=a.touches&&a.touches.length===1?a.touches[0]:a,this.moveState.yawLeft=a.pageX-this.mouseDownX,this.moveState.pitchDown=a.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=a.pageX,this.mouseDownY=
a.pageY};this.mouseup=function(a){if(this.mouseStatus)a.preventDefault(),this.mouseStatus=0,this.moveState.yawLeft=this.moveState.pitchDown=0,this.updateRotationVector(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",c),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",c)};this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;
this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-a+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,
this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};a=this.mousedown.bind(this);this.domElement.addEventListener("mousedown",a,!1);this.domElement.addEventListener("touchstart",a,!1);this.domElement.addEventListener("keydown",this.keydown.bind(this),!1);this.domElement.addEventListener("keyup",this.keyup.bind(this),!1);this.updateMovementVector();this.updateRotationVector()}c.prototype.externals=function(){return[{variable:"movementSpeed",type:"number"},{variable:"rollSpeed",
type:"number"}]};c.prototype.run=function(a){var b=a.transformComponent,c=b.transform,d=a._world.tpf,a=d*this.movementSpeed*this.movementSpeedMultiplier,d=d*this.rollSpeed*this.movementSpeedMultiplier;if(!this.moveVector.equals(f.ZERO)||!this.rotationVector.equals(f.ZERO)||this.mouseStatus>0){c.translation.x+=this.moveVector.x*a;c.translation.y+=this.moveVector.y*a;c.translation.z+=this.moveVector.z*a;this.tmpVec.x+=-this.rotationVector.x*d*this.multiplier.x;this.tmpVec.y+=this.rotationVector.y*d*
this.multiplier.y;this.tmpVec.z+=this.rotationVector.z*d*this.multiplier.z;c.rotation.fromAngles(this.tmpVec.x,this.tmpVec.y,this.tmpVec.z);if(this.mouseStatus>0)this.moveState.yawLeft=0,this.moveState.pitchDown=0,this.updateRotationVector();b.setUpdated()}};return c});
define("goo/scripts/FlyControlScript",["goo/math/Vector3"],function(f){function d(c){this.domElement=c!==void 0?c:document;c&&this.domElement.setAttribute("tabindex",-1);this.name="FlyControlScript";this.movementSpeed=10;this.rollSpeed=2;this.movementSpeedMultiplier=1;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new f(0,0,0);this.rotationVector=new f(0,0,0);this.handleEvent=function(a){if(typeof this[a.type]===
"function")this[a.type](a)};this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=
1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=
0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};var a,b;this.mousedown=function(c){this.domElement!==document&&this.domElement.focus();c.preventDefault();this.mouseDownX=c.pageX;this.mouseDownY=c.pageY;this.mouseStatus++;a=this.mousemove.bind(this);b=this.mouseup.bind(this);document.addEventListener("mousemove",a,!1);document.addEventListener("mouseup",
b,!1);document.addEventListener("touchmove",a,!1);document.addEventListener("touchend",b,!1)};this.mousemove=function(a){if(this.mouseStatus>0)this.moveState.yawLeft=a.pageX-this.mouseDownX,this.moveState.pitchDown=a.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=a.pageX,this.mouseDownY=a.pageY};this.mouseup=function(c){c.preventDefault();this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0;this.updateRotationVector();document.removeEventListener("mousemove",a);
document.removeEventListener("mouseup",b);document.removeEventListener("touchmove",a);document.removeEventListener("touchend",b)};this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-a+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;
this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};c=this.mousedown.bind(this);this.domElement.addEventListener("mousedown",c,!1);this.domElement.addEventListener("touchstart",
c,!1);this.domElement.addEventListener("keydown",this.keydown.bind(this),!1);this.domElement.addEventListener("keyup",this.keyup.bind(this),!1);this.updateMovementVector();this.updateRotationVector()}d.prototype.run=function(c){var a=new f;this.moveVector.z===1?a.add(c._direction):this.moveVector.z===-1&&a.sub(c._direction);this.moveVector.x===1?a.add(c._left):this.moveVector.x===-1&&a.sub(c._left);a.y=0;a.normalize();c.onFrameChange();if(this.mouseStatus>0)this.moveState.yawLeft=0,this.moveState.pitchDown=
0,this.updateRotationVector()};return d});
define("goo/scripts/MouseLookControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(f,d){function c(a){a=a||{};this.name="MouseLookControlScript";this.domElement=a.domElement||document;this.turnSpeedHorizontal=!isNaN(a.turnSpeedHorizontal)?a.turnSpeed:0.01;this.turnSpeedVertical=!isNaN(a.turnSpeedVertical)?a.turnSpeed:0.01;this.dragOnly=a.dragOnly!==void 0?a.dragOnly===!0:!0;this.dragButton=!isNaN(a.dragButton)?a.dragButton:-1;this.worldUpVector=a.worldUpVector||new f(0,1,0);this.localLeftVector=
a.localLeftVector||new f(-1,0,0);this.onRun=a.onRun;this.calcVector=new f;this.calcMat1=new d;this.calcMat2=new d;this.resetMouseState();this.setupMouseControls()}c.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN,dX:0,dY:0}};c.prototype.updateButtonState=function(a,b){this.domElement!==document&&this.domElement.focus();if(this.dragOnly&&(this.dragButton===-1||this.dragButton===a.button))this.mouseState.buttonDown=b,a.preventDefault()};c.prototype.updateDeltas=
function(a){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0):(this.mouseState.dX=a.clientX-this.mouseState.lastX,this.mouseState.dY=a.clientY-this.mouseState.lastY);this.mouseState.lastX=a.clientX;this.mouseState.lastY=a.clientY};var a,b,e,g=function(a){this.resetMouseState();this.updateButtonState(a,!0);b=l.bind(this);e=k.bind(this);document.addEventListener("mousemove",b,!1);document.addEventListener("mouseup",e,!1)},l=function(a){this.updateDeltas(a)},
k=function(a){this.updateButtonState(a,!1);document.removeEventListener("mousemove",b);document.removeEventListener("mouseup",e)};c.prototype.setupMouseControls=function(){a=g.bind(this);this.domElement.addEventListener("mousedown",a,!1)};c.prototype.run=function(a){if(a=a.transformComponent){var b=a.transform;if(!(this.dragOnly&&!this.mouseState.buttonDown||this.mouseState.dX===0&&this.mouseState.dY===0)){var c=this.turnSpeedHorizontal,e=this.turnSpeedVertical;this.mouseState.dX!==0&&(this.calcMat1.fromAngleNormalAxis(c*
-this.mouseState.dX,this.worldUpVector.x,this.worldUpVector.y,this.worldUpVector.z),d.combine(this.calcMat1,b.rotation,this.calcMat2),b.rotation.set(this.calcMat2));this.mouseState.dY!==0&&(this.calcMat1.fromAngleNormalAxis(e*this.mouseState.dY,this.localLeftVector.x,this.localLeftVector.y,this.localLeftVector.z),d.combine(b.rotation,this.calcMat1,this.calcMat2),b.rotation.set(this.calcMat2));a.setUpdated()}this.mouseState.dX=0;this.mouseState.dY=0}};return c});
define("goo/scripts/OrbitCamControlScript",["goo/math/Vector2","goo/math/Vector3","goo/math/MathUtils"],function(f,d,c){function a(a){var a=a||{},c;for(c in b)this[c]=typeof b[c]==="boolean"?a[c]!==void 0?a[c]===!0:b[c]:isNaN(b[c])?b[c]instanceof d?a[c]||(new d).copy(b[c]):a[c]||b[c]:!isNaN(a[c])?a[c]:b[c];this.name="OrbitCamControlScript";this.timeSamples=[0,0,0,0,0];this.xSamples=[0,0,0,0,0];this.ySamples=[0,0,0,0,0];this.sample=0;this.velocity=new f;this.targetSpherical=new d(this.spherical);this.cartesian=
new d;this.dirty=!0;this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN};this.setupMouseControls()}var b={domElement:document,turnSpeedHorizontal:0.005,turnSpeedVertical:0.005,zoomSpeed:0.2,dragOnly:!0,dragButton:-1,worldUpVector:new d(0,1,0),baseDistance:15,minZoomDistance:1,maxZoomDistance:1E3,minAscent:-89.95*c.DEG_TO_RAD,maxAscent:89.95*c.DEG_TO_RAD,clampAzimuth:!1,minAzimuth:90*c.DEG_TO_RAD,maxAzimuth:270*c.DEG_TO_RAD,releaseVelocity:!0,invertedX:!1,invertedY:!1,invertedWheel:!0,drag:5,maxSampleTimeMS:200,
lookAtPoint:new d(0,0,0),spherical:new d(15,0,0),interpolationSpeed:7,onRun:null};a.prototype.updateButtonState=function(a,b){this.domElement!==document&&this.domElement.focus();if(this.dragOnly&&(this.dragButton===-1||this.dragButton===a))(this.mouseState.buttonDown=b)?(this.mouseState.lastX=NaN,this.mouseState.lastY=NaN,this.velocity.set(0,0),this.spherical.y=c.moduloPositive(this.spherical.y,c.TWO_PI),this.targetSpherical.copy(this.spherical)):this.applyReleaseDrift()};a.prototype.updateDeltas=
function(a,b){var c=0,d=0;!isNaN(this.mouseState.lastX)&&!isNaN(this.mouseState.lastY)&&(c=-(a-this.mouseState.lastX),d=b-this.mouseState.lastY);this.mouseState.lastX=a;this.mouseState.lastY=b;if(!(this.dragOnly&&!this.mouseState.buttonDown||c===0&&d===0)){this.timeSamples[this.sample]=Date.now();this.xSamples[this.sample]=c;this.ySamples[this.sample]=d;this.sample++;if(this.sample>this.timeSamples.length-1)this.sample=0;this.velocity.set(0,0);this.move(this.turnSpeedHorizontal*c,this.turnSpeedVertical*
d)}};a.prototype.move=function(a,b){var d=this.invertedX?-a:a,f=this.invertedY?-b:b;if(this.clampAzimuth){var i=this.targetSpherical,d=this.targetSpherical.y-d,h=this.minAzimuth,j=this.maxAzimuth,n=(h+j)/2+(j>h?Math.PI:0),o=c.moduloPositive(d-n,c.TWO_PI),q=c.moduloPositive(h-n,c.TWO_PI),n=c.moduloPositive(j-n,c.TWO_PI);d<0&&h>0?h-=c.TWO_PI:d>0&&h<0&&(h+=c.TWO_PI);d>c.TWO_PI&&j<c.TWO_PI&&(j+=c.TWO_PI);i.y=o<q?h:o>n?j:d}else this.targetSpherical.y-=d;this.targetSpherical.z=c.clamp(this.targetSpherical.z+
f,this.minAscent,this.maxAscent);this.dirty=!0};a.prototype.applyWheel=function(a){this.zoom(this.zoomSpeed*(this.invertedWheel?-1:1)*Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)))};a.prototype.zoom=function(a){this.targetSpherical.x=c.clamp(this.targetSpherical.x+a*this.baseDistance,this.minZoomDistance,this.maxZoomDistance);this.dirty=!0};a.prototype.applyReleaseDrift=function(){for(var a=Date.now(),b=0,c=0,d=!1,f=0,h=this.timeSamples.length;f<h;f++)a-this.timeSamples[f]<this.maxSampleTimeMS&&
(b+=this.xSamples[f],c+=this.ySamples[f],d=!0);d?this.velocity.set(b*this.turnSpeedHorizontal/this.timeSamples.length,c*this.turnSpeedVertical/this.timeSamples.length):this.velocity.set(0,0)};a.prototype.setupMouseControls=function(){var a=this;this.domElement.addEventListener("mousedown",function(b){a.updateButtonState(b.button,!0)},!1);document.addEventListener("mouseup",function(b){a.updateButtonState(b.button,!1)},!1);document.addEventListener("mousemove",function(b){a.updateDeltas(b.clientX,
b.clientY)},!1);this.domElement.addEventListener("mousewheel",function(b){a.applyWheel(b)},!1);this.domElement.addEventListener("DOMMouseScroll",function(b){a.applyWheel(b)},!1);if(typeof window.Hammer!=="undefined")window.Hammer(this.domElement,{transform_always_block:!0,transform_min_scale:1}).on("touch drag transform release",function(b){switch(b.type){case "transform":b=b.gesture.scale;b<1?a.zoom(a.zoomSpeed*1):b>1&&a.zoom(a.zoomSpeed*-1);break;case "touch":a.updateButtonState(0,!0);break;case "release":a.updateButtonState(0,
!1);break;case "drag":a.updateDeltas(b.gesture.center.pageX,b.gesture.center.pageY)}})};a.prototype.updateVelocity=function(a){this.velocity.lengthSquared()>1.0E-6?(this.move(this.velocity.x,this.velocity.y),this.velocity.mul(c.clamp(c.lerp(a,1,1-this.drag),0,1)),this.dirty=!0):this.velocity.set(0,0,0)};a.prototype.run=function(a){var b=a.transformComponent;if(b){var d=b.transform;this.releaseVelocity&&this.updateVelocity(a._world.tpf);if(this.dirty){a=this.interpolationSpeed*a._world.tpf;this.spherical.y=
c.lerp(a,this.spherical.y,this.targetSpherical.y);this.spherical.x=c.lerp(a,this.spherical.x,this.targetSpherical.x);this.spherical.z=c.lerp(a,this.spherical.z,this.targetSpherical.z);c.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian);d.translation.set(this.cartesian.add(this.lookAtPoint));d.translation.equals(this.lookAtPoint)||d.lookAt(this.lookAtPoint,this.worldUpVector);if(this.spherical.distanceSquared(this.targetSpherical)<1.0E-6)this.dirty=!1,this.spherical.y=
c.moduloPositive(this.spherical.y,c.TWO_PI),this.targetSpherical.copy(this.spherical);b.setUpdated()}}};return a});
define("goo/scripts/RotationControlScript",["goo/math/Matrix3x3"],function(f){function d(a){this.bindings={attach:c.bind(this),update:null,remove:null};this.element=a;this.name="RotationControlScript";this.states={dirty:!1,x:null,y:null,dx:null,dy:null};this.element.addEventListener("mousedown",this.bindings.attach,!1);this.element.addEventListener("touchstart",this.bindings.attach,!1)}var c=function(c){c=c.touches&&c.touches.length===1?c.touches[0]:c;this.states.dx=0;this.states.dy=0;this.states.x=
c.pageX;this.states.y=c.pageY;this.bindings.update=a.bind(this);this.bindings.remove=b.bind(this);document.addEventListener("mousemove",this.bindings.update,!1);document.addEventListener("touchmove",this.bindings.update,!1);document.addEventListener("mouseup",this.bindings.remove,!1);document.addEventListener("touchend",this.bindings.remove,!1)},a=function(a){a=a.touches&&a.touches.length===1?a.touches[0]:a;this.states.dirty=!0;this.states.dx+=a.pageX-this.states.x;this.states.dy+=a.pageY-this.states.y;
this.states.x=a.pageX;this.states.y=a.pageY},b=function(){document.removeEventListener("mousemove",this.bindings.update);document.removeEventListener("touchmove",this.bindings.update);document.removeEventListener("mouseup",this.bindings.remove);document.removeEventListener("touchend",this.bindings.remove)};d.prototype.run=function(a){if(this.states.dirty){var b=Math.PI*this.states.dy/this.element.clientHeight,c=Math.PI*this.states.dx/this.element.clientWidth,d=Math.cos(b),b=Math.sin(b),i=Math.cos(c),
c=Math.sin(c),d=new f(i,b*c,0-d*c,0,d,b,c,0-b*i,d*i);f.combine(d,a.transformComponent.transform.rotation,a.transformComponent.transform.rotation);a.transformComponent.setUpdated();this.states.dirty=!1;this.states.dx=0;this.states.dy=0}};return d});
define("goo/scripts/SplineInterpolator",["goo/math/Matrix4x4","goo/math/Vector4"],function(f,d){function c(a){a=a||{};this.controlPoint=0;this.controlPoints=a.controlPoints||[];this.elapsedTime=0;this.enabled=a.enabled||!0;this.firstIteration=!0;this.tolerance=a.tolerance||0.01;this.beforeFunction=a.beforeFunction||function(a){return a.transformComponent.transform.translation.clone().data};this.updateFunction=a.updateFunction||function(a,c){a.transformComponent.transform.translation.set(c);a.transformComponent.setUpdated()};
this.afterFunction=a.afterFunction||function(){}}c.CATMULL_ROM=new f(-0.5,1,-0.5,0,1.5,-2.5,0,1,-1.5,2,0.5,0,0.5,-0.5,0,0);c.UNIFORM_CUBIC=new f(-0.16667,0.5,-0.5,0.16667,0.5,-1,0,0.66667,-0.5,0.5,0.5,0.16667,0.16667,0,0,0);c.prototype.run=function(a,b){if(this.firstIteration){this.firstIteration=!1;try{this.controlPoints.unshift({time:0,value:this.beforeFunction(a)})}catch(e){this.enabled=!1;return}}for(var f=Math.min(Math.max(this.controlPoint-1,0),this.controlPoints.length-1),l=Math.min(Math.max(this.controlPoint+
0,0),this.controlPoints.length-1),k=Math.min(Math.max(this.controlPoint+1,0),this.controlPoints.length-1),i=Math.min(Math.max(this.controlPoint+2,0),this.controlPoints.length-1),h=this.controlPoints[k].time>this.controlPoints[l].time?(this.elapsedTime-this.controlPoints[l].time)/(this.controlPoints[k].time-this.controlPoints[l].time):0,h=c.CATMULL_ROM.applyPre(new d(h*h*h,h*h,h,1)),j=Array(this.controlPoints[0].value.length),n=0,o=0;o<j.length;o++)j[o]=0,j[o]+=this.controlPoints[f].value[o]*h[0],
j[o]+=this.controlPoints[l].value[o]*h[1],j[o]+=this.controlPoints[k].value[o]*h[2],j[o]+=this.controlPoints[i].value[o]*h[3],n+=Math.abs(this.controlPoints[this.controlPoints.length-1].value[o]-j[o]);try{this.updateFunction(a,j)}catch(q){this.enabled=!1;return}this.elapsedTime+=b;this.elapsedTime>=this.controlPoints[k].time&&this.controlPoint++;if(this.controlPoint>=this.controlPoints.length||n<this.tolerance){try{this.afterFunction(a)}catch(m){}this.enabled=!1}};return c});
define("goo/scripts/WASDControlScript",["goo/math/Vector","goo/math/Vector3"],function(f,d){function c(a){a=a||{};this.name="WASDControlScript";this.domElement=a.domElement||document;a.domElement&&this.domElement.setAttribute("tabindex",-1);this.walkSpeed=!isNaN(a.walkSpeed)?a.walkSpeed:100;this.crawlSpeed=!isNaN(a.crawlSpeed)?a.crawlSpeed:10;this.fwdVector=a.fwdVector||new d(0,0,-1);this.leftVector=a.leftVector||new d(-1,0,0);this.crawlKey=!isNaN(a.crawlKey)?a.crawlKey:16;this.forwardKey=!isNaN(a.forwardKey)?
a.forwardKey:87;this.backKey=!isNaN(a.backKey)?a.backKey:83;this.strafeLeftKey=!isNaN(a.strafeLeftKey)?a.strafeLeftKey:65;this.strafeRightKey=!isNaN(a.strafeRightKey)?a.strafeRightKey:68;this.onRun=a.onRun;this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1};this.moveVector=new d(0,0,0);this.calcVector=new d;this.setupKeyControls()}c.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight;this.moveVector.z=this.moveState.forward-
this.moveState.back};c.prototype.updateKeys=function(a,b){if(!a.altKey){var c=!1;switch(a.keyCode){case this.crawlKey:this.moveState.crawling=b;break;case this.forwardKey:this.moveState.forward=b?1:0;c=!0;break;case this.backKey:this.moveState.back=b?1:0;c=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=b?1:0;c=!0;break;case this.strafeRightKey:this.moveState.strafeRight=b?1:0,c=!0}c&&this.updateMovementVector()}};c.prototype.setupKeyControls=function(){var a=this;this.domElement.addEventListener("keydown",
function(b){a.updateKeys(b,!0)},!1);this.domElement.addEventListener("keyup",function(b){a.updateKeys(b,!1)},!1)};c.prototype.run=function(a){var b=a.transformComponent;if(b){var c=b.transform;f.equals(this.moveVector,d.ZERO)||(this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize(),this.calcVector.mul(a._world.tpf*
(this.moveState.crawling?this.crawlSpeed:this.walkSpeed)),c.rotation.applyPost(this.calcVector),c.translation.add(this.calcVector),b.setUpdated())}};return c});
define("goo/shapes/ProjectedGrid","goo/renderer/MeshData,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/renderer/Camera,goo/math/MathUtils".split(","),function(f,d,c,a,b,e,g){function l(g,i){this.densityX=g!==void 0?g:20;this.densityY=i!==void 0?i:20;this.projectorCamera=new e(45,1,0.1,2E3);this.mainCamera=new e(45,1,0.1,2E3);this.freezeProjector=!1;this.upperBound=20;this.origin=new a;this.direction=new a;this.source=new d;this.rangeMatrix=new b;this.intersectBottomLeft=
new a;this.intersectTopLeft=new a;this.intersectTopRight=new a;this.intersectBottomRight=new a;this.planeIntersection=new c;this.freezeProjector=!1;this.projectorMinHeight=50;this.intersections=[];for(var h=0;h<24;h++)this.intersections.push(new c);this.connections=[0,3,1,2,0,4,1,5,2,6,3,7,4,7,5,6];var h=this.densityX*this.densityY,j=(this.densityX-1)*(this.densityY-1)*6,l=f.defaultMap([f.POSITION,f.TEXCOORD0]);f.call(this,l,h,j);this.rebuild()}l.prototype=Object.create(f.prototype);l.prototype.update=
function(d){var e=this.upperBound,f=this.mainCamera;this.freezeProjector||f.copy(d);d=f.translation;d.y>0&&d.y<e+f.near?f.translation.setd(d.x,e+f.near,d.z):d.y<0&&d.y>-e-f.near&&f.translation.setd(d.x,-e-f.near,d.z);for(var j=f.calculateFrustumCorners(),l=0,o=new c,q=0;q<8;q++){var d=this.connections[q*2],m=this.connections[q*2+1];(j[d].y>e&&j[m].y<e||j[d].y<e&&j[m].y>e)&&this.getWorldIntersectionSimple(e,j[d],j[m],this.intersections[l++],o);(j[d].y>-e&&j[m].y<-e||j[d].y<-e&&j[m].y>-e)&&this.getWorldIntersectionSimple(-e,
j[d],j[m],this.intersections[l++],o)}for(q=0;q<8;q++)j[q].y<e&&j[q].y>-e&&this.intersections[l++].set(j[q]);if(l===0)return!1;e=this.projectorCamera;e.copy(f);if(e.translation.y>0&&e._direction.y>0||e.translation.y<0&&e._direction.y<0)e._direction.y=-e._direction.y,d=new c,d.setv(e._direction).cross(e._left).normalize(),e._up.setv(d);d=this.source;q=this.planeIntersection;d.set(0.5,0.5);this.getWorldIntersection(0,d,e.getViewProjectionInverseMatrix(),q);f=e.translation;f.y>0&&f.y<this.projectorMinHeight*
2?(j=(this.projectorMinHeight*2-f.y)/(this.projectorMinHeight*2),e.translation.setd(f.x,this.projectorMinHeight*2-this.projectorMinHeight*j,f.z)):f.y<0&&f.y>-this.projectorMinHeight*2&&(j=(-this.projectorMinHeight*2-f.y)/(-this.projectorMinHeight*2),e.translation.setd(f.x,-this.projectorMinHeight*2+this.projectorMinHeight*j,f.z));q.subv(e.translation);q.y=0;f=q.length();if(f>Math.abs(e.translation.y))q.normalize(),q.mul(Math.abs(e.translation.y));else if(f<g.EPSILON)q.addv(e._up),q.y=0,q.normalize(),
q.mul(0.1);q.addv(e.translation);q.y=0;e.lookAt(q,c.UNIT_Y);j=e.getViewProjectionMatrix();o=new a;f=this.intersections;for(q=0;q<l;q++)o.set(f[q].x,0,this.intersections[q].z,1),j.applyPost(o),f[q].set(o.x,o.y,0),f[q].div(o.w);for(var j=Number.MAX_VALUE,o=-Number.MAX_VALUE,m=Number.MAX_VALUE,s=-Number.MAX_VALUE,q=0;q<l;q++){if(f[q].x<j)j=f[q].x;if(f[q].x>o)o=f[q].x;if(f[q].y<m)m=f[q].y;if(f[q].y>s)s=f[q].y}l=this.rangeMatrix;l.setIdentity();l.e00=o-j;l.e11=s-m;l.e03=j;l.e13=m;e=e.getViewProjectionInverseMatrix();
b.combine(e,l,l);d.set(0.5,0.5);this.getWorldIntersectionHomogenous(0,d,l,this.intersectBottomLeft);d.set(0.5,1);this.getWorldIntersectionHomogenous(0,d,l,this.intersectTopLeft);d.set(1,1);this.getWorldIntersectionHomogenous(0,d,l,this.intersectTopRight);d.set(1,0.5);this.getWorldIntersectionHomogenous(0,d,l,this.intersectBottomRight);return!0};l.prototype.getWorldIntersectionHomogenous=function(a,b,c,d){this.calculateIntersection(a,b,c);d.setv(this.origin)};l.prototype.getWorldIntersection=function(a,
b,c,d){this.calculateIntersection(a,b,c);d.setd(this.origin.x,this.origin.y,this.origin.z).div(this.origin.w)};l.prototype.getWorldIntersectionSimple=function(a,b,c,d,e){b=d.setv(b);c=e.setv(c).sub(b);a=(a-b.y)/c.y;c.mul(a);b.addv(c);return a>=0&&a<=1};l.prototype.calculateIntersection=function(a,b,c){this.origin.setd(b.x*2-1,b.y*2-1,-1,1);this.direction.setd(b.x*2-1,b.y*2-1,1,1);c.applyPost(this.origin);c.applyPost(this.direction);this.direction.sub(this.origin);Math.abs(this.direction.y)>g.EPSILON?
this.direction.mul((a-this.origin.y)/this.direction.y):(this.direction.normalize(),this.direction.mul(this.mainCamera._frustumFar));this.origin.add(this.direction)};l.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(f.POSITION),b=this.getAttributeBuffer(f.TEXCOORD0),c=this.getIndexBuffer(),d=this.densityX,e=this.densityY,g=0;g<d;g++)for(var l=0;l<e;l++)a[(g+l*d)*3+0]=g,a[(g+l*d)*3+1]=0,a[(g+l*d)*3+2]=l,b[(g+l*d)*2+0]=g/(d-1),b[(g+l*d)*2+1]=l/(e-1);for(b=a=0;b<d*(e-1);b++)b%(d*(Math.floor(b/
d)+1)-1)===0&&b!==0||(c[a++]=b,c[a++]=1+d+b,c[a++]=1+b,c[a++]=b,c[a++]=d+b,c[a++]=1+d+b);return this};return l});
define("goo/shapes/SimpleBox",["goo/renderer/MeshData"],function(f){function d(c,a,b){this.xExtent=c!==void 0?c*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=b!==void 0?b*0.5:0.5;c=f.defaultMap([f.POSITION]);f.call(this,c,8,36);this.rebuild()}d.prototype=Object.create(f.prototype);d.prototype.rebuild=function(){var c=this.xExtent,a=this.yExtent,b=this.zExtent;this.getAttributeBuffer(f.POSITION).set([-c,-a,-b,c,-a,-b,c,a,-b,-c,a,-b,-c,-a,b,c,-a,b,c,a,b,-c,a,b]);this.getIndexBuffer().set([0,
1,2,2,3,0,7,6,5,5,4,7,0,3,7,7,4,0,1,2,6,6,5,1,3,2,6,6,7,3,0,1,5,5,4,0]);return this};return d});define("goo/util/DebugDraw",[],function(){function f(){}f.prototype.countDown=function(){};return f});
define("goo/util/Promise",[],function(){function f(){this._state="pending";this._resolved=[];this._rejected=[];this._always=[]}f.prototype.then=function(d,c){d&&d!==null&&this._resolved.push(d);c&&c!==null&&this._rejected.push(c);return this};f.prototype.done=function(d){this._state==="pending"?this.then(d):this._state==="resolved"&&d(this._data);return this};f.prototype.fail=function(d){this._state==="pending"?this.then(null,d):this._state==="rejected"&&d(this._data);return this};f.prototype.always=
function(d){typeof d!=="undefined"&&d!==null&&(this._state==="pending"?this._always.push(d):d(this._data));return this};return f});
define("goo/util/Deferred",["goo/util/Promise"],function(f){function d(c){this._promise=c||new f}d.prototype.promise=function(){return this._promise};d.prototype.resolve=function(c){if(this._promise._state==="pending")this._promise._data=c,this._promise._resolved.every(function(a){a(c);return!0}),this._promise._always.every(function(a){a(c);return!0}),this._promise._state="resolved";return this._promise};d.prototype.reject=function(c){if(this._promise._state==="pending")this._promise._data=c,this._promise._rejected.every(function(a){if(c instanceof
Error)throw c;a(c);return!0}),this._promise._always.every(function(a){a(c);return!0}),this._promise._state="rejected";return this._promise};d.prototype.then=function(c,a){return this._promise.then(c,a)};d.prototype.done=function(c){return this._promise.done(c)};d.prototype.fail=function(c){return this._promise.fail(c)};d.prototype.always=function(c){return this._promise.always(c)};d.when=function(){var c=Array.prototype.slice.call(arguments),a=c.length,b=a,e=new d,f=[],l=function(a,c){return function(d){c[a]=
d;--b<=0&&e.resolve(c)}};if(a>0){var a=function(a){e.reject(a)},k;for(k in c)c[k]&&Object.prototype.toString.call(c[k].constructor)==="[object Function]"?c[k].done(l(k,f)).fail(a):--b}b||e.resolve(f);return e.promise()};return d});
define("goo/util/FastBuilder",["goo/renderer/MeshData","goo/math/Vector3"],function(f,d){function c(a,c,d){if(a.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);this.callback=d||{progress:function(){},done:function(){}};this.meshDatas=[];this.dataCounter=0;for(d=c;;){var l=Math.floor(65535/a.vertexCount),l=Math.min(l,c),k=a.vertexCount*l,i=a.indexCount*l,h={},j;for(j in a.attributeMap){var n=a.attributeMap[j];h[j]={count:n.count,type:n.type,
stride:n.stride,offset:n.offset,normalized:n.normalized}}k=new f(h,k,i);d-=l;this.meshDatas.push(k);if(d<=0)break}this.indexCounter=this.vertexCounter=0;this.callback.progress(0)}var a=new d;c.prototype.addMeshData=function(b,c){if(b.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+b.vertexCount);else if(this.vertexCounter+b.vertexCount>=65536)this.dataCounter++,this.vertexData={},this.indexData=[],this.indexCounter=this.vertexCounter=0,this.callback.progress(this.dataCounter/
(this.meshDatas.length-1));var d=this.meshDatas[this.dataCounter],l=b.attributeMap,k;for(k in l){var i=this.vertexCounter*l[k].count,h=b.getAttributeBuffer(k),j=h.length,n=d.getAttributeBuffer(k);if(k===f.POSITION)for(var o=0;o<j;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),c.matrix.applyPostPoint(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else if(k===f.NORMAL)for(o=0;o<j;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),c.rotation.applyPost(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else if(k===
f.TANGENT)for(o=0;o<j;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),c.rotation.applyPost(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else for(o=0;o<j;o++)n[i+o]=h[o]}l=b.getIndexBuffer();n=d.getIndexBuffer();o=0;for(d=b.indexCount;o<d;o++)n[this.indexCounter+o]=l[o]+this.vertexCounter;this.vertexCounter+=b.vertexCount;this.indexCounter+=b.indexCount};c.prototype.build=function(){this.callback.done();return this.meshDatas};return c});
define("goo/util/MeshBuilder",["goo/renderer/MeshData","goo/math/Vector3","goo/entities/EntityUtils"],function(f,d,c){function a(){this.meshDatas=[];this.vertexData={};this.indexData=[];this.indexCounter=this.vertexCounter=0}a.prototype.addEntity=function(a){c.traverse(a,function(){a.transformComponent._dirty&&a.transformComponent.updateTransform()});c.traverse(a,function(){a.transformComponent._dirty&&c.updateWorldTransform(a.transformComponent)});c.traverse(a,function(){a.meshDataComponent&&this.addMeshData(a.meshDataComponent.meshData,
a.transformComponent.worldTransform)})};var b=new d;a.prototype.addMeshData=function(a,c){if(a.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);else this.vertexCounter+a.vertexCount>=65536&&(console.log("Mesh size limit reached, creating new mesh"),this._generateMesh());var d=a.attributeMap,k;for(k in d){var i=d[k],h=this.vertexData[k];if(!h)this.vertexData[k]={},h=this.vertexData[k],h.array=[],h.map={count:i.count,type:i.type,stride:i.stride,
offset:i.offset,normalized:i.normalized};var j=a.getAttributeBuffer(k),n=j.length,o=h.array;if(k===f.POSITION)for(h=0;h<n;h+=3)b.setd(j[h+0],j[h+1],j[h+2]),c.matrix.applyPostPoint(b),o[this.vertexCounter*i.count+h+0]=b[0],o[this.vertexCounter*i.count+h+1]=b[1],o[this.vertexCounter*i.count+h+2]=b[2];else if(k===f.NORMAL)for(h=0;h<n;h+=3)b.setd(j[h+0],j[h+1],j[h+2]),c.rotation.applyPost(b),o[this.vertexCounter*i.count+h+0]=b[0],o[this.vertexCounter*i.count+h+1]=b[1],o[this.vertexCounter*i.count+h+2]=
b[2];else if(k===f.TANGENT)for(h=0;h<n;h+=3)b.setd(j[h+0],j[h+1],j[h+2]),c.rotation.applyPost(b),o[this.vertexCounter*i.count+h+0]=b[0],o[this.vertexCounter*i.count+h+1]=b[1],o[this.vertexCounter*i.count+h+2]=b[2];else for(h=0;h<n;h++)o[this.vertexCounter*i.count+h]=j[h]}d=a.getIndexBuffer();h=0;for(k=a.indexCount;h<k;h++)this.indexData[this.indexCounter+h]=d[h]+this.vertexCounter;this.vertexCounter+=a.vertexCount;this.indexCounter+=a.indexCount};a.prototype._generateMesh=function(){var a={},b;for(b in this.vertexData){var c=
this.vertexData[b];a[b]=c.map}a=new f(a,this.vertexCounter,this.indexCounter);for(b in this.vertexData)c=this.vertexData[b].array,a.getAttributeBuffer(b).set(c);a.getIndexBuffer().set(this.indexData);this.meshDatas.push(a);this.vertexData={};this.indexData=[];this.indexCounter=this.vertexCounter=0};a.prototype.build=function(){this.vertexCounter>0&&this._generateMesh();return this.meshDatas};return a});
define("goo/util/Rc4Random",[],function(){return function(f){var d=[],c=0,a=0;(function(a){for(var c=0;c<256;c++)d[c]=c;for(var f=0,c=0;c<256;c++){var f=(f+d[c]+a.charCodeAt(c%a.length))%256,l=d[c];d[c]=d[f];d[f]=l}})(f);this.getRandomNumber=function(){for(var b=0,e=1,f=0;f<8;f++){c=(c+1)%256;a=(a+d[c])%256;var l=d[c];d[c]=d[a];d[a]=l;b+=d[(d[c]+d[a])%256]*e;e*=256}return b/1.8446744073709552E19}}});
define("goo/util/TangentGenerator",["goo/math/Vector2","goo/math/Vector3","goo/renderer/MeshData"],function(f,d,c){function a(){}a.addTangentBuffer=function(a,e){function g(a){for(var b=[],c=0;c<a.length;c+=3)b.push(new d(a[c+0],a[c+1],a[c+2]));return b}var e=e||0,l=a.getAttributeBuffer(c.POSITION);if(!l)throw Error("Vertex buffer is null!");var k=a.getAttributeBuffer(c.NORMAL);if(!k)throw Error("Normal buffer is null!");var i=a.getAttributeBuffer("TEXCOORD"+e);!i&&e!==0&&(i=a.getAttributeBuffer(c.TEXCOORD0));
if(!i)throw Error("Texture buffer is null!");var h=a.getIndexBuffer();if(!h)throw Error("Index buffer is null!");for(var j=a.vertexCount,n=a.indexCount/3,o=[],q=[],m=0;m<j;m++)o[m]=new d,q[m]=new d;l=g(l);k=g(k);m=function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(new f(a[c+0],a[c+1]));return b}(i);for(i=0;i<n;i++){var s=h[i*3],p=h[i*3+1],t=h[i*3+2],u=l[s],w=l[p],r=l[t],v=m[s],z=m[p],y=m[t],A=w.x-u.x,x=r.x-u.x,D=w.y-u.y,E=r.y-u.y,w=w.z-u.z,u=r.z-u.z,r=z.x-v.x,C=y.x-v.x,z=z.y-v.y,y=y.y-v.y,v=1/(r*
y-C*z);isFinite(v)!==!1&&(y=new d((y*A-z*x)*v,(y*D-z*E)*v,(y*w-z*u)*v),A=new d((r*x-C*A)*v,(r*E-C*D)*v,(r*u-C*w)*v),o[s].add(y),o[p].add(y),o[t].add(y),q[s].add(A),q[p].add(A),q[t].add(A))}a.attributeMap[c.TANGENT]=c.createAttribute(4,"Float");a.rebuildData(a.vertexCount,a.indexCount,!0);h=a.getAttributeBuffer(c.TANGENT);n=new d;l=new d;for(i=0;i<j;i++)m=k[i],s=o[i],p=m.dot(s),n.copy(s).sub(l.copy(m).mul(p)).normalize(),h[i*4+0]=n.x,h[i*4+1]=n.y,h[i*4+2]=n.z,p=n.copy(m).cross(s).dot(q[i]),h[i*4+3]=
p<0?-1:1;return h};return a});require("goo/addons/box2d/components/Box2DComponent,goo/addons/box2d/systems/Box2DSystem,goo/addons/cannon/components/CannonjsComponent,goo/addons/cannon/systems/CannonjsSystem,goo/addons/soundmanager2/components/SoundManager2Component,goo/addons/soundmanager2/systems/SoundManager2System,goo/addons/terrain/Terrain,goo/addons/water/FlatWaterRenderer,goo/addons/water/ProjectedGridWaterRenderer,goo/animation/AnimationManager,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/animation/blendtree/AbstractTwoPartSource,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/ClipSource,goo/animation/blendtree/ExclusiveClipSource,goo/animation/blendtree/FrozenClipSource,goo/animation/blendtree/InclusiveClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/blendtree/SimpleAnimationApplier,goo/animation/clip/AbstractAnimationChannel,goo/animation/clip/AnimationClip,goo/animation/clip/AnimationClipInstance,goo/animation/clip/GuaranteedTriggerChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/clip/JointChannel,goo/animation/clip/JointData,goo/animation/clip/TransformChannel,goo/animation/clip/TransformData,goo/animation/clip/TriggerChannel,goo/animation/clip/TriggerData,goo/animation/layer/AnimationLayer,goo/animation/layer/LayerLERPBlender,goo/animation/state/AbstractFiniteState,goo/animation/state/AbstractTransitionState,goo/animation/state/AbstractTwoStateLerpTransition,goo/animation/state/FadeTransitionState,goo/animation/state/FrozenTransitionState,goo/animation/state/IgnoreTransitionState,goo/animation/state/ImmediateTransitionState,goo/animation/state/StateBlendType,goo/animation/state/SteadyState,goo/animation/state/SyncFadeTransitionState,goo/animation/state/loader/OutputStore,goo/entities/Entity,goo/entities/EntityUtils,goo/entities/EventHandler,goo/entities/GooRunner,goo/entities/World,goo/entities/components/CSSTransformComponent,goo/entities/components/CameraComponent,goo/entities/components/Component,goo/entities/components/LightComponent,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/ParticleComponent,goo/entities/components/ScriptComponent,goo/entities/components/TransformComponent,goo/entities/managers/DebugManager,goo/entities/managers/EntityManager,goo/entities/managers/LightManager,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/CSSTransformSystem,goo/entities/systems/CameraSystem,goo/entities/systems/LightingSystem,goo/entities/systems/ParticlesSystem,goo/entities/systems/PickingSystem,goo/entities/systems/RenderSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/System,goo/entities/systems/TransformSystem,goo/loaders/AnimationLoader,goo/loaders/AnimationTreeLoader,goo/loaders/BundleLoader,goo/loaders/EntityLoader,goo/loaders/JSONImporter,goo/loaders/JsonUtils,goo/loaders/Loader,goo/loaders/MaterialLoader,goo/loaders/MeshLoader,goo/loaders/SceneLoader,goo/loaders/ScriptLoader,goo/loaders/ShaderLoader,goo/loaders/SkeletonLoader,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/math/MathUtils,goo/math/Matrix,goo/math/Matrix2x2,goo/math/Matrix3x3,goo/math/Matrix4x4,goo/math/Plane,goo/math/Quaternion,goo/math/Ray,goo/math/Transform,goo/math/Transformation,goo/math/Vector,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4,goo/math/Versor,goo/noise/Noise,goo/noise/ValueNoise,goo/particles/Particle,goo/particles/ParticleEmitter,goo/particles/ParticleInfluence,goo/particles/ParticleUtils,goo/picking/BoundingTree,goo/picking/PrimitivePickLogic,goo/renderer/BufferData,goo/renderer/BufferUtils,goo/renderer/Camera,goo/renderer/Material,goo/renderer/MeshData,goo/renderer/RenderQueue,goo/renderer/Renderer,goo/renderer/RendererRecord,goo/renderer/Shader,goo/renderer/ShaderCall,goo/renderer/SimplePartitioner,goo/renderer/Texture,goo/renderer/TextureCreator,goo/renderer/Util,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/renderer/bounds/BoundingVolume,goo/renderer/light/DirectionalLight,goo/renderer/light/Light,goo/renderer/light/PointLight,goo/renderer/light/SpotLight,goo/renderer/pass/BloomPass,goo/renderer/pass/BlurPass,goo/renderer/pass/Composer,goo/renderer/pass/DepthPass,goo/renderer/pass/DoGPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/FullscreenUtil,goo/renderer/pass/NesPass,goo/renderer/pass/RenderPass,goo/renderer/pass/RenderTarget,goo/renderer/pass/SSAOPass,goo/renderer/shaders/ShaderBuilder,goo/renderer/shaders/ShaderFragment,goo/renderer/shaders/ShaderLib,goo/renderer/shadow/ShadowHandler,goo/scripts/BasicControlScript,goo/scripts/FlyControlScript,goo/scripts/MouseLookControlScript,goo/scripts/OrbitCamControlScript,goo/scripts/RotationControlScript,goo/scripts/SplineInterpolator,goo/scripts/WASDControlScript,goo/shapes/Box,goo/shapes/ProjectedGrid,goo/shapes/Quad,goo/shapes/ShapeCreator,goo/shapes/SimpleBox,goo/shapes/Sphere,goo/shapes/Torus,goo/util/Ajax,goo/util/DebugDraw,goo/util/Deferred,goo/util/Enum,goo/util/FastBuilder,goo/util/GameUtils,goo/util/Handy,goo/util/Latch,goo/util/MeshBuilder,goo/util/Promise,goo/util/Rc4Random,goo/util/SimpleResourceUtil,goo/util/Stats,goo/util/TangentGenerator,goo/util/URLTools,goo/util/rsvp".split(","));
define("req_temp",function(){});
