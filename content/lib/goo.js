'use strict';define("goo/entities/components/Component",[],function(){return function(){this.enabled=!0}});
define("goo/addons/box2d/components/Box2DComponent",["goo/entities/components/Component"],function(f){function d(b){this.type="Box2DComponent";this.world=this.body=null;this.mass=1;this.settings=b||{};this.shape=b.shape?b.shape:"box";this.width=b.width?b.width:1;this.height=b.height?b.height:1;this.radius=b.radius?b.radius:1;this.vertices=b.vertices?b.vertices:[0,1,2,2,0,2];this.movable=b.movable===!0?!0:!1;this.friction=b.friction?b.friction:1;this.offsetX=b.offsetX?b.offsetX:0;this.offsetY=b.offsetY?
b.offsetY:0}d.prototype=Object.create(f.prototype);return d});
define("goo/entities/systems/System",[],function(){function f(d,b){this.type=d;this.interests=b;this._activeEntities=[]}f.prototype.added=function(d){this._check(d)};f.prototype.changed=function(d){this._check(d)};f.prototype.removed=function(d){var b=this._activeEntities.indexOf(d);b!==-1&&(this._activeEntities.splice(b,1),this.deleted&&this.deleted(d))};f.prototype._check=function(d){var b=this.interests===null;if(!b&&this.interests.length<=d._components.length)for(var b=!0,a=0;a<this.interests.length;a++){var c=
this.interests[a].charAt(0).toLowerCase()+this.interests[a].substr(1);if(!d[c]){b=!1;break}}a=this._activeEntities.indexOf(d);b&&a===-1?(this._activeEntities.push(d),this.inserted&&this.inserted(d)):!b&&a!==-1&&(this._activeEntities.splice(a,1),this.deleted&&this.deleted(d))};f.prototype._process=function(d){this.process&&this.process(this._activeEntities,d)};return f});
define("goo/addons/box2d/systems/Box2DSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"Box2DSystem",["Box2DComponent","MeshDataComponent"]);this.SCALE=0.5;this.world=new Box2D.b2World(new Box2D.b2Vec2(0,-9));this.sortVertexesClockWise=function(b,a){var c=Math.atan2(b.get_y(),b.get_x()),e=Math.atan2(a.get_y(),a.get_x());return c>e?1:-1};this.createPolygonShape=function(b){for(var a=new Box2D.b2PolygonShape,c=Box2D.allocate(b.length*8,"float",Box2D.ALLOC_STACK),e=0,g=0;g<
b.length;g++)Box2D.setValue(c+e,b[g].get_x(),"float"),Box2D.setValue(c+(e+4),b[g].get_y(),"float"),e+=8;c=Box2D.wrapPointer(c,Box2D.b2Vec2);a.Set(c,b.length);return a}}d.prototype=Object.create(f.prototype);d.prototype.inserted=function(b){var a=b.physics2DComponent,c=0,e=0,g=new Box2D.b2PolygonShape;if(a.shape==="box")g.SetAsBox(a.width*this.SCALE,a.height*this.SCALE);else if(a.shape==="circle")g=new Box2D.b2CircleShape,g.set_m_radius(a.radius);else if(a.shape==="mesh"){for(var d=b.meshDataComponent.meshData.getAttributeBuffer("POSITION"),
g=0,f=[],c=1E4,i=-1E4,e=1E4,h=-1E4;g<=d.length-3;){var j=d[g],n=d[++g];n<c&&(c=n);n>i&&(i=n);j<e&&(e=j);j>h&&(h=j);++g;b.transformComponent.updateWorldTransform();j=new Box2D.b2Vec2(j,n);f.push(j)}g=this.createPolygonShape(f);c=Math.abs(i-c);e=Math.abs(h-e)}else if(a.shape==="polygon"){f=[];for(g=0;g<=a.vertices.length-2;)j=new Box2D.b2Vec2(a.vertices[g],a.vertices[++g]),f.push(j),++g;g=this.createPolygonShape(f);console.log(f)}f=new Box2D.b2FixtureDef;f.set_shape(g);f.set_density(1);f.set_friction(a.friction);
g=new Box2D.b2BodyDef;a.movable===!0&&g.set_type(Box2D.b2_dynamicBody);g.set_position(new Box2D.b2Vec2(b.transformComponent.transform.translation.x+a.offsetX,b.transformComponent.transform.translation.y+a.offsetY));g=this.world.CreateBody(g);g.CreateFixture(f);g.SetLinearDamping(0.95);g.SetAngularDamping(0.6);a.body=g;a.world=this.world;b.body=g;b.body.h=c;b.body.w=e};d.prototype.deleted=function(){};d.prototype.process=function(b,a){this.world.Step(a,2,2);for(var c=0;c<b.length;c++){var e=b[c].body.GetPosition();
b[c].transformComponent.transform.translation.y=e.get_y()-b[c].physics2DComponent.offsetY;b[c].transformComponent.transform.translation.x=e.get_x()-b[c].physics2DComponent.offsetX;b[c].transformComponent.setUpdated();b[c].transformComponent.transform.rotation.z=b[c].body.GetAngle();e.get_y()>100&&b[c].body.ApplyForce(new Box2D.b2Vec2(0,-100),b[c].body.GetPosition())}};return d});
define("goo/addons/cannon/components/CannonjsComponent",["goo/entities/components/Component"],function(f){function d(b){this.type="CannonjsComponent";this.settings=b||{};this.mass=b.mass!==void 0?b.mass:0;this.useBounds=b.useBounds!==void 0?b.useBounds:!1;this.linearDamping=b.linearDamping!==void 0?b.linearDamping:0;this.angularDamping=b.angularDamping!==void 0?b.angularDamping:0}d.prototype=Object.create(f.prototype);return d});
define("goo/math/MathUtils",[],function(){function f(){}f.DEG_TO_RAD=Math.PI/180;f.RAD_TO_DEG=180/Math.PI;f.HALF_PI=0.5*Math.PI;f.TWO_PI=2*Math.PI;f.EPSILON=1.0E-7;f.radFromDeg=function(d){return d*f.DEG_TO_RAD};f.degFromRad=function(d){return d*f.RAD_TO_DEG};f.lerp=function(d,b,a){return b===a?b:b+(a-b)*d};f.clamp=function(d,b,a){return b<a?d<b?b:d>a?a:d:d<a?a:d>b?b:d};f.moduloPositive=function(d,b){var a=d%b;a+=a<0?b:0;return a};f.scurve3=function(d){return(-2*d+3)*d*d};f.scurve5=function(d){return((6*
d-15)*d+10)*d*d*d};f.sphericalToCartesian=function(d,b,a,c){var e=d*Math.cos(a);c.x=e*Math.cos(b);c.y=d*Math.sin(a);c.z=e*Math.sin(b)};return f});
define("goo/math/Vector",["goo/math/MathUtils"],function(f){function d(b){this.data=new Float32Array(b||0)}d.prototype.setupAliases=function(b){for(var a=this,c=0;c<b.length;c++)(function(e){for(var g=0;g<b[e].length;g++)Object.defineProperty(a,b[e][g],{get:function(){return this.data[e]},set:function(c){this.data[e]=c}});Object.defineProperty(a,c,{get:function(){return this.data[e]},set:function(c){this.data[e]=c}})})(c)};d.add=function(b,a,c){var b=b.data||b,a=a.data||a,e=b.length;c||(c=new d(e));
if(a.length!==e||c.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<e;g++)c.data[g]=b[g]+a[g];return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){var b=b.data||b,a=a.data||a,e=b.length;c||(c=new d(e));if(a.length!==e||c.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<e;g++)c.data[g]=b[g]-a[g];return c};d.prototype.sub=function(b){return d.sub(this,
b,this)};d.mul=function(b,a,c){var b=b.data||b,a=a.data||a,e=b.length;c||(c=new d(e));if(a.length!==e||c.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<e;g++)c.data[g]=b[g]*a[g];return c};d.prototype.mul=function(b){return d.mul(this,b,this)};d.div=function(b,a,c){var b=b.data||b,a=a.data||a,e=b.length;c||(c=new d(e));if(a.length!==e||c.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
for(var g=0;g<e;g++)c.data[g]=b[g]/a[g];return c};d.prototype.div=function(b){return d.div(this,b,this)};d.copy=function(b,a){var c=b.data.length;a||(a=new d(c));if(a.data.length!==c)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(b.data);return a};d.prototype.copy=function(b){return d.copy(b,this)};d.dot=function(b,a){var c=b.data||b,e=a.data||a,g=c.length;if(e.length!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
for(var d=0,f=0;f<g;f++)d+=c[f]*e[f];return d};d.prototype.dot=function(b){return d.dot(this,b)};d.apply=function(b,a,c){var e=b.rows,g=b.cols,f=a.data.length;c||(c=new d(e));if(c.data.length!==e||g!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(c===a)return d.copy(d.apply(b,a),c);for(var k=0;k<g;k++)for(var i=k*e,h=0;h<e;h++){for(var j=0,n=0;n<f;n++)j+=b.data[n*b.rows+h]*a.data[n];c.data[i+h]=j}return c};d.prototype.apply=function(b){return d.apply(b,this,
this)};d.equals=function(b,a){var c=b.data.length;if(c!==a.data.length)return!1;for(var e=0;e<c;e++)if(Math.abs(b.data[e]-a.data[e])>f.EPSILON)return!1;return!0};d.prototype.equals=function(b){return d.equals(this,b)};d.distanceSquared=function(b,a){return d.sub(b,a).lengthSquared()};d.prototype.distanceSquared=function(b){return d.sub(this,b).lengthSquared()};d.distance=function(b,a){return d.sub(b,a).length()};d.prototype.distance=function(b){return d.sub(this,b).length()};d.prototype.lengthSquared=
function(){return d.dot(this,this)};d.prototype.length=function(){return Math.sqrt(d.dot(this,this))};d.prototype.invert=function(){for(var b=0;b<this.data.length;b++)this.data[b]=0-this.data[b];return this};d.prototype.normalize=function(){var b=this.length(),a=this.data.length;if(b<f.EPSILON)for(var c=0;c<a;c++)this.data[c]=0;else{b=1/b;for(c=0;c<a;c++)this.data[c]*=b}return this};d.prototype.clone=function(){return d.copy(this)};d.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]===
"object")if(arguments[0]instanceof d)this.copy(arguments[0]);else if(arguments[0].length>1)for(var b=0;b<arguments[0].length;b++)this.data[b]=arguments[0][b];else this.set(arguments[0][0]);else for(b=0;b<arguments.length;b++)this.data[b]=arguments[b];return this};d.prototype.toString=function(){var b="";b+="[";for(var a=0;a<this.data.length;a++)b+=this.data[a],b+=a!==this.data.length-1?", ":"";b+="]";return b};return d});
define("goo/math/Vector3",["goo/math/Vector"],function(f){function d(){f.call(this,3);arguments.length!==0?this.set(arguments):this.setd(0,0,0)}d.prototype=Object.create(f.prototype);d.prototype.setupAliases([["x","u","r"],["y","v","g"],["z","w","b"]]);d.ZERO=new d(0,0,0);d.ONE=new d(1,1,1);d.UNIT_X=new d(1,0,0);d.UNIT_Y=new d(0,1,0);d.UNIT_Z=new d(0,0,1);d.add=function(b,a,c){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==
3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]+a[0];c.data[1]=b[1]+a[1];c.data[2]=b[2]+a[2];return c};d.addv=function(b,a,c){c||(c=new d);c.data[0]=b.data[0]+a.data[0];c.data[1]=b.data[1]+a.data[1];c.data[2]=b.data[2]+a.data[2];return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",
message:"The arguments are of incompatible sizes."};c.data[0]=b[0]-a[0];c.data[1]=b[1]-a[1];c.data[2]=b[2]-a[2];return c};d.subv=function(b,a,c){c||(c=new d);c.data[0]=b.data[0]-a.data[0];c.data[1]=b.data[1]-a.data[1];c.data[2]=b.data[2]-a.data[2];return c};d.prototype.sub=function(b){return d.sub(this,b,this)};d.mul=function(b,a,c){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
c.data[0]=b[0]*a[0];c.data[1]=b[1]*a[1];c.data[2]=b[2]*a[2];return c};d.prototype.mul=function(b){return d.mul(this,b,this)};d.div=function(b,a,c){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]/a[0];c.data[1]=b[1]/a[1];c.data[2]=b[2]/a[2];return c};d.prototype.div=function(b){return d.div(this,b,this)};d.dot=function(b,
a){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);var c=b.data||b,e=a.data||a;if(c.length!==3||e.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var g=0;g+=c[0]*e[0];g+=c[1]*e[1];g+=c[2]*e[2];return g};d.prototype.dot=function(b){return d.dot(this,b)};d.cross=function(b,a,c){c||(c=new d);var e=a.data||a;if((b.data||b).length!==3||e.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var e=a.data[0]*
b.data[2]-a.data[2]*b.data[0],g=a.data[1]*b.data[0]-a.data[0]*b.data[1];c.data[0]=a.data[2]*b.data[1]-a.data[1]*b.data[2];c.data[1]=e;c.data[2]=g;return c};d.prototype.cross=function(b){return d.cross(this,b,this)};d.prototype.lerp=function(b,a){this.data[0]=(1-a)*this.data[0]+a*b.data[0];this.data[1]=(1-a)*this.data[1]+a*b.data[1];this.data[2]=(1-a)*this.data[2]+a*b.data[2];return this};d.prototype.setd=function(b,a,c){this.data[0]=b;this.data[1]=a;this.data[2]=c;return this};d.prototype.seta=function(b){this.data[0]=
b[0];this.data[1]=b[1];this.data[2]=b[2];return this};d.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];this.data[2]=b.data[2];return this};d.prototype.add_d=function(b,a,c){this.data[0]+=b;this.data[1]+=a;this.data[2]+=c;return this};d.prototype.addv=function(b){this.data[0]+=b.data[0];this.data[1]+=b.data[1];this.data[2]+=b.data[2];return this};d.prototype.mulv=function(b){this.data[0]*=b.data[0];this.data[1]*=b.data[1];this.data[2]*=b.data[2];return this};d.prototype.muld=
function(b,a,c){this.data[0]*=b;this.data[1]*=a;this.data[2]*=c;return this};d.prototype.subv=function(b){this.data[0]-=b.data[0];this.data[1]-=b.data[1];this.data[2]-=b.data[2];return this};d.prototype.sub_d=function(b,a,c){this.data[0]-=b;this.data[1]-=a;this.data[2]-=c;return this};d.prototype.lengthSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]};return d});
define("goo/renderer/bounds/BoundingVolume",["goo/math/Vector3"],function(f){function d(){this.center=new f;this.min=new f(Infinity,Infinity,Infinity);this.max=new f(-Infinity,-Infinity,-Infinity)}d.Outside=0;d.Inside=1;d.Intersects=2;return d});
define("goo/renderer/bounds/BoundingBox",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/math/MathUtils"],function(f,d,b){function a(){d.call(this);this.zExtent=this.yExtent=this.xExtent=1;this._compVect1=new f;this._compVect2=new f;this.vec=new f}a.prototype=Object.create(d.prototype);a.prototype.computeFromPoints=function(c){var e=this.min,a=this.max,b=this.vec;e.setd(Infinity,Infinity,Infinity);a.setd(-Infinity,-Infinity,-Infinity);for(var d,f,h,j=0;j<c.length;j+=3)d=c[j+0],f=c[j+
1],h=c[j+2],e.x=d<e.x?d:e.x,e.y=f<e.y?f:e.y,e.z=h<e.z?h:e.z,a.x=d>a.x?d:a.x,a.y=f>a.y?f:a.y,a.z=h>a.z?h:a.z;b.setv(a).subv(e).div(2);this.xExtent=b.x;this.yExtent=b.y;this.zExtent=b.z;this.center.setv(a).add_d(e).div(2)};a.prototype.computeFromPrimitives=function(c,e,g,b,d){if(!(d-b<=0)){for(var f=this._compVect1.set(Infinity,Infinity,Infinity),h=this._compVect2.set(-Infinity,-Infinity,-Infinity),j=[];b<d;b++)for(var j=c.getPrimitiveVertices(g[b],e,j),n=0;n<j.length;n++)a.checkMinMax(f,h,j[n]);this.center.copy(f.add(h));
this.center.mul(0.5);this.xExtent=h.x-this.center.x;this.yExtent=h.y-this.center.y;this.zExtent=h.z-this.center.z}};a.checkMinMax=function(c,e,a){if(a.x<c.x)c.x=a.x;if(a.x>e.x)e.x=a.x;if(a.y<c.y)c.y=a.y;if(a.y>e.y)e.y=a.y;if(a.z<c.z)c.z=a.z;if(a.z>e.z)e.z=a.z};a.prototype.transform=function(c,e){e===null&&(e=new a);for(var g=[],b=0;b<8;b++)g.push(new f);this.getCorners(g);for(b=0;b<g.length;b++)c.matrix.applyPostPoint(g[b]);for(var d=g[0].x,i=g[0].y,h=g[0].z,j=d,n=i,o=h,b=1;b<g.length;b++)var q=g[b].x,
m=g[b].y,r=g[b].z,d=Math.min(d,q),i=Math.min(i,m),h=Math.min(h,r),j=Math.max(j,q),n=Math.max(n,m),o=Math.max(o,r);g=(j+d)*0.5;i=(n+i)*0.5;h=(o+h)*0.5;e.center.set(g,i,h);e.xExtent=j-g;e.yExtent=n-i;e.zExtent=o-h;return e};a.prototype.getCorners=function(c){if(!c||c.length!==8)for(var c=[],e=0;e<c.length;e++)c.push(new f);c[0].set(this.center.x+this.xExtent,this.center.y+this.yExtent,this.center.z+this.zExtent);c[1].set(this.center.x+this.xExtent,this.center.y+this.yExtent,this.center.z-this.zExtent);
c[2].set(this.center.x+this.xExtent,this.center.y-this.yExtent,this.center.z+this.zExtent);c[3].set(this.center.x+this.xExtent,this.center.y-this.yExtent,this.center.z-this.zExtent);c[4].set(this.center.x-this.xExtent,this.center.y+this.yExtent,this.center.z+this.zExtent);c[5].set(this.center.x-this.xExtent,this.center.y+this.yExtent,this.center.z-this.zExtent);c[6].set(this.center.x-this.xExtent,this.center.y-this.yExtent,this.center.z+this.zExtent);c[7].set(this.center.x-this.xExtent,this.center.y-
this.yExtent,this.center.z-this.zExtent);return c};a.prototype.whichSide=function(c){var e=Math.abs(this.xExtent*c.normal.x)+Math.abs(this.yExtent*c.normal.y)+Math.abs(this.zExtent*c.normal.z),a=c.normal.data,b=this.center.data,c=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]-c.constant;return c<-e?d.Inside:c>e?d.Outside:d.Intersects};a.prototype._pseudoDistance=function(c,e){return c.normal.x*e.x+c.normal.y*e.y+c.normal.z*e.z-c.constant};a.prototype._maxAxis=function(c){return Math.max(Math.abs(c.x),Math.max(Math.abs(c.y),
Math.abs(c.z)))};a.prototype.toString=function(){var c=Math.round(this.center.x*10)/10,e=Math.round(this.center.y*10)/10,a=Math.round(this.center.z*10)/10;return"["+c+","+e+","+a+"] - ["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"};a.prototype.intersectsBoundingBox=function(c){return this.center.x+this.xExtent<c.center.x-c.xExtent||this.center.x-this.xExtent>c.center.x+c.xExtent?!1:this.center.y+this.yExtent<c.center.y-c.yExtent||this.center.y-this.yExtent>c.center.y+c.yExtent?!1:this.center.z+
this.zExtent<c.center.z-c.zExtent||this.center.z-this.zExtent>c.center.z+c.zExtent?!1:!0};a.prototype.testStaticAABBAABB=function(c,e){var a={mtvDistance:1E10,mtvAxis:new f};if(!this.testAxisStatic(f.UNIT_X,this.center.x-this.xExtent,this.center.x+this.xExtent,c.center.x-c.xExtent,c.center.x+c.xExtent,a))return!1;if(!this.testAxisStatic(f.UNIT_Y,this.center.y-this.yExtent,this.center.y+this.yExtent,c.center.y-c.yExtent,c.center.y+c.yExtent,a))return!1;if(!this.testAxisStatic(f.UNIT_Z,this.center.z-
this.zExtent,this.center.z+this.zExtent,c.center.z-c.zExtent,c.center.z+c.zExtent,a))return!1;if(e)e.isIntersecting=!0,e.normal=a.mtvAxis,e.penetration=Math.sqrt(a.mtvDistance)*1.001;return!0};a.prototype.testAxisStatic=function(c,e,a,b,d,i){var h=f.dot(c,c);if(h<1.0E-6)return!0;e=d-e;a-=b;if(e<=0||a<=0)return!1;a=e<a?e:-a;h=(new f).copy(c).mul(a/h);h=f.dot(h,h);if(h<i.mtvDistance)i.mtvDistance=h,i.mtvAxis=c;return!0};a.prototype.intersectsRay=function(c){if(isNaN(this.center.x)||isNaN(this.center.y)||
isNaN(this.center.z))return!1;var e=f.sub(c.origin,this.center,this._compVect1),c=c.direction,g=[0,Infinity],d=this.xExtent;if(d<b.ZERO_TOLERANCE&&d>=0)d=b.ZERO_TOLERANCE;var k=this.yExtent;if(k<b.ZERO_TOLERANCE&&k>=0)k=b.ZERO_TOLERANCE;var i=this.zExtent;if(i<b.ZERO_TOLERANCE&&i>=0)i=b.ZERO_TOLERANCE;return a.clip(c.x,-e.x-d,g)&&a.clip(-c.x,e.x-d,g)&&a.clip(c.y,-e.y-k,g)&&a.clip(-c.y,e.y-k,g)&&a.clip(c.z,-e.z-i,g)&&a.clip(-c.z,e.z-i,g)&&(g[0]!==0||g[1]!==Infinity)?!0:!1};a.prototype.intersectsRayWhere=
function(c){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return null;var e=f.sub(c.origin,this.center,this._compVect1),g=c.direction,d=[0,Infinity],k=this.xExtent;if(k<b.ZERO_TOLERANCE&&k>=0)k=b.ZERO_TOLERANCE;var i=this.yExtent;if(i<b.ZERO_TOLERANCE&&i>=0)i=b.ZERO_TOLERANCE;var h=this.zExtent;if(h<b.ZERO_TOLERANCE&&h>=0)h=b.ZERO_TOLERANCE;if(a.clip(g.x,-e.x-k,d)&&a.clip(-g.x,e.x-k,d)&&a.clip(g.y,-e.y-i,d)&&a.clip(-g.y,e.y-i,d)&&a.clip(g.z,-e.z-h,d)&&a.clip(-g.z,e.z-h,d)&&(d[0]!==
0||d[1]!==Infinity)){if(d[1]>d[0])return e=d,c=[(new f(c.direction)).mul(e[0]).add(c.origin),(new f(c.direction)).mul(e[1]).add(c.origin)],{distances:e,points:c};e=[d[0]];c=[(new f(c.direction)).mul(e[0]).add(c.origin)];return{distances:e,points:c}}return null};a.clip=function(c,e,a){if(c>0){if(e>c*a[1])return!1;e>c*a[0]&&(a[0]=e/c);return!0}else if(c<0){if(e>c*a[0])return!1;e>c*a[1]&&(a[1]=e/c);return!0}else return e<=0};return a});
define("goo/renderer/BufferData",[],function(){return function(f,d){this.data=f;this.target=d;this.glBuffer=null;this._dataUsage="StaticDraw";this._dataNeedsRefresh=!1}});
define("goo/renderer/Util",[],function(){function f(){}f.getByteSize=function(d){switch(d){case "Byte":return 1;case "UnsignedByte":return 1;case "Short":return 2;case "UnsignedShort":return 2;case "Int":return 4;case "HalfFloat":return 2;case "Float":return 4;case "Double":return 8;default:throw"Unknown type: "+d;}};f.checkGLError=function(d){for(var b=d.getError(),a=!1;b!==d.NO_ERROR;){a=!0;if(b===d.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");
else if(b===d.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===d.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===d.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");
else if(b===d.OUT_OF_MEMORY)throw"There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.";b=d.getError()}if(a)throw"Stopping due to error";};f.isPowerOfTwo=function(d){return(d&d-1)===0};f.nearestPowerOfTwo=function(d){return Math.pow(2,Math.ceil(Math.log(d)/Math.log(2)))};f.clone=function(d){if(d===null||typeof d!=="object")return d;if(d instanceof Uint8Array)return d;if(d instanceof Date){var b=
new Date;b.setTime(d.getTime());return b}if(d instanceof Array){for(var b=[],a=0,c=d.length;a<c;++a)b[a]=f.clone(d[a]);return b}if(d instanceof Object){b={};for(a in d)d.hasOwnProperty(a)&&(b[a]=f.clone(d[a]));return b}throw Error("Unable to copy obj! Its type isn't supported.");};return f});
define("goo/renderer/BufferUtils",[],function(){function f(){}f.createIndexBuffer=function(d,b){var a;if(b<256)a=new Uint8Array(d);else if(b<65536)a=new Uint16Array(d);else throw Error("Maximum number of vertices is 65535. Got: "+b);return a};return f});
define("goo/renderer/MeshData",["goo/renderer/BufferData","goo/renderer/Util","goo/renderer/BufferUtils","goo/math/Vector3"],function(f,d,b,a){function c(e,a,g){this.attributeMap=e;this.vertexCount=a!==void 0?a:0;this.indexCount=g!==void 0?g:0;this.primitiveCounts=[0];this.indexData=this.vertexData=null;this.dataViews={};this.indexLengths=null;this.indexModes=["Triangles"];this.type=c.MESH;this.rebuildData(this.vertexCount,this.indexCount)}function e(e){for(var c={},a=0;a<e.length;a++){var g=e[a];
if(k[g]!==void 0)c[g]=d.clone(k[g]);else throw"No default attribute named: "+g;}return c}var g=window.Uint8ClampedArray;c.MESH=0;c.SKINMESH=1;c.prototype.rebuildData=function(e,c,a){var g={},b=null;if(a){for(var d in this.attributeMap){var f=this.dataViews[d];f&&(g[d]=f)}if(this.indexData)b=this.indexData.data}this.rebuildVertexData(e);this.rebuildIndexData(c);if(a){for(d in this.attributeMap)if(e=g[d])f=this.dataViews[d],f.set(e);b&&this.indexData.data.set(b)}};c.prototype.rebuildVertexData=function(e){if(!isNaN(e))this._vertexCountStore=
this.vertexCount=e;if(this.vertexCount>0){var e=0,c;for(c in this.attributeMap){var a=this.attributeMap[c];e+=d.getByteSize(a.type)*a.count}this.vertexData=new f(new ArrayBuffer(e*this.vertexCount),"ArrayBuffer");this.generateAttributeData()}};c.prototype.rebuildIndexData=function(e){if(e!==void 0)this.indexCount=e;if(this.indexCount>0)e=b.createIndexBuffer(this.indexCount,this.vertexCount),this.indexData=new f(e,"ElementArrayBuffer")};c.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=
!0};c.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1};c.prototype.getPrimitiveCount=function(e){return e>=0&&e<this.primitiveCounts.length?this.primitiveCounts[e]:0};c.prototype.getPrimitiveVertices=function(e,g,b){var d=this.getPrimitiveCount(g);if(e>=d||e<0)throw Error("Invalid primitiveIndex '"+e+"'.  Count is "+d);d=c.getVertexCount(this.indexModes[g]);if(!b||b.length<d)b=[];for(var f=this.getAttributeBuffer(c.POSITION),l=0;l<d;l++){b[l]||(b[l]=new a);
var k=this.getIndexBuffer()?this.getIndexBuffer()[this.getVertexIndex(e,l,g)]:this.getVertexIndex(e,l,g);b[l].x=f[k*3+0];b[l].y=f[k*3+1];b[l].z=f[k*3+2]}return b};c.prototype.getVertexIndex=function(e,a,g){for(var b=0,d=0;d<g;d++)b+=this.indexLengths[d];switch(this.indexModes[g]){case "Triangles":b+=e*3+a;break;case "TriangleStrip":b+=e+a;break;case "TriangleFan":b+=a===0?0:e+a;break;case "Points":b+=e;break;case "Lines":b+=e*2+a;break;case "LineStrip":case "LineLoop":b+=e+a;break;default:return c.logger.warning("unimplemented index mode: "+
this.getIndexMode(0)),-1}return b};c.prototype.getTotalPrimitiveCount=function(){for(var e=0,c=0,a=this.primitiveCounts.length;c<a;c++)e+=this.primitiveCounts[c];return e};c.prototype.updatePrimitiveCounts=function(){var e=this.indexData?this.indexData.data.length:this.vertexCount,a=this.getSectionCount();if(this.primitiveCounts.length!==a)this.primitiveCounts=[];for(var g=0;g<a;g++){var b=c.getPrimitiveCount(this.indexModes[g],this.indexLengths?this.indexLengths[g]:e);this.primitiveCounts[g]=b}};
c.getPrimitiveCount=function(e,c){switch(e){case "Triangles":return c/3;case "TriangleFan":case "TriangleStrip":return c-2;case "Lines":return c/2;case "LineStrip":return c-1;case "LineLoop":return c;case "Points":return c}throw Error("unimplemented index mode: "+e);};c.getVertexCount=function(e){switch(e){case "Triangles":case "TriangleFan":case "TriangleStrip":return 3;case "Lines":case "LineStrip":case "LineLoop":return 2;case "Points":return 1}throw Error("unimplemented index mode: "+e);};var l=
{Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:g,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array,Double:Float64Array};c.prototype.generateAttributeData=function(){var e=this.vertexData.data,c,a=0,g;for(g in this.attributeMap){c=this.attributeMap[g];c.offset=a;var b=this.vertexCount*c.count;a+=b*d.getByteSize(c.type);var f=l[c.type];if(f)c=new f(e,c.offset,b);else throw"Unsupported DataType: "+c.type;this.dataViews[g]=c}};c.prototype.makeInterleavedData=
function(){var e=0,c=0,a;for(a in this.attributeMap){var g=this.attributeMap[a];g.offset=e;e+=g.count*d.getByteSize(g.type)}var b=new f(new ArrayBuffer(e*this.vertexCount),this.vertexData.target);b._dataUsage=this.vertexData._dataUsage;b._dataNeedsRefresh=!0;var l=new DataView(b.data);for(a in this.attributeMap){var k=this.dataViews[a],g=this.attributeMap[a];g.stride=e;for(var c=g.offset,r=g.count,p=d.getByteSize(g.type),g=this.getDataMethod(g.type),g=l[g],v=0;v<this.vertexCount;v++)for(var u=0;u<
r;u++)g.apply(l,[c+e*v+u*p,k[v*r+u],!0])}this.vertexData=b};c.prototype.getDataMethod=function(e){switch(e){case "Byte":return"setInt8";case "UnsignedByte":return"setUInt8";case "Short":return"setInt16";case "UnsignedShort":return"setUInt16";case "Int":return"setInt32";case "HalfFloat":return"setInt16";case "Float":return"setFloat32";case "Double":return"setFloat64"}};c.prototype.getAttributeBuffer=function(e){return this.dataViews[e]};c.prototype.getIndexData=function(){return this.indexData};c.prototype.getIndexBuffer=
function(){return this.indexData!==null?this.indexData.data:null};c.prototype.getIndexLengths=function(){return this.indexLengths};c.prototype.getIndexModes=function(){return this.indexModes};c.prototype.resetVertexCount=function(){this.vertexCount=this.vertexCountStore};c.POSITION="POSITION";c.NORMAL="NORMAL";c.COLOR="COLOR";c.TANGENT="TANGENT";c.TEXCOORD0="TEXCOORD0";c.TEXCOORD1="TEXCOORD1";c.TEXCOORD2="TEXCOORD2";c.TEXCOORD3="TEXCOORD3";c.WEIGHTS="WEIGHTS";c.JOINTIDS="JOINTIDS";c.createAttribute=
function(e,c,a){return{count:e,type:c,stride:0,offset:0,normalized:a!==void 0?a:!1}};var k={POSITION:c.createAttribute(3,"Float"),NORMAL:c.createAttribute(3,"Float"),COLOR:c.createAttribute(4,"Float"),TANGENT:c.createAttribute(4,"Float"),TEXCOORD0:c.createAttribute(2,"Float"),TEXCOORD1:c.createAttribute(2,"Float"),TEXCOORD2:c.createAttribute(2,"Float"),TEXCOORD3:c.createAttribute(2,"Float"),WEIGHTS:c.createAttribute(4,"Float"),JOINTIDS:c.createAttribute(4,"Short")};c.defaultMap=function(c){return c===
void 0?e(Object.keys(k)):e(c)};return c});
define("goo/renderer/bounds/BoundingSphere",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/renderer/MeshData"],function(f,d,b){function a(){d.call(this);this.radius=1;this.vec=new f}a.prototype=Object.create(d.prototype);a.prototype.constructor=a;a.prototype.computeFromPoints=function(c){var e=this.min,a=this.max,b=this.vec;e.setd(Infinity,Infinity,Infinity);a.setd(-Infinity,-Infinity,-Infinity);for(var d,f,h,j=0;j<c.length;j+=3)d=c[j+0],f=c[j+1],h=c[j+2],e.x=d<e.x?d:e.x,e.y=f<e.y?
f:e.y,e.z=h<e.z?h:e.z,a.x=d>a.x?d:a.x,a.y=f>a.y?f:a.y,a.z=h>a.z?h:a.z;e=a.addv(e).div(2);for(j=a=0;j<c.length;j+=3)b.setd(c[j],c[j+1],c[j+2]),d=b.subv(e).lengthSquared(),d>a&&(a=d);this.radius=Math.sqrt(a);this.center.setv(e)};a.prototype.computeFromPrimitives=function(c,e,a,d,k){if(!(k-d<=0)){for(var i=[],h=[],j=b.getVertexCount(c.indexModes[e]),n=0;d<k;d++)for(var h=c.getPrimitiveVertices(a[d],e,h),o=0;o<j;o++)i[n++]=(new f).set(h[o]);this.averagePoints(i)}};a.prototype.averagePoints=function(c){this.center.set(c[0]);
for(var e=1;e<c.length;e++)this.center.add(c[e]);this.center.mul(1/c.length);for(var a=0,e=0;e<c.length;e++){var b=f.sub(c[e],this.center,this.vec).lengthSquared();b>a&&(a=b)}this.radius=Math.sqrt(a)+1.0E-5};a.prototype.transform=function(c,e){e===null&&(e=new a);c.applyForward(this.center,e.center);e.radius=Math.abs(this._maxAxis(c.scale)*this.radius);return e};a.prototype.whichSide=function(c){var e=c.normal.data,a=this.center.data,c=e[0]*a[0]+e[1]*a[1]+e[2]*a[2]-c.constant;return c<-this.radius?
d.Inside:c>this.radius?d.Outside:d.Intersects};a.prototype._pseudoDistance=function(c,e){return c.normal.x*e.x+c.normal.y*e.y+c.normal.z*e.z-c.constant};a.prototype._maxAxis=function(c){return Math.max(Math.abs(c.x),Math.max(Math.abs(c.y),Math.abs(c.z)))};a.prototype.toString=function(){var c=Math.round(this.center.x*10)/10,e=Math.round(this.center.y*10)/10,a=Math.round(this.center.z*10)/10,b=Math.round(this.radius*10)/10;return"["+c+","+e+","+a+"] - "+b};a.prototype.intersectsRay=function(c){if(!this.center)return!1;
var e=(new f).copy(c.origin).sub(this.center),a=e.dot(e)-this.radius*this.radius;if(a<=0)return!0;c=c.direction.dot(e);return c>=0?!1:c*c>=a};a.prototype.intersectsRayWhere=function(c){var e=(new f).copy(c.origin).sub(this.center),a=e.dot(e)-this.radius*this.radius;if(a<=0)return e=c.direction.dot(e),a=Math.sqrt(e*e-a),e=[a-e],c=[(new f).copy(c.direction).mul(e[0]).add(c.origin)],{distances:e,points:c};e=c.direction.dot(e);if(e>=0)return null;a=e*e-a;if(a<0)return null;else if(a>=1.0E-5)return a=
Math.sqrt(a),e=[-e-a,-e+a],c=[(new f).copy(c.direction).mul(e[0]).add(c.origin),(new f).copy(c.direction).mul(e[1]).add(c.origin)],{distances:e,points:c};e=[-e];c=[(new f).copy(c.direction).mul(e[0]).add(c.origin)];return{distances:e,points:c}};return a});
define("goo/math/Matrix",["goo/math/MathUtils"],function(f){function d(b,a){this.rows=b||0;this.cols=a||0;this.data=new Float32Array(this.rows*this.cols)}d.prototype.setupAliases=function(b){for(var a=this,c=0;c<b.length;c++)(function(e){for(var g=0;g<b[e].length;g++)Object.defineProperty(a,b[e][g],{get:function(){return this.data[e]},set:function(c){this.data[e]=c}});Object.defineProperty(a,c,{get:function(){return this.data[e]},set:function(c){this.data[e]=c}})})(c)};d.add=function(b,a,c){var e=
b.rows,g=b.cols;c||(c=new d(e,g));if(a instanceof d){if(a.rows!==e||a.cols!==g||c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)c.data[e]=b.data[e]+a.data[e]}else{if(c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)c.data[e]=b.data[e]+a}return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){var e=
b.rows,g=b.cols;c||(c=new d(e,g));if(a instanceof d){if(a.rows!==e||a.cols!==g||c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)c.data[e]=b.data[e]-a.data[e]}else{if(c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)c.data[e]=b.data[e]-a}return c};d.prototype.sub=function(b){return d.sub(this,b,this)};d.mul=function(b,a,c){var e=
b.rows,g=b.cols;c||(c=new d(e,g));if(a instanceof d){if(a.rows!==e||a.cols!==g||c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)c.data[e]=b.data[e]*a.data[e]}else{if(c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)c.data[e]=b.data[e]*a}return c};d.prototype.mul=function(b){return d.mul(this,b,this)};d.div=function(b,a,c){var e=
b.rows,g=b.cols;c||(c=new d(e,g));if(a instanceof d){if(a.rows!==e||a.cols!==g||c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)c.data[e]=b.data[e]/a.data[e]}else{if(c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a=1/a;for(e=0;e<b.data.length;e++)c.data[e]=b.data[e]*a}return c};d.prototype.div=function(b){return d.div(this,b,this)};d.combine=function(b,a,
c){var e=b.rows,g=a.cols,f=b.cols=a.rows;c||(c=new d(e,g));if(b.cols!==f||a.rows!==f||c.rows!==e||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(c===b||c===a)return d.copy(d.combine(b,a),c);for(var k=0;k<g;k++)for(var i=k*e,h=0;h<e;h++){for(var j=0,n=0;n<f;n++)j+=b.data[n*b.rows+h]*a.data[k*a.rows+n];c.data[i+h]=j}return c};d.prototype.combine=function(b){return d.combine(this,b,this)};d.transpose=function(b,a){var c=b.cols,e=b.rows;a||(a=new d(c,
e));if(a.rows!==c||a.cols!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(a===b)return d.copy(d.transpose(b),a);for(var g=0;g<e;g++)for(var f=g*c,k=0;k<c;k++)a.data[f+k]=b.data[k*e+g];return a};d.prototype.transpose=function(){return d.transpose(this,this)};d.copy=function(b,a){var c=b.rows,e=b.cols;a||(a=new d(c,e));if(a.rows!==c||a.cols!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(b.data);return a};d.prototype.copy=
function(b){return d.copy(b,this)};d.equals=function(b,a){if(b.rows!==a.rows||b.cols!==a.cols)return!1;for(var c=0;c<b.data.length;c++)if(Math.abs(b.data[c]-a.data[c])>f.EPSILON)return!1;return!0};d.prototype.equals=function(b){return d.equals(this,b)};d.prototype.isOrthogonal=function(){for(var b=0;b<this.cols;b++)for(var a=b+1;a<this.cols;a++){for(var c=b*this.rows,e=a*this.rows,g=0,d=0;d<this.rows;d++)g+=this.data[c+d]*this.data[e+d];if(Math.abs(g)>f.EPSILON)return!1}return!0};d.prototype.isNormal=
function(){for(var b=0;b<this.cols;b++){for(var a=b*this.rows,c=0,e=0;e<this.rows;e++)c+=this.data[a+e]*this.data[a+e];if(Math.abs(c-1)>f.EPSILON)return!1}return!0};d.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};d.prototype.clone=function(){return d.copy(this)};d.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]==="object")if(arguments[0]instanceof d)this.copy(arguments[0]);else for(var b=0;b<arguments[0].length;b++)this.data[b]=arguments[0][b];
else for(b=0;b<arguments.length;b++)this.data[b]=arguments[b];return this};d.prototype.toString=function(){for(var b="",a=0;a<this.cols;a++){var c=a*this.rows;b+="[";for(var e=0;e<this.rows;e++)b+=this.data[c+e],b+=e!==this.rows-1?", ":"";b+=a!==this.cols-1?"], ":"]"}return b};return d});
define("goo/math/Matrix3x3",["goo/math/MathUtils","goo/math/Matrix","goo/math/Vector3"],function(f,d,b){function a(){d.call(this,3,3);arguments.length===0?this.setIdentity():this.set(arguments)}a.prototype=Object.create(d.prototype);a.prototype.setupAliases([["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]);a.IDENTITY=new a(1,0,0,0,1,0,0,0,1);a.add=function(c,e,b){b||(b=new a);e instanceof a?(b.e00=c.e00+e.e00,b.e10=c.e10+e.e10,b.e20=c.e20+e.e20,b.e01=c.e01+e.e01,b.e11=c.e11+
e.e11,b.e21=c.e21+e.e21,b.e02=c.e02+e.e02,b.e12=c.e12+e.e12,b.e22=c.e22+e.e22):(b.e00=c.e00+e,b.e10=c.e10+e,b.e20=c.e20+e,b.e01=c.e01+e,b.e11=c.e11+e,b.e21=c.e21+e,b.e02=c.e02+e,b.e12=c.e12+e,b.e22=c.e22+e);return b};a.prototype.add=function(c){return a.add(this,c,this)};a.sub=function(c,e,b){b||(b=new a);e instanceof a?(b.e00=c.e00-e.e00,b.e10=c.e10-e.e10,b.e20=c.e20-e.e20,b.e01=c.e01-e.e01,b.e11=c.e11-e.e11,b.e21=c.e21-e.e21,b.e02=c.e02-e.e02,b.e12=c.e12-e.e12,b.e22=c.e22-e.e22):(b.e00=c.e00-e,
b.e10=c.e10-e,b.e20=c.e20-e,b.e01=c.e01-e,b.e11=c.e11-e,b.e21=c.e21-e,b.e02=c.e02-e,b.e12=c.e12-e,b.e22=c.e22-e);return b};a.prototype.sub=function(c){return a.sub(this,c,this)};a.mul=function(c,e,b){b||(b=new a);e instanceof a?(b.e00=c.e00*e.e00,b.e10=c.e10*e.e10,b.e20=c.e20*e.e20,b.e01=c.e01*e.e01,b.e11=c.e11*e.e11,b.e21=c.e21*e.e21,b.e02=c.e02*e.e02,b.e12=c.e12*e.e12,b.e22=c.e22*e.e22):(b.e00=c.e00*e,b.e10=c.e10*e,b.e20=c.e20*e,b.e01=c.e01*e,b.e11=c.e11*e,b.e21=c.e21*e,b.e02=c.e02*e,b.e12=c.e12*
e,b.e22=c.e22*e);return b};a.prototype.mul=function(c){return a.mul(this,c,this)};a.div=function(c,e,b){b||(b=new a);e instanceof a?(b.e00=c.e00/e.e00,b.e10=c.e10/e.e10,b.e20=c.e20/e.e20,b.e01=c.e01/e.e01,b.e11=c.e11/e.e11,b.e21=c.e21/e.e21,b.e02=c.e02/e.e02,b.e12=c.e12/e.e12,b.e22=c.e22/e.e22):(e=1/e,b.e00=c.e00*e,b.e10=c.e10*e,b.e20=c.e20*e,b.e01=c.e01*e,b.e11=c.e11*e,b.e21=c.e21*e,b.e02=c.e02*e,b.e12=c.e12*e,b.e22=c.e22*e);return b};a.prototype.div=function(c){return a.div(this,c,this)};a.combine=
function(c,e,b){b||(b=new a);var d=c.data,c=d[0],f=d[3],i=d[6],h=d[1],j=d[4],n=d[7],o=d[2],q=d[5],d=d[8],m=e.data,e=m[0],r=m[3],p=m[6],v=m[1],u=m[4],s=m[7],t=m[2],w=m[5],m=m[8],z=b.data;z[0]=c*e+f*v+i*t;z[3]=c*r+f*u+i*w;z[6]=c*p+f*s+i*m;z[1]=h*e+j*v+n*t;z[4]=h*r+j*u+n*w;z[7]=h*p+j*s+n*m;z[2]=o*e+q*v+d*t;z[5]=o*r+q*u+d*w;z[8]=o*p+q*s+d*m;return b};a.prototype.combine=function(c){return a.combine(this,c,this)};a.transpose=function(c,e){e||(e=new a);var b=c.data,d=e.data;if(e===c){var f=b[3],i=b[6],
h=b[7];d[3]=b[1];d[6]=b[2];d[7]=b[5];d[1]=f;d[2]=i;d[5]=h;return e}d[0]=b[0];d[1]=b[3];d[2]=b[6];d[3]=b[1];d[4]=b[4];d[5]=b[7];d[6]=b[2];d[7]=b[5];d[8]=b[8];return e};a.prototype.transpose=function(){return a.transpose(this,this)};a.invert=function(c,e){e||(e=new a);if(e===c)return d.copy(a.invert(c),e);var b=c.determinant();if(Math.abs(b)<f.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};b=1/b;e.e00=(c.e11*c.e22-c.e12*c.e21)*b;e.e10=(c.e12*c.e20-c.e10*
c.e22)*b;e.e20=(c.e10*c.e21-c.e11*c.e20)*b;e.e01=(c.e02*c.e21-c.e01*c.e22)*b;e.e11=(c.e00*c.e22-c.e02*c.e20)*b;e.e21=(c.e01*c.e20-c.e00*c.e21)*b;e.e02=(c.e01*c.e12-c.e02*c.e11)*b;e.e12=(c.e02*c.e10-c.e00*c.e12)*b;e.e22=(c.e00*c.e11-c.e01*c.e10)*b;return e};a.prototype.invert=function(){return a.invert(this,this)};a.prototype.isOrthogonal=function(){var c;c=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21;if(Math.abs(c)>f.EPSILON)return!1;c=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22;
if(Math.abs(c)>f.EPSILON)return!1;c=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22;return Math.abs(c)>f.EPSILON?!1:!0};a.prototype.isNormal=function(){var c;c=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20;if(Math.abs(c-1)>f.EPSILON)return!1;c=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21;if(Math.abs(c-1)>f.EPSILON)return!1;c=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22;return Math.abs(c-1)>f.EPSILON?!1:!0};a.prototype.isOrthonormal=function(){return this.isOrthogonal()&&
this.isNormal()};a.prototype.determinant=function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)};a.prototype.setIdentity=function(){var c=this.data;c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=1;c[5]=0;c[6]=0;c[7]=0;c[8]=1;return this};a.prototype.applyPost=function(c){var e=c.data,a=this.data,b=e[0],d=e[1],f=e[2];e[0]=a[0]*b+a[3]*d+a[6]*f;e[1]=a[1]*b+a[4]*d+a[7]*f;e[2]=a[2]*b+a[5]*d+a[8]*f;return c};a.prototype.applyPre=
function(c){var e=c.x,a=c.y,b=c.z;c.x=this.e00*e+this.e10*a+this.e20*b;c.y=this.e01*e+this.e11*a+this.e21*b;c.z=this.e02*e+this.e12*a+this.e22*b;return c};a.prototype.multiplyDiagonalPost=function(c,e){var a=c.data[0],b=c.data[1],d=c.data[2],f=this.data,h=e.data;h[0]=a*f[0];h[1]=a*f[1];h[2]=a*f[2];h[3]=b*f[3];h[4]=b*f[4];h[5]=b*f[5];h[6]=d*f[6];h[7]=d*f[7];h[8]=d*f[8];return e};a.prototype.fromAngles=function(a,e,b){var d=Math.cos(a),a=Math.sin(a),f=Math.cos(e),e=Math.sin(e),i=Math.cos(b),b=Math.sin(b);
this.e00=f*i;this.e01=e*a-f*b*d;this.e02=f*b*a+e*d;this.e10=b;this.e11=i*d;this.e12=-i*a;this.e20=-e*i;this.e21=e*b*d+f*a;this.e22=-e*b*a+f*d;return this};a.prototype.rotateX=function(a,e){var b=this.data,d=(e||this).data,f=Math.sin(a),i=Math.cos(a),h=b[3],j=b[4],n=b[5],o=b[6],q=b[7],m=b[8];b!==d&&(d[0]=b[0],d[1]=b[1],d[2]=b[2]);d[3]=h*i+o*f;d[4]=j*i+q*f;d[5]=n*i+m*f;d[6]=o*i-h*f;d[7]=q*i-j*f;d[8]=m*i-n*f;return d};a.prototype.rotateY=function(a,e){var b=this.data,d=(e||this).data,f=Math.sin(a),i=
Math.cos(a),h=b[0],j=b[1],n=b[2],o=b[6],q=b[7],m=b[8];b!==d&&(d[3]=b[3],d[4]=b[4],d[5]=b[5]);d[0]=h*i-o*f;d[1]=j*i-q*f;d[2]=n*i-m*f;d[6]=h*f+o*i;d[7]=j*f+q*i;d[8]=n*f+m*i;return d};a.prototype.rotateZ=function(a,e){var b=this.data,d=(e||this).data,f=Math.sin(a),i=Math.cos(a),h=b[0],j=b[1],n=b[2],o=b[3],q=b[4],m=b[5];b!==d&&(d[6]=b[6],d[7]=b[7],d[8]=b[8]);d[0]=h*i+o*f;d[1]=j*i+q*f;d[2]=n*i+m*f;d[3]=o*i-h*f;d[4]=q*i-j*f;d[5]=m*i-n*f;return d};a.prototype.toAngles=function(a){a||(a=new b);var e=this.data;
e[3]>1-f.EPSILON?(a.y=Math.atan2(e[2],e[8]),a.z=Math.PI/2,a.x=0):e[3]<-1+f.EPSILON?(a.y=Math.atan2(e[2],e[8]),a.z=-Math.PI/2,a.x=0):(a.y=Math.atan2(-e[2],e[0]),a.x=Math.atan2(-e[7],e[4]),a.z=Math.asin(e[1]));return a};a.prototype.fromAngleNormalAxis=function(a,e,b,d){var f=Math.cos(a),i=Math.sin(a),a=1-f,h=e*b*a,j=e*d*a,n=b*d*a,o=e*i,q=b*i;i*=d;this.e00=e*e*a+f;this.e01=h-i;this.e02=j+q;this.e10=h+i;this.e11=b*b*a+f;this.e12=n-o;this.e20=j-q;this.e21=n+o;this.e22=d*d*a+f;return this};a.prototype.lookAt=
function(a,e){var g=new b,d=new b,f=new b;f.copy(a).normalize();g.copy(e).normalize().cross(f).normalize();g.equals(b.ZERO)&&(f.x!==0?g.set(f.y,-f.x,0):g.set(0,f.z,-f.y));d.copy(f).cross(g).normalize();this.e00=g.x;this.e10=g.y;this.e20=g.z;this.e01=d.x;this.e11=d.y;this.e21=d.z;this.e02=f.x;this.e12=f.y;this.e22=f.z;return this};a.prototype.copyQuaternion=function(a){return a.toRotationMatrix(this)};a.prototype.copy=function(a){var e=this.data,a=a.data;e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=a[3];e[4]=
a[4];e[5]=a[5];e[6]=a[6];e[7]=a[7];e[8]=a[8];return this};a.prototype.clone=function(){var c=this.data;return new a(c[0],c[1],c[2],c[3],c[4],c[5],c[4],c[5],c[6])};return a});
define("goo/math/Quaternion",["goo/math/Vector","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(f,d,b,a){function c(){f.call(this,4);arguments.length!==0?this.set(arguments):this.setd(0,0,0,1)}c.prototype=Object.create(f.prototype);c.prototype.setupAliases([["x"],["y"],["z"],["w"]]);c.IDENTITY=new c(0,0,0,1);c.ALLOWED_DEVIANCE=1.0E-8;c.add=function(e,a,b){b||(b=new c);b.data[0]=e.data[0]+a.data[0];b.data[1]=e.data[1]+a.data[1];b.data[2]=e.data[2]+a.data[2];b.data[3]=e.data[3]+
a.data[3];return b};c.sub=function(e,a,b){b||(b=new c);b.data[0]=e.data[0]-a.data[0];b.data[1]=e.data[1]-a.data[1];b.data[2]=e.data[2]-a.data[2];b.data[3]=e.data[3]-a.data[3];return b};c.mul=function(e,a,b){b||(b=new c);b.data[0]=e.data[0]*a.data[0];b.data[1]=e.data[1]*a.data[1];b.data[2]=e.data[2]*a.data[2];b.data[3]=e.data[3]*a.data[3];return b};c.div=function(a,b,d){d||(d=new c);var f=!0;d.data[0]=(f&=b.data[0]<0||b.data[0]>0)?a.data[0]/b.data[0]:0;d.data[1]=(f&=b.data[1]<0||b.data[1]>0)?a.data[1]/
b.data[1]:0;d.data[2]=(f&=b.data[2]<0||b.data[2]>0)?a.data[2]/b.data[2]:0;d.data[3]=(f&=b.data[3]<0||b.data[3]>0)?a.data[3]/b.data[3]:0;f===!1&&console.warn("[Quaternion.div] Attempted to divide by zero!");return d};c.scalarAdd=function(a,b,d){d||(d=new c);d.data[0]=a.data[0]+b;d.data[1]=a.data[1]+b;d.data[2]=a.data[2]+b;d.data[3]=a.data[3]+b;return d};c.scalarSub=function(a,b,d){d||(d=new c);d.data[0]=a.data[0]-b;d.data[1]=a.data[1]-b;d.data[2]=a.data[2]-b;d.data[3]=a.data[3]-b;return d};c.scalarMul=
function(a,b,d){d||(d=new c);d.data[0]=a.data[0]*b;d.data[1]=a.data[1]*b;d.data[2]=a.data[2]*b;d.data[3]=a.data[3]*b;return d};c.scalarDiv=function(a,b,d){d||(d=new c);var f=!0,b=(f&=b<0||b>0)?1/b:0;d.data[0]=a.data[0]*b;d.data[1]=a.data[1]*b;d.data[2]=a.data[2]*b;d.data[3]=a.data[3]*b;f===!1&&console.warn("[Quaternion.scalarDiv] Attempted to divide by zero!");return d};c.slerp=function(a,c,b,d){if(b===0)return d.setv(a);else if(b===1)return d.setv(c);if(a.equals(c))return d.setv(a);var f=a.dot(c);
d.setv(c);f<0&&(d.negate(),f=-f);var c=1-b,h=b;1-f>0.1&&(f=Math.acos(f),h=1/Math.sin(f),c=Math.sin((1-b)*f)*h,h*=Math.sin(b*f));d.setd(c*a.data[0]+h*d.data[0],c*a.data[1]+h*d.data[1],c*a.data[2]+h*d.data[2],c*a.data[3]+h*d.data[3]);return d};c.prototype.negate=function(){this.x*=-1;this.y*=-1;this.z*=-1;this.w*=-1;return this};c.prototype.add=function(a){return c.add(this,a,this)};c.prototype.sub=function(a){return c.sub(this,a,this)};c.prototype.mul=function(a){return c.mul(this,a,this)};c.prototype.div=
function(a){return c.div(this,a,this)};c.prototype.scalarAdd=function(a){return c.scalarAdd(this,a,this)};c.prototype.scalarSub=function(a){return c.scalarSub(this,a,this)};c.prototype.scalarMul=function(a){return c.scalarMul(this,a,this)};c.prototype.scalarDiv=function(a){return c.scalarDiv(this,a,this)};c.prototype.slerp=function(a,b){var d=(new c).copy(a);c.slerp(this,a,b,d);this.copy(d);return this};c.prototype.fromRotationMatrix=function(a){var c=a.e00+a.e11+a.e22,b,d,f;if(c>=0){var h=Math.sqrt(c+
1);f=0.5*h;h=0.5/h;c=(a.e21-a.e12)*h;b=(a.e02-a.e20)*h;d=(a.e10-a.e01)*h}else a.e00>a.e11&&a.e00>a.e22?(h=Math.sqrt(1+a.e00-a.e11-a.e22),c=h*0.5,h=0.5/h,b=(a.e10+a.e01)*h,d=(a.e02+a.e20)*h,f=(a.e21-a.e12)*h):a.e11>a.e22?(h=Math.sqrt(1+a.e11-a.e00-a.e22),b=h*0.5,h=0.5/h,c=(a.e10+a.e01)*h,d=(a.e21+a.e12)*h,f=(a.e02-a.e20)*h):(h=Math.sqrt(1+a.e22-a.e00-a.e11),d=h*0.5,h=0.5/h,c=(a.e02+a.e20)*h,b=(a.e21+a.e12)*h,f=(a.e10-a.e01)*h);return this.set(c,b,d,f)};c.prototype.toRotationMatrix=function(a){a||(a=
new b);var c=this.magnitudeSquared(),c=c>0?2/c:0,d=this.data,f=d[0]*c,i=d[1]*c,h=d[2]*c,c=d[0]*f,j=d[0]*i,n=d[0]*h;f*=d[3];var o=d[1]*i,q=d[1]*h;i*=d[3];var m=d[2]*h,d=d[3]*h,h=a.data;h[0]=1-(o+m);h[1]=j+d;h[2]=n-i;h[3]=j-d;h[4]=1-(c+m);h[5]=q+f;h[6]=n+i;h[7]=q-f;h[8]=1-(c+o);return a};c.prototype.fromVectorToVector=function(e,b){var f=e.length()*b.length();if(Math.abs(f)>a.EPSILON){var k=new d,i=e.dot(b)/f,f=Math.acos(Math.max(-1,Math.min(i,1)));e.cross(b,k);i<0&&k.length()<a.EPSILON&&(i=Math.abs(e.x)>
Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?0:2:Math.abs(e.y)>Math.abs(e.z)?1:2,k.setValue(i,-e[(i+1)%3]),k.setValue((i+1)%3,e[i]),k.setValue((i+2)%3,0));return this.fromAngleAxis(f,k)}else return this.set(c.IDENTITY)};c.prototype.normalize=function(){var a=1/this.magnitude();return this.set(this.x*a,this.y*a,this.z*a,this.w*a)};c.prototype.magnitude=function(){var a=this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3];return a===1?1:Math.sqrt(a)};
c.prototype.magnitudeSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3]};c.prototype.fromAngleAxis=function(a,c){var b=(new d(c)).normalize();return this.fromAngleNormalAxis(a,b)};c.prototype.fromAngleNormalAxis=function(e,b){if(b.equals(d.ZERO))return this.set(c.IDENTITY);var f=0.5*e,k=a.sin(f),f=a.cos(f),i=k*b.getX(),h=k*b.getY();k*=b.getZ();return this.set(i,h,k,f)};c.prototype.toAngleAxis=function(a){var b=this.x*this.x+
this.y*this.y+this.z*this.z,d;if(Math.abs(b)<=c.ALLOWED_DEVIANCE){if(d=0,a!==null)a.x=1,a.y=0,a.z=0}else if(d=2*Math.acos(this.w),a!==null)b=1/Math.sqrt(b),a.x=this.x*b,a.y=this.y*b,a.z=this.z*b;return d};c.prototype.equals=function(a){return this===a?!0:!a instanceof c?!1:Math.abs(this.data[0]-a.data[0])<c.ALLOWED_DEVIANCE&&Math.abs(this.data[1]-a.data[1])<c.ALLOWED_DEVIANCE&&Math.abs(this.data[2]-a.data[2])<c.ALLOWED_DEVIANCE&&Math.abs(this.data[3]-a.data[3])<c.ALLOWED_DEVIANCE};c.prototype.setd=
function(a,c,b,d){this.data[0]=a;this.data[1]=c;this.data[2]=b;this.data[3]=d;return this};c.prototype.seta=function(a){this.data[0]=a[0];this.data[1]=a[1];this.data[2]=a[2];this.data[3]=a[3];return this};c.prototype.setv=function(a){this.data[0]=a.data[0];this.data[1]=a.data[1];this.data[2]=a.data[2];this.data[3]=a.data[3];return this};return c});
define("goo/shapes/Box",["goo/renderer/MeshData"],function(f){function d(b,a,c,e,d){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=c!==void 0?c*0.5:0.5;this.tileX=e||1;this.tileY=d||1;b=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]);f.call(this,b,24,36);this.rebuild()}d.prototype=Object.create(f.prototype);d.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,c=this.zExtent,e=this.tileX,d=this.tileY,l=[-b,-a,-c,b,-a,-c,b,a,-c,-b,a,-c,b,-a,c,-b,-a,c,b,
a,c,-b,a,c],k=[];(function(a){for(var c=0;c<a.length;c++){var e=a[c]*3;k.push(l[e]);k.push(l[e+1]);k.push(l[e+2])}})([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]);this.getAttributeBuffer(f.POSITION).set(k);var i=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],h=[];(function(){for(var a=0;a<i.length/3;a++)for(var c=0;c<4;c++){var e=a*3;h.push(i[e]);h.push(i[e+1]);h.push(i[e+2])}})();this.getAttributeBuffer(f.NORMAL).set(h);b=[];for(a=0;a<6;a++)b.push(e),b.push(0),b.push(0),b.push(0),b.push(0),b.push(d),
b.push(e),b.push(d);this.getAttributeBuffer(f.TEXCOORD0).set(b);this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]);return this};return d});
define("goo/shapes/Quad",["goo/renderer/MeshData"],function(f){function d(b,a,c,e){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.tileX=c||1;this.tileY=e||1;b=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]);f.call(this,b,4,6);this.rebuild()}d.prototype=Object.create(f.prototype);d.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,c=this.tileX,e=this.tileY;this.getAttributeBuffer(f.POSITION).set([-b,-a,0,-b,a,0,b,a,0,b,-a,0]);this.getAttributeBuffer(f.NORMAL).set([0,
0,1,0,0,1,0,0,1,0,0,1]);this.getAttributeBuffer(f.TEXCOORD0).set([0,0,0,e,c,e,c,0]);this.getIndexBuffer().set([0,3,1,1,3,2]);return this};return d});
define("goo/util/Enum",[],function(){function f(a,c){Object.getOwnPropertyNames(c).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(c,e))});return a}function d(a,c){this.name=a;c&&f(this,c);Object.freeze(this)}function b(a){arguments.length===1&&a!==null&&typeof a==="object"?Object.keys(a).forEach(function(c){this[c]=new d(c,a[c])},this):Array.prototype.forEach.call(arguments,function(a){this[a]=new d(a)},this);Object.freeze(this)}d.prototype=Object.create(null);d.prototype.constructor=
d;d.prototype.toString=function(){return"|"+this.name+"|"};Object.freeze(d.prototype);b.prototype.symbols=function(){return Object.keys(this).map(function(a){return this[a]},this)};b.prototype.contains=function(a){return!a instanceof d?!1:this[a.name]===a};return b});
define("goo/shapes/Sphere",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(f,d,b,a){function c(a,e,b,d){this.zSamples=a!==void 0?a:8;this.radialSamples=e!==void 0?e:8;this.radius=b!==void 0?b:0.5;this.textureMode=d!==void 0?d:c.TextureModes.Polar;this.viewInside=!1;a=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]);f.call(this,a,(this.zSamples-2)*(this.radialSamples+1)+2,6*(this.zSamples-2)*this.radialSamples);this.rebuild()}function e(a,c,e){a[e*3+0]=a[c*
3+0];a[e*3+1]=a[c*3+1];a[e*3+2]=a[c*3+2]}c.prototype=Object.create(f.prototype);c.prototype.rebuild=function(){for(var d=this.getAttributeBuffer(f.POSITION),l=this.getAttributeBuffer(f.NORMAL),k=this.getAttributeBuffer(f.TEXCOORD0),i=this.getIndexBuffer(),h=1/this.radialSamples,j=2/this.zSamples,n=[],o=[],q=0;q<this.radialSamples;q++){var m=a.TWO_PI*h*q;o[q]=Math.cos(m);n[q]=Math.sin(m)}n[this.radialSamples]=n[0];o[this.radialSamples]=o[0];for(var m=0,r=new b,p=new b,v=new b,u=1;u<this.zSamples-1;u++){var s=
a.HALF_PI*(-1+j*u),t=Math.sin(s),q=this.radius*t,w=p.set(0,0,0);w.z+=q;for(var z=Math.sqrt(Math.abs(this.radius*this.radius-q*q)),y,A=m,q=0;q<this.radialSamples;q++){var x=q*h;y=v.set(o[q],n[q],0);b.mul(y,z,r);d[m*3+0]=w.x+r.x;d[m*3+1]=w.y+r.y;d[m*3+2]=w.z+r.z;y=r.set(d[m*3+0],d[m*3+1],d[m*3+2]);y.normalize();this.viewInside?(l[m*3+0]=-y.x,l[m*3+1]=-y.y,l[m*3+2]=-y.z):(l[m*3+0]=y.x,l[m*3+1]=y.y,l[m*3+2]=y.z);this.textureMode===c.TextureModes.Linear?(k[m*2+0]=x,k[m*2+1]=0.5*(t+1)):this.textureMode===
c.TextureModes.Projected?(k[m*2+0]=x,k[m*2+1]=a.HALF_PI+Math.asin(t)/Math.PI):this.textureMode===c.TextureModes.Polar&&(x=(a.HALF_PI-Math.abs(s))/Math.PI,y=x*n[q]+0.5,k[m*2+0]=x*o[q]+0.5,k[m*2+1]=y);m++}e(d,A,m);e(l,A,m);this.textureMode===c.TextureModes.Linear?(k[m*2+0]=1,k[m*2+1]=0.5*(t+1)):this.textureMode===c.TextureModes.Projected?(k[m*2+0]=1,k[m*2+1]=a.INV_PI*(a.HALF_PI+Math.asin(t))):this.textureMode===c.TextureModes.Polar&&(x=(a.HALF_PI-Math.abs(s))/Math.PI,k[m*2+0]=x+0.5,k[m*2+1]=0.5);m++}d[m*
3+0]=0;d[m*3+1]=0;d[m*3+2]=-this.radius;this.viewInside?(l[m*3+0]=0,l[m*3+1]=0,l[m*3+2]=1):(l[m*3+0]=0,l[m*3+1]=0,l[m*3+2]=-1);this.textureMode===c.TextureModes.Polar?(k[m*2+0]=0.5,k[m*2+1]=0.5):(k[m*2+0]=0.5,k[m*2+1]=0);m++;d[m*3+0]=0;d[m*3+1]=0;d[m*3+2]=this.radius;this.viewInside?(l[m*3+0]=0,l[m*3+1]=0,l[m*3+2]=-1):(l[m*3+0]=0,l[m*3+1]=0,l[m*3+2]=1);this.textureMode===c.TextureModes.Polar?(k[m*2+0]=0.5,k[m*2+1]=0.5):(k[m*2+0]=0.5,k[m*2+1]=1);for(l=u=d=0;u<this.zSamples-3;u++){k=l;h=k+1;l+=this.radialSamples+
1;j=l;n=j+1;for(m=0;m<this.radialSamples;m++)this.viewInside?(i[d++]=k++,i[d++]=j,i[d++]=h,i[d++]=h++,i[d++]=j++,i[d++]=n++):(i[d++]=k++,i[d++]=h,i[d++]=j,i[d++]=h++,i[d++]=n++,i[d++]=j++)}for(m=0;m<this.radialSamples;m++)this.viewInside?(i[d++]=m,i[d++]=m+1,i[d++]=this.vertexCount-2):(i[d++]=m,i[d++]=this.vertexCount-2,i[d++]=m+1);u=(this.zSamples-3)*(this.radialSamples+1);for(m=0;m<this.radialSamples;m++)this.viewInside?(i[d++]=m+u,i[d++]=this.vertexCount-1,i[d++]=m+1+u):(i[d++]=m+u,i[d++]=m+1+
u,i[d++]=this.vertexCount-1);return this};c.TextureModes=new d("Linear","Projected","Polar");return c});
define("goo/addons/cannon/systems/CannonjsSystem","goo/entities/systems/System,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/math/Quaternion,goo/shapes/Box,goo/shapes/Quad,goo/shapes/Sphere,goo/renderer/MeshData".split(","),function(f,d,b,a,c,e,g,l){function k(c){f.call(this,"CannonjsSystem",["CannonjsComponent","TransformComponent"]);var c=c||{},e=this.world=new i.World;e.gravity.y=-9.82;e.broadphase=new i.NaiveBroadphase;this.stepFrequency=c.stepFrequency||60;this.quat=
new a}var i=window.CANNON;k.prototype=Object.create(f.prototype);k.prototype.createShape=function(a){var f=a.cannonjsComponent,k=a.transformComponent,o;if(a.meshDataComponent)if(a=a.meshDataComponent,f.useBounds)a.computeBoundFromPoints(),f=a.modelBound,f instanceof d?o=new i.Box(new i.Vec3(f.xExtent,f.yExtent,f.zExtent)):f instanceof b&&(o=new i.Sphere(f.radius));else if(o=a.meshData,o instanceof c)o=new i.Box(new i.Vec3(o.xExtent,o.yExtent,o.zExtent));else if(o instanceof g)o=new i.Sphere(o.radius);
else if(o instanceof e)o=new i.Plane;else{for(var a=[],k=[],q=o.getAttributeBuffer(l.POSITION),m=o.getIndexBuffer(),f=0;f<o.vertexCount*3;f+=3)a.push(new i.Vec3(q[f],q[f+1],q[f+2]));for(f=0;f<o.indexCount;f+=3)k.push([m[f],m[f+1],m[f+2]]);o=new i.ConvexPolyhedron(a,k)}else{a=k.children;for(f=0;f<a.length;f++)if(m=a[f].entity,k=this.createShape(m))o||(o=new i.Compound),q=m.transformComponent.transform.translation,m=m.transformComponent.transform.rotation,q=new i.Vec3(q.x,q.y,q.z),this.quat.fromRotationMatrix(m),
m=new i.Quaternion(this.quat.x,this.quat.y,this.quat.z,this.quat.w),o.addChild(k,q,m)}return o};k.prototype.inserted=function(a){var c=a.cannonjsComponent,e=a.transformComponent,b=this.createShape(a);b?(a=new i.RigidBody(c.mass,b),a.position.set(e.transform.translation.x,e.transform.translation.y,e.transform.translation.z),this.quat.fromRotationMatrix(e.transform.rotation),a.quaternion.set(this.quat.x,this.quat.y,this.quat.z,this.quat.w),c.body=a,this.world.add(a)):a.clearComponent("CannonjsComponent")};
k.prototype.deleted=function(a){(a=a.cannonjsComponent)&&this.world.remove(a.body)};k.prototype.process=function(a){this.world.step(1/this.stepFrequency);for(var c=0;c<a.length;c++){var e=a[c],b=e.cannonjsComponent,d=b.body.position;e.transformComponent.transform.translation.x=d.x;e.transformComponent.transform.translation.y=d.y;e.transformComponent.transform.translation.z=d.z;b=b.body.quaternion;this.quat.set(b.x,b.y,b.z,b.w);e.transformComponent.transform.rotation.copyQuaternion(this.quat);e.transformComponent.setUpdated()}};
return k});define("goo/addons/soundmanager2/components/SoundManager2Component",["goo/entities/components/Component"],function(f){function d(b){this.type="SoundManager2Component";this.settings=b||{};this.sounds={}}d.prototype=Object.create(f.prototype);d.prototype.addSound=function(b,a){this.sounds[b]=a};d.prototype.playSound=function(b){this.sounds[b].soundObject.play()};return d});
define("goo/addons/soundmanager2/systems/SoundManager2System",["goo/entities/systems/System"],function(f){function d(){f.call(this,"SoundManager2System",["SoundManager2Component","TransformComponent"]);this.isReady=!1;b.bind(this).setup({url:"swf",onready:function(){this.isReady=!0},ontimeout:function(){console.warn("Failed to load soundmanager")}})}var b=window.soundManager;d.prototype=Object.create(f.prototype);d.prototype.inserted=function(a){for(var a=a.soundManager2Component,c=0;c<a.sounds.length;c++){var e=
a.sounds[c],d=b.createSound(e);e.soundObject=d}};d.prototype.deleted=function(){};d.prototype.process=function(){};return d});
define("goo/entities/components/MeshDataComponent",["goo/renderer/bounds/BoundingSphere","goo/entities/components/Component"],function(f,d){function b(a){this.type="MeshDataComponent";this.meshData=a;this.modelBound=new f;this.autoCompute=!0}b.prototype=Object.create(d.prototype);b.prototype.setModelBound=function(a,c){this.modelBound=a;this.autoCompute=c};b.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&this.modelBound!==null){var a=this.meshData.getAttributeBuffer("POSITION");
if(a!==void 0)this.modelBound.computeFromPoints(a),this.autoCompute=!1}};return b});define("goo/entities/components/MeshRendererComponent",["goo/entities/components/Component"],function(f){function d(){this.type="MeshRendererComponent";this.materials=[];this.worldBound=null;this.cullMode="Dynamic";this.receiveShadows=this.castShadows=!1}d.prototype=Object.create(f.prototype);d.prototype.updateBounds=function(b,a){this.worldBound=b.transform(a,this.worldBound)};return d});
define("goo/renderer/ShaderCall",[],function(){function f(a,c,e){this.context=a;this.location=c;if(e)switch(e){case "float":this.typeCall=this.uniform1f;break;case "bool":case "int":case "integer":case "sampler2D":case "sampler3D":case "samplerCube":this.typeCall=this.uniform1i;break;case "floatarray":this.typeCall=this.uniform1fv;break;case "intarray":this.typeCall=this.uniform1iv;break;case "vec2":this.typeCall=this.uniform2fv;break;case "vec3":this.typeCall=this.uniform3fv;break;case "vec4":this.typeCall=
this.uniform4fv;break;case "mat2":this.typeCall=this.uniformMatrix2fv;break;case "mat3":this.typeCall=this.uniformMatrix3fv;break;case "mat4":this.typeCall=this.uniformMatrix4fv;break;default:throw"Uniform type not handled: "+e;}}function d(a,c,e){for(e-=1;e>=0;e--)if(a[e]!==c[e])return!1;return!0}function b(a,c){var e=a.length;if(e!==c.length)return!1;for(var b=0;b<e;b++)if(a[b]!==c[b])return!1;return!0}f.prototype.call=function(a){this.typeCall(a)};f.prototype.uniform1f=function(a){if(this.location.value!==
a)this.context.uniform1f(this.location,a),this.location.value=a};f.prototype.uniform1fv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform1fv(this.location,a),this.location.value=a.slice()};f.prototype.uniform1i=function(a){if(this.location.value!==a)this.context.uniform1i(this.location,a),this.location.value=a};f.prototype.uniform1iv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform1iv(this.location,a),this.location.value=a.slice()};
f.prototype.uniform2f=function(a,c){var e=this.location.value;if(!(e!==void 0&&e.length===2&&e[0]===a&&e[1]===c))this.context.uniform2f(this.location,a,c),this.location.value=[a,c]};f.prototype.uniform2fv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform2fv(this.location,a),this.location.value=a.slice()};f.prototype.uniform2i=function(a,c){var e=this.location.value;if(!(e!==void 0&&e.length===2&&e[0]===a&&e[1]===c))this.context.uniform2i(this.location,a,c),this.location.value=
[a,c]};f.prototype.uniform2iv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform2iv(this.location,a),this.location.value=a.slice()};f.prototype.uniform3f=function(a,c,e){var b=this.location.value;if(!(b!==void 0&&b.length===3&&b[0]===a&&b[1]===c&&b[2]===e))this.context.uniform3f(this.location,a,c,e),this.location.value=[a,c,e]};f.prototype.uniform3fv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform3fv(this.location,a),this.location.value=
a.slice()};f.prototype.uniform3i=function(a,c,e){var b=this.location.value;if(!(b!==void 0&&b.length===3&&b[0]===a&&b[1]===c&&b[2]===e))this.context.uniform3i(this.location,a,c,e),this.location.value=[a,c,e]};f.prototype.uniform3iv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform3iv(this.location,a),this.location.value=a.slice()};f.prototype.uniform4f=function(a,c,e,b){var d=this.location.value;if(!(d!==void 0&&d.length===4&&d[0]===a&&d[1]===c&&d[2]===e&&d[3]===
b))this.context.uniform4f(this.location,a,c,e,b),this.location.value=[a,c,e,b]};f.prototype.uniform4fv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform4fv(this.location,a),this.location.value=a.slice()};f.prototype.uniform4i=function(a,c,e,b){var d=this.location.value;if(!(d!==void 0&&d.length===4&&d[0]===a&&d[1]===c&&d[2]===e&&d[3]===b))this.context.uniform4i(this.location,a,c,e,b),this.location.value=[a,c,e,b]};f.prototype.uniform4iv=function(a){var c=this.location.value;
if(!(c!==void 0&&b(a,c)))this.context.uniform4iv(this.location,a),this.location.value=a.slice()};f.prototype.uniformMatrix2fv=function(a,c){c=c===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(d(e.data,a.data,4))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix2fv(this.location,c,a.data)}else this.context.uniformMatrix2fv(this.location,c,a)};f.prototype.uniformMatrix3fv=function(a,c){c=c===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(d(e.data,
a.data,9))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix3fv(this.location,c,a.data)}else this.context.uniformMatrix3fv(this.location,c,a)};f.prototype.uniformMatrix4fv=function(a,c){c=c===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(d(e.data,a.data,16))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix4fv(this.location,c,a.data)}else this.context.uniformMatrix4fv(this.location,c,a)};return f});
define("goo/math/Matrix4x4",["goo/math/MathUtils","goo/math/Matrix"],function(f,d){function b(){d.call(this,4,4);arguments.length===0?this.setIdentity():this.set(arguments)}b.prototype=Object.create(d.prototype);b.prototype.setupAliases([["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]);b.IDENTITY=new b(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);b.add=function(a,c,e){e||(e=new b);c instanceof b?(e.e00=a.e00+c.e00,e.e10=a.e10+c.e10,
e.e20=a.e20+c.e20,e.e30=a.e30+c.e30,e.e01=a.e01+c.e01,e.e11=a.e11+c.e11,e.e21=a.e21+c.e21,e.e31=a.e31+c.e31,e.e02=a.e02+c.e02,e.e12=a.e12+c.e12,e.e22=a.e22+c.e22,e.e32=a.e32+c.e32,e.e03=a.e03+c.e03,e.e13=a.e13+c.e13,e.e23=a.e23+c.e23,e.e33=a.e33+c.e33):(e.e00=a.e00+c,e.e10=a.e10+c,e.e20=a.e20+c,e.e30=a.e30+c,e.e01=a.e01+c,e.e11=a.e11+c,e.e21=a.e21+c,e.e31=a.e31+c,e.e02=a.e02+c,e.e12=a.e12+c,e.e22=a.e22+c,e.e32=a.e32+c,e.e03=a.e03+c,e.e13=a.e13+c,e.e23=a.e23+c,e.e33=a.e33+c);return e};b.prototype.add=
function(a){return b.add(this,a,this)};b.sub=function(a,c,e){e||(e=new b);c instanceof b?(e.e00=a.e00-c.e00,e.e10=a.e10-c.e10,e.e20=a.e20-c.e20,e.e30=a.e30-c.e30,e.e01=a.e01-c.e01,e.e11=a.e11-c.e11,e.e21=a.e21-c.e21,e.e31=a.e31-c.e31,e.e02=a.e02-c.e02,e.e12=a.e12-c.e12,e.e22=a.e22-c.e22,e.e32=a.e32-c.e32,e.e03=a.e03-c.e03,e.e13=a.e13-c.e13,e.e23=a.e23-c.e23,e.e33=a.e33-c.e33):(e.e00=a.e00-c,e.e10=a.e10-c,e.e20=a.e20-c,e.e30=a.e30-c,e.e01=a.e01-c,e.e11=a.e11-c,e.e21=a.e21-c,e.e31=a.e31-c,e.e02=a.e02-
c,e.e12=a.e12-c,e.e22=a.e22-c,e.e32=a.e32-c,e.e03=a.e03-c,e.e13=a.e13-c,e.e23=a.e23-c,e.e33=a.e33-c);return e};b.prototype.sub=function(a){return b.sub(this,a,this)};b.mul=function(a,c,e){e||(e=new b);c instanceof b?(e.e00=a.e00*c.e00,e.e10=a.e10*c.e10,e.e20=a.e20*c.e20,e.e30=a.e30*c.e30,e.e01=a.e01*c.e01,e.e11=a.e11*c.e11,e.e21=a.e21*c.e21,e.e31=a.e31*c.e31,e.e02=a.e02*c.e02,e.e12=a.e12*c.e12,e.e22=a.e22*c.e22,e.e32=a.e32*c.e32,e.e03=a.e03*c.e03,e.e13=a.e13*c.e13,e.e23=a.e23*c.e23,e.e33=a.e33*c.e33):
(e.e00=a.e00*c,e.e10=a.e10*c,e.e20=a.e20*c,e.e30=a.e30*c,e.e01=a.e01*c,e.e11=a.e11*c,e.e21=a.e21*c,e.e31=a.e31*c,e.e02=a.e02*c,e.e12=a.e12*c,e.e22=a.e22*c,e.e32=a.e32*c,e.e03=a.e03*c,e.e13=a.e13*c,e.e23=a.e23*c,e.e33=a.e33*c);return e};b.prototype.mul=function(a){return b.mul(this,a,this)};b.div=function(a,c,e){e||(e=new b);c instanceof b?(e.e00=a.e00/c.e00,e.e10=a.e10/c.e10,e.e20=a.e20/c.e20,e.e30=a.e30/c.e30,e.e01=a.e01/c.e01,e.e11=a.e11/c.e11,e.e21=a.e21/c.e21,e.e31=a.e31/c.e31,e.e02=a.e02/c.e02,
e.e12=a.e12/c.e12,e.e22=a.e22/c.e22,e.e32=a.e32/c.e32,e.e03=a.e03/c.e03,e.e13=a.e13/c.e13,e.e23=a.e23/c.e23,e.e33=a.e33/c.e33):(c=1/c,e.e00=a.e00*c,e.e10=a.e10*c,e.e20=a.e20*c,e.e30=a.e30*c,e.e01=a.e01*c,e.e11=a.e11*c,e.e21=a.e21*c,e.e31=a.e31*c,e.e02=a.e02*c,e.e12=a.e12*c,e.e22=a.e22*c,e.e32=a.e32*c,e.e03=a.e03*c,e.e13=a.e13*c,e.e23=a.e23*c,e.e33=a.e33*c);return e};b.prototype.div=function(a){return b.div(this,a,this)};b.combine=function(a,c,e){e||(e=new b);var d=a.data,a=d[0],f=d[4],k=d[8],i=d[12],
h=d[1],j=d[5],n=d[9],o=d[13],q=d[2],m=d[6],r=d[10],p=d[14],v=d[3],u=d[7],s=d[11],d=d[15],t=c.data,c=t[0],w=t[4],z=t[8],y=t[12],A=t[1],x=t[5],D=t[9],E=t[13],C=t[2],F=t[6],G=t[10],H=t[14],I=t[3],J=t[7],K=t[11],t=t[15],B=e.data;B[0]=a*c+f*A+k*C+i*I;B[4]=a*w+f*x+k*F+i*J;B[8]=a*z+f*D+k*G+i*K;B[12]=a*y+f*E+k*H+i*t;B[1]=h*c+j*A+n*C+o*I;B[5]=h*w+j*x+n*F+o*J;B[9]=h*z+j*D+n*G+o*K;B[13]=h*y+j*E+n*H+o*t;B[2]=q*c+m*A+r*C+p*I;B[6]=q*w+m*x+r*F+p*J;B[10]=q*z+m*D+r*G+p*K;B[14]=q*y+m*E+r*H+p*t;B[3]=v*c+u*A+s*C+d*I;
B[7]=v*w+u*x+s*F+d*J;B[11]=v*z+u*D+s*G+d*K;B[15]=v*y+u*E+s*H+d*t;return e};b.prototype.combine=function(a){return b.combine(this,a,this)};b.transpose=function(a,c){c||(c=new b);var e=a.data,d=c.data;if(c===a){var f=e[4],k=e[8],i=e[12],h=e[9],j=e[13],n=e[14];d[4]=e[1];d[8]=e[2];d[12]=e[3];d[9]=e[6];d[13]=e[7];d[14]=e[11];d[1]=f;d[2]=k;d[3]=i;d[6]=h;d[7]=j;d[11]=n;return c}d[0]=e[0];d[1]=e[4];d[2]=e[8];d[3]=e[12];d[4]=e[1];d[5]=e[5];d[6]=e[9];d[7]=e[13];d[8]=e[2];d[9]=e[6];d[10]=e[10];d[11]=e[14];d[12]=
e[3];d[13]=e[7];d[14]=e[11];d[15]=e[15];return c};b.prototype.transpose=function(){return b.transpose(this,this)};b.invert=function(a,c){c||(c=new b);if(c===a)return d.copy(b.invert(a),c);var e=a.determinant();if(Math.abs(e)<f.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};var g=a.data,l=c.data,e=1/e;l[0]=(g[5]*(g[10]*g[15]-g[14]*g[11])-g[9]*(g[6]*g[15]-g[14]*g[7])+g[13]*(g[6]*g[11]-g[10]*g[7]))*e;l[1]=(g[1]*(g[14]*g[11]-g[10]*g[15])-g[9]*(g[14]*g[3]-
g[2]*g[15])+g[13]*(g[10]*g[3]-g[2]*g[11]))*e;l[2]=(g[1]*(g[6]*g[15]-g[14]*g[7])-g[5]*(g[2]*g[15]-g[14]*g[3])+g[13]*(g[2]*g[7]-g[6]*g[3]))*e;l[3]=(g[1]*(g[10]*g[7]-g[6]*g[11])-g[5]*(g[10]*g[3]-g[2]*g[11])+g[9]*(g[6]*g[3]-g[2]*g[7]))*e;l[4]=(g[4]*(g[14]*g[11]-g[10]*g[15])-g[8]*(g[14]*g[7]-g[6]*g[15])+g[12]*(g[10]*g[7]-g[6]*g[11]))*e;l[5]=(g[0]*(g[10]*g[15]-g[14]*g[11])-g[8]*(g[2]*g[15]-g[14]*g[3])+g[12]*(g[2]*g[11]-g[10]*g[3]))*e;l[6]=(g[0]*(g[14]*g[7]-g[6]*g[15])-g[4]*(g[14]*g[3]-g[2]*g[15])+g[12]*
(g[6]*g[3]-g[2]*g[7]))*e;l[7]=(g[0]*(g[6]*g[11]-g[10]*g[7])-g[4]*(g[2]*g[11]-g[10]*g[3])+g[8]*(g[2]*g[7]-g[6]*g[3]))*e;l[8]=(g[4]*(g[9]*g[15]-g[13]*g[11])-g[8]*(g[5]*g[15]-g[13]*g[7])+g[12]*(g[5]*g[11]-g[9]*g[7]))*e;l[9]=(g[0]*(g[13]*g[11]-g[9]*g[15])-g[8]*(g[13]*g[3]-g[1]*g[15])+g[12]*(g[9]*g[3]-g[1]*g[11]))*e;l[10]=(g[0]*(g[5]*g[15]-g[13]*g[7])-g[4]*(g[1]*g[15]-g[13]*g[3])+g[12]*(g[1]*g[7]-g[5]*g[3]))*e;l[11]=(g[0]*(g[9]*g[7]-g[5]*g[11])-g[4]*(g[9]*g[3]-g[1]*g[11])+g[8]*(g[5]*g[3]-g[1]*g[7]))*e;
l[12]=(g[4]*(g[13]*g[10]-g[9]*g[14])-g[8]*(g[13]*g[6]-g[5]*g[14])+g[12]*(g[9]*g[6]-g[5]*g[10]))*e;l[13]=(g[0]*(g[9]*g[14]-g[13]*g[10])-g[8]*(g[1]*g[14]-g[13]*g[2])+g[12]*(g[1]*g[10]-g[9]*g[2]))*e;l[14]=(g[0]*(g[13]*g[6]-g[5]*g[14])-g[4]*(g[13]*g[2]-g[1]*g[14])+g[12]*(g[5]*g[2]-g[1]*g[6]))*e;l[15]=(g[0]*(g[5]*g[10]-g[9]*g[6])-g[4]*(g[1]*g[10]-g[9]*g[2])+g[8]*(g[1]*g[6]-g[5]*g[2]))*e;return c};b.prototype.invert=function(){return b.invert(this,this)};b.prototype.isOrthogonal=function(){var a;a=this.e00*
this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31;if(Math.abs(a)>f.EPSILON)return!1;a=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32;if(Math.abs(a)>f.EPSILON)return!1;a=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33;if(Math.abs(a)>f.EPSILON)return!1;a=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32;if(Math.abs(a)>f.EPSILON)return!1;a=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33;if(Math.abs(a)>
f.EPSILON)return!1;a=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33;return Math.abs(a)>f.EPSILON?!1:!0};b.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30;if(Math.abs(a-1)>f.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31;if(Math.abs(a-1)>f.EPSILON)return!1;a=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32;if(Math.abs(a-1)>f.EPSILON)return!1;a=this.e03*
this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33;return Math.abs(a-1)>f.EPSILON?!1:!0};b.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};b.prototype.determinant=function(){var a=this.data;return a[0]*(a[5]*a[10]*a[15]+a[9]*a[14]*a[7]+a[13]*a[6]*a[11]-a[13]*a[10]*a[7]-a[9]*a[6]*a[15]-a[5]*a[14]*a[11])-a[4]*(a[1]*a[10]*a[15]+a[9]*a[14]*a[3]+a[13]*a[2]*a[11]-a[13]*a[10]*a[3]-a[9]*a[2]*a[15]-a[1]*a[14]*a[11])+a[8]*(a[1]*a[6]*a[15]+a[5]*a[14]*a[3]+a[13]*a[2]*
a[7]-a[13]*a[6]*a[3]-a[5]*a[2]*a[15]-a[1]*a[14]*a[7])-a[12]*(a[1]*a[6]*a[11]+a[5]*a[10]*a[3]+a[9]*a[2]*a[7]-a[9]*a[6]*a[3]-a[5]*a[2]*a[11]-a[1]*a[10]*a[7])};b.prototype.setIdentity=function(){var a=this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this};b.prototype.setRotationFromVector=function(a){var c=Math.sin(a.x),e=Math.cos(a.x),b=Math.sin(a.y),d=Math.cos(a.y),f=Math.sin(a.z),a=Math.cos(a.z);this.e00=a*d;this.e10=
f*d;this.e20=0-b;this.e01=a*b*c-f*e;this.e11=f*b*c+a*e;this.e21=d*c;this.e02=a*b*e+f*c;this.e12=f*b*e-a*c;this.e22=d*e;return this};b.prototype.setRotationFromQuaternion=function(a){var c=a.lengthSquared(),c=c>0?2/c:0,e=a.x*c,b=a.y*c,d=a.z*c,c=a.w*e,f=a.w*b,i=a.w*d;e*=a.x;var h=a.x*b,j=a.x*d;b*=a.y;var n=a.y*d,a=a.z*d;this.e00=1-b-a;this.e10=h+i;this.e20=j-f;this.e01=h-i;this.e11=1-e-a;this.e21=n+c;this.e02=j+f;this.e12=n-c;this.e22=1-e-b;return this};b.prototype.setTranslation=function(a){this.e03=
a.x;this.e13=a.y;this.e23=a.z;return this};b.prototype.getTranslation=function(a){a.x=this.e03;a.y=this.e13;a.z=this.e23;return this};b.prototype.setScale=function(a){this.e00*=a.x;this.e10*=a.y;this.e20*=a.z;this.e01*=a.x;this.e11*=a.y;this.e21*=a.z;this.e02*=a.x;this.e12*=a.y;this.e22*=a.z;return this};b.prototype.applyPre=function(a){var c=a.data[0],e=a.data[1],b=a.data[2],d=a.data[3],f=this.data;a.data[0]=f[0]*c+f[1]*e+f[2]*b+f[3]*d;a.data[1]=f[4]*c+f[5]*e+f[6]*b+f[7]*d;a.data[2]=f[8]*c+f[9]*
e+f[10]*b+f[11]*d;a.data[3]=f[12]*c+f[13]*e+f[14]*b+f[15]*d;return a};b.prototype.applyPost=function(a){var c=a.data[0],e=a.data[1],b=a.data[2],d=a.data[3],f=this.data;a.data[0]=f[0]*c+f[4]*e+f[8]*b+f[12]*d;a.data[1]=f[1]*c+f[5]*e+f[9]*b+f[13]*d;a.data[2]=f[2]*c+f[6]*e+f[10]*b+f[14]*d;a.data[3]=f[3]*c+f[7]*e+f[11]*b+f[15]*d;return a};b.prototype.applyPostPoint=function(a){var c=a.data[0],e=a.data[1],b=a.data[2],d=this.data;a.data[0]=d[0]*c+d[4]*e+d[8]*b+d[12];a.data[1]=d[1]*c+d[5]*e+d[9]*b+d[13];
a.data[2]=d[2]*c+d[6]*e+d[10]*b+d[14];return a};b.prototype.applyPostVector=function(a){var c=a.x,e=a.y,b=a.z,d=this.data;a.x=d[0]*c+d[4]*e+d[8]*b;a.y=d[1]*c+d[5]*e+d[9]*b;a.z=d[2]*c+d[6]*e+d[10]*b;a.x=this.e00*c+this.e01*e+this.e02*b;a.y=this.e10*c+this.e11*e+this.e12*b;a.z=this.e20*c+this.e21*e+this.e22*b;return a};b.prototype.copy=function(a){var c=this.data,a=a.data;c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=
a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return this};b.prototype.clone=function(){var a=this.data;return new b(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])};return b});
define("goo/entities/Entity",[],function(){function f(b,a){this._world=b;this._components=[];Object.defineProperty(this,"id",{value:f.entityCount++,writable:!1});this.name=a!==void 0?a:"Entity_"+this.id}function d(b){return b.charAt(0).toLowerCase()+b.substr(1)}f.prototype.addToWorld=function(){this._world.addEntity(this)};f.prototype.removeFromWorld=function(){this._world.removeEntity(this)};f.prototype.setComponent=function(b){var a=this._components.indexOf(b);a===-1?this._components.push(b):this._components[a]=
b;this[d(b.type)]=b;if(b.type==="TransformComponent")b.entity=this;this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,b,"addedComponent")};f.prototype.getComponent=function(b){return this[d(b)]};f.prototype.clearComponent=function(b){var a=this[d(b)],c=this._components.indexOf(a);if(c!==-1){a=this._components[c];if(a.type==="TransformComponent")a.entity=void 0;this._components.splice(c,1)}delete this[d(b)];this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,
a,"removedComponent")};f.prototype.toString=function(){return this.name};f.entityCount=0;return f});
define("goo/entities/managers/EntityManager",[],function(){function f(){this.type="EntityManager";this._entities=[]}f.prototype.added=function(d){this._entities.indexOf(d)===-1&&this._entities.push(d)};f.prototype.removed=function(d){d=this._entities.indexOf(d);d!==-1&&this._entities.splice(d,1)};f.prototype.containsEntity=function(d){return this._entities.indexOf(d)!==-1};f.prototype.getEntityById=function(d){for(var b=0,a=this._entities.length;b<a;b++){var c=this._entities[b];if(c.id===d)return c}};
f.prototype.getEntityByName=function(d){for(var b=0,a=this._entities.length;b<a;b++){var c=this._entities[b];if(c.name===d)return c}};f.prototype.getEntities=function(){return this._entities};f.prototype.getTopEntities=function(){for(var d=[],b=0;b<this._entities.length;b++){var a=this._entities[b];a.transformComponent?a.transformComponent.parent||d.push(a):d.push(a)}return d};return f});
define("goo/math/Transform",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/Matrix4x4"],function(f,d,b){function a(){this.matrix=new b;this.translation=new f;this.rotation=new d;this.scale=new f(1,1,1);this.tmpVec=new f;this.tmpMat1=new d;this.tmpMat2=new d}a.prototype.multiply=function(a,e){b.combine(a.matrix,e.matrix,this.matrix);this.tmpMat1.data.set(a.rotation.data);this.tmpMat1.multiplyDiagonalPost(a.scale,this.tmpMat1);this.tmpMat2.data.set(e.rotation.data);this.tmpMat2.multiplyDiagonalPost(e.scale,
this.tmpMat2);d.combine(this.tmpMat1,this.tmpMat2,this.rotation);this.translation.setv(e.translation);this.tmpMat1.applyPost(this.translation).addv(a.translation);this.scale.setv(a.scale).mulv(e.scale)};a.prototype.setIdentity=function(){this.matrix.setIdentity();this.translation.setv(f.ZERO);this.rotation.setIdentity();this.scale.setv(f.ONE)};a.prototype.applyForward=function(a,e){e.setv(a);this.matrix.applyPostPoint(e);return e};a.prototype.applyForwardVector=function(a,e){e.copy(a);e.set(e.x*this.scale.x,
e.y*this.scale.y,e.z*this.scale.z);this.rotation.applyPost(e);return e};a.prototype.update=function(){var a=this.matrix.data,e=this.rotation.data,b=this.scale.data,d=this.translation.data;a[0]=b[0]*e[0];a[1]=b[0]*e[1];a[2]=b[0]*e[2];a[3]=0;a[4]=b[1]*e[3];a[5]=b[1]*e[4];a[6]=b[1]*e[5];a[7]=0;a[8]=b[2]*e[6];a[9]=b[2]*e[7];a[10]=b[2]*e[8];a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1};a.prototype.copy=function(a){this.matrix.copy(a.matrix);this.translation.setv(a.translation);this.rotation.copy(a.rotation);
this.scale.setv(a.scale)};a.prototype.setRotationXYZ=function(a,e,b){this.rotation.fromAngles(a,e,b)};a.prototype.lookAt=function(a,e){this.tmpVec.copy(this.translation).sub(a).normalize();this.rotation.lookAt(this.tmpVec,e)};a.prototype.invert=function(c){c||(c=new a);c.matrix.copy(this.matrix);c.matrix.invert();var e=c.rotation.copy(this.rotation);e.multiplyDiagonalPost(this.scale,e).invert();c.translation.copy(this.translation);c.rotation.applyPost(c.translation).invert();return c};a.prototype.toString=
function(){return""+this.matrix};return a});
define("goo/entities/components/TransformComponent",["goo/math/Transform","goo/entities/components/Component"],function(f,d){function b(){this.type="TransformComponent";this.parent=null;this.children=[];this.transform=new f;this.worldTransform=new f;this._dirty=!0;this._updated=!1}b.prototype=Object.create(d.prototype);b.prototype.setUpdated=function(){this._dirty=!0};b.prototype.attachChild=function(a){a===this?console.warn("attachChild: An object can't be added as a child of itself."):(a.parent&&
a.parent.detachChild(a),a.parent=this,this.children.push(a))};b.prototype.detachChild=function(a){if(a===this)console.warn("attachChild: An object can't be removed from itself.");else{var c=this.children.indexOf(a);if(c!==-1)a.parent=null,this.children.splice(c,1)}};b.prototype.updateTransform=function(){this.transform.update()};b.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform);this._dirty=
!1;this._updated=!0};return b});
define("goo/entities/World",["goo/entities/Entity","goo/entities/managers/EntityManager","goo/entities/components/TransformComponent"],function(f,d,b){function a(){this._managers=[];this._systems=[];this._addedEntities=[];this._changedEntities=[];this._removedEntities=[];this.entityManager=new d;this.setManager(this.entityManager);this.time=0;this.tpf=1}a.time=0;a.prototype.setManager=function(a){this._managers.push(a)};a.prototype.getManager=function(a){for(var e=0;e<this._managers.length;e++){var b=
this._managers[e];if(b.type===a)return b}};a.prototype.setSystem=function(a){this._systems.push(a)};a.prototype.getSystem=function(a){for(var e=0;e<this._systems.length;e++){var b=this._systems[e];if(b.type===a)return b}};a.prototype.createEntity=function(a){a=new f(this,a);a.setComponent(new b);return a};a.prototype.getEntities=function(){return this.entityManager.getEntities()};a.prototype.addEntity=function(a){this._addedEntities.push(a)};a.prototype.removeEntity=function(a){this._removedEntities.push(a)};
a.prototype.changedEntity=function(a,e,b){a={entity:a};if(e!==void 0)a.component=e;if(b!==void 0)a.eventType=b;this._changedEntities.push(a)};a.prototype.process=function(){this._check(this._addedEntities,function(a,e){a.added&&a.added(e);if(a.addedComponent)for(var c=0;c<e._components.length;c++)a.addedComponent(e,e._components[c])});this._check(this._changedEntities,function(a,e){a.changed&&a.changed(e.entity);if(e.eventType!==void 0&&a[e.eventType])a[e.eventType](e.entity,e.component)});this._check(this._removedEntities,
function(a,e){a.removed&&a.removed(e);if(a.removedComponent)for(var c=0;c<e._components.length;c++)a.removedComponent(e,e._components[c])});for(var a=0;a<this._systems.length;a++){var e=this._systems[a];e.passive||e._process(this.tpf)}};a.prototype._check=function(a,e){for(var b=0;b<a.length;b++){for(var d=a[b],f=0;f<this._managers.length;f++)e(this._managers[f],d);for(f=0;f<this._systems.length;f++)e(this._systems[f],d)}a.length=0};return a});
define("goo/renderer/RenderQueue",["goo/math/Vector3"],function(f){function d(){var b=this,a=new f;this.opaqueSorter=function(c,e){var d=c.meshRendererComponent.materials[0].shader,f=e.meshRendererComponent.materials[0].shader;return d._id===f._id?(f=c.meshRendererComponent.worldBound,d=e.meshRendererComponent.worldBound,f=a.setv(b.camera.translation).subv(f.center).lengthSquared(),d=a.setv(b.camera.translation).subv(d.center).lengthSquared(),f-d):d._id-f._id};this.transparentSorter=function(c,e){var d=
c.meshRendererComponent.worldBound,f=e.meshRendererComponent.worldBound,d=a.setv(b.camera.translation).subv(d.center).lengthSquared();return a.setv(b.camera.translation).subv(f.center).lengthSquared()-d};this.bucketSorter=function(a,e){return a-e}}d.prototype.sort=function(b,a){var c=0;this.camera=a;for(var e={},g=[],f=0;f<b.length;f++){var k=b[f];if(!k.meshRendererComponent||k.meshRendererComponent.materials.length===0)b[c]=k,c++;else{var i=k.meshRendererComponent.materials[0].getRenderQueue(),h=
e[i];h||(h=[],e[i]=h,g.push(i));h.push(k)}}g.length>1&&g.sort(this.bucketSorter);for(k=0;k<g.length;k++){f=g[k];h=e[f];f<=d.TRANSPARENT?h.sort(this.opaqueSorter):h.sort(this.transparentSorter);for(f=0;f<h.length;f++)b[c]=h[f],c++}};d.BACKGROUND=0;d.OPAQUE=1E3;d.TRANSPARENT=2E3;d.OVERLAY=3E3;return d});
define("goo/renderer/Shader",["goo/renderer/ShaderCall","goo/math/Matrix4x4","goo/math/Vector3","goo/entities/World","goo/renderer/RenderQueue"],function(f,d,b,a,c){function e(a,b){if(!b.vshader||!b.fshader)throw Error("Missing shader sources for shader: "+a);this.name=a;this.vertexSource=b.vshader;this.fragmentSource=b.fshader;this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping={};this.uniformCallMapping={};this.textureSlots=[];this.defaultCallbacks=
{};g(this.defaultCallbacks);this.currentCallbacks={};this.defines=b.defines;this.attributes=b.attributes;this.uniforms=b.uniforms;this.renderQueue=c.OPAQUE;this._id=e.id++;this.errorOnce=!1}function g(c){var b=new d;c[e.PROJECTION_MATRIX]=function(a,e){var c=e.camera.getProjectionMatrix();a.uniformMatrix4fv(c)};c[e.VIEW_MATRIX]=function(a,e){var c=e.camera.getViewMatrix();a.uniformMatrix4fv(c)};c[e.WORLD_MATRIX]=function(a,e){a.uniformMatrix4fv(e.transform!==void 0?e.transform.matrix:b)};c[e.VIEW_INVERSE_MATRIX]=
function(a,e){var c=e.camera.getViewInverseMatrix();a.uniformMatrix4fv(c)};c[e.VIEW_PROJECTION_MATRIX]=function(a,e){var c=e.camera.getViewProjectionMatrix();a.uniformMatrix4fv(c)};c[e.VIEW_PROJECTION_INVERSE_MATRIX]=function(a,e){var c=e.camera.getViewProjectionInverseMatrix();a.uniformMatrix4fv(c)};for(var g=0;g<16;g++)c[e["TEXTURE"+g]]=function(a){return function(e){e.uniform1i(a)}}(g);for(g=0;g<8;g++)c[e["LIGHT"+g]]=function(a){return function(e,c){var b=c.lights[a];b!==void 0?e.uniform3f(b.translation.x,
b.translation.y,b.translation.z):e.uniform3f(-20,20,20)}}(g);c[e.LIGHTCOUNT]=function(a,e){a.uniform1i(e.lights.length)};c[e.CAMERA]=function(a,e){var c=e.camera.translation;a.uniform3f(c.x,c.y,c.z)};c[e.NEAR_PLANE]=function(a,e){a.uniform1f(e.camera.near)};c[e.FAR_PLANE]=function(a,e){a.uniform1f(e.camera.far)};c[e.MAIN_NEAR_PLANE]=function(a,e){a.uniform1f(e.mainCamera.near)};c[e.MAIN_FAR_PLANE]=function(a,e){a.uniform1f(e.mainCamera.far)};var f=[0.1,0.1,0.1,1],k=[0,0,0,0],l=[1,1,1,1],m=[0.8,0.8,
0.8,1];c[e.AMBIENT]=function(a,e){a.uniform4fv(e.material.materialState!==void 0?e.material.materialState.ambient:f)};c[e.EMISSIVE]=function(a,e){a.uniform4fv(e.material.materialState!==void 0?e.material.materialState.emissive:k)};c[e.DIFFUSE]=function(a,e){a.uniform4fv(e.material.materialState!==void 0?e.material.materialState.diffuse:l)};c[e.SPECULAR]=function(a,e){a.uniform4fv(e.material.materialState!==void 0?e.material.materialState.specular:m)};c[e.SPECULAR_POWER]=function(a,e){var c=e.material.materialState!==
void 0?e.material.materialState.shininess:8,c=Math.max(c,1);a.uniform1f(c)};c[e.TIME]=function(e){e.uniform1f(a.time)};c[e.LIGHT_PROJECTION_MATRIX]=function(a,e){var c=e.lightCamera.getProjectionMatrix();a.uniformMatrix4fv(c)};c[e.LIGHT_VIEW_MATRIX]=function(a,e){var c=e.lightCamera.getViewMatrix();a.uniformMatrix4fv(c)};c[e.LIGHT_NEAR_PLANE]=function(a,e){a.uniform1f(e.lightCamera.near)};c[e.LIGHT_FAR_PLANE]=function(a,e){a.uniform1f(e.lightCamera.far)};c[e.RESOLUTION]=function(a,e){a.uniform2f(e.renderer.viewportWidth,
e.renderer.viewportHeight)}}var l=window.WebGLRenderingContext;e.id=0;var k=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;e.prototype.apply=function(a,e){var c=e.context,b=e.rendererRecord;this.shaderProgram===null&&(this._investigateShaders(),this.addDefines(this.defines),this.compile(e));var d=!1;if(b.usedProgram!==this.shaderProgram)c.useProgram(this.shaderProgram),b.usedProgram=this.shaderProgram,d=!0;if(this.attributes){var c=
a.meshData.attributeMap,g;for(g in this.attributes)if(b=c[this.attributes[g]]){var f=this.attributeIndexMapping[g];f!==void 0&&(d&&e.context.enableVertexAttribArray(f),e.bindVertexAttribute(f,b))}}if(this.uniforms){d=a.material.uniforms;try{for(var k in this.uniforms){var l=this.uniformCallMapping[k];if(l){var v=d[k]||this.uniforms[k];if(typeof v==="string"){var u=this.currentCallbacks[k];u&&u(l,a)}else{var s=typeof v==="function"?v(a):v;l.call(s)}}}this.errorOnce=!1}catch(t){if(this.errorOnce===
!1)console.error(t.stack),this.errorOnce=!0}}};e.prototype.rebuild=function(){this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping={};this.uniformCallMapping={};this.currentCallbacks={}};e.prototype._investigateShaders=function(){this.textureSlots=[];e.investigateShader(this.vertexSource,this);e.investigateShader(this.fragmentSource,this)};e.investigateShader=function(a,e){k.lastIndex=0;for(var c=k.exec(a);c!==null;){var b={format:c[2]},d=c[1],g=c[3];
if(c[4])if(b.format==="float")b.format="floatarray";else if(b.format==="int")b.format="intarray";"attribute"===d?e.attributeMapping[g]=b:(b.format.indexOf("sampler")===0&&e.textureSlots.push({format:b.format,name:g}),e.uniformMapping[g]=b);c=k.exec(a)}};e.prototype.compile=function(a){var a=a.context,e=this._getShader(a,l.VERTEX_SHADER,this.vertexSource),c=this._getShader(a,l.FRAGMENT_SHADER,this.fragmentSource);(e===null||c===null)&&console.error("Shader error - no shaders");this.shaderProgram=a.createProgram();
var b=a.getError();(this.shaderProgram===null||b!==l.NO_ERROR)&&console.error("Shader error: "+b+" [shader: "+this.name+"]");a.attachShader(this.shaderProgram,e);a.attachShader(this.shaderProgram,c);a.linkProgram(this.shaderProgram);a.getProgramParameter(this.shaderProgram,l.LINK_STATUS)||console.error("Could not initialise shaders: "+a.getProgramInfoLog(this.shaderProgram));for(var d in this.attributeMapping)e=a.getAttribLocation(this.shaderProgram,d),e===-1?console.warn("Attribute ["+this.attributeMapping[d]+
"/"+d+"] variable not found in shader. Probably unused and optimized away."):this.attributeIndexMapping[d]=e;for(d in this.uniformMapping)e=a.getUniformLocation(this.shaderProgram,d),e===null?console.warn("Uniform ["+d+"] variable not found in shader. Probably unused and optimized away. "+d):this.uniformCallMapping[d]=new f(a,e,this.uniformMapping[d].format);if(this.attributes){for(var g in this.attributes)a=this.attributeIndexMapping[g],a===void 0&&console.warn("No attribute found for binding: "+
g+" ["+this.name+"]["+this._id+"]");for(g in this.attributeIndexMapping)a=this.attributes[g],a===void 0&&console.warn("No binding found for attribute: "+g+" ["+this.name+"]["+this._id+"]")}if(this.uniforms){if(this.uniforms.$link){a=this.uniforms.$link instanceof Array?this.uniforms.$link:[this.uniforms.$link];for(e=0;e<a.length;e++)for(d in c=a[e],c)this.uniforms[d]=c[d];delete this.uniforms.$link}for(g in this.uniforms)a=this.uniformCallMapping[g],a===void 0&&console.warn("No uniform found for binding: "+
g+" ["+this.name+"]["+this._id+"]"),d=this.uniforms[g],this.defaultCallbacks[d]&&(this.currentCallbacks[g]=this.defaultCallbacks[d]);for(g in this.uniformCallMapping)a=this.uniforms[g],a===void 0&&console.warn("No binding found for uniform: "+g+" ["+this.name+"]["+this._id+"]")}console.log("Shader ["+this.name+"]["+this._id+"] compiled")};e.prototype._getShader=function(a,e,c){e=a.createShader(e);a.shaderSource(e,c);a.compileShader(e);return!a.getShaderParameter(e,l.COMPILE_STATUS)?(console.error("Shader ["+
this.name+"]["+this._id+"] "+a.getShaderInfoLog(e)),null):e};e.prototype.addDefines=function(a){if(a)a=this.generateDefines(a),this.vertexSource=a+"\n"+this.vertexSource,this.fragmentSource=a+"\n"+this.fragmentSource};e.prototype.generateDefines=function(a){var e=[],c;for(c in a){var b=a[c];b!==!1&&e.push("#define "+c+" "+b)}return e.join("\n")};e.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms}};
e.prototype.toString=function(){return this.name};e.PROJECTION_MATRIX="PROJECTION_MATRIX";e.VIEW_MATRIX="VIEW_MATRIX";e.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX";e.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX";e.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX";e.WORLD_MATRIX="WORLD_MATRIX";for(b=0;b<16;b++)e["TEXTURE"+b]="TEXTURE"+b;for(b=0;b<4;b++)e["LIGHT"+b]="LIGHT"+b;e.CAMERA="CAMERA";e.AMBIENT="AMBIENT";e.EMISSIVE="EMISSIVE";e.DIFFUSE="DIFFUSE";e.SPECULAR="SPECULAR";e.SPECULAR_POWER=
"SPECULAR_POWER";e.NEAR_PLANE="NEAR_PLANE";e.FAR_PLANE="FAR_PLANE";e.MAIN_NEAR_PLANE="NEAR_PLANE";e.MAIN_FAR_PLANE="FAR_PLANE";e.TIME="TIME";e.RESOLUTION="RESOLUTION";e.LIGHT_PROJECTION_MATRIX="LIGHT_PROJECTION_MATRIX";e.LIGHT_VIEW_MATRIX="LIGHT_VIEW_MATRIX";e.LIGHT_NEAR_PLANE="LIGHT_NEAR_PLANE";e.LIGHT_FAR_PLANE="LIGHT_FAR_PLANE";return e});
define("goo/renderer/Material",["goo/renderer/Shader"],function(f){function d(b){this.name=b;this.shader=null;this.uniforms={};this.textures=[];this._originalTextureCount=-1;this.materialState=void 0;this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"};this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"};this.depthState={enabled:!0,write:!0};this.offsetState={enabled:!1,factor:1,units:1};this.wireframe=!1;this.renderQueue=
null}d.prototype.getRenderQueue=function(){return this.renderQueue!==null?this.renderQueue:this.shader.renderQueue};d.prototype.setRenderQueue=function(b){this.renderQueue=b};d.store=[];d.hash=[];d.createShader=function(b,a){var c=d.store.indexOf(b);if(c!==-1)return d.hash[c];c=new f(a||"DefaultShader",b);d.store.push(b);d.hash.push(c);return c};d.clearShaderCache=function(){d.store.length=0;d.hash.length=0};d.createMaterial=function(b,a){var c=new d(a||"DefaultMaterial");c.shader=d.createShader(b);
return c};return d});
define("goo/util/rsvp",["exports"],function(f){function d(e,c){a.async(function(){e.trigger("promise:resolved",{detail:c});e.isResolved=!0;e.resolvedValue=c})}function b(e,c){a.async(function(){e.trigger("promise:failed",{detail:c});e.isRejected=!0;e.rejectedValue=c})}var a={},c=typeof window!=="undefined"?window:{},c=c.MutationObserver||c.WebKitMutationObserver;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]")a.async=function(a,e){process.nextTick(function(){a.call(e)})};else if(c){var e=
[],g=new c(function(){var a=e.slice();e=[];a.forEach(function(a){a[0].call(a[1])})}),l=document.createElement("div");g.observe(l,{attributes:!0});window.addEventListener("unload",function(){g.disconnect();g=null});a.async=function(a,c){e.push([a,c]);l.setAttribute("drainQueue","drainQueue")}}else a.async=function(a,e){setTimeout(function(){a.call(e)},1)};var k=function(a,e){this.type=a;for(var c in e)e.hasOwnProperty(c)&&(this[c]=e[c])},i=function(a,e){for(var c=0,b=a.length;c<b;c++)if(a[c][0]===
e)return c;return-1},h=function(a){var e=a._promiseCallbacks;if(!e)e=a._promiseCallbacks={};return e},c={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,e,c){for(var b=h(this),d,g,a=a.split(/\s+/),c=c||this;g=a.shift();)(d=b[g])||(d=b[g]=[]),i(d,e)===-1&&d.push([e,c])},off:function(a,e){for(var c=h(this),b,d,a=a.split(/\s+/);b=a.shift();)e?(b=c[b],d=i(b,e),d!==-1&&b.splice(d,1)):c[b]=[]},trigger:function(a,e){var c,b,d,g;if(c=h(this)[a])for(var f=0,i=c.length;f<
i;f++)b=c[f],d=b[0],b=b[1],typeof e!=="object"&&(e={detail:e}),g=new k(a,e),d.call(b,g)}},j=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},n=function(){},o=function(a,e,c,b){var d=typeof c==="function",g,f,h,i;if(d)try{g=c(b.detail),h=!0}catch(k){i=!0,f=k}else g=b.detail,h=!0;if(g&&typeof g.then==="function")g.then(function(a){e.resolve(a)},function(a){e.reject(a)});
else if(d&&h)e.resolve(g);else if(i)e.reject(f);else e[a](g)};j.prototype={then:function(e,c){var b=new j;this.isResolved&&a.async(function(){o("resolve",b,e,{detail:this.resolvedValue})},this);this.isRejected&&a.async(function(){o("reject",b,c,{detail:this.rejectedValue})},this);this.on("promise:resolved",function(a){o("resolve",b,e,a)});this.on("promise:failed",function(a){o("reject",b,c,a)});return b},resolve:function(a){d(this,a);this.reject=this.resolve=n},reject:function(a){b(this,a);this.reject=
this.resolve=n}};c.mixin(j.prototype);f.Promise=j;f.Event=k;f.EventTarget=c;f.all=function(a){var e,c=[],b=new j,d=a.length;d===0&&b.resolve([]);var g=function(a){return function(e){c[a]=e;--d===0&&b.resolve(c)}},f=function(a){b.reject(a)};for(e=0;e<d;e++)a[e].then(g(e),f);return b};f.configure=function(e,c){a[e]=c}});
define("goo/util/Ajax",["goo/util/rsvp"],function(f){function d(){}d.prototype.get=function(b){var a=new f.Promise,b=b||{},c=b.url||"",e=new XMLHttpRequest;if(b.responseType)e.responseType=b.responseType;e.open("GET",c,!0);e.onreadystatechange=function(){e.readyState===4&&(e.status>=200&&e.status<=299?a.resolve(e):a.reject(e.statusText))};e.send();return a};return d});
define("goo/loaders/Loader",["goo/util/rsvp","goo/util/Ajax"],function(f,d){function b(a){if(typeof a!=="undefined"&&a!==null&&typeof a!=="object")throw Error("Loader(): Argument `parameters` must be of type `object`");else if(typeof a==="undefined"||a===null)a={};this._crossOrigin=a.crossOrigin||"anonymous";this.rootPath=a.rootPath||"";this.xhr=a.xhr||new d}b.prototype.load=function(a,c,e){if(typeof a==="undefined"||a===null)throw Error("Loader(): `path` was undefined/null");var d={url:this._buildURL(a)};
if(e===b.ARRAY_BUFFER)d.responseType=b.ARRAY_BUFFER;var f=this,k=this.xhr.get(d).then(function(a){return f._getDataFromSuccessfulRequest(a)}).then(function(a){return typeof c==="function"?c(a):a}).then(function(a){k.resolve(a);console.log("Loaded: "+d.url);return a}).then(null,function(a){console.error("Loader.load(): Could not retrieve data from `"+d.url+"`.\n Reason: "+a);throw Error("Loader.load(): Could not retrieve data from `"+d.url+"`.\n Reason: "+a);});return k};b.prototype._getDataFromSuccessfulRequest=
function(a){return a.response};b.prototype.loadImage=function(a){var c=new f.Promise,e=new Image,b=this._buildURL(a);e.crossOrigin=this._crossOrigin||"";e.addEventListener("load",function(){e.dataReady=!0;c.resolve(e)},!1);e.addEventListener("error",function(){c.reject("Loader.loadImage(): Couldn't load from ["+b+"]")},!1);e.src=b;return c};b.prototype._buildURL=function(a){return this.rootPath+a};b.ARRAY_BUFFER="arraybuffer";return b});
define("goo/math/Vector2",["goo/math/Vector"],function(f){function d(){f.call(this,2);arguments.length!==0?this.set(arguments):this.setd(0,0)}d.prototype=Object.create(f.prototype);d.prototype.setupAliases([["x","u","s"],["y","v","t"]]);d.ZERO=new d(0,0);d.ONE=new d(1,1);d.UNIT_X=new d(1,0);d.UNIT_Y=new d(0,1);d.add=function(b,a,c){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
c.data[0]=b[0]+a[0];c.data[1]=b[1]+a[1];return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]-a[0];c.data[1]=b[1]-a[1];return c};d.prototype.sub=function(b){return d.sub(this,b,this)};d.mul=function(b,a,c){typeof b==="number"&&(b=[b,b]);typeof a===
"number"&&(a=[a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]*a[0];c.data[1]=b[1]*a[1];return c};d.prototype.mul=function(b){return d.mul(this,b,this)};d.div=function(b,a,c){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
c.data[0]=b[0]/a[0];c.data[1]=b[1]/a[1];return c};d.prototype.div=function(b){return d.div(this,b,this)};d.dot=function(b,a){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);var c=b.data||b,e=a.data||a;if(c.length!==2||e.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var d=0;d+=c[0]*e[0];d+=c[1]*e[1];return d};d.prototype.dot=function(b){return d.dot(this,b)};d.prototype.setd=function(b,a){this.data[0]=b;this.data[1]=a;return this};d.prototype.seta=
function(b){this.data[0]=b[0];this.data[1]=b[1];return this};d.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];return this};return d});
define("goo/renderer/Texture",["goo/math/Vector2"],function(f){function d(b,a,c,e){this.glTexture=null;a=a||{};b&&this.setImage(b,a,c,e);this.wrapS=a.wrapS||"Repeat";this.wrapT=a.wrapT||"Repeat";this.magFilter=a.magFilter||"Bilinear";this.minFilter=a.minFilter||"Trilinear";this.anisotropy=a.anisotropy!==void 0?a.anisotropy:1;this.format=a.format||"RGBA";this.type=a.type||"UnsignedByte";this.variant="2D";this.offset=new f(0,0);this.repeat=new f(1,1);this.generateMipmaps=a.generateMipmaps!==void 0?
a.generateMipmaps:!0;this.premultiplyAlpha=a.premultiplyAlpha!==void 0?a.premultiplyAlpha:!1;this.flipY=a.flipY!==void 0?a.flipY:!0;this.needsUpdate=this.hasBorder=!1;this.readyCallback=this.updateCallback=null}d.prototype.checkDataReady=function(){return this.image&&this.image.dataReady||this.readyCallback!==null&&this.readyCallback()};d.prototype.checkNeedsUpdate=function(){return this.needsUpdate||this.updateCallback!==null&&this.updateCallback()};d.prototype.setImage=function(b,a,c,e){this.image=
b;var d=b instanceof Array?b[0]:b;if(d instanceof Uint8Array||d instanceof Uint16Array)if(c=c||b.width,e=e||b.height,c!==void 0&&e!==void 0)if(this.image={data:b},this.image.width=c,this.image.height=e,this.image.isData=!0,this.image.dataReady=!0,d instanceof Uint8Array)a.type="UnsignedByte";else{if(d instanceof Uint16Array)a.type="UnsignedShort4444"}else throw"Data textures need width and height";else if(b instanceof Array)this.image={data:b}};d.CUBE_FACES="PositiveX,NegativeX,PositiveY,NegativeY,PositiveZ,NegativeZ".split(",");
return d});
define("goo/loaders/dds/DdsUtils",[],function(){function f(){}f.getDdsExtension=function(d){for(var b=["","WEBKIT_","MOZ_"],a=0;a<b.length;a++){var c=d.getExtension(b[a]+"WEBGL_compressed_texture_s3tc");if(typeof c!=="undefined"&&c!==null)return c}return null};f.isSupported=function(d){return f.getDdsExtension(d)!==null};f.shiftCount=function(d){if(d===0)return 0;for(var b=0;(d&1)===0;)if(d>>=1,b++,b>32)throw"invalid mask!";return b};f.isSet=function(d,b){return(d&b)===b};f.getIntFromString=function(d){for(var b=
[],a=0;a<d.length;a++)b[a]=d.charCodeAt(a);return f.getIntFromBytes(b)};f.getIntFromBytes=function(d){var b=0;b|=(d[0]&255)<<0;d.length>1&&(b|=(d[1]&255)<<8);d.length>2&&(b|=(d[2]&255)<<16);d.length>3&&(b|=(d[3]&255)<<24);return b};f.getComponents=function(d){switch(d){case "Alpha":return 1;case "RGB":return 3;case "RGBA":return 4;case "Luminance":return 1;case "LuminanceAlpha":return 2;case "PrecompressedDXT1":return 1;case "PrecompressedDXT1A":return 1;case "PrecompressedDXT3":return 2;case "PrecompressedDXT5":return 2}return 0};
f.flipDXT=function(d,b,a,c){for(var e=new Uint8Array(d.length),b=b+3>>2,a=a+3>>2,g=f.getComponents(c)*8,l=0;l<a;l++)for(var k=a-l-1,i=0;i<b;i++){var h=(k*b+i)*g,j=(l*b+i)*g;switch(c){case "PrecompressedDXT1":case "PrecompressedDXT1A":e[h+0]=d[j+0];e[h+1]=d[j+1];e[h+2]=d[j+2];e[h+3]=d[j+3];e[h+4]=d[j+7];e[h+5]=d[j+6];e[h+6]=d[j+5];e[h+7]=d[j+4];break;case "PrecompressedDXT3":e[h+0]=d[j+6];e[h+1]=d[j+7];e[h+2]=d[j+4];e[h+3]=d[j+5];e[h+4]=d[j+2];e[h+5]=d[j+3];e[h+6]=d[j+0];e[h+7]=d[j+1];e[h+8]=d[j+8];
e[h+9]=d[j+9];e[h+10]=d[j+10];e[h+11]=d[j+11];e[h+12]=d[j+15];e[h+13]=d[j+14];e[h+14]=d[j+13];e[h+15]=d[j+12];break;case "PrecompressedDXT5":e[h+0]=d[j+0],e[h+1]=d[j+1],f.getBytesFromUInt24(e,h+5,f.flipUInt24(f.getUInt24(d,j+2))),f.getBytesFromUInt24(e,h+2,f.flipUInt24(f.getUInt24(d,j+5))),e[h+8]=d[j+8],e[h+9]=d[j+9],e[h+10]=d[j+10],e[h+11]=d[j+11],e[h+12]=d[j+15],e[h+13]=d[j+14],e[h+14]=d[j+13],e[h+15]=d[j+12]}}return e};f.getUInt24=function(d,b){var a=0;a|=(d[b+0]&255)<<0;a|=(d[b+1]&255)<<8;a|=
(d[b+2]&255)<<16;return a};f.getBytesFromUInt24=function(d,b,a){d[b+0]=a&255;d[b+1]=(a&65280)>>8;d[b+2]=(a&16711680)>>16};f.ThreeBitMask=7;f.flipUInt24=function(d){for(var b=[],a=0;a<2;a++)b.push([0,0,0,0]);b[0][0]=d&f.ThreeBitMask;d>>=3;b[0][1]=d&f.ThreeBitMask;d>>=3;b[0][2]=d&f.ThreeBitMask;d>>=3;b[0][3]=d&f.ThreeBitMask;d>>=3;b[1][0]=d&f.ThreeBitMask;d>>=3;b[1][1]=d&f.ThreeBitMask;d>>=3;b[1][2]=d&f.ThreeBitMask;d>>=3;b[1][3]=d&f.ThreeBitMask;d=0;d|=b[1][0]<<0;d|=b[1][1]<<3;d|=b[1][2]<<6;d|=b[1][3]<<
9;d|=b[0][0]<<12;d|=b[0][1]<<15;d|=b[0][2]<<18;d|=b[0][3]<<21;return d};return f});
define("goo/loaders/dds/DdsLoader",["goo/loaders/dds/DdsUtils"],function(f){function d(){this.dwABitMask=this.dwBBitMask=this.dwGBitMask=this.dwRBitMask=this.dwRGBBitCount=this.dwFourCC=this.dwFlags=this.dwSize=0}function b(){this.dwAlphaBitDepth=this.dwMipMapCount=this.dwDepth=this.dwLinearSize=this.dwWidth=this.dwHeight=this.dwFlags=this.dwSize=0;this.dwReserved1=[];this.ddpf=null;this.dwTextureStage=this.dwCaps4=this.dwCaps3=this.dwCaps2=this.dwCaps=0}function a(){this.flipVertically=!1;this.bpp=
0;this.headerDX10=this.header=null;this.mipmapByteSizes=[]}function c(){}d.HEADER_OFFSET=19;d.DDPF_ALPHAPIXELS=1;d.DDPF_ALPHA=2;d.DDPF_FOURCC=4;d.DDPF_RGB=64;d.DDPF_YUV=512;d.DDPF_LUMINANCE=131072;d.read=function(a){var c=new d;c.dwSize=a[d.HEADER_OFFSET+0];if(c.dwSize!==32)throw"invalid pixel format size: "+c.dwSize;c.dwFlags=a[d.HEADER_OFFSET+1];c.dwFourCC=a[d.HEADER_OFFSET+2];c.dwRGBBitCount=a[d.HEADER_OFFSET+3];c.dwRBitMask=a[d.HEADER_OFFSET+4];c.dwGBitMask=a[d.HEADER_OFFSET+5];c.dwBBitMask=a[d.HEADER_OFFSET+
6];c.dwABitMask=a[d.HEADER_OFFSET+7];return c};b.DDSD_CAPS=1;b.DDSD_HEIGHT=2;b.DDSD_WIDTH=4;b.DDSD_PITCH=8;b.DDSD_PIXELFORMAT=4096;b.DDSD_MIPMAPCOUNT=131072;b.DDSD_LINEARSIZE=524288;b.DDSD_DEPTH=8388608;b.DDSCAPS_COMPLEX=8;b.DDSCAPS_MIPMAP=4194304;b.DDSCAPS_TEXTURE=4096;b.DDSCAPS2_CUBEMAP=512;b.DDSCAPS2_CUBEMAP_POSITIVEX=1024;b.DDSCAPS2_CUBEMAP_NEGATIVEX=2048;b.DDSCAPS2_CUBEMAP_POSITIVEY=4096;b.DDSCAPS2_CUBEMAP_NEGATIVEY=8192;b.DDSCAPS2_CUBEMAP_POSITIVEZ=16384;b.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768;b.DDSCAPS2_VOLUME=
2097152;b.read=function(a){var c=new b;c.dwSize=a[1];if(c.dwSize!==124)throw"invalid dds header size: "+c.dwSize;c.dwFlags=a[2];c.dwHeight=a[3];c.dwWidth=a[4];c.dwLinearSize=a[5];c.dwDepth=a[6];c.dwMipMapCount=a[7];c.dwAlphaBitDepth=a[8];for(var l=0;l<c.dwReserved1.length;l++)c.dwReserved1[l]=a[9+l];c.ddpf=d.read(a);c.dwCaps=a[27];c.dwCaps2=a[28];c.dwCaps3=a[29];c.dwCaps4=a[30];c.dwTextureStage=a[31];a=1+Math.ceil(Math.log(Math.max(c.dwHeight,c.dwWidth))/Math.log(2));f.isSet(c.dwCaps,b.DDSCAPS_MIPMAP)?
f.isSet(c.dwFlags,b.DDSD_MIPMAPCOUNT)?c.dwMipMapCount!==a&&console.warn("Got "+c.dwMipMapCount+" mipmaps, expected "+a):c.dwMipMapCount=a:c.dwMipMapCount=1;return c};a.prototype.calcMipmapSizes=function(a){for(var c=this.header.dwWidth,b=this.header.dwHeight,d=0,f=0;f<this.header.dwMipMapCount;f++)d=a?~~((c+3)/4)*~~((b+3)/4)*this.bpp*2:~~(c*b*this.bpp/8),this.mipmapByteSizes.push(~~((d+3)/4)*4),c=~~(c/2)>1?~~(c/2):1,b=~~(b/2)>1?~~(b/2):1};c.updateDepth=function(a,c){if(f.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP)){var d=
0;f.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEX)&&d++;f.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEX)&&d++;f.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEY)&&d++;f.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEY)&&d++;f.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEZ)&&d++;f.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&d++;if(d!==6)throw Error("Cubemaps without all faces defined are not currently supported.");a.depth=d}else a.depth=c.header.dwDepth>0?c.header.dwDepth:
1};c.readDXT=function(a,c,b,d){d.image.isCompressed=!0;if(!b.flipVertically)return new Uint8Array(a.buffer,a.byteOffset+0,c);for(var i=b.header.dwWidth,h=b.header.dwHeight,c=new Uint8Array(c),j=0,n=0;n<b.header.dwMipMapCount;n++){for(var o=[],q=0,m=b.mipmapByteSizes[n];q<m;q++)o.push(a[q+j]);o=f.flipDXT(o,i,h,d.format);c.set(o,j);j+=o.length;i=~~(i/2)>1?~~(i/2):1;h=~~(h/2)>1?~~(h/2):1}return c};c.readUncompressed=function(a,c,b,d,i,h,j,n){for(var o=f.shiftCount(j.header.ddpf.dwRBitMask),q=f.shiftCount(j.header.ddpf.dwGBitMask),
m=f.shiftCount(j.header.ddpf.dwBBitMask),r=f.shiftCount(j.header.ddpf.dwABitMask),p=~~(j.header.ddpf.dwRGBBitCount/8),n=f.getComponents(n.format)*1,c=new Uint8Array(c),v=j.header.dwWidth,u=j.header.dwHeight,s=0,t=0,w=0,z=[],w=0;w<p;w++)z.push(0);for(var y=0;y<j.header.dwMipMapCount;y++){for(var A=0;A<u;A++)for(var x=0;x<v;x++){for(w=0;w<p;w++)z[w]=a[t++];var w=f.getIntFromBytes(z),D=(w&j.header.ddpf.dwRBitMask)>>o,E=(w&j.header.ddpf.dwGBitMask)>>q,C=(w&j.header.ddpf.dwBBitMask)>>m,w=(w&j.header.ddpf.dwABitMask)>>
r;i?c[s++]=w:d?(c[s++]=D,h&&(c[s++]=w)):b&&(c[s++]=D,c[s++]=E,c[s++]=C,h&&(c[s++]=w))}s+=v*u*n;v=~~(v/2)>1?~~(v/2):1;u=~~(u/2)>1?~~(u/2):1}return c};c.populate=function(a,b,l){var k=b.header.ddpf.dwFlags,i=f.isSet(k,d.DDPF_FOURCC),h=f.isSet(k,d.DDPF_RGB),j=f.isSet(k,d.DDPF_ALPHAPIXELS),n=f.isSet(k,d.DDPF_LUMINANCE),k=f.isSet(k,d.DDPF_ALPHA);a.type="UnsignedByte";if(i){var o=b.header.ddpf.dwFourCC;if(o===f.getIntFromString("DXT1"))b.bpp=4,a.format="PrecompressedDXT1A";else if(o===f.getIntFromString("DXT3"))b.bpp=
8,a.format="PrecompressedDXT3";else if(o===f.getIntFromString("DXT5"))b.bpp=8,a.format="PrecompressedDXT5";else if(o===f.getIntFromString("DX10"))throw Error("dxt10 LATC formats not supported currently: "+b.headerDX10.dxgiFormat);else if(o===f.getIntFromString("DXT2"))throw"DXT2 is not supported.";else if(o===f.getIntFromString("DXT4"))throw"DXT4 is not supported.";else throw"unsupported compressed dds format found ("+o+")";}else if(b.bpp=b.header.ddpf.dwRGBBitCount,h)a.format=j?"RGBA":"RGB";else if(n||
j)if(n&&j)a.format="LuminanceAlpha";else if(n)a.format="Luminance";else{if(k)a.format="Alpha"}else throw Error("unsupported uncompressed dds format found.");b.calcMipmapSizes(i);a.image.mipmapSizes=b.mipmapByteSizes;for(var q=o=0;q<b.mipmapByteSizes.length;q++)o+=b.mipmapByteSizes[q];for(var m=[],q=0;q<a.image.depth;q++)i?m.push(c.readDXT(l,o,b,a)):(h||n||k)&&m.push(c.readUncompressed(l,o,h,n,k,j,b,a));a.image.data=a.image.depth===1?m[0]:m;a.image.useArrays=!0};c.prototype.load=function(e,d,l,k,i){var h=
new Int32Array(e,k+0,32);if(h[0]!==f.getIntFromString("DDS "))throw"Not a dds file.";var j=new a;j.flipVertically=l;j.header=b.read(h);j.headerDX10=j.header.ddpf.dwFourCC===f.getIntFromString("DX10")?b.read(Int32Array.create(e,k+128,5)):null;l=d.image;if(typeof l==="undefined"||l===null)l={},d.image=l;l.width=j.header.dwWidth;l.height=j.header.dwHeight;c.updateDepth(l,j);h=128+(j.headerDX10?20:0);c.populate(d,j,new Uint8Array(e,k+h,i-h));l.bpp=j.bpp;l.dataReady=!0;d.needsUpdate=!0};c.SUPPORTS_DDS=
!1;c.prototype.isSupported=function(){return c.SUPPORTS_DDS};c.prototype.toString=function(){return"DdsLoader"};return c});
define("goo/util/SimpleResourceUtil",[],function(){function f(){}f.countdown=function(d,b,a){d[0]--;if(d[0]===0)b.onSuccess(a)};f.loadTextAsset=function(d,b,a,c,e,g){var l=new XMLHttpRequest;l.open("GET",a[b],!0);l.onreadystatechange=function(){if(l.readyState===4)if(l.status>=200&&l.status<=299)e[c[b]]=l.responseText,f.countdown(d,g,e);else g.onError(l.statusText)};l.send()};f.loadTextAssets=function(d,b,a){for(var c=[d.length],e={},g=0,l=d.length;g<l;g++)f.loadTextAsset(c,g,d,b,e,a)};f.loadBinaryAsArrayBuffer=
function(d,b){var a=new XMLHttpRequest;a.open("GET",d);a.responseType="arraybuffer";a.onload=function(){if(a.status!==404)b.onSuccess(a.response);else a.onerror(null)};a.onerror=function(){b.onError(null)};a.send()};return f});define("goo/util/Latch",[],function(){function f(d,b){this.count=d;this.callback=b}f.prototype.countDown=function(){this.count--;this.isDone()&&this.callback&&this.callback()};f.prototype.isDone=function(){return this.count===0};return f});
define("goo/renderer/TextureCreator","goo/loaders/Loader,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/util/SimpleResourceUtil,goo/renderer/Util,goo/util/Latch".split(","),function(f,d,b,a,c,e){function g(a){a=a||{};this.verticalFlip=a.verticalFlip!==void 0?a.verticalFlip:!0;this._loader=a.loader!==void 0?a.loader:new f;this.textureLoaders={".dds":new b}}function l(a,c){return a.indexOf(c,a.length-c.length)!==-1}g.cache={};g.UNSUPPORTED_FALLBACK=".png";g.clearCache=function(){g.cache={}};g.prototype.loadTexture2D=
function(a,e){if(g.cache[a]!==void 0)return g.cache[a];var b=function(a){q.load(a,m,n.verticalFlip,0,a.byteLength);g._finishedLoading()},j=function(c){console.warn("Error loading texture: "+a+" | "+c)},n=this,o;for(o in this.textureLoaders)if(l(a.toLowerCase(),o)){var q=this.textureLoaders[o];if(!q||!q.isSupported()){a=a.substring(0,a.length-o.length);a+=g.UNSUPPORTED_FALLBACK;e=e||{};e.flipY=!1;break}var m=new d(c.clone(g.DEFAULT_TEXTURE_2D.image),e);m.image.dataReady=!1;m.a=a;g.cache[a]=m;this._loader.load(a,
null,f.ARRAY_BUFFER).then(b,j);return m}if(g.cache[a]!==void 0)return g.cache[a];var r=new d(null,e);g.cache[a]=r;this._loader.loadImage(a).then(function(a){r.setImage(a);g._finishedLoading(a)});return r};g.prototype.loadTextureVideo=function(a,e){if(g.cache[a]!==void 0)return g.cache[a];var b=document.createElement("video");b.loop=typeof e==="boolean"?e:!0;b.addEventListener("error",function(){console.warn("Couldn't load video URL ["+a+"]")},!1);var f=new d(b,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});
f.readyCallback=function(){if(b.readyState>=3){console.log("Video ready: "+b.videoWidth+", "+b.videoHeight);b.width=b.videoWidth;b.height=b.videoHeight;if(c.isPowerOfTwo(b.width)===!1||c.isPowerOfTwo(b.height)===!1)f.generateMipmaps=!1,f.minFilter="BilinearNoMipMaps";b.play();return b.dataReady=!0}return!1};f.updateCallback=function(){return!b.paused};b.crossOrigin="anonymous";b.src=a;return g.cache[a]=f};g.prototype.loadTextureWebCam=function(){var a=document.createElement("video");a.autoplay=!0;
a.loop=!0;var e=new d(a,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});e.readyCallback=function(){if(a.readyState>=3){console.log("WebCam video ready: "+a.videoWidth+", "+a.videoHeight);a.width=a.videoWidth;a.height=a.videoHeight;if(c.isPowerOfTwo(a.width)===!1||c.isPowerOfTwo(a.height)===!1)e.generateMipmaps=!1,e.minFilter="BilinearNoMipMaps";return a.dataReady=!0}return!1};e.updateCallback=function(){return!a.paused};window.URL=window.URL||window.webkitURL;navigator.getUserMedia=navigator.getUserMedia||
navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia?navigator.getUserMedia({video:!0},function(c){a.src=window.URL.createObjectURL(c)},function(a){console.warn("Unable to capture WebCam. Please reload the page.",a)}):console.warn("No support for WebCam getUserMedia found!");return e};g.prototype.loadTextureCube=function(a,c){var b=new d(null,c);b.variant="CUBE";for(var g=[],f=new e(6,function(){for(var a=g[0].width,c=g[0].height,e=0;e<6;e++){var d=
g[e];if(a!==d.width||c!==d.height)b.generateMipmaps=!1,b.minFilter="BilinearNoMipMaps",console.error("Images not all the same size!")}b.setImage(g);b.image.dataReady=!0;b.image.width=a;b.image.height=c}),l=this,q=0;q<a.length;q++)(function(c){var e=a[c];typeof e==="string"?l._loader.loadImage(e).then(function(a){g[c]=a;f.countDown()}):(g[c]=e,f.countDown())})(q);return b};g._globalCallback=null;g._finishedLoading=function(a){if(g._globalCallback)try{g._globalCallback(a)}catch(c){console.error("Error in texture callback:",
c)}};a=new Uint8Array([255,255,255,255]);g.DEFAULT_TEXTURE_2D=new d(a,null,1,1);g.DEFAULT_TEXTURE_CUBE=new d([a,a,a,a,a,a],null,1,1);g.DEFAULT_TEXTURE_CUBE.variant="CUBE";return g});
define("goo/addons/terrain/Terrain","goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/MeshData,goo/renderer/Material,goo/renderer/Shader,goo/renderer/TextureCreator".split(","),function(f,d,b,a,c,e){function g(c){var b=a.createMaterial(l),d=(new e).loadTexture2D("../resources/head_diffuse.jpg");b.textures.push(d);var g=a.createMaterial(l);g.textures.push(d);g.wireframe=!0;this.material=b;this.material2=g;b=c.createEntity();b.addToWorld();for(d=0;d<
6;d++)g=this.createClipmapLevel(c,d,d===0),b.transformComponent.attachChild(g.transformComponent)}g.prototype.createClipmapLevel=function(a,c,e){var b=a.createEntity(),d=Math.pow(2,c);b.transformComponent.transform.scale.set(d,d,1);d=(2*Math.pow(-1,c+1)+Math.pow(2,c+1))/6;c=c%2===0?d:-d;b.transformComponent.transform.translation.set(c,-c,0);b.addToWorld();this.createQuadEntity(a,b,0,0,3,3);this.createQuadEntity(a,b,3,0,3,3);this.createQuadEntity(a,b,6,0,2,3);this.createQuadEntity(a,b,8,0,3,3);this.createQuadEntity(a,
b,11,0,3,3);this.createQuadEntity(a,b,0,3,3,3);this.createQuadEntity(a,b,11,3,3,3);this.createQuadEntity(a,b,0,6,3,2);this.createQuadEntity(a,b,11,6,3,2);this.createQuadEntity(a,b,0,8,3,3);this.createQuadEntity(a,b,11,8,3,3);this.createQuadEntity(a,b,0,11,3,3);this.createQuadEntity(a,b,3,11,3,3);this.createQuadEntity(a,b,6,11,2,3);this.createQuadEntity(a,b,8,11,3,3);this.createQuadEntity(a,b,11,11,3,3);e&&this.createQuadEntity(a,b,3,4,7,7);return b};g.prototype.createQuadEntity=function(a,c,e,b,g,
l){e=this.createGrid(e,b,g,l);a=a.createEntity();c.transformComponent.attachChild(a.transformComponent);c=new f(e);a.setComponent(c);c=new d;c.materials.push(this.material2);a.setComponent(c);a.addToWorld();return a};g.prototype.createGrid=function(a,c,e,d){for(var g=b.defaultMap([b.POSITION,b.TEXCOORD0]),g=new b(g,(e+1)*(d+1),e*d*6),f=g.getAttributeBuffer(b.POSITION),l=g.getAttributeBuffer(b.TEXCOORD0),m=g.getIndexBuffer(),r=0;r<e+1;r++)for(var p=0;p<d+1;p++){var v=p*(e+1)+r;f[v*3+0]=r+a-7;f[v*3+
1]=p+c-7;f[v*3+2]=0;l[v*2+0]=(r+a)/15;l[v*2+1]=(p+c)/15}for(r=0;r<e;r++)for(p=0;p<d;p++)v=p*(e+1)+r,a=p*e+r,m[a*6+0]=v,m[a*6+1]=v+1,m[a*6+2]=v+e+1,m[a*6+3]=v+1,m[a*6+4]=v+e+1+1,m[a*6+5]=v+e+1;return g};var l={attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,diffuseMap:c.TEXTURE0,time:c.TIME},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform float time;\nuniform sampler2D diffuseMap;\nvarying vec4 texCol;\nvoid main(void) {\n\ttexCol = texture2D(diffuseMap, vertexUV0 + vec2(time*0.0));\n\tfloat height = length(texCol.rgb);\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * \n\t\tvec4(vertexPosition.x,vertexPosition.y,height*5.0, 1.0);\n}",
fshader:"precision mediump float;\nvarying vec4 texCol;\nvoid main(void)\n{\n\tgl_FragColor = texCol;\n}"};return g});
define("goo/util/Handy",[],function(){function f(){}f.deepFreeze=function(d){var b,a;Object.freeze(d);for(a in d)b=d[a],d.hasOwnProperty(a)&&!(typeof b!=="object"||Object.isFrozen(b))&&f.deepFreeze(b)};f.defineProperty=function(d,b,a,c){var e=a;Object.defineProperty(d,b,{get:function(){return e},set:function(a){e=a;c(e)},configurable:!0,enumerable:!0})};f.addListener=function(d,b,a,c){var e=d[b];Object.defineProperty(d,b,{get:function(){a&&a();return e},set:function(a){e=a;c&&c(e)},configurable:!0,
enumerable:!0})};return f});
define("goo/math/Vector4",["goo/math/Vector"],function(f){function d(){f.call(this,4);arguments.length!==0?this.set(arguments):this.setd(0,0,0,0)}d.prototype=Object.create(f.prototype);d.prototype.setupAliases([["x","r"],["y","g"],["z","b"],["w","a"]]);d.ZERO=new d(0,0,0,0);d.ONE=new d(1,1,1,1);d.UNIT_X=new d(1,0,0,0);d.UNIT_Y=new d(0,1,0,0);d.UNIT_Z=new d(0,0,1,0);d.UNIT_W=new d(0,0,0,1);d.add=function(b,a,c){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);c||(c=new d);b=b.data||
b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]+a[0];c.data[1]=b[1]+a[1];c.data[2]=b[2]+a[2];c.data[3]=b[3]+a[3];return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
c.data[0]=b[0]-a[0];c.data[1]=b[1]-a[1];c.data[2]=b[2]-a[2];c.data[3]=b[3]-a[3];return c};d.prototype.sub=function(b){return d.sub(this,b,this)};d.mul=function(b,a,c){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]*a[0];c.data[1]=b[1]*a[1];c.data[2]=b[2]*a[2];c.data[3]=b[3]*a[3];return c};d.prototype.mul=function(b){return d.mul(this,
b,this)};d.div=function(b,a,c){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]/a[0];c.data[1]=b[1]/a[1];c.data[2]=b[2]/a[2];c.data[3]=b[3]/a[3];return c};d.prototype.div=function(b){return d.div(this,b,this)};d.dot=function(b,a){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);var c=b.data||b,
e=a.data||a;if(c.length!==4||e.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var d=0;d+=c[0]*e[0];d+=c[1]*e[1];d+=c[2]*e[2];d+=c[3]*e[3];return d};d.prototype.dot=function(b){return d.dot(this,b)};d.prototype.lerp=function(b,a){this.x=(1-a)*this.x+a*b.x;this.y=(1-a)*this.y+a*b.y;this.z=(1-a)*this.z+a*b.z;this.w=(1-a)*this.w+a*b.w;return this};d.prototype.setd=function(b,a,c,e){this.data[0]=b;this.data[1]=a;this.data[2]=c;this.data[3]=e;return this};
d.prototype.seta=function(b){this.data[0]=b[0];this.data[1]=b[1];this.data[2]=b[2];this.data[3]=b[3];return this};d.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];this.data[2]=b.data[2];this.data[3]=b.data[3];return this};return d});
define("goo/math/Plane",["goo/math/Vector3"],function(f){function d(b,a){this.normal=b!==void 0?new f(b):new f(f.UNIT_Y);this.constant=isNaN(a)?0:a}d.XZ=new d(f.UNIT_Y,0);d.XY=new d(f.UNIT_Z,0);d.YZ=new d(f.UNIT_X,0);d.prototype.pseudoDistance=function(b){return this.normal.dot(b)-this.constant};d.prototype.setPlanePoints=function(b,a,c){this.normal.set(a).subtractLocal(b);this.normal.crossLocal(c.x-b.x,c.y-b.y,c.z-b.z).normalizeLocal();this.constant=this.normal.dot(b);return this};d.prototype.reflectVector=
function(b,a){var c=a;c===null&&(c=new f);var e=this.normal.dot(b)*2;c.set(b).subtractLocal(this.normal.x*e,this.normal.y*e,this.normal.z*e);return c};return d});
define("goo/math/Ray",["goo/math/Vector3","goo/math/MathUtils"],function(f,d){function b(a,c){this.origin=a||new f;this.direction=c||(new f).copy(f.UNIT_Z)}b.prototype.intersects=function(a,c,e){if(a.length===3)return this.intersectsTriangle(a[0],a[1],a[2],c,e);else if(a.length===4)return this.intersectsTriangle(a[0],a[1],a[2],c,e)||this.intersectsTriangle(a[0],a[2],a[3],c,e);return!1};b.prototype.intersectsTriangle=function(a,c,e,b,l){var k=(new f).set(this.origin).sub(a),c=(new f).set(c).sub(a),
a=(new f).set(e).sub(a),i=(new f).set(c).cross(a),e=this.direction.dot(i),h;if(e>d.EPSILON)h=1;else if(e<-d.EPSILON)h=-1,e=-e;else return!1;var a=h*this.direction.dot(f.cross(k,a,a)),j=!1;if(a>=0&&(c=h*this.direction.dot(c.cross(k)),c>=0&&a+c<=e&&(k=-h*k.dot(i),k>=0))){if(!l)return!0;e=1/e;k*=e;b?l.set(k,a*e,c*e):l.copy(this.origin).add(this.direction.x*k,this.direction.y*k,this.direction.z*k);j=!0}return j};b.prototype.getDistanceToPrimitive=function(a){var c=new f;return this.intersects(a,!1,c)?
this.origin.distance(c.x,c.y,c.z):Infinity};b.prototype.intersectsPlane=function(a,c){var e=a.normal,b=e.dot(this.direction);if(Math.abs(b)<1.0E-5)return!1;e=(-e.dot(this.origin)+a.constant)/b;if(e<1.0E-5)return!1;c!==null&&c.set(this.direction).multiplyLocal(e).addLocal(this.origin);return!0};b.prototype.distanceSquared=function(a,c){var e=new f;e.set(a).subtractLocal(this.origin);var b=this.direction.dot(e);b>0?(e.set(this.direction).multiplyLocal(b),e.addLocal(this.origin)):e.set(this.origin);
c!==null&&c.set(e);a.subtract(e,e);return e.lengthSquared()};return b});
define("goo/renderer/Camera","goo/util/Handy,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/math/Plane,goo/math/MathUtils,goo/math/Ray,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/renderer/bounds/BoundingVolume".split(","),function(f,d,b,a,c,e,g,l,k,i){function h(e,g,i,l){this.translation=new d(0,0,0);this._left=new d(-1,0,0);this._up=new d(0,1,0);this._direction=new d(0,0,-1);f.defineProperty(this,"this._depthRangeNear",0,function(){this._depthRangeDirty=!0});
f.defineProperty(this,"this._depthRangeFar",1,function(){this._depthRangeDirty=!0});this._depthRangeDirty=!0;this._frustumNear=1;this._frustumFar=2;this._frustumLeft=-0.5;this._frustumTop=this._frustumRight=0.5;this._frustumBottom=-0.5;this._coeffLeft=[];this._coeffRight=[];this._coeffBottom=[];this._coeffTop=[];this._viewPortLeft=0;this._viewPortTop=this._viewPortRight=1;this._viewPortBottom=0;this._planeQuantity=6;this._worldPlane=[];for(var k=0;k<h.FRUSTUM_PLANES;k++)this._worldPlane[k]=new c;
this._newDirection=new d;this.projectionMode=h.Perspective;this._updateInverseMVPMatrix=this._updateMVPMatrix=this._updatePMatrix=this._updateInverseMVMatrix=this._updateMVMatrix=!0;this.modelView=new a;this.modelViewInverse=new a;this.projection=new a;this.modelViewProjection=new a;this.modelViewProjectionInverse=new a;this._viewPortDirty=this._depthRangeDirty=!0;this._planeState=0;this._clipPlane=new b;this._qCalc=new b;this._corners=[];for(k=0;k<8;k++)this._corners.push(new d);this._extents=new d;
this.vNearPlaneCenter=new d;this.vFarPlaneCenter=new d;this.direction=new d;this.left=new d;this.up=new d;this.planeNormal=new d;this.setFrustumPerspective(e,g,i,l);this.onFrameChange()}h.LEFT_PLANE=0;h.RIGHT_PLANE=1;h.BOTTOM_PLANE=2;h.TOP_PLANE=3;h.FAR_PLANE=4;h.NEAR_PLANE=5;h.FRUSTUM_PLANES=6;h.Perspective=0;h.Parallel=1;h.Custom=2;h.Outside=0;h.Inside=1;h.Intersects=2;h.prototype.normalize=function(){this._left.normalize();this._up.normalize();this._direction.normalize();this.onFrameChange()};
h.prototype.setFrustumPerspective=function(a,c,b,d){if(a!==void 0&&a!==null)this.fov=a;if(c!==void 0&&c!==null)this.aspect=c;if(b!==void 0&&b!==null)this.near=b;if(d!==void 0&&d!==null)this.far=d;if(this.fov!==void 0)a=Math.tan(this.fov*e.DEG_TO_RAD*0.5)*this.near,c=a*this.aspect,this._frustumLeft=-c,this._frustumRight=c,this._frustumBottom=-a,this._frustumTop=a,this._frustumNear=this.near,this._frustumFar=this.far,this.onFrustumChange()};h.prototype.setFrustum=function(a,c,e,b,d,g){this.near=this._frustumNear=
a;this.far=this._frustumFar=c;this._frustumLeft=e;this._frustumRight=b;this._frustumTop=d;this._frustumBottom=g;this.onFrustumChange()};h.prototype.copy=function(a){this.translation.setv(a.translation);this._left.setv(a._left);this._up.setv(a._up);this._direction.setv(a._direction);this.fov=a.fov;this.aspect=a.aspect;this.near=a.near;this.far=a.far;this._frustumLeft=a._frustumLeft;this._frustumRight=a._frustumRight;this._frustumBottom=a._frustumBottom;this._frustumTop=a._frustumTop;this._frustumNear=
a._frustumNear;this._frustumFar=a._frustumFar;this.projectionMode=a.projectionMode;this._depthRangeDirty=!0;this.onFrustumChange();this.onFrameChange()};h.prototype.setFrame=function(a,c,e,b){this._left.copy(c);this._up.copy(e);this._direction.copy(b);this.translation.copy(a);this.onFrameChange()};h.prototype.lookAt=function(a,c){this._newDirection.copy(a).sub(this.translation).normalize();this._newDirection.equals(this._direction)||(this._direction.copy(this._newDirection),this._up.copy(c).normalize(),
this._up.equals(d.ZERO)&&this._up.copy(d.UNIT_Y),this._left.copy(this._up).cross(this._direction).normalize(),this._left.equals(d.ZERO)&&(this._direction.x!==0?this._left.set(this._direction.y,-this._direction.x,0):this._left.set(0,this._direction.z,-this._direction.y)),this._up.copy(this._direction).cross(this._left).normalize(),this.onFrameChange())};h.prototype.makeDirty=function(){this._viewPortDirty=this._depthRangeDirty=!0};h.prototype.update=function(){this._depthRangeDirty=!0;this.onFrustumChange();
this.onFrameChange()};h.prototype.setViewPort=function(){console.warn("Camera.setViewPort() not implemented.")};h.prototype.contains=function(a){if(!a)return h.Inside;for(var c=h.Inside,e=h.FRUSTUM_PLANES-1;e>=0;e--)switch(a.whichSide(this._worldPlane[e])){case i.Inside:return h.Outside;case i.Intersects:c=h.Intersects}return c};h.prototype.onFrustumChange=function(){if(this.projectionMode===h.Perspective){var a=this._frustumNear*this._frustumNear,c=this._frustumRight*this._frustumRight,e=this._frustumBottom*
this._frustumBottom,b=this._frustumTop*this._frustumTop,d=1/Math.sqrt(a+this._frustumLeft*this._frustumLeft);this._coeffLeft[0]=this._frustumNear*d;this._coeffLeft[1]=-this._frustumLeft*d;d=1/Math.sqrt(a+c);this._coeffRight[0]=-this._frustumNear*d;this._coeffRight[1]=this._frustumRight*d;d=1/Math.sqrt(a+e);this._coeffBottom[0]=this._frustumNear*d;this._coeffBottom[1]=-this._frustumBottom*d;d=1/Math.sqrt(a+b);this._coeffTop[0]=-this._frustumNear*d;this._coeffTop[1]=this._frustumTop*d}else this.projectionMode===
h.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft[0]=-1,this._coeffLeft[1]=0,this._coeffRight[0]=1):(this._coeffLeft[0]=1,this._coeffLeft[1]=0,this._coeffRight[0]=-1),this._coeffRight[1]=0,this._frustumTop>this._frustumBottom?(this._coeffBottom[0]=-1,this._coeffBottom[1]=0,this._coeffTop[0]=1):(this._coeffBottom[0]=1,this._coeffBottom[1]=0,this._coeffTop[0]=-1),this._coeffTop[1]=0);this._updateInverseMVPMatrix=this._updateInverseMVMatrix=this._updateMVPMatrix=this._updatePMatrix=
!0};h.prototype.onFrameChange=function(){var a=this._direction.dot(this.translation),c=this.planeNormal;c.x=this._left.x*this._coeffLeft[0];c.y=this._left.y*this._coeffLeft[0];c.z=this._left.z*this._coeffLeft[0];c.add([this._direction.x*this._coeffLeft[1],this._direction.y*this._coeffLeft[1],this._direction.z*this._coeffLeft[1]]);this._worldPlane[h.LEFT_PLANE].normal.copy(c);this._worldPlane[h.LEFT_PLANE].constant=this.translation.dot(c);c.x=this._left.x*this._coeffRight[0];c.y=this._left.y*this._coeffRight[0];
c.z=this._left.z*this._coeffRight[0];c.add([this._direction.x*this._coeffRight[1],this._direction.y*this._coeffRight[1],this._direction.z*this._coeffRight[1]]);this._worldPlane[h.RIGHT_PLANE].normal.copy(c);this._worldPlane[h.RIGHT_PLANE].constant=this.translation.dot(c);c.x=this._up.x*this._coeffBottom[0];c.y=this._up.y*this._coeffBottom[0];c.z=this._up.z*this._coeffBottom[0];c.add([this._direction.x*this._coeffBottom[1],this._direction.y*this._coeffBottom[1],this._direction.z*this._coeffBottom[1]]);
this._worldPlane[h.BOTTOM_PLANE].normal.copy(c);this._worldPlane[h.BOTTOM_PLANE].constant=this.translation.dot(c);c.x=this._up.x*this._coeffTop[0];c.y=this._up.y*this._coeffTop[0];c.z=this._up.z*this._coeffTop[0];c.add([this._direction.x*this._coeffTop[1],this._direction.y*this._coeffTop[1],this._direction.z*this._coeffTop[1]]);this._worldPlane[h.TOP_PLANE].normal.copy(c);this._worldPlane[h.TOP_PLANE].constant=this.translation.dot(c);if(this.projectionMode===h.Parallel)this._frustumRight>this._frustumLeft?
(this._worldPlane[h.LEFT_PLANE].constant=this._worldPlane[h.LEFT_PLANE].contant+this._frustumLeft,this._worldPlane[h.RIGHT_PLANE].constant=this._worldPlane[h.RIGHT_PLANE].contant-this._frustumRight):(this._worldPlane[h.LEFT_PLANE].constant=this._worldPlane[h.LEFT_PLANE].contant-this._frustumLeft,this._worldPlane[h.RIGHT_PLANE].constant=this._worldPlane[h.RIGHT_PLANE].contant+this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[h.TOP_PLANE].constant=this._worldPlane[h.TOP_PLANE].contant+
this._frustumTop,this._worldPlane[h.BOTTOM_PLANE].constant=this._worldPlane[h.BOTTOM_PLANE].contant-this._frustumBottom):(this._worldPlane[h.TOP_PLANE].constant=this._worldPlane[h.TOP_PLANE].contant-this._frustumTop,this._worldPlane[h.BOTTOM_PLANE].constant=this._worldPlane[h.BOTTOM_PLANE].contant+this._frustumBottom);c.copy(this._direction).invert();this._worldPlane[h.FAR_PLANE].normal.copy(c);this._worldPlane[h.FAR_PLANE].constant=-(a+this._frustumFar);this._worldPlane[h.NEAR_PLANE].normal.copy(this._direction);
this._worldPlane[h.NEAR_PLANE].constant=a+this._frustumNear;this._updateInverseMVPMatrix=this._updateInverseMVMatrix=this._updateMVPMatrix=this._updateMVMatrix=!0};h.prototype.updateProjectionMatrix=function(){if(this.projectionMode===h.Parallel){this.projection.setIdentity();var a=this.projection.data;a[0]=2/(this._frustumRight-this._frustumLeft);a[5]=2/(this._frustumTop-this._frustumBottom);a[10]=-2/(this._frustumFar-this._frustumNear);a[12]=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-
this._frustumLeft);a[13]=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom);a[14]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear)}else if(this.projectionMode===h.Perspective)this.projection.setIdentity(),a=this.projection.data,a[0]=2*this._frustumNear/(this._frustumRight-this._frustumLeft),a[5]=2*this._frustumNear/(this._frustumTop-this._frustumBottom),a[8]=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),a[9]=(this._frustumTop+
this._frustumBottom)/(this._frustumTop-this._frustumBottom),a[10]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),a[11]=-1,a[14]=-(2*this._frustumFar*this._frustumNear)/(this._frustumFar-this._frustumNear),a[15]=0};h.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var a=this.modelView.data;a[0]=-this._left.x;a[4]=-this._left.y;a[8]=-this._left.z;a[1]=this._up.x;a[5]=this._up.y;a[9]=this._up.z;a[2]=-this._direction.x;a[6]=-this._direction.y;a[10]=
-this._direction.z;a[12]=this._left.dot(this.translation);a[13]=-this._up.dot(this.translation);a[14]=this._direction.dot(this.translation)};h.prototype.getPickRay=function(a,c,e,b,f){f||(f=new g);var h=new d,i=new d;this.getWorldCoordinates(a,b-c,e,b,0,h);this.getWorldCoordinates(a,b-c,e,b,0.3,i).sub(h).normalize();f.origin.copy(h);f.direction.copy(i);return f};h.prototype.getWorldCoordinates=function(a,c,e,g,f,h){h||(h=new d);this.checkInverseModelViewProjection();var i=new b;i.set((a/e-this._viewPortLeft)/
(this._viewPortRight-this._viewPortLeft)*2-1,(c/g-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom)*2-1,f*2-1,1);this.modelViewProjectionInverse.applyPost(i);i.mul(1/i.w);h.x=i.x;h.y=i.y;h.z=i.z;return h};h.prototype.getScreenCoordinates=function(a,c,e,b){b=this.getNormalizedDeviceCoordinates(a,b);b.x=(b.x+1)*(this._viewPortRight-this._viewPortLeft)/2*c;b.y=(b.y+1)*(this._viewPortTop-this._viewPortBottom)/2*e;b.z=(b.z+1)/2;return b};h.prototype.getFrustumCoordinates=function(a,c){c=this.getNormalizedDeviceCoordinates(a,
c);c.x=(c.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft;c.y=(c.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom;c.z=(c.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear;return c};h.prototype.getNormalizedDeviceCoordinates=function(a,c){c||(c=new d);this.checkModelViewProjection();var e=new b;e.set(a.x,a.y,a.z,1);this.modelViewProjection.applyPost(e);e.mul(1/e.w);c.x=e.x;c.y=e.y;c.z=e.z;return c};h.prototype.checkModelView=function(){if(this._updateMVMatrix)this.updateModelViewMatrix(),
this._updateMVMatrix=!1};h.prototype.checkProjection=function(){if(this._updatePMatrix)this.updateProjectionMatrix(),this._updatePMatrix=!1};h.prototype.checkModelViewProjection=function(){if(this._updateMVPMatrix)this.checkModelView(),this.checkProjection(),this.modelViewProjection.copy(this.getProjectionMatrix()).combine(this.getViewMatrix()),this._updateMVPMatrix=!1};h.prototype.checkInverseModelView=function(){if(this._updateInverseMVMatrix)this.checkModelView(),a.invert(this.modelView,this.modelViewInverse),
this._updateInverseMVMatrix=!1};h.prototype.checkInverseModelViewProjection=function(){if(this._updateInverseMVPMatrix)this.checkModelViewProjection(),a.invert(this.modelViewProjection,this.modelViewProjectionInverse),this._updateInverseMVPMatrix=!1};h.prototype.getViewMatrix=function(){this.checkModelView();return this.modelView};h.prototype.getProjectionMatrix=function(){this.checkProjection();return this.projection};h.prototype.getViewProjectionMatrix=function(){this.checkModelViewProjection();
return this.modelViewProjection};h.prototype.getViewInverseMatrix=function(){this.checkInverseModelView();return this.modelViewInverse};h.prototype.getViewProjectionInverseMatrix=function(){this.checkInverseModelViewProjection();return this.modelViewProjectionInverse};h.prototype.pack=function(a){for(var c=a.center,e=this._corners,d=this._extents,g=0;g<e.length;g++)e[g].set(c);a instanceof l?d.setd(a.xExtent,a.yExtent,a.zExtent):a instanceof k&&d.setd(a.radius,a.radius,a.radius);e[0].add_d(d.x,d.y,
d.z);e[1].add_d(d.x,-d.y,d.z);e[2].add_d(d.x,d.y,-d.z);e[3].add_d(d.x,-d.y,-d.z);e[4].add_d(-d.x,d.y,d.z);e[5].add_d(-d.x,-d.y,d.z);e[6].add_d(-d.x,d.y,-d.z);e[7].add_d(-d.x,-d.y,-d.z);for(var d=this.getViewMatrix(),a=Number.MAX_VALUE,c=-Number.MAX_VALUE,f=new b,g=0;g<e.length;g++)f.setd(e[g].x,e[g].y,e[g].z,1),d.applyPre(f),a=Math.min(-f.z,a),c=Math.max(-f.z,c);a=Math.min(Math.max(this._frustumNear,a),this._frustumFar);c=Math.max(a,Math.min(this._frustumFar,c));e=a/this._frustumNear;this._frustumLeft*=
e;this._frustumRight*=e;this._frustumTop*=e;this._frustumBottom*=e;this._frustumNear=a;this._frustumFar=c};h.prototype.calculateFrustumCorners=function(a,c){var a=a!==void 0?a:this._frustumNear,c=c!==void 0?c:this._frustumFar,e=(this._frustumTop-this._frustumBottom)*a*0.5/this._frustumNear,b=(this._frustumRight-this._frustumLeft)*a*0.5/this._frustumNear,d=(this._frustumTop-this._frustumBottom)*c*0.5/this._frustumNear,g=(this._frustumRight-this._frustumLeft)*c*0.5/this._frustumNear;this.projectionMode===
h.Parallel&&(e=(this._frustumTop-this._frustumBottom)*0.5,b=(this._frustumRight-this._frustumLeft)*0.5,d=(this._frustumTop-this._frustumBottom)*0.5,g=(this._frustumRight-this._frustumLeft)*0.5);var f=this.vNearPlaneCenter,i=this.vFarPlaneCenter,l=this.direction,k=this.left,j=this.up;l.setv(this._direction).mul(a);f.setv(this.translation).addv(l);l.setv(this._direction).mul(c);i.setv(this.translation).addv(l);k.setv(this._left).mul(b);j.setv(this._up).mul(e);this._corners[0].setv(f).subv(k).subv(j);
this._corners[1].setv(f).addv(k).subv(j);this._corners[2].setv(f).addv(k).addv(j);this._corners[3].setv(f).subv(k).addv(j);k.setv(this._left).mul(g);j.setv(this._up).mul(d);this._corners[4].setv(i).subv(k).subv(j);this._corners[5].setv(i).addv(k).subv(j);this._corners[6].setv(i).addv(k).addv(j);this._corners[7].setv(i).subv(k).addv(j);return this._corners};var j=function(a){if(a>0)return 1;else if(a<0)return-1;return 0};h.prototype.setToObliqueMatrix=function(a,c){var c=c||0,e=this._clipPlane.setv(a);
this.getViewMatrix().applyPost(e);e.w=this.translation.y*a.y+c;this._updatePMatrix=!0;var d=this.getProjectionMatrix();this._qCalc.setd((j(e.x)+d[8])/d[0],(j(e.y)+d[9])/d[5],-1,(1+d[10])/d[14]);e.mul(2/b.dot(e,this._qCalc));d[2]=e.x;d[6]=e.y;d[10]=e.z+1;d[14]=e.w;this._updateInverseMVPMatrix=this._updateMVPMatrix=!0};return h});
define("goo/renderer/pass/RenderTarget",["goo/math/Vector2"],function(f){function d(b,a,c){this._glFrameBuffer=this._glRenderBuffer=this.glTexture=null;this.width=b;this.height=a;c=c||{};this.wrapS=c.wrapS!==void 0?c.wrapS:"EdgeClamp";this.wrapT=c.wrapT!==void 0?c.wrapT:"EdgeClamp";this.magFilter=c.magFilter!==void 0?c.magFilter:"Bilinear";this.minFilter=c.minFilter!==void 0?c.minFilter:"BilinearNoMipMaps";this.anisotropy=c.anisotropy!==void 0?c.anisotropy:1;this.offset=new f(0,0);this.repeat=new f(1,
1);this.format=c.format!==void 0?c.format:"RGBA";this.type=c.type!==void 0?c.type:"UnsignedByte";this.variant="2D";this.depthBuffer=c.depthBuffer!==void 0?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==void 0?c.stencilBuffer:!0;this.generateMipmaps=!1}d.prototype.clone=function(){var b=new d(this.width,this.height);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.anisotropy=this.anisotropy;b.minFilter=this.minFilter;b.offset.copy(this.offset);b.repeat.copy(this.repeat);b.format=
this.format;b.type=this.type;b.variant=this.variant;b.depthBuffer=this.depthBuffer;b.stencilBuffer=this.stencilBuffer;b.generateMipmaps=this.generateMipmaps;return b};return d});
define("goo/renderer/shaders/ShaderFragment",[],function(){function f(){}f.noisecommon="vec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}";f.noise2d=[f.noisecommon,"float snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}"].join("\n");
f.noise3d=[f.noisecommon,"vec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat snoise(vec3 v) {\n\tconst vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i  = floor(v + dot(v, C.yyy) );\n\tvec3 x0 =   v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min( g.xyz, l.zxy );\n\tvec3 i2 = max( g.xyz, l.zxy );\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i); \n\tvec4 p = permute( permute( permute( \n         i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n       + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n       + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3  ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\tvec4 x = x_ *ns.x + ns.yyyy;\n\tvec4 y = y_ *ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4( x.xy, y.xy );\n\tvec4 b1 = vec4( x.zw, y.zw );\n\tvec4 s0 = floor(b0)*2.0 + 1.0;\n\tvec4 s1 = floor(b1)*2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\tvec3 p0 = vec3(a0.xy,h.x);\n\tvec3 p1 = vec3(a0.zw,h.y);\n\tvec3 p2 = vec3(a1.xy,h.z);\n\tvec3 p3 = vec3(a1.zw,h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );\n}"].join("\n");
f.methods={packDepth:"vec4 packDepth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = fract( depth * bit_shift );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}",unpackDepth:"float unpackDepth( const in vec4 rgba_depth ) {\n\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\tfloat depth = dot( rgba_depth, bit_shift );\n\treturn depth;\n}"};
return f});
define("goo/renderer/shaders/ShaderLib",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/entities/World"],function(f,d,b,a){function c(){}c.screenCopy={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};c.copy=
{attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,opacity:1,diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);\n}"};
c.copyPure={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,opacity:1,diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 col = texture2D(diffuseMap, texCoord0);\n\tgl_FragColor = vec4(col.rgb, col.a * opacity);\n}"};
c.simple={attributes:{vertexPosition:f.POSITION},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nvoid main(void)\n{\n\tgl_FragColor = vec4(1.0);\n}"};c.simpleColored={attributes:{vertexPosition:f.POSITION},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,
worldMatrix:d.WORLD_MATRIX,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform vec3 color;\nvoid main(void)\n{\n\tgl_FragColor = vec4(color, 1.0);\n}"};c.simpleLit={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,
cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,materialAmbient:d.AMBIENT,materialDiffuse:d.DIFFUSE,materialSpecular:d.SPECULAR,materialSpecularPower:d.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * worldPos;\n\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvoid main(void)\n{\n\tvec4 final_color = materialAmbient;\n\tvec3 N = normalize(normal);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( max(dot(R, E), 0.0), materialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t\tfinal_color = clamp(final_color, vec4(0.0), vec4(1.0));\n\t}\n\tgl_FragColor = vec4(final_color.rgb, 1.0);\n}"};
c.textured={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};
c.texturedLit={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,diffuseMap:d.TEXTURE0,materialAmbient:d.AMBIENT,materialDiffuse:d.DIFFUSE,materialSpecular:d.SPECULAR,materialSpecularPower:d.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * worldPos;\n\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\ttexCoord0 = vertexUV0;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision highp float;\nuniform sampler2D diffuseMap;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n\tvec4 final_color = materialAmbient;\n\tvec3 N = normalize(normal);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( clamp(dot(R, E), 0.0, 1.0), materialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t}\n\tgl_FragColor = vec4(texCol.rgb * final_color.rgb, texCol.a);\n}"};
c.texturedNormalAOLit={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL,vertexTangent:f.TANGENT,vertexUV0:f.TEXCOORD0,vertexUV1:f.TEXCOORD1,vertexUV2:f.TEXCOORD2},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,diffuseMap:d.TEXTURE0,normalMap:d.TEXTURE1,aoMap:d.TEXTURE2,materialAmbient:d.AMBIENT,materialDiffuse:d.DIFFUSE,materialSpecular:d.SPECULAR,materialSpecularPower:d.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec4 vertexTangent;\nattribute vec2 vertexUV0;\nattribute vec2 vertexUV1;\nattribute vec2 vertexUV2;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 binormal;\nvarying vec3 tangent;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec2 texCoord2;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * worldPos;\n\tnormal = normalize((worldMatrix * vec4(vertexNormal, 0.0)).xyz);\n\ttangent = normalize((worldMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);\n\tbinormal = cross(normal, tangent) * vec3(vertexTangent.w);\n\ttexCoord0 = vertexUV0;\n\ttexCoord1 = vertexUV1;\n\ttexCoord2 = vertexUV2;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform sampler2D normalMap;\nuniform sampler2D aoMap;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 binormal;\nvarying vec3 tangent;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec2 texCoord2;\nvoid main(void)\n{\n\tmat3 tangentToWorld = mat3(tangent,\n\t\t\t\t\t\t\t\tbinormal,\n\t\t\t\t\t\t\t\tnormal);\n\tvec4 texCol = texture2D(diffuseMap, texCoord1);\n\tvec4 final_color = materialAmbient;\n\tvec3 tangentNormal = texture2D(normalMap, texCoord0).xyz * vec3(2.0) - vec3(1.0);\n\tvec3 worldNormal = (tangentToWorld * tangentNormal);\n\tvec3 N = normalize(worldNormal);\n\tvec4 aoCol = texture2D(aoMap, texCoord2);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( max(dot(R, E), 0.0),\n\t\t\t\t\t\tmaterialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t}\n\tgl_FragColor = vec4(texCol.rgb * aoCol.rgb * final_color.rgb, texCol.a);\n}"};
c.convolution={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:f.POSITION,uv:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:0,uImageIncrement:[0.001953125,0],cKernel:[]},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cKernel[ KERNEL_SIZE_INT ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvec2 imageCoord = vUv;\n\tvec4 sum = vec4( 0.0 );\n\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\timageCoord += uImageIncrement;\n\t}\n\tgl_FragColor = sum;\n}",buildKernel:function(a){var c,b,d,f,h=2*Math.ceil(a*3)+1;h>25&&(h=25);f=(h-1)*0.5;b=Array(h);for(c=
d=0;c<h;++c)b[c]=Math.exp(-((c-f)*(c-f))/(2*a*a)),d+=b[c];for(c=0;c<h;++c)b[c]/=d;return b}};c.showDepth={attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,near:d.NEAR_PLANE,far:d.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform float near;\nuniform float far;\nvoid main(void)\n{\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat d = 1.0 - smoothstep( near, far, depth );\n\tgl_FragColor = vec4(d);\n}"};c.showNormals={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\nvNormal = vec3(viewMatrix * worldMatrix * vec4(vertexNormal, 0.0)); //normalMatrix * vertexNormal;\ngl_Position = projectionMatrix * mvPosition;\n}",
fshader:"precision mediump float;\nuniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"};c.bokehShader={attributes:{position:f.POSITION,uv:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tColor:0,tDepth:1,focus:1,aspect:1,aperture:0.025,maxblur:1},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"};
c.particles={attributes:{vertexPosition:f.POSITION,vertexColor:f.COLOR,vertexUV0:f.TEXCOORD0},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,diffuseMap:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void) {\n    texCoord0 = vertexUV0;\n    color = vertexColor;\n\t gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n   if (color.a == 0.0 || texCol.a == 0.0) discard;\n\telse gl_FragColor = texCol * color;\n}"};c.sepia={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,amount:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nvec3 c = color.rgb;\ncolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\ncolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\ncolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\ngl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"};
c.dotscreen={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,tSize:[256,256],center:[0.5,0.5],angle:1.57,scale:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\nfloat s = sin( angle ), c = cos( angle );\nvec2 tex = vUv * tSize - center;\nvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\nreturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nfloat average = ( color.r + color.g + color.b ) / 3.0;\ngl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"};
c.vignette={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,offset:1,darkness:1.5},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\ngl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"};c.film={attributes:c.copy.attributes,uniforms:{tDiffuse:0,time:function(){return a.time},nIntensity:0.5,sIntensity:0.5,sCount:1024,grayscale:0,$link:c.copy.uniforms},vshader:c.copy.vshader,
fshader:"precision mediump float;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 texCoord0;\nvoid main() {\n\tvec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );\n\tfloat x = texCoord0.x * texCoord0.y * time * 1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\n\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\n\tvec2 sc = vec2( sin( texCoord0.y * sCount ), cos( texCoord0.y * sCount ) );\n\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\n\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\n\tif( grayscale ) {\n\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n\t}\n\tgl_FragColor = vec4( cResult, cTextureScreen.a );\n}"};
c.bleachbypass={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 base = texture2D( tDiffuse, vUv );\nvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\nfloat lum = dot( lumCoeff, base.rgb );\nvec3 blend = vec3( lum );\nfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\nvec3 result1 = 2.0 * base.rgb * blend;\nvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\nvec3 newColor = mix( result1, result2, L );\nfloat A2 = opacity * base.a;\nvec3 mixRGB = A2 * newColor.rgb;\nmixRGB += ( ( 1.0 - A2 ) * base.rgb );\ngl_FragColor = vec4( mixRGB, base.a );\n}"};
c.horizontalTiltShift={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,h:0.0078125,r:0.5},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat hh = h * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x,            vUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"};
c.colorify={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v * color, texel.w );\n}"};c.normalmap={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,heightMap:d.TEXTURE0,resolution:[512,512],
height:0.05},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\nfloat val = texture2D( heightMap, vUv ).x;\nfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\nfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\ngl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"};
c.ssao={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,tDepth:d.TEXTURE1,size:[512,512],cameraNear:d.MAIN_NEAR_PLANE,cameraFar:d.MAIN_FAR_PLANE,fogNear:d.MAIN_NEAR_PLANE,fogFar:d.MAIN_FAR_PLANE,fogEnabled:0,onlyAO:1,aoClamp:0.3,lumInfluence:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogEnabled;\nuniform bool onlyAO;\nuniform vec2 size;\nuniform float aoClamp;\nuniform float lumInfluence;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nfloat width = size.x;\nfloat height = size.y;\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nconst int samples = 16;\nconst float radius = 4.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0003;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\nconst vec3 onlyAOColor = vec3( 1.0, 1.0, 1.0 );\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( width / 2.0 ) );\nfloat gg = fract( coord.t * ( height / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat doFog() {\nfloat zdepth = unpackDepth( texture2D( tDepth, vUv ) );\nfloat depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );\nreturn smoothstep( fogNear, fogFar, depth );\n}\nfloat readDepth( const in vec2 coord ) {\nreturn cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat pw;\nfloat ph;\nfloat ao;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\npw = cos( l ) * r;\nph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nif ( fogEnabled ) {\nao = mix( ao, 1.0, doFog() );\n}\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"};
c.skinning={defines:{JOINT_COUNT:56,WEIGHTS:4},attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0,vertexWeights:f.WEIGHTS,vertexJointIDs:f.JOINTIDS},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,diffuseMap:d.TEXTURE0,jointPalette:function(a){var a=a.meshData,c=a.currentPose;if(c!==null){var c=c._matrixPalette,b=a.paletteMap.length*16,d=a.store;if(!d)d=new Float32Array(b),a.store=d;for(var f=0;f<a.paletteMap.length;f++)for(var b=c[a.paletteMap[f]],h=0;h<
4;h++)for(var j=0;j<4;j++)d[f*16+h*4+j]=b.data[j*4+h];return d}}},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nattribute vec4 vertexWeights;\nattribute vec4 vertexJointIDs;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 jointPalette[JOINT_COUNT];\nvarying vec2 texCoord0;\nvoid main(void) {\n\tmat4 mat = mat4(0.0);\n\tmat += jointPalette[int(vertexJointIDs.x)] * vertexWeights.x;\n\tmat += jointPalette[int(vertexJointIDs.y)] * vertexWeights.y;\n\tmat += jointPalette[int(vertexJointIDs.z)] * vertexWeights.z;\n\tmat += jointPalette[int(vertexJointIDs.w)] * vertexWeights.w;\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * mat * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};c.rgbshift={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,amount:0.005,angle:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float amount;\nuniform float angle;\nvarying vec2 vUv;\nvoid main() {\nvec2 offset = amount * vec2( cos(angle), sin(angle));\nvec4 cr = texture2D(tDiffuse, vUv + offset);\nvec4 cga = texture2D(tDiffuse, vUv);\nvec4 cb = texture2D(tDiffuse, vUv - offset);\ngl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n}"};c.brightnesscontrast={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,
worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,brightness:0,contrast:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float brightness;\nuniform float contrast;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb += brightness;\nif (contrast > 0.0) {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n} else {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n}\n}"};
c.luminosity={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v, v, v, texel.w );\n}"};
c.point={attributes:{vertexPosition:f.POSITION,vertexColor:f.COLOR},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,pointSize:2},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform float pointSize;\nvarying vec4 color;\nvoid main(void) {\n\tcolor = vertexColor;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_PointSize = pointSize;\n}",fshader:"precision mediump float;\nvarying vec4 color;\nvoid main(void)\n{\n\tgl_FragColor = color;\n}"};
c.toon={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,HighlightColour:[0.9,0.8,0.7,1],MidColour:[0.65,0.55,0.45,1],ShadowColour:[0.4,0.3,0.2,1],HighlightSize:0.2,ShadowSize:0.01,OutlineWidth:0.15},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 N;\nvarying vec3 V;\nvarying vec3 L;\nvoid main()\n{\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tN = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tL = lightPosition - worldPos.xyz;\n\tV = cameraPosition - worldPos.xyz;\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n}",
fshader:"precision mediump float;\nuniform vec4 HighlightColour;\nuniform vec4 MidColour;\nuniform vec4 ShadowColour;\nuniform float HighlightSize;\nuniform float ShadowSize;\nuniform float OutlineWidth;\nvarying vec3 N;\nvarying vec3 L;\nvarying vec3 V;\nvoid main()\n{\n\tvec3 n = normalize(N);\n\tvec3 l = normalize(L);\n\tvec3 v = normalize(V);\n    float lambert = dot(l,n);\n    vec4 colour = MidColour;\n    if (lambert > 1.0 - HighlightSize) colour = HighlightColour;\n    if (lambert < ShadowSize) colour = ShadowColour;\n    if (dot(n,v) < OutlineWidth) colour = vec4(0.0,0.0,0.0,1.0);\n    gl_FragColor = colour;\n}"};
c.differenceOfGaussians={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,gaussBlurredImage1:d.TEXTURE0,gaussBlurredImage2:d.TEXTURE1,originalImage:d.TEXTURE2,threshold:0.01},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D gaussBlurredImage1;\nuniform sampler2D gaussBlurredImage2;\nuniform sampler2D originalImage;\nuniform float threshold;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 blur1 = texture2D(gaussBlurredImage1, texCoord0);\n\tvec4 blur2 = texture2D(gaussBlurredImage2, texCoord0);\n\tvec4 originalColor = texture2D(originalImage, texCoord0);\n\tvec3 col = clamp(blur1.rgb - blur2.rgb, 0.0, 1.0);\n\tfloat value = (col.r + col.g + col.b) / 3.0;\n\tvalue = step(threshold, value);\n\tvec3 outputColor = mix(originalColor.rgb, vec3(value), value);\n\tgl_FragColor = vec4(outputColor, 1.0);\n}"};
c.downsample={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\n}"};
c.boxfilter={attributes:{vertexPosition:f.POSITION,vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,tDiffuse:d.TEXTURE0,viewport:[128,128]},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform vec2 viewport;\nvarying vec2 vUv;\nvoid main() {\nvec3 result = vec3(0.0);\nfor(int x=-1; x<=1; x++) {\n\tfor(int y=-1; y<=1; y++) {\n\t\tresult += texture2D(tDiffuse, vUv + vec2(x, y) / viewport).rgb;\n\t}\n}\ngl_FragColor = vec4(result / vec3(9.0), 1.0);\n}"};c.lightDepth={attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraFar:d.LIGHT_FAR_PLANE},
vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec3 worldPosition;\nvoid main(void) {\n\tvec4 viewpos = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tworldPosition = viewpos.xyz;\n\tgl_Position = projectionMatrix * viewpos;\n}",fshader:"precision mediump float;\nuniform mat4 viewMatrix;\nuniform float cameraFar;\nvarying vec3 worldPosition;\nvoid main(void)\n{\n\tfloat depth = clamp(length(worldPosition) / cameraFar, 0.0, 1.0);\n\tgl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\n}"};
c.packDepth={attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,farPlane:d.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",fshader:["precision mediump float;\nuniform float farPlane;",
b.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(length(vPosition), farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")};return c});
define("goo/entities/EventHandler",[],function(){function f(){}f.listeners=[];f.dispatch=function(){if(arguments.length===0)throw Error("Event needs to specify a callback as first argument");for(var d=arguments[0],b=Array.prototype.slice.call(arguments,1),a=0;a<f.listeners.length;a++){var c=f.listeners[a];c[d]&&c[d].apply(null,b)}};f.addListener=function(d){f.listeners.indexOf(d)===-1&&f.listeners.push(d)};f.removeListener=function(d){d=f.listeners.indexOf(d);d!==-1&&f.listeners.splice(d,1)};return f});
define("goo/addons/water/FlatWaterRenderer","goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/Camera,goo/math/Plane,goo/renderer/pass/RenderTarget,goo/math/Vector3,goo/math/Vector4,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/shaders/ShaderLib,goo/entities/EventHandler,goo/renderer/shaders/ShaderFragment".split(","),function(f,d,b,a,c,e,g,l,k,i,h,j){function n(d,f){this.camera=d;f=f||{};this.useRefraction=f.useRefraction!==void 0?f.useRefraction:!0;this.waterCamera=new b(45,
1,0.1,2E3);this.renderList=[];this.waterPlane=new a;var i=window.innerWidth/(f.divider||2),j=window.innerHeight/(f.divider||2);this.reflectionTarget=new c(i,j);if(this.useRefraction)this.refractionTarget=new c(i,j),this.depthTarget=new c(i,j);i=l.createMaterial(o,"WaterMaterial");i.shader.defines.REFRACTION=this.useRefraction;i.cullState.enabled=!1;j=f.normalsUrl||"../resources/water/waternormals3.png";i.textures[0]=(new k).loadTexture2D(j);i.textures[1]=this.reflectionTarget;if(this.useRefraction)i.textures[2]=
this.refractionTarget,i.textures[3]=this.depthTarget;this.waterMaterial=i;this.followCam=!0;this.calcVect=new e;this.camReflectDir=new e;this.camReflectUp=new e;this.camReflectLeft=new e;this.camLocation=new e;this.camReflectPos=new e;this.offset=new e;this.clipPlane=new g;this.waterEntity=null;this.depthMaterial=l.createMaterial(q,"depth");var u=this;this.camera=null;this.lights=[];h.addListener({setCurrentCamera:function(a){u.camera=a},setLights:function(a){u.lights=a}})}n.prototype.process=function(a,
c,e){var b=this.camera,d=this.waterPlane;this.waterCamera.copy(b);d.constant=this.waterEntity.transformComponent.transform.translation.y;var f=b.translation.y>d.constant;this.waterEntity.skip=!0;if(f){if(this.useRefraction)e.process(this.waterCamera,c,this.renderList),this.clipPlane.setd(d.normal.x,-d.normal.y,d.normal.z,d.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),a.overrideMaterial=this.depthMaterial,a.render(this.renderList,this.waterCamera,this.lights,this.depthTarget,!0),a.overrideMaterial=
null,a.render(this.renderList,this.waterCamera,this.lights,this.refractionTarget,!0);var g=this.calcVect,h=this.camReflectDir,i=this.camReflectUp,l=this.camReflectLeft,k=this.camLocation,j=this.camReflectPos;k.set(b.translation);var n=d.pseudoDistance(k);g.set(d.normal).mul(n*2);j.set(k.sub(g));k.set(b.translation).add(b._direction);n=d.pseudoDistance(k);g.set(d.normal).mul(n*2);h.set(k.sub(g)).sub(j).normalize();k.set(b.translation).add(b._up);n=d.pseudoDistance(k);g.set(d.normal).mul(n*2);i.set(k.sub(g)).sub(j).normalize();
l.set(i).cross(h).normalize();this.waterCamera.translation.set(j);this.waterCamera._direction.set(h);this.waterCamera._up.set(i);this.waterCamera._left.set(l);this.waterCamera.normalize();this.waterCamera.update();if(this.skybox&&this.followCam)g=this.skybox.transformComponent.worldTransform,g.translation.setv(j),g.update()}this.waterMaterial.shader.uniforms.abovewater=f;e.process(this.waterCamera,c,this.renderList);a.setRenderTarget(this.reflectionTarget);a.clear();if(this.skybox)if(this.skybox instanceof
Array){this.clipPlane.setd(d.normal.x,d.normal.y,d.normal.z,d.constant);this.waterCamera.setToObliqueMatrix(this.clipPlane,10);for(c=0;c<this.skybox.length;c++)a.render(this.skybox[c],this.waterCamera,this.lights,this.reflectionTarget,!1),this.skybox[c].skip=!0}else a.render(this.skybox,this.waterCamera,this.lights,this.reflectionTarget,!1),this.skybox.skip=!0;this.clipPlane.setd(d.normal.x,d.normal.y,d.normal.z,d.constant);this.waterCamera.setToObliqueMatrix(this.clipPlane);a.render(this.renderList,
this.waterCamera,this.lights,this.reflectionTarget,!1);this.waterEntity.skip=!1;if(this.skybox)if(this.skybox instanceof Array)for(c=0;c<this.skybox.length;c++)this.skybox[c].skip=!1;else this.skybox.skip=!1;if(f&&this.skybox&&this.followCam)a=b.translation,g=this.skybox.transformComponent.worldTransform,g.translation.setv(a).addv(this.offset),g.update(),this.waterCamera._updatePMatrix=!0};n.prototype.setSkyBox=function(a){this.skybox=a;if(a.meshRendererComponent)this.skybox.meshRendererComponent.materials[0].depthState.enabled=
!1,this.skybox.meshRendererComponent.materials[0].renderQueue=0,this.skybox.meshRendererComponent.cullMode="Never"};n.prototype.setWaterEntity=function(a){this.waterEntity=a;this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial};var o={defines:{REFRACTION:!1},attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,normalMap:d.TEXTURE0,reflection:d.TEXTURE1,
refraction:d.TEXTURE2,depthmap:d.TEXTURE3,vertexTangent:[1,0,0,1],waterColor:[0.0625,0.0625,0.0625],abovewater:!0,fogColor:[1,1,1],sunDirection:[0.66,0.66,0.33],sunColor:[1,1,0.5],sunShininess:100,sunSpecPower:4,fogStart:0,fogScale:2E3,timeMultiplier:1,time:d.TIME,distortionMultiplier:0.025,fresnelPow:2,normalMultiplier:3,fresnelMultiplier:1,waterScale:5,doFog:!0,resolution:d.RESOLUTION},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform vec4 vertexTangent;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform float waterScale;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvoid main(void) {\n\tworldPos = (worldMatrix * vec4(vertexPosition, 1.0)).xyz;\n\ttexCoord0 = worldPos.xz * waterScale;\n\tmat3 normalMatrix = mat3(worldMatrix);\n\tvec3 n = normalize(normalMatrix * vec3(vertexNormal.x, vertexNormal.y, -vertexNormal.z));\n\tvec3 t = normalize(normalMatrix * vertexTangent.xyz);\n\tvec3 b = cross(n, t) * vertexTangent.w;\n\tmat3 rotMat = mat3(t, b, n);\n\tvec3 eyeDir = worldPos - cameraPosition;\n\teyeVec = eyeDir * rotMat;\n\tviewCoords = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewCoords;\n}",
fshader:["precision highp float;\nuniform sampler2D normalMap;\nuniform sampler2D reflection;\n#ifdef REFRACTION\nuniform sampler2D refraction;\nuniform sampler2D depthmap;\n#endif\nuniform vec3 waterColor;\nuniform bool abovewater;\nuniform vec3 fogColor;\nuniform float fogStart;\nuniform float fogScale;\nuniform vec3 sunDirection;\nuniform float time;\nuniform float timeMultiplier;\nuniform float distortionMultiplier;\nuniform float fresnelPow;\nuniform vec3 sunColor;\nuniform float sunShininess;\nuniform float sunSpecPower;\nuniform float normalMultiplier;\nuniform float fresnelMultiplier;\nuniform bool doFog;\nuniform vec2 resolution;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvec4 getNoise(vec2 uv) {\n\tfloat t = time * timeMultiplier;\n    vec2 uv0 = (uv/vec2(123.0)) + vec2(t/17.0, t/29.0);\n    vec2 uv1 = (uv/vec2(167.0)) - vec2(t/-19.0, t/31.0);\n    vec2 uv2 = uv/vec2(827.0, 983.0) + vec2(t/51.0, t/47.0);\n    vec2 uv3 = uv/vec2(991.0, 877.0) - vec2(t/59.0, t/-63.0);\n    vec4 noise = (texture2D(normalMap, uv0)*0.25) +\n                 (texture2D(normalMap, uv1)*0.25) +\n                 (texture2D(normalMap, uv2)*0.75) +\n                 (texture2D(normalMap, uv3)*1.0);\n    return noise/2.25-0.48;\n}\nvoid sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, const float shiny, const float spec, inout vec3 specularColor){\n    vec3 reflection = normalize(reflect(-sunDirection, surfaceNormal));\n    float direction = max(0.0, dot(normalize(eyeDirection), reflection));\n    specularColor += pow(direction, shiny) * spec * sunColor;\n}",
j.methods.unpackDepth,"void main(void)\n{\n\tfloat fogDist = clamp((viewCoords.z-fogStart)/fogScale,0.0,1.0);\n\tvec2 normCoords = texCoord0;\n\tvec4 noise = getNoise(normCoords);\n\tvec3 normalVector = normalize(noise.xyz * vec3(normalMultiplier, normalMultiplier, 1.0));\n\tvec3 localView = normalize(eyeVec);\n\tfloat fresnel = dot(normalize(normalVector * vec3(fresnelMultiplier, fresnelMultiplier, 1.0)), localView);\n\tif ( abovewater == false ) {\n\t\tfresnel = -fresnel;\n\t}\n\tfresnel *= 1.0 - fogDist;\n\tfloat fresnelTerm = 1.0 - fresnel;\n\tfresnelTerm = pow(fresnelTerm, fresnelPow);\n\tfresnelTerm = clamp(fresnelTerm, 0.0, 1.0);\n\tfresnelTerm = fresnelTerm * 0.95 + 0.05;\n\tvec2 projCoord = viewCoords.xy / viewCoords.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tprojCoord.y -= 1.0 / resolution.y;\n#ifdef REFRACTION\n\tfloat depthUnpack = unpackDepth(texture2D(depthmap, projCoord));\n\tif (depthUnpack > 0.5) {depthUnpack = 0.0;}\n\tfloat depth2 = clamp(depthUnpack * 400.0, 0.0, 1.0);\n\tvec2 projCoordRefr = vec2(projCoord);\n\tprojCoordRefr += (normalVector.xy * distortionMultiplier) * (depth2);\n\tprojCoordRefr = clamp(projCoordRefr, 0.001, 0.999);\n\tdepthUnpack = unpackDepth(texture2D(depthmap, projCoordRefr));\n\tfloat depth = clamp(depthUnpack * 40.0, 0.8, 1.0);\n#else\n#endif\n\tprojCoord += (normalVector.xy * distortionMultiplier);\n\tprojCoord = clamp(projCoord, 0.001, 0.999);\n\tif ( abovewater == true ) {\n\t\tprojCoord.x = 1.0 - projCoord.x;\n\t}\n\tvec4 waterColorX = vec4(waterColor, 1.0);\n\tvec4 reflectionColor = texture2D(reflection, projCoord);\n\tif ( abovewater == false ) {\n\t\treflectionColor *= vec4(0.8,0.9,1.0,1.0);\n\t\tvec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);\n\t\tgl_FragColor = mix(endColor,waterColorX,fogDist);\n\t}\n\telse {\n\t\tvec3 specular = vec3(0.0);\n\t    sunLight(normalVector, localView, sunShininess, sunSpecPower, specular);\n\t\tvec4 endColor = waterColorX;\n#ifdef REFRACTION\n\t\tvec4 refractionColor = texture2D(refraction, projCoordRefr) * vec4(0.6);\n\t\tendColor = mix(refractionColor, waterColorX, depth);\n#endif\n\t\tendColor = mix(endColor, reflectionColor, fresnelTerm);\n\t\tif (doFog) {\n\t\t\tgl_FragColor = (vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist)) * (1.0-fogDist) + vec4(fogColor, 1.0) * fogDist;\n\t\t} else {\n\t\t\tgl_FragColor = vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist);\n\t\t}\n\t}\n}"].join("\n")},
q={attributes:{vertexPosition:f.POSITION},uniforms:{viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,farPlane:d.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * vPosition;\n}",fshader:["precision highp float;\nuniform float farPlane;",j.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = abs(vPosition.y) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")};
return n});
define("goo/shapes/Torus",["goo/renderer/MeshData","goo/math/Vector3","goo/math/MathUtils"],function(f,d,b){function a(a,c,b,d){this._circleSamples=a!==void 0?a:8;this._radialSamples=c!==void 0?c:8;this._tubeRadius=b!==void 0?b:1;this._centerRadius=d!==void 0?d:2;this.viewInside=!1;a=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]);f.call(this,a,(this._circleSamples+1)*(this._radialSamples+1),6*this._circleSamples*this._radialSamples);this.rebuild()}function c(a,c,b){a[b*3+0]=a[c*3+0];a[b*3+1]=a[c*
3+1];a[b*3+2]=a[c*3+2]}a.prototype=Object.create(f.prototype);a.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(f.POSITION),g=this.getAttributeBuffer(f.NORMAL),l=this.getAttributeBuffer(f.TEXCOORD0),k=this.getIndexBuffer(),i=1/this._circleSamples,h=1/this._radialSamples,j=0,n=new d,o=new d,q=new d,m=0;m<this._circleSamples;m++){var r=m*i,p=b.TWO_PI*r,v=Math.cos(p),p=Math.sin(p);n.set(v,p,0);d.mul(n,this._centerRadius,o);v=j;for(p=0;p<this._radialSamples;p++){var u=p*h,s=b.TWO_PI*u,
t=Math.cos(s),s=Math.sin(s);q.copy(n).mul(t);q.z+=s;q.normalize();this.viewInside?(g[j*3+0]=-q.x,g[j*3+1]=-q.y,g[j*3+2]=-q.z):(g[j*3+0]=q.x,g[j*3+1]=q.y,g[j*3+2]=q.z);q.mul(this._tubeRadius).add(o);a[j*3+0]=q.x;a[j*3+1]=q.y;a[j*3+2]=q.z;l[j*2+0]=u;l[j*2+1]=r;j++}c(a,v,j);c(g,v,j);l[j*2+0]=1;l[j*2+1]=r;j++}for(m=0;m<=this._radialSamples;m++,j++)c(a,m,j),c(g,m,j),i=l,h=m,n=j,i[n*2+0]=i[h*2+0],i[n*2+1]=i[h*2+1],l[j*2+1]=1;for(m=g=a=0;m<this._circleSamples;m++){l=g;i=l+1;g+=this._radialSamples+1;h=g;
n=h+1;for(j=0;j<this._radialSamples;j++)this.viewInside?(k[a++]=l++,k[a++]=i,k[a++]=h,k[a++]=i++,k[a++]=n++,k[a++]=h++):(k[a++]=l++,k[a++]=h,k[a++]=i,k[a++]=i++,k[a++]=h++,k[a++]=n++)}return this};return a});
define("goo/shapes/ShapeCreator",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Torus"],function(f,d,b,a){function c(){}c.createQuad=function(a,c,b,f){return new d(a,c,b,f)};c.createBox=function(a,c,b,d,i){return new f(a,c,b,d,i)};c.createSphere=function(a,c,d,f){return new b(a,c,d,f)};c.createTorus=function(c,b,d,f){return new a(c,b,d,f)};return c});
define("goo/renderer/pass/FullscreenUtil",["goo/shapes/ShapeCreator","goo/renderer/Camera","goo/math/Vector3"],function(f,d,b){function a(){}var c=new d;c.projectionMode=d.Parallel;c.setFrustum(-1,1,-1,1,1,-1);c._left.copy(b.UNIT_X).invert();c._up.copy(b.UNIT_Y);c._direction.copy(b.UNIT_Z);c.onFrameChange();a.camera=c;a.quad=f.createQuad(2,2);return a});
define("goo/renderer/pass/FullscreenPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(f,d,b){function a(a){this.material=f.createMaterial(a||b.simple);this.useReadBuffer=!0;this.renderToScreen=!1;this.renderable={meshData:d.quad,materials:[this.material]};this.enabled=!0;this.clear=!1;this.needsSwap=!0}a.prototype.render=function(a,e,b){this.useReadBuffer&&(this.material.textures[0]=b);this.renderToScreen?a.render(this.renderable,d.camera,
[],null,this.clear):a.render(this.renderable,d.camera,[],e,this.clear)};return a});
define("goo/addons/water/ProjectedGridWaterRenderer","goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/Camera,goo/math/Plane,goo/renderer/pass/RenderTarget,goo/renderer/pass/FullscreenPass,goo/math/Vector3,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/shaders/ShaderLib,goo/renderer/shaders/ShaderFragment".split(","),function(f,d,b,a,c,e,g,l,k,i,h){function j(d,h){this.camera=d;this.waterCamera=new b(45,1,0.1,2E3);this.renderList=[];this.waterPlane=new a;var h=h||{},j=window.innerWidth/
(h.divider||4),p=window.innerHeight/(h.divider||4);this.renderTarget=new c(j,p);j=window.innerWidth/(h.divider||1);p=window.innerHeight/(h.divider||1);this.heightTarget=new c(j,p,{type:"Float"});this.normalTarget=new c(j,p,{});this.fullscreenPass=new e(i.normalmap);this.fullscreenPass.material.shader.uniforms.resolution=[j,p];j=this.waterMaterial=l.createMaterial(n,"WaterMaterial");j.cullState.enabled=!1;j.textures[0]=(new k).loadTexture2D("../resources/water/waternormals3.png");j.textures[1]=this.renderTarget;
j.textures[2]=this.heightTarget;j.textures[3]=this.normalTarget;j=this.materialWire=l.createMaterial(i.simple,"mat");j.wireframe=!0;j.wireframeColor=[0,0,0];this.calcVect=new g;this.camReflectDir=new g;this.camReflectUp=new g;this.camReflectLeft=new g;this.camLocation=new g;this.camReflectPos=new g;this.waterEntity=null;j=this.projData=new f(f.defaultMap([f.POSITION]),4,6);j.getAttributeBuffer(f.POSITION).set([0,0,0,1,0,0,1,1,0,0,1,0]);j.getIndexBuffer().set([1,3,0,2,3,1]);p=l.createMaterial(o,"mat");
p.textures[0]=(new k).loadTexture2D("../resources/water/uniformclouds.jpg");this.projRenderable={meshData:j,materials:[p]}}j.prototype.updateHelper=function(a,c,e,b){var d=this.projData.getAttributeBuffer(f.POSITION);d[0]=a.x/a.w;d[1]=0;d[2]=a.z/a.w;d[3]=c.x/c.w;d[4]=0;d[5]=c.z/c.w;d[6]=e.x/e.w;d[7]=0;d[8]=e.z/e.w;d[9]=b.x/b.w;d[10]=0;d[11]=b.z/b.w;this.projData.setVertexDataUpdated()};j.prototype.process=function(a,c,e){var b=this.camera,d=this.waterEntity.meshDataComponent.meshData;d.update(this.camera);
this.waterMaterial.shader.uniforms.intersectBottomLeft=[d.intersectBottomLeft.x,d.intersectBottomLeft.y,d.intersectBottomLeft.z,d.intersectBottomLeft.w];this.waterMaterial.shader.uniforms.intersectBottomRight=[d.intersectBottomRight.x,d.intersectBottomRight.y,d.intersectBottomRight.z,d.intersectBottomRight.w];this.waterMaterial.shader.uniforms.intersectTopLeft=[d.intersectTopLeft.x,d.intersectTopLeft.y,d.intersectTopLeft.z,d.intersectTopLeft.w];this.waterMaterial.shader.uniforms.intersectTopRight=
[d.intersectTopRight.x,d.intersectTopRight.y,d.intersectTopRight.z,d.intersectTopRight.w];this.updateHelper(d.intersectBottomLeft,d.intersectBottomRight,d.intersectTopRight,d.intersectTopLeft);a.render(this.projRenderable,b,[],this.heightTarget,!0);this.fullscreenPass.render(a,this.normalTarget,this.heightTarget,0);var f=this.waterPlane;this.waterCamera.copy(b);f.constant=this.waterEntity.transformComponent.transform.translation.y;if(d=b.translation.y>f.constant){var g=this.calcVect,h=this.camReflectDir,
i=this.camReflectUp,k=this.camReflectLeft,l=this.camLocation,j=this.camReflectPos;l.set(b.translation);var n=f.pseudoDistance(l);g.set(f.normal).mul(n*2);j.set(l.sub(g));l.set(b.translation).add(b._direction);n=f.pseudoDistance(l);g.set(f.normal).mul(n*2);h.set(l.sub(g)).sub(j).normalize();l.set(b.translation).add(b._up);n=f.pseudoDistance(l);g.set(f.normal).mul(n*2);i.set(l.sub(g)).sub(j).normalize();k.set(i).cross(h).normalize();this.waterCamera.translation.set(j);this.waterCamera._direction.set(h);
this.waterCamera._up.set(i);this.waterCamera._left.set(k);this.waterCamera.normalize();this.waterCamera.update();if(this.skybox)f=this.skybox.transformComponent.worldTransform,f.translation.setv(j),f.update()}this.waterMaterial.shader.uniforms.abovewater=d;this.waterEntity.skip=!0;this.renderList.length=0;e.process(this.waterCamera,c,this.renderList);a.render(this.renderList,this.waterCamera,[],this.renderTarget,!0);this.waterEntity.skip=!1;if(d&&this.skybox)a=b.translation,f=this.skybox.transformComponent.worldTransform,
f.translation.setv(a),f.update()};j.prototype.setSkyBox=function(a){this.skybox=a};j.prototype.setWaterEntity=function(a){this.waterEntity=a;this.waterEntity.meshRendererComponent.cullMode="Never";this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial;a=this.waterEntity.meshDataComponent.meshData;this.waterMaterial.shader.uniforms.density=[a.densityX,a.densityY]};var n={attributes:{vertexUV0:f.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,
cameraPosition:d.CAMERA,normalMap:d.TEXTURE0,reflection:d.TEXTURE1,bump:d.TEXTURE2,normalMapCoarse:d.TEXTURE3,vertexNormal:[0,-1,0],vertexTangent:[1,0,0,1],waterColor:[15,15,15],abovewater:!0,fogColor:[1,1,1,1],sunDirection:[0.66,-0.1,0.66],coarseStrength:0.25,detailStrength:2,fogStart:0,camNear:d.NEAR_PLANE,camFar:d.FAR_PLANE,time:d.TIME,intersectBottomLeft:[0,0,0,0],intersectTopLeft:[0,0,0,0],intersectTopRight:[0,0,0,0],intersectBottomRight:[0,0,0,0],grid:!1,heightMultiplier:50,density:[1,1]},vshader:"attribute vec2 vertexUV0;\nuniform vec3 vertexNormal;\nuniform vec4 vertexTangent;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform float time;\nuniform vec3 sunDirection;\nuniform float coarseStrength;\nuniform float heightMultiplier;\nuniform sampler2D bump;\nuniform vec4 intersectBottomLeft;\nuniform vec4 intersectTopLeft;\nuniform vec4 intersectTopRight;\nuniform vec4 intersectBottomRight;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec3 eyeVec;\nvarying vec3 sunDir;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvarying vec3 normal;\nvoid main(void) {\n\tvec4 pointTop = mix(intersectTopLeft, intersectTopRight, vertexUV0.x);\n\tvec4 pointBottom = mix(intersectBottomLeft, intersectBottomRight, vertexUV0.x);\n\tvec4 pointFinal = mix(pointTop, pointBottom, 1.0 - vertexUV0.y);\n\tpointFinal.xz /= pointFinal.w;\n\tpointFinal.y = 0.0;\n\tvec4 screenpos = projectionMatrix * viewMatrix * worldMatrix * vec4(pointFinal.xyz, 1.0);\n\tvec2 projCoord = screenpos.xy / screenpos.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tfloat height = texture2D(bump, projCoord).x;\n\tpointFinal.y = height * heightMultiplier;\n\ttexCoord1 = vertexUV0;\n\tvec4 pos = worldMatrix * vec4(pointFinal.xyz, 1.0);\n\tworldPos = pos.xyz;\n\ttexCoord0 = worldPos.xz * 2.0;\n\tmat3 normalMatrix = mat3(worldMatrix);\n vec3 n = normalize(normalMatrix * vertexNormal);\n\tvec3 t = normalize(normalMatrix * vertexTangent.xyz);\n\tvec3 b = cross(n, t) * vertexTangent.w;\n\tmat3 rotMat = mat3(t, b, n);\n\tvec3 eyeDir = worldPos - cameraPosition;\n\teyeVec = eyeDir * rotMat;\n\tsunDir = sunDirection * rotMat;\n\tviewCoords = projectionMatrix * viewMatrix * pos;\n\tgl_Position = viewCoords;\n}",
fshader:"precision highp float;\nuniform sampler2D normalMap;\nuniform sampler2D reflection;\nuniform sampler2D normalMapCoarse;\nuniform vec3 waterColor;\nuniform bool abovewater;\nuniform vec4 fogColor;\nuniform float time;\nuniform bool grid;\nuniform vec2 density;\nuniform float camNear;\nuniform float camFar;\nuniform float fogStart;\nuniform float coarseStrength;\nuniform float detailStrength;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec3 eyeVec;\nvarying vec3 sunDir;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvarying vec3 normal;\nconst vec3 sunColor = vec3(1.0, 0.96, 0.96);\nvec4 getNoise(vec2 uv) {\n    vec2 uv0 = (uv/123.0)+vec2(time/17.0, time/29.0);\n    vec2 uv1 = uv/127.0-vec2(time/-19.0, time/31.0);\n    vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(time/51.0, time/47.0);\n    vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(time/59.0, time/-63.0);\n    vec4 noise = (texture2D(normalMap, uv0)) +\n                 (texture2D(normalMap, uv1)) +\n                 (texture2D(normalMap, uv2)*3.0) +\n                 (texture2D(normalMap, uv3)*3.0);\n    return noise/4.0-1.0;\n}\nvoid sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse,\n              inout vec3 diffuseColor, inout vec3 specularColor){\n    vec3 reflection = normalize(reflect(-sunDir, surfaceNormal));\n    float direction = max(0.0, dot(eyeDirection, reflection));\n    specularColor += pow(direction, shiny)*sunColor*spec;\n    diffuseColor += max(dot(sunDir, surfaceNormal),0.0)*sunColor*diffuse;\n}\nvoid main(void)\n{\n\tvec2 projCoord = viewCoords.xy / viewCoords.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tfloat fs = camFar * fogStart;\n\tfloat fogDist = clamp(max(viewCoords.z - fs, 0.0)/(camFar - camNear - fs), 0.0, 1.0);\n\tvec3 coarseNormal = texture2D(normalMapCoarse, projCoord).xyz * 2.0 - 1.0;\n\tvec2 normCoords = texCoord0;\n\tvec4 noise = getNoise(normCoords);\n\tvec3 normalVector = normalize(noise.xyz * vec3(1.8 * detailStrength, 1.8 * detailStrength, 1.0) + coarseNormal.xyz * vec3(1.8 * coarseStrength, 1.8 * coarseStrength, 1.0));\n\tvec3 localView = normalize(eyeVec);\n\tfloat fresnel = dot(normalize(normalVector*vec3(1.0, 1.0, 1.0)), localView);\n\tif ( abovewater == false ) {\n\t\tfresnel = -fresnel;\n\t}\n\tfloat fresnelTerm = 1.0 - fresnel;\n\tfresnelTerm *= fresnelTerm;\n\tfresnelTerm *= fresnelTerm;\n\tfresnelTerm = fresnelTerm * 0.95 + 0.05;\n\tif ( abovewater == true ) {\n\t\tprojCoord.x = 1.0 - projCoord.x;\n\t}\n\tprojCoord += (normalVector.xy * 0.05);\n\tprojCoord = clamp(projCoord, 0.001, 0.999);\n vec4 waterColorX = vec4(waterColor / 255.0, 1.0);\n\tvec4 reflectionColor = texture2D(reflection, projCoord);\n\tif ( abovewater == false ) {\n\t\treflectionColor *= vec4(0.8,0.9,1.0,1.0);\n\t\tvec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);\n\t\tgl_FragColor = mix(endColor,waterColorX,fogDist);\n\t}\n\telse {\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular = vec3(0.0);\n\t    sunLight(normalVector, localView, 100.0, 2.0, 0.4, diffuse, specular);\n\t\tvec4 endColor = mix(waterColorX,reflectionColor,fresnelTerm);\n\t\tgl_FragColor = mix(vec4(diffuse*0.0 + specular, 1.0) + mix(endColor,reflectionColor,fogDist), fogColor, fogDist);\n\t}\n\tif (grid) {\n\t\tvec2 low = abs(fract(texCoord1*density)-0.5);\n\t\tfloat dist = 1.0 - step(min(low.x, low.y), 0.05);\n\t\tgl_FragColor *= vec4(dist);\n\t}\n}"},
o={attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,time:d.TIME},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 worldPos;\nvarying vec4 viewCoords;\nvoid main(void) {\n\tworldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tviewCoords = viewMatrix * worldPos;\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n}",
fshader:["precision mediump float;\nuniform float time;\nvarying vec4 worldPos;\nvarying vec4 viewCoords;",h.noise3d,"vec4 getNoise(sampler2D map, vec2 uv) {\n    vec2 uv0 = (uv/223.0)+vec2(time/17.0, time/29.0);\n    vec2 uv1 = uv/327.0-vec2(time/-19.0, time/31.0);\n    vec2 uv2 = uv/vec2(697.0, 983.0)+vec2(time/151.0, time/147.0);\n    vec2 uv3 = uv/vec2(791.0, 877.0)-vec2(time/259.0, time/263.0);\n    vec4 noise = (texture2D(map, uv0)*0.0) +\n                 (texture2D(map, uv1)*0.0) +\n                 (texture2D(map, uv2)*0.0) +\n                 (texture2D(map, uv3)*10.0);\n    return noise/5.0-1.0;\n}\nvoid main(void)\n{\n\tfloat fogDist = clamp(-viewCoords.z / 1000.0, 0.0, 1.0);\n\tgl_FragColor = vec4((snoise(vec3(worldPos.xz * 0.008, time * 0.4))+snoise(vec3(worldPos.xz * 0.02, time * 0.8))*0.5)/10.0);\n}"].join("\n")};
return j});define("goo/animation/state/AbstractFiniteState",[],function(){function f(){this._globalStartTime=0;this._lastOwner=null}f.prototype.resetClips=function(d,b){this._globalStartTime=isNaN(b)?d.getCurrentGlobalTime():b};return f});
define("goo/animation/state/SteadyState",["goo/animation/state/AbstractFiniteState"],function(f){function d(b){f.call(this);this._name=b;this._transitions={};this._sourceTree=this._endTransition=null}d.prototype=Object.create(f.prototype);d.prototype.doTransition=function(b,a){var c=this._transitions[b];return c?c.doTransition(this,a):null};d.prototype.update=function(b,a){if(!this._sourceTree.setTime(b,a._manager)){var c=this._lastOwner;if(this._endTransition!==null){var e=this._endTransition.doTransition(this,
a);e&&(e.resetClips(a.getManager()),e.update(b,a));this!==e&&c.replaceState(this,e)}}};d.prototype.postUpdate=function(b){if(!this._sourceTree.isActive(b._manager))b=this._lastOwner,this._endTransition===null&&b.replaceState(this,null)};d.prototype.getCurrentSourceData=function(b){return this._sourceTree.getSourceData(b)};d.prototype.resetClips=function(b,a){f.prototype.resetClips.call(this,b,a);this._sourceTree.resetClips(b,this._globalStartTime)};return d});
define("goo/animation/layer/AnimationLayer",["goo/animation/state/SteadyState"],function(f){function d(b){this._name=b;this._steadyStates={};this._layerBlender=this._manager=this._currentState=null;this._transitions={}}d.BASE_LAYER_NAME="-BASE_LAYER-";d.prototype.doTransition=function(b){var a=this._currentState;if(a instanceof f){var c=a.doTransition(b,this);c||((b=this._transitions[b])||(b=this._transitions["*"]),b&&(c=b.doTransition(a,this)));if(c&&c!==a)return this.setCurrentState(c,!1),!0}else if(!a&&
((b=this._transitions[b])||(b=this._transitions["*"]),b))return this.setCurrentState(b.doTransition(a,this),!0),!0;return!1};d.prototype.setCurrentState=function(b,a){if(this._currentState=b)b._lastOwner=this,a&&b.resetClips(this._manager)};d.prototype.setCurrentStateByName=function(b,a){if(b){var c=this._steadyStates[b];if(c)return this.setCurrentState(c,a),!0;else console.warn("unable to find SteadyState named: "+b)}return!1};d.prototype.getCurrentSourceData=function(){return this._layerBlender!==
null?this._layerBlender.getBlendedSourceData(this._manager):this._currentState!==null?this._currentState.getCurrentSourceData(this._manager):null};d.prototype.updateLayerBlending=function(b){if(this._layerBlender)this._layerBlender._layerA=b,this._layerBlender._layerB=this};d.prototype.clearCurrentState=function(){this.setCurrentState(null,!1)};d.prototype.replaceState=function(b,a){this._currentState===b&&this.setCurrentState(a,!1)};return d});
define("goo/animation/clip/AnimationClipInstance",[],function(){function f(){this._active=!0;this._loopCount=0;this._timeScale=1;this._prevUnscaledClockTime=this._prevClockTime=this._startTime=0;this._clipStateObjects={};this._animationListeners=[]}f.prototype.setTimeScale=function(d,b){if(this._active&&this._timeScale!==d)if(this._timeScale!==0&&d!==0){var a=b.globalTime,c=a-this._startTime;c*=this._timeScale;c/=d;this._startTime=a-c}else if(this._timeScale===0)a=b.globalTime,this._startTime=a-this._prevUnscaledClockTime;
this._timeScale=d};f.prototype.getApplyTo=function(d){var b=d._channelName,a=this._clipStateObjects[b];a||(a=d.createStateDataObject(),this._clipStateObjects[b]=a);return a};f.prototype.fireAnimationFinished=function(){for(var d=0,b=this._animationListeners.length;d<b;d++)this._animationListeners[d].animationFinished(this)};return f});
define("goo/animation/AnimationManager",["goo/animation/layer/AnimationLayer","goo/animation/clip/AnimationClipInstance"],function(f,d){function b(a){this.globalTime=0;this._layers=[];this._applier=null;this._clipInstances={};this._updateRate=1/60;this._lastUpdate=0;var c=new f(f.BASE_LAYER_NAME);c._manager=this;this._layers.push(c);this._applyToPoses=[];a&&this._applyToPoses.push(a);this._valuesStore={}}b.prototype.update=function(a){this.globalTime+=a;a=this.globalTime;if(this._updateRate!==0){if(a-
this._lastUpdate<this._updateRate)return;this._lastUpdate=a-(a-this._lastUpdate)%this._updateRate}for(var c=0,e=this._layers.length;c<e;c++){var b=this._layers[c],d=b._currentState;d&&d.update(a,b)}c=0;for(e=this._applyToPoses.length;c<e;c++)this._applier.applyTo(this._applyToPoses[c],this);this._entityManager&&this._applier.apply(this._entityManager,this);c=0;for(e=this._layers.length;c<e;c++)b=this._layers[c],(d=b._currentState)&&d.postUpdate(b)};b.prototype.getClipInstance=function(a){var c=this._clipInstances[a];
if(!c)c=new d,c._startTime=this.globalTime,this._clipInstances[a]=c;return c};b.prototype.getCurrentSourceData=function(){for(var a=0,c=this._layers.length-1;a<c;a++)this._layers[a+1].updateLayerBlending(this._layers[a]);return this._layers[this._layers.length-1].getCurrentSourceData()};b.prototype.getCurrentGlobalTime=function(){return this.globalTime};b.prototype.resetClipInstance=function(a,c){var e=this.getClipInstance(a);if(e)e._startTime=c,e._active=!0};b.prototype.getBaseAnimationLayer=function(){return this._layers[0]};
b.prototype.findAnimationLayer=function(a){for(var c=0,e=this._layers.length;c<e;c++){var b=this._layers[c];if(a===b._name)return b}return null};b.prototype.addAnimationLayer=function(a){this._layers.push(a);a._manager=this;return this._layers.length-1};return b});define("goo/animation/Joint",["goo/math/Transform"],function(f){function d(b){this._name=b;this._parentIndex=this._index=0;this._inverseBindPose=new f}d.NO_PARENT=-32768;return d});
define("goo/animation/Skeleton",["goo/animation/Joint"],function(f){function d(b,a){this._name=b;this._joints=a}d.prototype.copy=function(){for(var b=this._name,a=this._joints,c=[],e=0,g=a.length;e<g;e++){var l=a[e],k=new f(l._name);k._index=l._index;k._parentIndex=l._parentIndex;k._inverseBindPose.copy(l._inverseBindPose);k._inverseBindPose.update();c[e]=k}return new d(b,c)};return d});
define("goo/animation/SkeletonPose",["goo/math/Transform","goo/animation/Joint","goo/math/Matrix4x4"],function(f,d,b){function a(a){this._skeleton=a;this._localTransforms=[];this._globalTransforms=[];this._matrixPalette=[];this._poseListeners=[];for(var a=this._skeleton._joints.length,e=0;e<a;e++)this._localTransforms[e]=new f;for(e=0;e<a;e++)this._globalTransforms[e]=new f;for(e=0;e<a;e++)this._matrixPalette[e]=new b;this.setToBindPose()}a.prototype.setToBindPose=function(){for(var a=new f,b=0;b<
this._localTransforms.length;b++){this._localTransforms[b].copy(this._skeleton._joints[b]._inverseBindPose);this._localTransforms[b].invert(this._localTransforms[b]);var g=this._skeleton._joints[b]._parentIndex;g!==d.NO_PARENT&&(a.multiply(this._skeleton._joints[g]._inverseBindPose,this._localTransforms[b]),this._localTransforms[b].copy(a))}this.updateTransforms()};a.prototype.updateTransforms=function(){for(var a=this._skeleton._joints.length,e=0;e<a;e++){var f=e,l=this._skeleton._joints[f]._parentIndex;
l!==d.NO_PARENT?this._globalTransforms[f].multiply(this._globalTransforms[l],this._localTransforms[f]):this._globalTransforms[f].copy(this._localTransforms[f]);b.combine(this._globalTransforms[f].matrix,this._skeleton._joints[f]._inverseBindPose.matrix,this._matrixPalette[f]);this._matrixPalette[f].transpose()}this.firePoseUpdated()};a.prototype.firePoseUpdated=function(){for(var a=this._poseListeners.length;--a>=0;)this._poseListeners[a].poseUpdated(this)};return a});
define("goo/animation/blendtree/AbstractTwoPartSource",[],function(){return function(f,d,b){this._sourceA=f?f:null;this._sourceB=d?d:null;this._blendKey=b?b:null}});
define("goo/animation/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(f,d){function b(a){this._rotation=(new f).copy(a?a._rotation:f.IDENTITY);this._scale=(new d).copy(a?a._scale:d.ONE);this._translation=(new d).copy(a?a._translation:d.ZERO)}b.prototype.applyTo=function(a){a.setIdentity();a.rotation.copyQuaternion(this._rotation);a.scale.data.set(this._scale.data);a.translation.data.set(this._translation.data);a.update()};b.prototype.set=function(a){this._rotation.copy(a._rotation);
this._scale.copy(a._scale);this._translation.copy(a._translation)};b.prototype.blend=function(a,c,e){var e=e?e:new b,d=0,l=0,k=0,i=0,h=0,j=0,n,o;o=1-c;n=this._translation;i+=n.x*o;h+=n.y*o;j+=n.z*o;n=this._scale;d+=n.x*o;l+=n.y*o;k+=n.z*o;o=c;n=a._translation;i+=n.x*o;h+=n.y*o;j+=n.z*o;n=a._scale;d+=n.x*o;l+=n.y*o;k+=n.z*o;e._scale.set(d,l,k);e._translation.set(i,h,j);f.slerp(this._rotation,a._rotation,o,e._rotation);return e};return b});
define("goo/animation/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animation/clip/TransformData","goo/animation/blendtree/AbstractTwoPartSource"],function(f,d,b){function a(a,e,d){b.call(this,a,e,d)}a.prototype=Object.create(b.prototype);a.prototype.getSourceData=function(c){var b=this._sourceA?this._sourceA.getSourceData(c):null,d=this._sourceB?this._sourceB.getSourceData(c):null;return a.combineSourceData(b,d,c._valuesStore[this._blendKey])};a.prototype.setTime=function(a,b){var d=!1;
this._sourceA&&(d=d||this._sourceA.setTime(a,b));this._sourceB&&(d=d||this._sourceB.setTime(a,b));return d};a.prototype.resetClips=function(a,b){this._sourceA&&this._sourceA.resetClips(a,b);this._sourceB&&this._sourceB.resetClips(a,b)};a.prototype.isActive=function(a){var b=!1;this._sourceA&&(b=b||this._sourceA.isActive(a));this._sourceB&&(b=b||this._sourceB.isActive(a));return b};a.combineSourceData=function(c,b,f,l){if(b){if(!c)return b}else return c;var l=l?l:{},k;for(k in c){var i=c[k],h=b[k];
isNaN(i)?l[k]=i instanceof d?h?i.blend(h,f,l[k]):i:i:a.blendFloatValues(l,k,f,i,h)}for(k in b)l[k]||(l[k]=b[k]);return l};a.blendFloatValues=function(a,b,d,l,k){a[b]=isNaN(k)?l:f.lerp(d,l[0],k[0])};return a});
define("goo/animation/blendtree/ClipSource",["goo/math/MathUtils"],function(f){function d(b,a){this._clip=b;a.getClipInstance(b)}d.prototype.setTime=function(b,a){var c=a.getClipInstance(this._clip),e;if(c._active){c._timeScale!==0?(c._prevUnscaledClockTime=b-c._startTime,e=c._timeScale*c._prevUnscaledClockTime,c._prevClockTime=e):e=c._prevClockTime;var d=this._clip._maxTime;if(d===-1)return!1;if(d!==0&&(c._loopCount===-1||c._loopCount>1&&d*c._loopCount>=Math.abs(e)?e<0?e=d+e%d:e%=d:e<0&&(e=d+e),
e>d||e<0))e=f.clamp(e,0,d),c.fireAnimationFinished(),c._active=!1;this._clip.update(e,c)}return c._active};d.prototype.resetClips=function(b,a){b.resetClipInstance(this._clip,a)};d.prototype.isActive=function(b){return b.getClipInstance(this._clip)._active&&this._clip._maxTime!==-1};d.prototype.getSourceData=function(b){return b.getClipInstance(this._clip)._clipStateObjects};return d});
define("goo/animation/clip/AbstractAnimationChannel",[],function(){function f(d,b){this._channelName=d;this._times=b instanceof Array&&b.length?b.slice(0):[]}f.prototype.getSampleCount=function(){return this._times.length};f.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0};f.prototype.updateSample=function(d,b){if(this._times.length){var a=this._times.length-1;if(d<0||this._times.length===1)this.setCurrentSample(0,0,b);else if(d>=this._times[a])this.setCurrentSample(a,
0,b);else{for(var c=a=0;c<this._times.length-1;c++)this._times[c]<d&&(a=c);this.setCurrentSample(a,(d-this._times[a])/(this._times[a+1]-this._times[a]),b)}}};return f});
define("goo/animation/clip/TransformChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TransformData","goo/math/Quaternion","goo/math/Vector3"],function(f,d,b,a){function c(c,d,l,k,i){f.call(this,c,d);if(l.length/4!==d.length||k.length/3!==d.length||i.length/3!==d.length)throw Error("All provided arrays must be the same length (accounting for type)! Channel: "+c);this._rotations=l.slice(0);this._translations=k.slice(0);this._scales=i.slice(0);this.tmpVec=new a;this.tmpQuat=
new b;this.tmpQuat2=new b}c.prototype=Object.create(f.prototype);c.prototype.createStateDataObject=function(){return new d};c.prototype.setCurrentSample=function(a,c,d){var f=a*4,i=a*3,h=(a+1)*4,a=(a+1)*3;c===0?(d._rotation.data[0]=this._rotations[f+0],d._rotation.data[1]=this._rotations[f+1],d._rotation.data[2]=this._rotations[f+2],d._rotation.data[3]=this._rotations[f+3],d._translation.data[0]=this._translations[i+0],d._translation.data[1]=this._translations[i+1],d._translation.data[2]=this._translations[i+
2],d._scale.data[0]=this._scales[i+0],d._scale.data[1]=this._scales[i+1],d._scale.data[2]=this._scales[i+2]):c===1?(d._rotation.data[0]=this._rotations[h+0],d._rotation.data[1]=this._rotations[h+1],d._rotation.data[2]=this._rotations[h+2],d._rotation.data[3]=this._rotations[h+3],d._translation.data[0]=this._translations[a+0],d._translation.data[1]=this._translations[a+1],d._translation.data[2]=this._translations[a+2],d._scale.data[0]=this._scales[a+0],d._scale.data[1]=this._scales[a+1],d._scale.data[2]=
this._scales[a+2]):(d._rotation.data[0]=this._rotations[f+0],d._rotation.data[1]=this._rotations[f+1],d._rotation.data[2]=this._rotations[f+2],d._rotation.data[3]=this._rotations[f+3],this.tmpQuat.data[0]=this._rotations[h+0],this.tmpQuat.data[1]=this._rotations[h+1],this.tmpQuat.data[2]=this._rotations[h+2],this.tmpQuat.data[3]=this._rotations[h+3],d._rotation.equals(this.tmpQuat)||(b.slerp(d._rotation,this.tmpQuat,c,this.tmpQuat2),d._rotation.setv(this.tmpQuat2)),d._translation.data[0]=this._translations[i+
0],d._translation.data[1]=this._translations[i+1],d._translation.data[2]=this._translations[i+2],this.tmpVec.data[0]=this._translations[a+0],this.tmpVec.data[1]=this._translations[a+1],this.tmpVec.data[2]=this._translations[a+2],d._translation.equals(this.tmpVec)||d._translation.lerp(this.tmpVec,c),d._scale.data[0]=this._scales[i+0],d._scale.data[1]=this._scales[i+1],d._scale.data[2]=this._scales[i+2],this.tmpVec.data[0]=this._scales[a+0],this.tmpVec.data[1]=this._scales[a+1],this.tmpVec.data[2]=
this._scales[a+2],d._scale.equals(this.tmpVec)||d._scale.lerp(this.tmpVec,c))};c.prototype.getTransformData=function(a,c){var b=c?c:new d;b.setRotation(this._rotations[a]);b.setScale(this._scales[a]);b.setTranslation(this._translations[a]);return b};return c});
define("goo/animation/clip/JointData",["goo/animation/clip/TransformData"],function(f){function d(b){f.call(this,b);this._jointIndex=b?b._jointIndex:0}d.prototype=Object.create(f.prototype);d.prototype.set=function(b){f.prototype.set.call(this,b);this._jointIndex=b._jointIndex};d.prototype.blend=function(b,a,c){if(c){if(c instanceof d)c._jointIndex=this._jointIndex}else c=new d,c._jointIndex=this._jointIndex;return f.prototype.blend.call(this,b,a,c)};return d});
define("goo/animation/clip/JointChannel",["goo/animation/clip/TransformChannel","goo/animation/clip/JointData"],function(f,d){function b(a,c,e,d,l,k){f.call(this,b.JOINT_CHANNEL_NAME+c,e,d,l,k);this._jointName=a;this._jointIndex=c}b.prototype=Object.create(f.prototype);b.JOINT_CHANNEL_NAME="_jnt";b.prototype.createStateDataObject=function(){return new d};b.prototype.setCurrentSample=function(a,c,b){f.prototype.setCurrentSample.call(this,a,c,b);b._jointIndex=this._jointIndex};b.prototype.getJointData=
function(a,c){var b=c?c:new d;f.prototype.getTransformData.call(this,a,b);b._jointIndex=this._jointIndex;return b};return b});
define("goo/animation/blendtree/ExclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(f,d){function b(a,c){d.call(this,a,c);this._disabledChannels={}}b.prototype=Object.create(d.prototype);b.prototype.clearDisabled=function(){this._disabledChannels={}};b.prototype.addDisabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._disabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._disabledChannels[arguments[a]]=
!0};b.prototype.addDisabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var c=f.JOINT_CHANNEL_NAME+arguments[0][a];this._disabledChannels[c]=!0}else for(a=0;a<arguments.length;a++)c=f.JOINT_CHANNEL_NAME+arguments[a],this._disabledChannels[c]=!0};b.prototype.getSourceData=function(a){var a=d.prototype.getSourceData.call(this,a),c={},b;for(b in a)this._disabledChannels[b]||(c[b]=a[b]);return c};return b});
define("goo/animation/blendtree/FrozenClipSource",[],function(){function f(d,b){this._source=d;this._time=b}f.prototype.getSourceData=function(d){return this._source.getSourceData(d)};f.prototype.resetClips=function(d){this._source.resetClips(d,0)};f.prototype.setTime=function(d,b){this._source.setTime(this._time,b);return!0};f.prototype.isActive=function(){return!0};return f});
define("goo/animation/blendtree/InclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(f,d){function b(a,c){d.call(this,a,c);this._enabledChannels={}}b.prototype=Object.create(d.prototype);b.prototype.clearEnabled=function(){this._enabledChannels={}};b.prototype.addEnabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._enabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._enabledChannels[arguments[a]]=
!0};b.prototype.addEnabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var c=f.JOINT_CHANNEL_NAME+arguments[0][a];this._enabledChannels[c]=!0}else for(a=0;a<arguments.length;a++)c=f.JOINT_CHANNEL_NAME+arguments[a],this._enabledChannels[c]=!0};b.prototype.getSourceData=function(a){var a=d.prototype.getSourceData.call(this,a),c={},b;for(b in this._enabledChannels)this._enabledChannels[b]&&(c[b]=a[b]);return c};return b});
define("goo/animation/blendtree/ManagedTransformSource",["goo/animation/clip/JointChannel","goo/animation/clip/JointData"],function(f,d){function b(a){this._sourceName=a?a:null;this._data={}}b.prototype.resetClips=function(){};b.prototype.setTime=function(){return!0};b.prototype.isActive=function(){return!0};b.prototype.setJointTransformData=function(a,c){var b=f.JOINT_CHANNEL_NAME+a;this._data[b]?this._data[b].set(c):this._data[b]=new d(c)};b.prototype.setJointTranslation=function(a,c){var b=f.JOINT_CHANNEL_NAME+
a;if(this._data[b])this._data[b]._translation.set(c);else{var g=new d;g._jointIndex=a;g._translation.set(c);this._data[b]=g}};b.prototype.setJointScale=function(a,c){var b=f.JOINT_CHANNEL_NAME+a;if(this._data[b])this._data[b]._scale.set(c);else{var g=new d;g._jointIndex=a;g._scale.set(c);this._data[b]=g}};b.prototype.setJointRotation=function(a,c){var b=f.JOINT_CHANNEL_NAME+a;if(this._data[b])this._data[b]._rotation.set(c);else{var g=new d;g._jointIndex=a;g._rotation.set(c);this._data[b]=g}};b.prototype.initJointsByName=
function(a,c,b){for(var g=0,l=b.length;g<l;g++){var k=a._skeleton.findJointByName(b[g]),i=new d;i._jointIndex=k;this.setJointTransformData(k,c.findChannelByName(f.JOINT_CHANNEL_NAME+k).getJointData(0,i))}};b.prototype.initJointsById=function(a,c){for(var b=0,g=c.length;b<g;b++){var l=c[b],k=new d;k._jointIndex=l;this.setJointTransformData(l,a.findChannelByName(f.JOINT_CHANNEL_NAME+l).getJointData(0,k))}};return b});
define("goo/animation/clip/TriggerData",[],function(){function f(){this._currentTriggers=[];this._currentIndex=-1;this._armed=!1}f.prototype.getCurrentTrigger=function(){return this._currentTriggers.length===0?null:this._currentTriggers[this._currentTriggers.size()-1]};f.prototype.arm=function(d,b){if(b===null||b.length===0)this._currentTriggers.length=0,this._armed=!1;else if(d!==this._currentIndex){for(var a=this._currentTriggers.length=0,c=b.length;a<c;a++)this._currentTriggers.push(b[a]);this._armed=
!0}this._currentIndex=d};return f});
define("goo/animation/blendtree/SimpleAnimationApplier",["goo/animation/clip/JointData","goo/animation/clip/TransformData","goo/animation/clip/TriggerData"],function(f,d,b){function a(){this._triggerCallbacks={}}a.prototype.apply=function(a,b){if(a){var g=b.getCurrentSourceData();if(g)for(var l in g){var k=g[l];if(k instanceof d&&!(k instanceof f)){var i=a.getEntityByName(l);i&&i.transformComponent&&k.applyTo(i.transformComponent.transform)}}}};a.prototype.applyTo=function(a,e){var d=e.getCurrentSourceData();
if(d){for(var l in d){var k=d[l];if(k instanceof f)k._jointIndex>=0&&k.applyTo(a._localTransforms[k._jointIndex]);else if(k instanceof b&&k.isArmed()){for(var i=0,h=k._currentTriggers.length;i<h;i++)for(var j=this._triggerCallbacks[k._currentTriggers[i]],n=0,o=j.length;n<o;n++)j[n](a,e);k.setArmed(!1)}}a.updateTransforms()}};return a});
define("goo/animation/clip/AnimationClip",[],function(){function f(d,b){this._name=d;this._channels=b||[];this._maxTime=-1;this.updateMaxTimeIndex()}f.prototype.update=function(d,b){for(var a=0,c=this._channels.length;a<c;++a){var e=this._channels[a],f=b.getApplyTo(e);e.updateSample(d,f)}};f.prototype.addChannel=function(d){this._channels.push(d);this.updateMaxTimeIndex()};f.prototype.removeChannel=function(d){d=this._channels.indexOf(d);return d>=0?(this._channels.splice(d,1),this.updateMaxTimeIndex(),
!0):!1};f.prototype.findChannelByName=function(d){for(var b=0,a=this._channels.length;b<a;++b){var c=this._channels[b];if(d===c._channelName)return c}return null};f.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;for(var d,b=0;b<this._channels.length;b++)if(d=this._channels[b].getMaxTime(),d>this._maxTime)this._maxTime=d};f.prototype.toString=function(){return this._name+this._channels.length};return f});
define("goo/animation/clip/TriggerChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TriggerData"],function(f,d){function b(a,c,b){f.call(this,a,c);this._keys=b?b.slice(0):null}b.prototype=Object.create(f.prototype);b.prototype.createStateDataObject=function(){return new d};b.prototype.setCurrentSample=function(a,c,b){a=c!==1?a:a+1;b.arm(a,[this._keys[a]])};return b});
define("goo/animation/clip/GuaranteedTriggerChannel",["goo/animation/clip/TriggerChannel"],function(f){function d(b,a,c){f.call(this,b,a,c)}d.prototype=Object.create(f.prototype);d.prototype.setCurrentSample=function(b,a,c){var e=c.getCurrentIndex(),b=a!==1?b:b+1;if(e===b)c.arm(b,this._keys[b]);else{a=[];for(e+=1;e<=b;e++)this._keys[e]||a.push(this._keys[e]);c.arm(b,a)}};return d});
define("goo/animation/clip/InterpolatedFloatChannel",["goo/animation/clip/AbstractAnimationChannel","goo/math/MathUtils"],function(f,d){function b(a,c,b){f.call(this,a,c);this._values=b?b.slice(0):null}b.prototype=Object.create(f.prototype);b.prototype.createStateDataObject=function(){return[0]};b.prototype.setCurrentSample=function(a,c,b){b[0]=d.lerp(c,this._values[a],this._values[a+1])};return b});
define("goo/animation/layer/LayerLERPBlender",["goo/animation/blendtree/BinaryLERPSource"],function(f){function d(){this._layerB=this._layerA=this._blendKey=null}d.prototype.getBlendedSourceData=function(b){var a=this._layerA.getCurrentSourceData(),c=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData(b):null;return f.combineSourceData(a,c,b._valuesStore[this._blendKey])};return d});
define("goo/animation/state/AbstractTransitionState",["goo/animation/state/AbstractFiniteState"],function(f){function d(b){f.call(this);this._targetState=b;this._endWindow=this._startWindow=-1}d.prototype=Object.create(f.prototype);d.prototype.doTransition=function(b,a){return!a._currentState?null:this.isInTimeWindow(a._manager.getCurrentGlobalTime()-a._currentState._globalStartTime)?this.getTransitionState(b,a):null};d.prototype.isInTimeWindow=function(b){return this._startWindow<=0?this._endWindow<=
0?!0:b<=this._endWindow:this._endWindow<=0?b>=this._startWindow:this._startWindow<=this._endWindow?this._startWindow<=b&&b<=this._endWindow:b>=this._startWindow||b<=this._endWindow};d.prototype.getTransitionState=function(){return null};return d});define("goo/animation/state/StateBlendType",["goo/util/Enum"],function(f){return new f("Linear","SCurve3","SCurve5")});
define("goo/animation/state/AbstractTwoStateLerpTransition",["goo/animation/state/AbstractTransitionState","goo/animation/state/StateBlendType","goo/animation/blendtree/BinaryLERPSource","goo/math/MathUtils"],function(f,d,b,a){function c(a,c,b){f.call(this,a);this._fadeTime=c;this._type=b;this._start=this._percent=0;this._sourceData=this._stateB=this._stateA=null}c.prototype=Object.create(f.prototype);c.prototype.setStateA=function(a){if(a===this)throw Error("Can not set state A to self.");this._stateA=
a;if(this._stateA!==null)this._stateA._lastOwner=this;if(this._sourceData)this._sourceData={}};c.prototype.setStateB=function(a){if(a===this)throw Error("Can not set state B to self.");this._stateB=a;if(this._stateB!==null)this._stateB._lastOwner=this;if(this._sourceData)this._sourceData={}};c.prototype.update=function(c){c-=this._start;if(c>this._fadeTime)this._lastOwner.replaceState(this,this._stateB);else switch(c/=this._fadeTime,this._blendType){case d.SCurve3:this._percent=a.scurve3(c);break;
case d.SCurve5:this._percent=a.scurve5(c);break;case d.Linear:this._percent=c;break;default:this._percent=c}};c.prototype.getCurrentSourceData=function(a){var c=this._stateA?this._stateA.getCurrentSourceData(a):null,a=this._stateB?this._stateB.getCurrentSourceData(a):null;if(!this._sourceData)this._sourceData={};return b.combineSourceData(c,a,this._percent,this._sourceData)};c.prototype.getCurrentSourceData=function(a){var c=this._stateA?this._stateA.getCurrentSourceData(a):null,a=this._stateB?this._stateB.getCurrentSourceData(a):
null;if(!this._sourceData)this._sourceData={};return b.combineSourceData(c,a,this._percent,this._sourceData)};c.prototype.replaceState=function(a,c){if(c!==null)if(this._stateA===a)this._stateA=c;else if(this._stateB===a)this._stateB=c};return c});
define("goo/animation/state/FadeTransitionState",["goo/animation/state/AbstractTwoStateLerpTransition"],function(f){function d(b,a,c){f.call(this,b,a,c)}d.prototype=Object.create(f.prototype);d.prototype.update=function(b,a){f.prototype.update.call(this,b,a);this._stateA!==null&&this._stateA.update(b,a);this._stateB!==null&&this._stateB.update(b,a)};d.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);
if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._start);return this};d.prototype.postUpdate=function(b){this._stateA!==null&&this._stateA.postUpdate(b);this._stateB!==null&&this._stateB.postUpdate(b)};return d});
define("goo/animation/state/FrozenTransitionState",["goo/animation/state/AbstractTwoStateLerpTransition"],function(f){function d(b,a,c){f.call(this,b,a,c)}d.prototype=Object.create(f.prototype);d.prototype.update=function(b,a){f.prototype.update.call(this,b,a);this._stateB!==null&&this._stateB.update(b,a)};d.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,
this._start);return this};d.prototype.postUpdate=function(b){this._stateB!==null&&this._stateB.postUpdate(b)};return d});define("goo/animation/state/IgnoreTransitionState",["goo/animation/state/AbstractTransitionState"],function(f){function d(){f.call(this,null)}d.prototype=Object.create(f.prototype);d.prototype.update=function(){};d.prototype.getTransitionState=function(b){return b};d.prototype.getCurrentSourceData=function(){return null};d.prototype.postUpdate=function(){};return d});
define("goo/animation/state/ImmediateTransitionState",["goo/animation/state/AbstractTransitionState"],function(f){function d(b){f.call(this,b)}d.prototype=Object.create(f.prototype);d.prototype.getTransitionState=function(b,a){var c=a._steadyStates[this._targetState];if(!c)return null;c.resetClips(a._manager);return c};d.prototype.update=function(){};d.prototype.getCurrentSourceData=function(){return{}};d.prototype.postUpdate=function(){};return d});
define("goo/animation/state/SyncFadeTransitionState",["goo/animation/state/FadeTransitionState"],function(f){function d(b,a,c){f.call(this,b,a,c)}d.prototype=Object.create(f.prototype);d.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._stateA._globalStartTime);return this};return d});
define("goo/animation/state/loader/OutputStore",[],function(){function f(){this._attachments=[];this._usedClipSources={}}f.prototype.findAttachmentPoint=function(d){for(var b=0,a=this._attachments.length;b<a;b++){var c=this._attachments[b];if(d===c.getName())return c}return null};return f});
define("goo/entities/components/CSSTransformComponent",["goo/entities/components/Component"],function(f){function d(b){f.call(this);this.type="CSSTransformComponent";this.domElement=b}d.prototype=Object.create(f.prototype);return d});
define("goo/entities/EntityUtils",["goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CSSTransformComponent"],function(f,d,b,a){function c(){}function e(a,c,k){for(var i=a.createEntity(c.name),h=0;h<c._components.length;h++){var j=c._components[h];if(j instanceof f)i.transformComponent.transform.copy(j.transform);else if(j instanceof d){var n=new d(j.meshData);n.modelBound=new j.modelBound.constructor;
i.setComponent(n)}else if(j instanceof b){for(var o=new b,n=0;n<j.materials.length;n++)o.materials.push(j.materials[n]);i.setComponent(o)}else i.setComponent(j);for(n=0;n<c.transformComponent.children.length;n++)j=e(a,c.transformComponent.children[n].entity,k),i.transformComponent.attachChild(j.transformComponent)}k.callback&&k.callback(i);return i}c.clone=function(a,c,b){b=b||{};b.shareData=b.shareData||!0;b.shareMaterial=b.shareMaterial||!0;b.cloneHierarchy=b.cloneHierarchy||!0;return e(a,c,b)};
c.traverse=function(a,b){b&&b(a);for(var e=0;e<a.transformComponent.children.length;e++)c.traverse(a.transformComponent.children[e].entity,b)};c.updateWorldTransform=function(a){a.updateWorldTransform();for(var b=0;b<a.children.length;b++)c.updateWorldTransform(a.children[b])};c.createTypicalEntity=function(a,c){var e=a.createEntity(),f=new d(c);e.setComponent(f);f=new b;e.setComponent(f);return e};c.createDOMEntity=function(c,b){var e=c.createEntity();e.setComponent(new a(b));return e};return c});
define("goo/entities/systems/TransformSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"TransformSystem",["TransformComponent"])}d.prototype=Object.create(f.prototype);d.prototype.process=function(b){var a,c;for(a=0;a<b.length;a++)c=b[a].transformComponent,c._updated=!1,c._dirty&&c.updateTransform();for(a=0;a<b.length;a++)c=b[a].transformComponent,c._dirty&&this.updateWorldTransform(c)};d.prototype.updateWorldTransform=function(b){b.updateWorldTransform();for(var a=0;a<
b.children.length;a++)this.updateWorldTransform(b.children[a])};return d});define("goo/renderer/SimplePartitioner",["goo/renderer/Camera"],function(f){function d(){}d.prototype.added=function(){};d.prototype.removed=function(){};d.prototype.process=function(b,a,c){for(var e=0,d=0;d<a.length;d++){var l=a[d];if(!l.skip)l.meshRendererComponent.cullMode==="Never"?(c[e++]=l,l.isVisible=!0):b.contains(l.meshRendererComponent.worldBound)!==f.Outside?(c[e++]=l,l.isVisible=!0):l.isVisible=!1}c.length=e};return d});
define("goo/entities/systems/RenderSystem",["goo/entities/systems/System","goo/entities/EventHandler","goo/renderer/SimplePartitioner"],function(f,d,b){function a(){f.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]);this.entities=[];this.renderList=[];this.partitioner=new b;this.preRenderers=[];this.composers=[];this.doRender=!0;this.camera=null;this.lights=[];this.currentTpf=0;var a=this;d.addListener({setCurrentCamera:function(b){a.camera=b},setLights:function(b){a.lights=
b}})}a.prototype=Object.create(f.prototype);a.prototype.inserted=function(a){this.partitioner&&this.partitioner.added(a)};a.prototype.deleted=function(a){this.partitioner&&this.partitioner.removed(a)};a.prototype.process=function(a,b){this.entities=a;this.currentTpf=b};a.prototype.render=function(a){a.checkResize(this.camera);if(this.doRender&&this.camera){for(var b=0;b<this.preRenderers.length;b++)this.preRenderers[b].process(a,this.entities,this.partitioner);this.partitioner.process(this.camera,
this.entities,this.renderList);if(this.composers.length>0)for(b=0;b<this.composers.length;b++)this.composers[b].render(a,this.currentTpf);else a.render(this.renderList,this.camera,this.lights)}};return a});
define("goo/renderer/RendererRecord",[],function(){function f(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}};this.currentFrameBuffer=null;this.clippingTestEnabled=this.clippingTestValid=!1;this.clips=[];this.enabledTextures=0;this.texturesValid=!1;this.currentTextureArraysUnit=0;this.textureRecord=[];this.usedProgram=null;this.boundAttributes=[];this.depthRecord={};this.cullRecord={};this.blendRecord={};this.offsetRecord={}}f.prototype.invalidateBuffer=
function(d){this.currentBuffer[d].buffer=null;this.currentBuffer[d].valid=!1};return f});
define("goo/renderer/shadow/ShadowHandler","goo/math/Vector3,goo/renderer/pass/FullscreenPass,goo/renderer/Camera,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/renderer/pass/RenderTarget,goo/math/Vector4".split(","),function(f,d,b,a,c,e,g){function l(){this.shadowY=this.shadowX=512;this.nearZ=1;this.farZ=1E3;this.lightCam=new b(55,1,this.nearZ,this.farZ);this.currentState="Perspective";this.depthMaterial=a.createMaterial(c.lightDepth,"depthMaterial");this.depthMaterial.cullState.cullFace=
"Front";this.shadowTarget=new e(this.shadowX,this.shadowY,{type:"Float"});this.shadowTargetDown=new e(this.shadowX/2,this.shadowY/2,{type:"Float"});this.shadowTargetDown2=new e(this.shadowX/4,this.shadowY/4,{type:"Float"});this.shadowResult=this.shadowBlurred=new e(this.shadowX/4,this.shadowY/4,{type:"Float"});this.fullscreenPass=new d;this.downsample=a.createShader(c.downsample,"downsample");this.boxfilter=a.createShader(c.boxfilter,"boxfilter");this.boxfilter.uniforms.viewport=[this.shadowX/4,this.shadowY/
4];this.oldClearColor=new g(0,0,0,0);this.shadowClearColor=new g(1,1,1,1)}l.prototype.checkShadowRendering=function(a,c,e,d){for(e=a.shadowCount=0;e<d.length;e++){var g=d[e];if(g.shadowCaster){var l=this.lightCam;l.translation.copy(g.translation);g.shadowSettings.projection==="Perspective"&&l.lookAt(f.ZERO,f.UNIT_Y);if(this.currentState!==g.shadowSettings.projection)if(this.currentState=g.shadowSettings.projection,g.shadowSettings.projection==="Perspective")l.setFrustumPerspective(g.shadowSettings.fov,
1,g.shadowSettings.near,g.shadowSettings.far);else if(g.shadowSettings.projection==="Parallel"){var q=g.shadowSettings.size;l.setFrustum(g.shadowSettings.near,g.shadowSettings.far,-q,q,q,-q);l.projectionMode=b.Parallel;l.update()}l.onFrameChange();this.oldClearColor.copy(a.clearColor);a.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a);a.overrideMaterial=this.depthMaterial;a.render(c,l,[],this.shadowTarget,!0,!0);a.overrideMaterial=null;
switch(g.shadowSettings.type){case "Blur":this.fullscreenPass.material.shader=this.downsample;this.fullscreenPass.render(a,this.shadowTargetDown,this.shadowTarget,0);this.fullscreenPass.render(a,this.shadowTargetDown2,this.shadowTargetDown,0);this.fullscreenPass.material.shader=this.boxfilter;this.fullscreenPass.render(a,this.shadowBlurred,this.shadowTargetDown2,0);this.shadowResult=this.shadowBlurred;break;case "None":this.shadowResult=this.shadowTarget;break;default:this.shadowResult=this.shadowBlurred}a.setClearColor(this.oldClearColor.r,
this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a);a.shadowCount++}}};return l});
define("goo/renderer/Renderer","goo/renderer/RendererRecord,goo/renderer/Util,goo/renderer/TextureCreator,goo/renderer/pass/RenderTarget,goo/math/Vector4,goo/entities/Entity,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/renderer/MeshData,goo/renderer/Material,goo/math/Transform,goo/renderer/RenderQueue,goo/renderer/shaders/ShaderLib,goo/renderer/shadow/ShadowHandler".split(","),function(f,d,b,a,c,e,g,l,k,i,h,j,n,o,q){function m(a){var a=a||{},b=a.canvas;if(b===void 0)b=
document.createElement("canvas"),b.width=500,b.height=500;this.domElement=b;this._alpha=a.alpha!==void 0?a.alpha:!1;this._premultipliedAlpha=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0;this._antialias=a.antialias!==void 0?a.antialias:!1;this._stencil=a.stencil!==void 0?a.stencil:!1;this._preserveDrawingBuffer=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1;this._onError=a.onError;var e={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,
preserveDrawingBuffer:this._preserveDrawingBuffer};this.context=null;try{if(this.context=b.getContext("experimental-webgl",e),!this.context)this.context=b.getContext("webgl",e)}catch(d){}if(!this.context)throw"WebGL is not supported! (Could not create WebGL context)";if(a.debug){var g=new XMLHttpRequest;g.open("GET","../lib/webgl-debug.js",!1);g.onreadystatechange=function(){g.readyState===4&&g.status>=200&&g.status<=299&&window.eval.call(window,g.responseText)};g.send(null);typeof window.WebGLDebugUtils===
"undefined"?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),a.validate?(console.log('Running with "undefined arguments" validation.'),this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),r)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))}this.rendererRecord=new f;this.glExtensionCompressedTextureS3TC=l.SUPPORTS_DDS=
k.isSupported(this.context);this.glExtensionTextureFloat=this.context.getExtension("OES_texture_float");this.glExtensionStandardDerivatives=this.context.getExtension("OES_standard_derivatives");this.glExtensionTextureFilterAnisotropic=this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic");this.glExtensionDepthTexture=this.context.getExtension("WEBGL_depth_texture")||
this.context.getExtension("WEBKIT_WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture");this.glExtensionTextureFloat||console.log("Float textures not supported.");this.glExtensionStandardDerivatives||console.log("Standard derivatives not supported.");this.glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported.");this.glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported.");this.glExtensionDepthTexture||console.log("Depth textures not supported.");
this.capabilities={maxTexSize:this.context.getParameter(p.MAX_TEXTURE_SIZE),maxCubeSize:this.context.getParameter(p.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderbufferSize:this.context.getParameter(p.MAX_RENDERBUFFER_SIZE),vertexUnits:this.context.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS),fragmentUnits:this.context.getParameter(p.MAX_TEXTURE_IMAGE_UNITS),combinedUnits:this.context.getParameter(p.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.context.getParameter(p.MAX_VERTEX_ATTRIBS),maxVertexShader:this.context.getParameter(p.MAX_VERTEX_UNIFORM_VECTORS),
maxFragmentShader:this.context.getParameter(p.MAX_FRAGMENT_UNIFORM_VECTORS),maxVaryingVectors:this.context.getParameter(p.MAX_VARYING_VECTORS)};this.downScale=a.downScale||1;this.clearColor=new c;this.setClearColor(0.3,0.3,0.3,1);this.context.clearDepth(1);this.context.clearStencil(0);this.context.stencilMask(0);this.context.enable(p.DEPTH_TEST);this.context.depthFunc(p.LEQUAL);this.currentHeight=this.currentWidth=this.viewportHeight=this.viewportWidth=this.viewportY=this.viewportX=0;this.overrideMaterial=
null;this.renderQueue=new n;this.info={calls:0,vertices:0,indices:0,reset:function(){this.indices=this.vertices=this.calls=0},toString:function(){return"Calls: "+this.calls+" Vertices: "+this.vertices+" Indices: "+this.indices}};this.shadowCount=0;this.shadowHandler=null}function r(a,c){for(var b=0;b<c.length;++b)c[b]===void 0&&console.error("undefined passed to gl."+a+"("+window.WebGLDebugUtils.glFunctionArgsToString(a,c)+")")}var p=window.WebGLRenderingContext;m.prototype.onDebugError=function(a,
c,b){for(var a="WebGL error "+window.WebGLDebugUtils.glEnumToString(a)+" in "+c+"(",e=0;e<b.length;++e)a+=(e===0?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(c,e,b[e]);a+=")";console.error(a);this._onError&&this._onError(a)};m.mainCamera=null;m.prototype.checkResize=function(a){var c=this.domElement.offsetWidth/this.downScale,b=this.domElement.offsetHeight/this.downScale;(c!==this.domElement.width||b!==this.domElement.height)&&this.setSize(c,b);c=this.domElement.width/this.domElement.height;
if(a&&a.aspect!==c)a.aspect=c,a.setFrustumPerspective(),a.onFrameChange()};m.prototype.setSize=function(a,c){this.domElement.width=a;this.domElement.height=c;this.setViewport(0,0,a,c)};m.prototype.setViewport=function(a,c,b,e){this.viewportX=a!==void 0?a:0;this.viewportY=c!==void 0?c:0;this.viewportWidth=b!==void 0?b:this.domElement.width;this.viewportHeight=e!==void 0?e:this.domElement.height;this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight)};m.prototype.setClearColor=
function(a,c,b,e){this.clearColor.set(a,c,b,e);this.context.clearColor(a,c,b,e)};m.prototype.bindData=function(a){var c=a.glBuffer;if(c!==null){if(this.setBoundBuffer(c,a.target),a._dataNeedsRefresh)this.context.bufferSubData(this.getGLBufferTarget(a.target),0,a.data),a._dataNeedsRefresh=!1}else c=this.context.createBuffer(),a.glBuffer=c,this.rendererRecord.invalidateBuffer(a.target),this.setBoundBuffer(c,a.target),this.context.bufferData(this.getGLBufferTarget(a.target),a.data,this.getGLBufferUsage(a._dataUsage))};
m.prototype.render=function(a,c,b,e,d,f){if(c){if(m.mainCamera===null)m.mainCamera=c;if(!f)if(this.shadowHandler)this.shadowHandler.checkShadowRendering(this,a,c,b);else for(f=0;f<b.length;f++)if(b[f].shadowCaster){this.shadowHandler=new q;break}this.setRenderTarget(e);d===void 0||d===null||d===!0?this.clear():typeof d==="object"&&this.clear(d.color,d.depth,d.stencil);b={camera:c,mainCamera:m.mainCamera,lights:b,lightCamera:this.shadowHandler?this.shadowHandler.lightCam:null,renderer:this};if(Array.isArray(a)){this.renderQueue.sort(a,
c);for(f=0;f<a.length;f++)this.fillRenderInfo(a[f],b),this.renderMesh(b)}else this.fillRenderInfo(a,b),this.renderMesh(b)}};m.prototype.fillRenderInfo=function(a,c){a instanceof e?(c.meshData=a.meshDataComponent.meshData,c.materials=a.meshRendererComponent.materials,c.transform=a.particleComponent?j.IDENTITY:a.transformComponent.worldTransform):(c.meshData=a.meshData,c.materials=a.materials,c.transform=a.transform)};m.prototype.renderMesh=function(a){var c=a.meshData;if(!(c.vertexData===null||c.vertexData!==
null&&c.vertexData.data.byteLength===0||c.indexData!==null&&c.indexData.data.byteLength===0)){this.bindData(c.vertexData);var b=a.materials;this.overrideMaterial!==null&&(b=[this.overrideMaterial]);for(var e=!1,d=c,f=0;f<b.length;f++){var g=b[f];if(g.shader){if(g._originalTextureCount===-1)g._originalTextureCount=g.textures.length;if(this.shadowCount>0)g.textures[g._originalTextureCount]=this.shadowHandler.shadowResult;if(g.wireframe&&!e){if(!c.wireframeData)c.wireframeData=this.buildWireframeData(c);
c=c.wireframeData;this.bindData(c.vertexData);if(!g.wireframeMaterial)g.wireframeMaterial=this.buildWireframeMaterial(g);g=g.wireframeMaterial;e=!0}else!g.wireframe&&e&&(c=d,this.bindData(c.vertexData),e=!1);a.material=g;g.shader.apply(a,this);this.updateDepthTest(g);this.updateCulling(g);this.updateBlending(g);this.updateOffset(g);this.updateTextures(g);c.getIndexBuffer()!==null?(this.bindData(c.getIndexData()),c.getIndexLengths()!==null?this.drawElementsVBO(c.getIndexBuffer(),c.getIndexModes(),
c.getIndexLengths()):this.drawElementsVBO(c.getIndexBuffer(),c.getIndexModes(),[c.getIndexBuffer().length])):c.getIndexLengths()!==null?this.drawArraysVBO(c.getIndexModes(),c.getIndexLengths()):this.drawArraysVBO(c.getIndexModes(),[c.vertexCount]);this.info.calls++;this.info.vertices+=c.vertexCount;this.info.indices+=c.indexCount}}}};m.prototype.readPixels=function(a,c,b,e,d){this.context.readPixels(a,c,b,e,p.RGBA,p.UNSIGNED_BYTE,d)};m.prototype.drawElementsVBO=function(a,c,b){for(var e=0,d=0,f=0;f<
b.length;f++){var g=b[f],h=this.getGLIndexMode(c[d]),i=this.getGLArrayType(a),k=this.getGLByteSize(a);this.context.drawElements(h,g,i,e*k);e+=g;d<c.length-1&&d++}};m.prototype.drawArraysVBO=function(a,c){for(var b=0,e=0,d=0;d<c.length;d++){var f=c[d];this.context.drawArrays(this.getGLIndexMode(a[e]),b,f);b+=f;e<a.length-1&&e++}};m.prototype.buildWireframeData=function(a){var c=d.clone(a.attributeMap),c=new i(c,0,0);c.vertexData=a.vertexData;c.dataViews=a.dataViews;c.attributeMap=a.attributeMap;c.vertexCount=
c._vertexCountStore=a.vertexCount;c.rebuildIndexData(a.indexCount*2);for(var b=a.getIndexBuffer(),e=c.getIndexBuffer(),f=0;f<a.indexCount;f++){var g=b[f*3+0],h=b[f*3+1],k=b[f*3+2];e[f*6+0]=g;e[f*6+1]=h;e[f*6+2]=h;e[f*6+3]=k;e[f*6+4]=k;e[f*6+5]=g}c.indexModes[0]="Lines";return c};m.prototype.buildWireframeMaterial=function(a){var c=h.createMaterial(o.simpleColored,"Wireframe");c.uniforms.color=a.wireframeColor||[1,1,1];return c};m.prototype.updateDepthTest=function(a){var c=this.rendererRecord.depthRecord,
a=a.depthState;if(c.enabled!==a.enabled)a.enabled?this.context.enable(p.DEPTH_TEST):this.context.disable(p.DEPTH_TEST),c.enabled=a.enabled;if(c.write!==a.write)a.write?this.context.depthMask(!0):this.context.depthMask(!1),c.write=a.write};m.prototype.updateCulling=function(a){var c=this.rendererRecord.cullRecord,b=a.cullState.cullFace,e=a.cullState.frontFace,a=a.cullState.enabled;if(c.enabled!==a)a?this.context.enable(p.CULL_FACE):this.context.disable(p.CULL_FACE),c.enabled=a;if(c.cullFace!==b)this.context.cullFace(b===
"Front"?p.FRONT:b==="Back"?p.BACK:p.FRONT_AND_BACK),c.cullFace=b;if(c.frontFace!==e){switch(e){case "CCW":this.context.frontFace(p.CCW);break;case "CW":this.context.frontFace(p.CW)}c.frontFace=e}};m.prototype.updateTextures=function(c){for(var e=this.context,f=0;f<c.shader.textureSlots.length;f++){var g=c.textures[f];if(g===void 0||g instanceof a===!1&&(g.image===void 0||g.checkDataReady()===!1))if(c.shader.textureSlots[f].format==="sampler2D")g=b.DEFAULT_TEXTURE_2D;else if(c.shader.textureSlots[f].format===
"samplerCube")g=b.DEFAULT_TEXTURE_CUBE;var h=this.rendererRecord.textureRecord[f];h===void 0&&(h=this.rendererRecord.textureRecord[f]={});g.glTexture===null?(g.glTexture=e.createTexture(),this.updateTexture(e,g,f,h)):g instanceof a===!1&&g.checkNeedsUpdate()?(this.updateTexture(e,g,f,h),g.needsUpdate=!1):this.bindTexture(e,g,f,h);h=g.image!==void 0?g.image:g;h=d.isPowerOfTwo(h.width)&&d.isPowerOfTwo(h.height);this.updateTextureParameters(g,h)}};m.prototype.updateTextureParameters=function(a,c){var b=
this.context,e=a.textureRecord;if(e===void 0)e={},a.textureRecord=e;if(e.magFilter!==a.magFilter){var d=this.getGLType(a.variant);b.texParameteri(d,p.TEXTURE_MAG_FILTER,this.getGLMagFilter(a.magFilter));e.magFilter=a.magFilter}var f=c?a.minFilter:this.getFilterFallback(a.minFilter);if(e.minFilter!==f)d=this.getGLType(a.variant),b.texParameteri(d,p.TEXTURE_MIN_FILTER,this.getGLMinFilter(f)),e.minFilter=f;f=c?a.wrapS:"EdgeClamp";if(e.wrapS!==f){var d=this.getGLType(a.variant),g=this.getGLWrap(f,b);
b.texParameteri(d,p.TEXTURE_WRAP_S,g);e.wrapS=f}f=c?a.wrapT:"EdgeClamp";if(e.wrapT!==f)d=this.getGLType(a.variant),g=this.getGLWrap(f,b),b.texParameteri(d,p.TEXTURE_WRAP_T,g),e.wrapT=f};m.prototype.bindTexture=function(a,c,b,e){if(e.boundTexture===void 0||c.glTexture!==void 0&&e.boundTexture!==c.glTexture)a.activeTexture(p.TEXTURE0+b),a.bindTexture(this.getGLType(c.variant),c.glTexture),e.boundTexture=c.glTexture};m.prototype.getGLType=function(a){switch(a){case "2D":return p.TEXTURE_2D;case "CUBE":return p.TEXTURE_CUBE_MAP}throw"invalid texture type: "+
a;};m.prototype.loadCompressedTexture=function(a,c,b,e){var d=b.image.mipmapSizes,f=0,g=0,h=b.image.width,i=b.image.height,l=k.getDdsExtension(a),j=l.COMPRESSED_RGBA_S3TC_DXT5_EXT;if(b.format==="PrecompressedDXT1")j=l.COMPRESSED_RGB_S3TC_DXT1_EXT;else if(b.format==="PrecompressedDXT1A")j=l.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if(b.format==="PrecompressedDXT3")j=l.COMPRESSED_RGBA_S3TC_DXT3_EXT;else if(b.format==="PrecompressedDXT5")j=l.COMPRESSED_RGBA_S3TC_DXT5_EXT;else throw Error("Unhandled compression format: "+
e.getDataFormat().name());if(typeof d==="undefined"||d===null)e instanceof Uint8Array?a.compressedTexImage2D(c,0,j,h,i,0,e):a.compressedTexImage2D(c,0,j,h,i,0,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));else{b.generateMipmaps=!1;for(l=0;l<d.length;l++)g=d[l],a.compressedTexImage2D(c,l,j,h,i,0,new Uint8Array(e.buffer,e.byteOffset+f,g)),h=~~(h/2)>1?~~(h/2):1,i=~~(i/2)>1?~~(i/2):1,f+=g;e=1+Math.ceil(Math.log(Math.max(b.image.height,b.image.width))/Math.log(2));f=d[d.length-1];if(d.length<e)for(l=
d.length;l<e;l++)f=~~((h+3)/4)*~~((i+3)/4)*b.image.bpp*2,a.compressedTexImage2D(c,l,j,h,i,0,new Uint8Array(f)),h=~~(h/2)>1?~~(h/2):1,i=~~(i/2)>1?~~(i/2):1}};m.prototype.updateTexture=function(a,c,b,e){this.bindTexture(a,c,b,e);a.pixelStorei(p.UNPACK_ALIGNMENT,1);a.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c.flipY);b=c.image;if(c.variant==="2D")if(b){if(c.generateMipmaps||b.width>this.capabilities.maxTexSize||b.height>this.capabilities.maxTexSize)this.checkRescale(c,b,b.width,b.height,this.capabilities.maxTexSize),
b=c.image;b.isData===!0?b.isCompressed?this.loadCompressedTexture(a,p.TEXTURE_2D,c,b.data):a.texImage2D(p.TEXTURE_2D,0,this.getGLInternalFormat(c.format),b.width,b.height,c.hasBorder?1:0,this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),b.data):a.texImage2D(p.TEXTURE_2D,0,this.getGLInternalFormat(c.format),this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),b);c.generateMipmaps&&!b.isCompressed&&a.generateMipmap(p.TEXTURE_2D)}else a.texImage2D(p.TEXTURE_2D,0,this.getGLInternalFormat(c.format),
c.width,c.height,0,this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),null);else if(c.variant==="CUBE"){if(b&&(c.generateMipmaps||b.width>this.capabilities.maxCubeSize||b.height>this.capabilities.maxCubeSize)){for(e=0;e<g.CUBE_FACES.length;e++)this.checkRescale(c,b.data[e],b.width,b.height,this.capabilities.maxCubeSize);b=c.image}for(e=0;e<g.CUBE_FACES.length;e++){var d=g.CUBE_FACES[e];b?b.isData===!0?b.isCompressed?this.loadCompressedTexture(a,this.getGLCubeMapFace(d),c,b.data[e]):
a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(c.format),b.width,b.height,c.hasBorder?1:0,this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),b.data[e]):a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(c.format),this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),b.data[e]):a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(c.format),c.width,c.height,0,this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),null)}b&&
c.generateMipmaps&&!b.isCompressed&&a.generateMipmap(p.TEXTURE_CUBE_MAP)}};m.prototype.checkRescale=function(a,c,b,e,f){var g=d.nearestPowerOfTwo(b),h=d.nearestPowerOfTwo(e),g=Math.min(g,f),h=Math.min(h,f);if(b!==g||e!==h)f=document.createElement("canvas"),f.width=g,f.height=h,f.getContext("2d").drawImage(c,0,0,b,e,0,0,g,h),document.body.appendChild(f),f.dataReady=!0,a.image=f,f.parentNode.removeChild(f)};m.prototype.getGLWrap=function(a){switch(a){case "Repeat":return p.REPEAT;case "MirroredRepeat":return p.MIRRORED_REPEAT;
case "EdgeClamp":return p.CLAMP_TO_EDGE}throw"invalid WrapMode type: "+a;};m.prototype.getGLInternalFormat=function(a){switch(a){case "RGBA":return p.RGBA;case "RGB":return p.RGB;case "Alpha":return p.ALPHA;case "Luminance":return p.LUMINANCE;case "LuminanceAlpha":return p.LUMINANCE_ALPHA;default:throw"Unsupported format: "+a;}};m.prototype.getGLPixelDataType=function(a){switch(a){case "UnsignedByte":return p.UNSIGNED_BYTE;case "UnsignedShort565":return p.UNSIGNED_SHORT_5_6_5;case "UnsignedShort4444":return p.UNSIGNED_SHORT_4_4_4_4;
case "UnsignedShort5551":return p.UNSIGNED_SHORT_5_5_5_1;case "Float":return p.FLOAT;default:throw"Unsupported type: "+a;}};m.prototype.getFilterFallback=function(a){switch(a){case "NearestNeighborNoMipMaps":case "NearestNeighborNearestMipMap":case "NearestNeighborLinearMipMap":return"NearestNeighborNoMipMaps";case "BilinearNoMipMaps":case "Trilinear":case "BilinearNearestMipMap":return"BilinearNoMipMaps";default:return"NearestNeighborNoMipMaps"}};m.prototype.getGLMagFilter=function(a){switch(a){case "Bilinear":return p.LINEAR;
case "NearestNeighbor":return p.NEAREST}throw"invalid MagnificationFilter type: "+a;};m.prototype.getGLMinFilter=function(a){switch(a){case "BilinearNoMipMaps":return p.LINEAR;case "Trilinear":return p.LINEAR_MIPMAP_LINEAR;case "BilinearNearestMipMap":return p.LINEAR_MIPMAP_NEAREST;case "NearestNeighborNoMipMaps":return p.NEAREST;case "NearestNeighborNearestMipMap":return p.NEAREST_MIPMAP_NEAREST;case "NearestNeighborLinearMipMap":return p.NEAREST_MIPMAP_LINEAR}throw"invalid MinificationFilter type: "+
a;};m.prototype.getGLBufferTarget=function(a){return a==="ElementArrayBuffer"?p.ELEMENT_ARRAY_BUFFER:p.ARRAY_BUFFER};m.prototype.getGLArrayType=function(a){if(a instanceof Uint8Array)return p.UNSIGNED_BYTE;else if(a instanceof Uint16Array)return p.UNSIGNED_SHORT;else if(a instanceof Uint32Array)return p.UNSIGNED_INT;else if(a instanceof Int8Array)return p.UNSIGNED_BYTE;else if(a instanceof Int16Array)return p.UNSIGNED_SHORT;else if(a instanceof Int32Array)return p.UNSIGNED_INT;return null};m.prototype.getGLByteSize=
function(a){if(!(a instanceof Uint8Array))if(a instanceof Uint16Array)return 2;else if(a instanceof Uint32Array)return 4;else if(!(a instanceof Int8Array))if(a instanceof Int16Array)return 2;else if(a instanceof Int32Array)return 4;return 1};m.prototype.getGLCubeMapFace=function(a){switch(a){case "PositiveX":return p.TEXTURE_CUBE_MAP_POSITIVE_X;case "NegativeX":return p.TEXTURE_CUBE_MAP_NEGATIVE_X;case "PositiveY":return p.TEXTURE_CUBE_MAP_POSITIVE_Y;case "NegativeY":return p.TEXTURE_CUBE_MAP_NEGATIVE_Y;
case "PositiveZ":return p.TEXTURE_CUBE_MAP_POSITIVE_Z;case "NegativeZ":return p.TEXTURE_CUBE_MAP_NEGATIVE_Z}throw"Invalid cubemap face: "+a;};m.prototype.getGLBufferUsage=function(a){var c=p.STATIC_DRAW;switch(a){case "StaticDraw":c=p.STATIC_DRAW;break;case "DynamicDraw":c=p.DYNAMIC_DRAW;break;case "StreamDraw":c=p.STREAM_DRAW}return c};m.prototype.getGLIndexMode=function(a){var c=p.TRIANGLES;switch(a){case "Triangles":c=p.TRIANGLES;break;case "TriangleStrip":c=p.TRIANGLE_STRIP;break;case "TriangleFan":c=
p.TRIANGLE_FAN;break;case "Lines":c=p.LINES;break;case "LineStrip":c=p.LINE_STRIP;break;case "LineLoop":c=p.LINE_LOOP;break;case "Points":c=p.POINTS}return c};m.prototype.updateBlending=function(a){var c=this.rendererRecord.blendRecord,b=this.context,e=a.blendState.blending;if(e!==c.blending)e==="NoBlending"?b.disable(p.BLEND):e==="AdditiveBlending"?(b.enable(p.BLEND),b.blendEquation(p.FUNC_ADD),b.blendFunc(p.SRC_ALPHA,p.ONE)):e==="SubtractiveBlending"?(b.enable(p.BLEND),b.blendEquation(p.FUNC_ADD),
b.blendFunc(p.ZERO,p.ONE_MINUS_SRC_COLOR)):e==="MultiplyBlending"?(b.enable(p.BLEND),b.blendEquation(p.FUNC_ADD),b.blendFunc(p.DST_COLOR,p.ONE_MINUS_SRC_ALPHA)):e==="AlphaBlending"?(b.enable(p.BLEND),b.blendEquation(p.FUNC_ADD),b.blendFunc(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA)):e==="CustomBlending"?b.enable(p.BLEND):(b.enable(p.BLEND),b.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),b.blendFuncSeparate(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA)),c.blending=e;if(e==="CustomBlending"){var e=
a.blendState.blendEquation,d=a.blendState.blendSrc,a=a.blendState.blendDst;if(e!==c.blendEquation)b.blendEquation(this.getGLBlendParam(e)),c.blendEquation=e;if(d!==c.blendSrc||a!==c.blendDst)b.blendFunc(this.getGLBlendParam(d),this.getGLBlendParam(a)),c.blendSrc=d,c.blendDst=a}else c.blendEquation=null,c.blendSrc=null,c.blendDst=null};m.prototype.updateOffset=function(a){var c=this.rendererRecord.offsetRecord,b=this.context,e=a.offsetState.enabled,d=a.offsetState.factor,a=a.offsetState.units;if(c.enabled!==
e)e?b.enable(p.POLYGON_OFFSET_FILL):b.disable(p.POLYGON_OFFSET_FILL),c.enabled=e;if(e&&(c.factor!==d||c.units!==a))b.polygonOffset(d,a),c.factor=d,c.units=a};m.prototype.setBoundBuffer=function(a,c){var b=this.rendererRecord.currentBuffer[c];if(!b.valid||b.buffer!==a)this.context.bindBuffer(this.getGLBufferTarget(c),a),b.buffer=a,b.valid=!0};m.prototype.bindVertexAttribute=function(a,c){this.context.vertexAttribPointer(a,c.count,this.getGLDataType(c.type),c.normalized,c.stride,c.offset)};m.prototype.getGLDataType=
function(a){switch(a){case "Float":case "HalfFloat":case "Double":return p.FLOAT;case "Byte":return p.BYTE;case "UnsignedByte":return p.UNSIGNED_BYTE;case "Short":return p.SHORT;case "UnsignedShort":return p.UNSIGNED_SHORT;case "Int":return p.INT;case "UnsignedInt":return p.UNSIGNED_INT;default:throw"Unknown datatype: "+a;}};m.prototype.getGLBlendParam=function(a){switch(a){case "AddEquation":return p.FUNC_ADD;case "SubtractEquation":return p.FUNC_SUBTRACT;case "ReverseSubtractEquation":return p.FUNC_REVERSE_SUBTRACT;
case "ZeroFactor":return p.ZERO;case "OneFactor":return p.ONE;case "SrcColorFactor":return p.SRC_COLOR;case "OneMinusSrcColorFactor":return p.ONE_MINUS_SRC_COLOR;case "SrcAlphaFactor":return p.SRC_ALPHA;case "OneMinusSrcAlphaFactor":return p.ONE_MINUS_SRC_ALPHA;case "DstAlphaFactor":return p.DST_ALPHA;case "OneMinusDstAlphaFactor":return p.ONE_MINUS_DST_ALPHA;case "DstColorFactor":return p.DST_COLOR;case "OneMinusDstColorFactor":return p.ONE_MINUS_DST_COLOR;case "SrcAlphaSaturateFactor":return p.SRC_ALPHA_SATURATE;
default:throw"Unknown blend param: "+a;}};m.prototype.clear=function(a,c,b){var e=0;if(a===void 0||a)e|=p.COLOR_BUFFER_BIT;if(c===void 0||c)e|=p.DEPTH_BUFFER_BIT;if(b===void 0||b)e|=p.STENCIL_BUFFER_BIT;this.context.clear(e)};m.prototype.flush=function(){this.context.flush()};m.prototype.finish=function(){this.context.finish()};m.prototype.setupFrameBuffer=function(a,c,b){this.context.bindFramebuffer(p.FRAMEBUFFER,a);this.context.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,b,c.glTexture,
0)};m.prototype.setupRenderBuffer=function(a,c){this.context.bindRenderbuffer(p.RENDERBUFFER,a);c.depthBuffer&&!c.stencilBuffer?(this.context.renderbufferStorage(p.RENDERBUFFER,p.DEPTH_COMPONENT16,c.width,c.height),this.context.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,a)):c.depthBuffer&&c.stencilBuffer?(this.context.renderbufferStorage(p.RENDERBUFFER,p.DEPTH_STENCIL,c.width,c.height),this.context.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,
a)):this.context.renderbufferStorage(p.RENDERBUFFER,p.RGBA4,c.width,c.height)};m.prototype.setRenderTarget=function(a){if(a&&!a._glFrameBuffer){if(a.depthBuffer===void 0)a.depthBuffer=!0;if(a.stencilBuffer===void 0)a.stencilBuffer=!0;a.glTexture=this.context.createTexture();var c=d.isPowerOfTwo(a.width)&&d.isPowerOfTwo(a.height),b=this.getGLInternalFormat(a.format),e=this.getGLDataType(a.type);a._glFrameBuffer=this.context.createFramebuffer();a._glRenderBuffer=this.context.createRenderbuffer();this.context.bindTexture(p.TEXTURE_2D,
a.glTexture);this.updateTextureParameters(a,c);this.context.texImage2D(p.TEXTURE_2D,0,b,a.width,a.height,0,b,e,null);this.setupFrameBuffer(a._glFrameBuffer,a,p.TEXTURE_2D);this.setupRenderBuffer(a._glRenderBuffer,a);a.generateMipmaps&&c&&this.context.generateMipmap(p.TEXTURE_2D);this.context.bindTexture(p.TEXTURE_2D,null);this.context.bindRenderbuffer(p.RENDERBUFFER,null);this.context.bindFramebuffer(p.FRAMEBUFFER,null)}var f;a?(c=a._glFrameBuffer,b=a.width,a=a.height,f=e=0):(c=null,b=this.viewportWidth,
a=this.viewportHeight,e=this.viewportX,f=this.viewportY);if(c!==this.rendererRecord.currentFrameBuffer)this.context.bindFramebuffer(p.FRAMEBUFFER,c),this.context.viewport(e,f,b,a),this.rendererRecord.currentFrameBuffer=c;this.currentWidth=b;this.currentHeight=a};m.prototype.updateRenderTargetMipmap=function(a){this.context.bindTexture(p.TEXTURE_2D,a.glTexture);this.context.generateMipmap(p.TEXTURE_2D);this.context.bindTexture(p.TEXTURE_2D,null)};m.prototype._deallocateMeshData=function(){};m.prototype._deallocateTexture=
function(){};m.prototype._deallocateRenderTarget=function(){};m.prototype._deallocateShader=function(){};return m});
define("goo/entities/systems/BoundingUpdateSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"])}d.prototype=Object.create(f.prototype);d.prototype.process=function(b){for(var a=0;a<b.length;a++){var c=b[a],e=c.meshDataComponent,d=c.transformComponent,c=c.meshRendererComponent;e.autoCompute?(e.computeBoundFromPoints(),c.updateBounds(e.modelBound,d.worldTransform)):d._updated&&c.updateBounds(e.modelBound,
d.worldTransform)}};return d});define("goo/entities/systems/ScriptSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"ScriptSystem",["ScriptComponent"])}d.prototype=Object.create(f.prototype);d.prototype.process=function(b,a){for(var c=0;c<b.length;c++)b[c].scriptComponent.run(b[c],a)};return d});
define("goo/entities/systems/LightingSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"LightingSystem",["LightComponent"])}d.prototype=Object.create(f.prototype);d.prototype.process=function(b){for(var a=0;a<b.length;a++){var c=b[a],e=c.transformComponent,c=c.lightComponent;e._updated&&c.light.translation.copy(e.transform.translation)}};return d});
define("goo/entities/managers/LightManager",["goo/entities/EventHandler"],function(f){function d(){this.type="LightManager";this.lights=[]}d.prototype.addedComponent=function(b,a){a.type==="LightComponent"&&this.lights.indexOf(a.light)===-1&&(this.lights.push(a.light),f.dispatch("setLights",this.lights))};d.prototype.removedComponent=function(b,a){if(a.type==="LightComponent"){var c=this.lights.indexOf(a.light);c!==-1&&(this.lights.splice(c,1),f.dispatch("setLights",this.lights))}};return d});
define("goo/entities/systems/CameraSystem",["goo/entities/systems/System","goo/entities/EventHandler","goo/renderer/Renderer"],function(f,d,b){function a(){f.call(this,"CameraSystem",["TransformComponent","CameraComponent"]);this.mainCamera=null}a.prototype=Object.create(f.prototype);a.prototype.findMainCamera=function(){for(var a=null,e=0;e<this._activeEntities.length;e++){var f=this._activeEntities[e].cameraComponent;if(!a||f.isMain)a=f.camera}d.dispatch("setCurrentCamera",a);b.mainCamera=a};a.prototype.inserted=
function(){this.findMainCamera()};a.prototype.deleted=function(){this.findMainCamera()};a.prototype.process=function(a){for(var b=0;b<a.length;b++){var d=a[b],f=d.transformComponent,d=d.cameraComponent;f._updated&&d.updateCamera(f.worldTransform)}};return a});
define("goo/entities/systems/ParticlesSystem",["goo/entities/systems/System"],function(f){function d(){f.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]);this.passive=!1}d.prototype=Object.create(f.prototype);d.prototype.process=function(b,a){if(!(a>1))for(var c=0,e=b.length;c<e;c++){var d=b[c],f=d.particleComponent;if(f&&f.enabled)try{this.updateParticles(d,f,a)}catch(k){console.log(k.stack)}}};d.prototype.updateParticles=function(b,
a,c){for(var e=0,d=-1,f,k=!1,i=!1;e<a.particleCount;){for(;f===void 0;)if(d++,a.emitters.length>d){f=a.emitters[d];if(f.influences.length)for(var h=0,j=f.influences.length;h<j;h++)f.influences[h].prepare(b,f);if(f.enabled){if(f.totalParticlesToSpawn!==0)f.particlesWaitingToRelease+=f.releaseRatePerSecond*c,f.particlesWaitingToRelease=Math.max(f.particlesWaitingToRelease,0),i=!0;f.particlesWaitingToRelease<1&&(f=void 0)}else f=void 0}else f=null;var n=a.particles[e];if(n.alive&&n.emitter&&n.emitter.influences.length){h=
0;for(j=n.emitter.influences.length;h<j;h++)n.emitter.influences[h].enabled&&n.emitter.influences[h].apply(c,n,e)}n.alive&&(n.update(c,b),i=k=!0);if(!n.alive&&f&&(f.particlesWaitingToRelease--,f.totalParticlesToSpawn>=1&&f.totalParticlesToSpawn--,n.respawnParticle(f),f.getEmissionPoint(n,b),f.getEmissionVelocity(n,b),f.particlesWaitingToRelease<1||f.totalParticlesToSpawn===0))f=void 0;e++}if(k)a.meshData.vertexData._dataNeedsRefresh=!0,b.meshDataComponent.autoCompute=!0;if(!i)a.enabled=!1};return d});
define("goo/util/Stats",[],function(){return function(){var f=Date.now(),d=f,b=f,a=0,c=Infinity,e=0,g=0,l=Infinity,k=0,i=0,h=0,j=document.createElement("div");j.id="stats";j.addEventListener("mousedown",function(a){a.preventDefault();s(++h%2)},!1);j.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var n=document.createElement("div");n.id="fps";n.style.cssText=
"padding:0 0 3px 3px;text-align:left;background-color:#002";j.appendChild(n);var o=document.createElement("div");o.id="fpsText";o.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";o.innerHTML="FPS";n.appendChild(o);var q=document.createElement("div");q.id="fpsGraph";q.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(n.appendChild(q);q.children.length<74;){var m=document.createElement("span");m.style.cssText=
"width:1px;height:30px;float:left;background-color:#113";q.appendChild(m)}var r=document.createElement("div");r.id="ms";r.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";j.appendChild(r);var p=document.createElement("div");p.id="msText";p.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";p.innerHTML="MS";r.appendChild(p);var v=document.createElement("div");v.id="msGraph";v.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";
for(r.appendChild(v);v.children.length<74;)m=document.createElement("span"),m.style.cssText="width:1px;height:30px;float:left;background-color:#131",v.appendChild(m);m=document.createElement("div");m.id="info";m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200";j.appendChild(m);var u=document.createElement("div");u.id="infoText";u.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";u.innerHTML="INFO";m.appendChild(u);
var s=function(a){h=a;switch(h){case 0:n.style.display="block";r.style.display="none";break;case 1:n.style.display="none",r.style.display="block"}};this.domElement=j;this.setMode=s;this.begin=function(){f=Date.now()};this.end=function(h){var j=Date.now();if(j>b+100){a=j-f;c=Math.min(c,a);e=Math.max(e,a);p.textContent=a+" MS ("+c+"-"+e+")";var m=Math.min(30,30-a/200*30);v.appendChild(v.firstChild).style.height=m+"px";b=j;if(h)u.innerHTML="Calls: "+h.calls+"<br>Vertices: "+h.vertices+"<br>Indices: "+
h.indices}i++;if(j>d+1E3)g=Math.round(i*1E3/(j-d)),l=Math.min(l,g),k=Math.max(k,g),o.textContent=g+" FPS ("+l+"-"+k+")",h=Math.min(30,30-g/(Math.min(500,k)+10)*30),q.appendChild(q.firstChild).style.height=h+"px",d=j,i=0;return j};this.update=function(a){f=this.end(a)}}});
define("goo/entities/systems/CSSTransformSystem",["goo/entities/systems/System","goo/renderer/Renderer","goo/math/Matrix4x4","goo/math/MathUtils","goo/math/Vector3"],function(f,d,b,a,c){function e(a){f.call(this,"CSSTransformSystem",["TransformComponent","CSSTransformComponent"]);this.renderer=a;this.viewDom=document.querySelector("#view");this.containerDom=document.querySelector("#cam1");this.containerDom2=document.querySelector("#cam2");this.tmpMatrix=new b;this.tmpMatrix2=new b;this.tmpVector=
new c}e.prototype=Object.create(f.prototype);var g=function(a){return Math.abs(a)<1.0E-6?0:a},l=["","-webkit-","-moz-","-ms-","-o-"],k=function(a,c,b){for(var e=0;e<l.length;e++)a.style[l[e]+c]=b},i=function(a){a=a.data;return"matrix3d("+g(a[0])+","+g(-a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(-a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+","+g(-a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(-a[13])+","+g(a[14])+","+g(a[15])+")"};e.prototype.process=function(b){if(b.length!==0){var e=d.mainCamera,
f=0.5/Math.tan(a.DEG_TO_RAD*e.fov*0.5)*this.renderer.domElement.offsetHeight;k(this.viewDom,"perspective",f+"px");this.tmpMatrix.copy(e.getViewInverseMatrix());this.tmpMatrix2.copy(this.tmpMatrix);this.tmpMatrix.invert();this.tmpMatrix.setTranslation(new c(0,0,f));var g=i(this.tmpMatrix);k(this.containerDom,"transform",g);this.tmpMatrix2.e03=-this.tmpMatrix2.e03;this.tmpMatrix2.e23=-this.tmpMatrix2.e23;this.tmpMatrix2.setRotationFromVector(new c(0,0,0));g=i(this.tmpMatrix2);k(this.containerDom2,"transform",
g);for(e=0;e<b.length;e++)g=b[e],f=g.getComponent("CSSTransformComponent").domElement,g="translate3d(-50%,-50%,0) "+i(g.transformComponent.worldTransform.matrix)+" scale3d(1,-1,1)",k(f,"transform",g),f.parentNode!==this.containerDom2&&this.containerDom2.appendChild(f)}};return e});
define("goo/util/GameUtils",[],function(){function f(){}f.supported={fullscreen:!0,pointerLock:!0};f.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()};f.togglePointerLock=function(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()};
f.initAllShims=function(d){this.initAnimationShims();this.initFullscreenShims(d);this.initPointerLockShims(d)};f.initAnimationShims=function(){for(var d=0,b=["ms","moz","webkit","o"],a=0;a<b.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"];if(window.requestAnimationFrame===void 0)window.requestAnimationFrame=function(a){var b=Date.now(),
f=Math.max(0,16-(b-d)),l=window.setTimeout(function(){a(b+f)},f);d=b+f;return l};if(window.cancelAnimationFrame===void 0)window.cancelAnimationFrame=function(a){clearTimeout(a)}};f.initFullscreenShims=function(d){function b(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenchange",!0,!1,null);document.dispatchEvent(a)}function a(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenerror",!0,!1,null);document.dispatchEvent(a)}var d=d||window,c=(d.HTMLElement||
d.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var e=function(){if("webkitIsFullScreen"in document)return function(){return document.webkitFullscreenEnabled};if("mozFullScreenEnabled"in document)return function(){return document.mozFullScreenEnabled};f.supported.fullscreen=!1;return function(){return!1}}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:e})}document.hasOwnProperty("fullscreenElement")||(e=function(){for(var a=
["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],c=function(c){return function(){return document[a[c]]}},b=0;b<a.length;b++)if(a[b]in document)return c(b);return function(){return null}}(),Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:e}));document.addEventListener("webkitfullscreenchange",b,!1);document.addEventListener("mozfullscreenchange",b,!1);document.addEventListener("webkitfullscreenerror",a,!1);document.addEventListener("mozfullscreenerror",
a,!1);if(!c.requestFullScreen)c.requestFullScreen=function(){return c.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(d.Element.ALLOW_KEYBOARD_INPUT)}:c.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}();if(!document.cancelFullScreen)document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}()};f.initPointerLockShims=function(d){function b(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockchange",
!0,!1,null);document.dispatchEvent(a)}function a(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockerror",!0,!1,null);document.dispatchEvent(a)}var d=d||window,c=(d.HTMLElement||d.Element).prototype,d=d.MouseEvent.prototype;"movementX"in d||Object.defineProperty(d,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}});"movementY"in d||Object.defineProperty(d,"movementY",{enumerable:!0,configurable:!1,writeable:!1,
get:function(){return this.webkitMovementY||this.mozMovementY||0}});if(!navigator.pointer)navigator.pointer=navigator.webkitPointer||navigator.mozPointer;document.addEventListener("webkitpointerlockchange",b,!1);document.addEventListener("webkitpointerlocklost",b,!1);document.addEventListener("mozpointerlockchange",b,!1);document.addEventListener("mozpointerlocklost",b,!1);document.addEventListener("webkitpointerlockerror",a,!1);document.addEventListener("mozpointerlockerror",a,!1);document.hasOwnProperty("pointerLockElement")||
(d=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}(),Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:d}));if(!c.requestPointerLock)c.requestPointerLock=function(){if(c.webkitRequestPointerLock)return function(){this.webkitRequestPointerLock()};if(c.mozRequestPointerLock)return function(){this.mozRequestPointerLock()};
if(navigator.pointer)return function(){navigator.pointer.lock(this,b,a)};f.supported.pointerLock=!1;return function(){}}();if(!document.exitPointerLock)document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}()};return f});
define("goo/entities/GooRunner","goo/entities/World,goo/entities/systems/TransformSystem,goo/entities/systems/RenderSystem,goo/renderer/Renderer,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/LightingSystem,goo/entities/managers/LightManager,goo/entities/systems/CameraSystem,goo/entities/systems/ParticlesSystem,goo/util/Stats,goo/entities/systems/CSSTransformSystem,goo/util/GameUtils".split(","),function(f,d,b,a,c,e,g,l,k,i,h,j,n){function o(o){o=
o||{};this.world=new f;this.renderer=new a(o);this.world.setManager(new l);this.world.setSystem(new e);this.world.setSystem(new d);this.world.setSystem(new k);this.world.setSystem(new j(this.renderer));this.world.setSystem(new i);this.world.setSystem(new c);this.world.setSystem(new g);var m=this.renderSystem=new b;this.world.setSystem(m);this.doRender=!0;n.initAllShims();if(o.showStats)this.stats=new h,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top=
"10px",document.body.appendChild(this.stats.domElement);this.callbacks=[];this.callbacksPreProcess=[];this.callbacksPreRender=[];var r=this;this.start=-1;this.run=function(a){try{if(r.start<0)r.start=a;r.world.tpf=(a-r.start)/1E3;r.world.time+=r.world.tpf;f.time=r.world.time;r.start=a;if(r.world.tpf<0)r.world.time=0,r.world.tpf=0,f.time=0;else if(!(r.world.tpf>0.5)){for(a=0;a<r.callbacksPreProcess.length;a++)r.callbacksPreProcess[a](r.world.tpf);r.world.process();for(a=0;a<r.callbacksPreRender.length;a++)r.callbacksPreRender[a](r.world.tpf);
r.renderer.info.reset();r.doRender&&m.render(r.renderer);for(a=0;a<r.callbacks.length;a++)r.callbacks[a](r.world.tpf);r.stats&&r.stats.update(r.renderer.info)}r.animationId=window.requestAnimationFrame(r.run)}catch(c){c instanceof Error?console.error(c.stack):console.error(c)}};this.animationId=-1;o.manuallyStartGameLoop||this.startGameLoop(this.run);var p=!1;document.onkeyup=function(a){a.which===17&&(p=!1)};document.onkeydown=function(a){a.which===17?p=!0:a.which===32&&p?n.toggleFullScreen():a.which===
13&&p&&n.togglePointerLock()}}o.prototype.startGameLoop=function(){this.start=-1;this.animationId=window.requestAnimationFrame(this.run)};o.prototype.stopGameLoop=function(){window.cancelAnimationFrame(this.animationId)};return o});
define("goo/entities/components/CameraComponent",["goo/entities/components/Component","goo/math/Vector3"],function(f,d){function b(a){this.type="CameraComponent";this.camera=a;this.leftVec=new d(-1,0,0);this.upVec=new d(0,1,0);this.dirVec=new d(0,0,-1)}b.prototype=Object.create(f.prototype);b.prototype.setUpVector=function(a){a===0?(this.leftVec.setd(0,-1,0),this.upVec.setd(1,0,0),this.dirVec.setd(0,0,-1)):a===2?(this.leftVec.setd(-1,0,0),this.upVec.setd(0,0,1),this.dirVec.setd(0,-1,0)):(this.leftVec.setd(-1,
0,0),this.upVec.setd(0,1,0),this.dirVec.setd(0,0,-1))};b.prototype.updateCamera=function(a){this.camera._left.setv(this.leftVec);a.matrix.applyPostVector(this.camera._left);this.camera._up.setv(this.upVec);a.matrix.applyPostVector(this.camera._up);this.camera._direction.setv(this.dirVec);a.matrix.applyPostVector(this.camera._direction);a.matrix.getTranslation(this.camera.translation);this.camera.update()};return b});
define("goo/entities/components/LightComponent",["goo/entities/components/Component"],function(f){function d(b){this.type="LightComponent";this.light=b}d.prototype=Object.create(f.prototype);d.prototype.stuff=function(){};return d});
define("goo/particles/ParticleUtils",["goo/math/Vector3"],function(f){function d(){}d.getRandomVelocityOffY=function(b,a,c,e,f){a+=Math.random()*(c-a);c=Math.PI*2*Math.random();b.x=Math.cos(c)*Math.sin(a);b.y=Math.cos(a);b.z=Math.sin(c)*Math.sin(a);f&&d.applyEntityTransformVector(b,f);b.mul(e);return b};d.randomPointInCube=function(b,a,c,e,d){b.x=Math.random()*2*a-a+(d?d.x:0);b.y=Math.random()*2*c-c+(d?d.y:0);b.z=Math.random()*2*e-e+(d?d.z:0);return b};d.createConstantForce=function(b){var a=new f(b);
return{enabled:!0,prepare:function(){},apply:function(c,b){b.velocity.x+=a.x*c;b.velocity.y+=a.y*c;b.velocity.z+=a.z*c}}};d.applyEntityTransformPoint=function(b,a){return!a.transformComponent||!a.transformComponent.worldTransform?b:a.transformComponent.worldTransform.applyForward(b,b)};d.applyEntityTransformVector=function(b,a){return!a.transformComponent||!a.transformComponent.worldTransform?b:a.transformComponent.worldTransform.applyForwardVector(b,b)};d.applyTimeline=function(b,a){for(var c=b.age,
e=b.lifeSpan,d=0,f=0,k=0,i=0,h=e,j=e,n=e,o=e,q=0,m=0,r=null,p=null,v=null,u=null,s=null,t=null,w=null,z=null,y=null,m=0,A=a.length;m<A;m++){var x=a[m];q+=(x.timeOffset?x.timeOffset:0)*e;t===null&&(q>c?x.color!==void 0&&(h=q,t=x):x.color!==void 0&&(d=q,r=x));w===null&&(q>c?x.mass!==void 0&&(j=q,w=x):x.mass!==void 0&&(f=q,p=x));q<=c&&x.uvIndex!==void 0&&(s=x);z===null&&(q>c?x.size!==void 0&&(n=q,z=x):x.size!==void 0&&(k=q,v=x));y===null&&(q>c?x.spin!==void 0&&(o=q,y=x):x.spin!==void 0&&(i=q,u=x))}m=
(c-d)/(h-d);e=r!==null?r.color:[1,1,1,1];t=t!==null?t.color:e;b.color.data[0]=(1-m)*e[0]+m*t[0];b.color.data[1]=(1-m)*e[1]+m*t[1];b.color.data[2]=(1-m)*e[2]+m*t[2];b.color.data[3]=(1-m)*e[3]+m*t[3];m=(c-f)/(j-f);e=p!==null?p.mass:1;t=w!==null?w.mass:e;b.mass=(1-m)*e+m*t;b.uvIndex=s!==null?s.uvIndex:0;m=(c-k)/(n-k);e=v!==null?v.size:1;t=z!==null?z.size:e;b.size=(1-m)*e+m*t;m=(c-i)/(o-i);e=u!==null?u.spin:0;t=y!==null?y.spin:e;b.spin=(1-m)*e+m*t};return d});
define("goo/particles/Particle",["goo/particles/ParticleUtils","goo/math/Vector","goo/math/Vector3","goo/math/Vector4","goo/renderer/MeshData"],function(f,d,b,a,c){function e(c,e){this.alive=!1;this.position=new b;this.velocity=new b;this.lifeSpan=0;this.parent=c;this.age=0;this.index=e;this.color=new a(1,0,0,1);this.spin=this.size=0;this.mass=1;this.emitter=null;this.uvIndex=0;this.lastUVIndex=-1;this.bbX=new b;this.bbY=new b;this.lastColor=new a}var g=new b;e.prototype.respawnParticle=function(a){this.emitter=
a;this.lifeSpan=a.nextParticleLifeSpan();this.alive=!0;this.age=0};e.prototype.update=function(a,e){if(this.alive)if(this.age+=a,this.age>this.lifeSpan)this.kill();else{this.position.add_d(this.velocity.x*a,this.velocity.y*a,this.velocity.z*a);f.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline);if(!d.equals(this.lastColor,this.color)){var i=this.parent.meshData.getAttributeBuffer(c.COLOR);i.set(this.color.data,this.index*16+0);i.set(this.color.data,
this.index*16+4);i.set(this.color.data,this.index*16+8);i.set(this.color.data,this.index*16+12);this.lastColor.setv(this.color)}this.emitter&&this.emitter.getParticleBillboardVectors(this,e);if(this.spin===0)this.bbX.muld(this.size,this.size,this.size),this.bbY.muld(this.size,this.size,this.size);else{var i=Math.cos(this.spin)*this.size,h=Math.sin(this.spin)*this.size,j=this.bbY.x,n=this.bbY.y,o=this.bbY.z;this.bbY.setv(this.bbX);this.bbX.muld(i,i,i).add_d(j*h,n*h,o*h);this.bbY.muld(-h,-h,-h).add_d(j*
i,n*i,o*i)}i=this.parent.meshData.getAttributeBuffer(c.POSITION);b.subv(this.position,this.bbX,g).subv(this.bbY);i.set(g.data,this.index*12+0);b.subv(this.position,this.bbX,g).addv(this.bbY);i.set(g.data,this.index*12+3);b.addv(this.position,this.bbX,g).addv(this.bbY);i.set(g.data,this.index*12+6);b.addv(this.position,this.bbX,g).subv(this.bbY);i.set(g.data,this.index*12+9);if(this.lastUVIndex!==this.uvIndex)i=this.parent.meshData.getAttributeBuffer(c.TEXCOORD0),h=this.uvIndex%this.parent.uRange/
this.parent.uRange,j=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,n=1/this.parent.uRange,o=1/this.parent.vRange,i.set([h+n,j-o],this.index*8+0),i.set([h+n,j],this.index*8+2),i.set([h,j],this.index*8+4),i.set([h,j-o],this.index*8+6),this.lastUVIndex=this.uvIndex}};e.prototype.kill=function(){this.alive=!1;var a=this.parent.meshData.getAttributeBuffer(c.POSITION),b=a.subarray(this.index*12,this.index*12+3);a.set(b,this.index*12+3);a.set(b,this.index*12+6);a.set(b,this.index*12+9)};
return e});
define("goo/particles/ParticleEmitter",["goo/particles/ParticleUtils","goo/renderer/Renderer"],function(f,d){function b(a){a=a||{};this.totalParticlesToSpawn=!isNaN(a.totalParticlesToSpawn)?a.totalParticlesToSpawn:-1;this.maxLifetime=!isNaN(a.maxLifetime)?a.maxLifetime:3;this.minLifetime=!isNaN(a.minLifetime)?a.minLifetime:2;this.timeline=a.timeline?a.timeline:void 0;this.influences=a.influences?a.influences:[];this.getEmissionPoint=a.getEmissionPoint?a.getEmissionPoint:function(a,b){var d=a.position;
d.setd(0,0,0);return f.applyEntityTransformPoint(d,b)};this.getEmissionVelocity=a.getEmissionVelocity?a.getEmissionVelocity:function(a,b){var d=a.velocity;d.setd(0,1,0);return f.applyEntityTransformVector(d,b)};this.getParticleBillboardVectors=a.getParticleBillboardVectors?a.getParticleBillboardVectors:b.CAMERA_BILLBOARD_FUNC;this.releaseRatePerSecond=!isNaN(a.releaseRatePerSecond)?a.releaseRatePerSecond:10;this.particlesWaitingToRelease=0;this.enabled=a.enabled!==void 0?a.enabled===!0:!0}b.CAMERA_BILLBOARD_FUNC=
function(a){var c=d.mainCamera;a.bbX.setv(c._left);a.bbY.setv(c._up)};b.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()};return b});
define("goo/entities/components/ParticleComponent",["goo/entities/components/Component","goo/particles/Particle","goo/particles/ParticleEmitter","goo/renderer/MeshData"],function(f,d,b,a){function c(a){this.type="ParticleComponent";f.call(this);a=a||{};this.emitters=[];if(a.emitters)for(var c=0,d=a.emitters.length;c<d;c++)this.emitters.push(new b(a.emitters[c]));this.timeline=a.timeline?a.timeline:[];this.uRange=isNaN(a.uRange)?1:a.uRange;this.vRange=isNaN(a.vRange)?1:a.vRange;this.recreateParticles(isNaN(a.particleCount)?
100:a.particleCount);this.enabled=!0}c.prototype=Object.create(f.prototype);c.prototype.generateMeshData=function(){var c=a.defaultMap([a.POSITION,a.COLOR,a.TEXCOORD0]);this.meshData=new a(c,this.particleCount*4,this.particleCount*6);for(var c=this.meshData.getAttributeBuffer(a.TEXCOORD0),b=this.meshData.getIndexBuffer(),d=0,f=this.particleCount;d<f;d++)c.set([1,0],d*8+0),c.set([1,1],d*8+2),c.set([0,1],d*8+4),c.set([0,0],d*8+6),b.set([d*4+0,d*4+3,d*4+1,d*4+1,d*4+3,d*4+2],d*6)};c.prototype.recreateParticles=
function(a){this.particleCount=a;this.particles=[];for(a=0;a<this.particleCount;a++)this.particles[a]=new d(this,a);this.generateMeshData()};return c});
define("goo/entities/components/ScriptComponent",["goo/entities/components/Component"],function(f){function d(b){this.type="ScriptComponent";this.scripts=b instanceof Array?b:b?[b]:[]}d.prototype=Object.create(f.prototype);d.prototype.run=function(b,a){for(var c,e=0,d=this.scripts.length;e<d;e++)(c=this.scripts[e])&&c.run&&(c.enabled===void 0||c.enabled)&&c.run(b,a)};return d});
define("goo/entities/managers/DebugManager",[],function(){function f(){this.type="DebugManager";this._entities={}}f.prototype.added=function(d){this._entities[d.id]=d};f.prototype.removed=function(d){delete this._entities[d.id]};f.prototype.getEntities=function(){var d=[],b;for(b in this._entities)d.push(this._entities[b]);return d};return f});
define("goo/entities/systems/PickingSystem",["goo/entities/systems/System"],function(f){function d(b){f.call(this,"PickingSystem",["MeshRendererComponent","TransformComponent"]);this.passive=!0;this.onPick=this.pickRay=null;b=b||{};this.setPickLogic(b.pickLogic||null)}d.prototype=Object.create(f.prototype);d.prototype.setPickLogic=function(b){(this.pickLogic=b)&&this.interests.indexOf("MeshDataComponent")===-1&&this.interests.push("MeshDataComponent")};d.prototype.inserted=function(b){this.pickLogic&&
this.pickLogic.added(b)};d.prototype.deleted=function(b){this.pickLogic&&this.pickLogic.removed(b)};d.prototype.process=function(b){if(this.pickRay&&this.onPick){for(var a=[],c=0;c<b.length;c++){var e=b[c],d=e.meshRendererComponent;this.pickLogic?(d=this.pickLogic.getPickResult(this.pickRay,e))&&d.distances&&d.distances.length&&a.push({entity:e,intersection:d}):d.worldBound&&(d=d.worldBound.intersectsRayWhere(this.pickRay))&&d.distances.length&&a.push({entity:e,intersection:d})}a.sort(function(a,
c){return a.intersection.distances[0]-c.intersection.distances[0]});this.onPick(a)}};return d});
define("goo/loaders/JsonUtils","goo/renderer/BufferUtils,goo/math/Transform,goo/math/Matrix3x3,goo/math/Vector3,goo/math/Quaternion,goo/animation/blendtree/ClipSource,goo/animation/layer/AnimationLayer,goo/animation/state/SteadyState,goo/animation/state/FadeTransitionState,goo/animation/state/FrozenTransitionState,goo/animation/state/IgnoreTransitionState,goo/animation/state/ImmediateTransitionState,goo/animation/state/SyncFadeTransitionState,goo/animation/state/StateBlendType,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/ExclusiveClipSource,goo/animation/blendtree/FrozenClipSource,goo/animation/blendtree/InclusiveClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/layer/LayerLERPBlender".split(","),function(f,
d,b,a,c,e,g,l,k,i,h,j,n,o,q,m,r,p,v,u){function s(){}s.fillAttributeBufferFromCompressedString=function(a,c,b,e,d){var c=c.getAttributeBuffer(b),b=e.length,f=a.length/e.length,g,h,i,k,j;for(j=0;j<b;j++)if(e[j]===0)return;for(j=0;j<b;j++)for(k=g=0;k<f;k++)h=a.charCodeAt(k+j*f),i=k*b+j,g+=s.unzip(h),c[i]=(g+d[j])*e[j]};s.fillAttributeBuffer=function(a,c,b){c=c.getAttributeBuffer(b);for(b=0;b<a.length;b++)c[b]=a[b]};s.getIntBuffer=function(a,c){var b=f.createIndexBuffer(a.length,c);b.set(a);return b};
s.getIntBufferFromCompressedString=function(a,c){for(var b=0,e=f.createIndexBuffer(a.length,c),d=0;d<a.length;++d){var g=a.charCodeAt(d);b+=s.unzip(g);e[d]=b}return e};s.unzip=function(a){a>=57344&&(a-=2048);a-=35;return a>>1^-(a&1)};s.parseTransform=function(a){var c=new d;c.translation=s.parseVector3(a.Translation);c.scale=s.parseVector3(a.Scale);c.rotation=s.parseMatrix3(a.Rotation);return c};s.parseMatrix3=function(a){var c=new b;c.e00=a[0];c.e01=a[1];c.e02=a[2];c.e10=a[3];c.e11=a[4];c.e12=a[5];
c.e20=a[6];c.e21=a[7];c.e22=a[8];return c};s.parseVector3=function(c){return new a(c[0],c[1],c[2])};s.parseAnimationLayers=function(a,c,b,e,d){var d=d.Layers,f;for(f in d){var h;"DEFAULT"===f?h=a.getBaseAnimationLayer():(h=new g(f),a.addAnimationLayer(h));var i=d[f];s.parseLayerProperties(a,h,i);if(i.States)for(var j=i.States,k=0,l=j.length;k<l;k++)s.parseSteadyState(j[k],b,e,a,h);if(i.Transitions){var i=i.Transitions,m;for(m in i)h._transitions[m]=s.parseTransitionState(i[m],b,e,a)}}if(c!==null)c.onSuccess(e)};
s.parseSteadyState=function(a,c,b,d,f){var g=new l(a.Name?a.Name:"unknown");if(a.Clip){var h=a.Clip,i=c[h.Name],j=new e(i,d);g._sourceTree=j;b._usedClipSources[j._clip._name]=j;s.populateClipSource(j,i,h,d)}else if(a.Tree)g._sourceTree=s.parseTreeSource(a.Tree,c,b,d);if(a.EndTransition)g._endTransition=s.parseTransitionState(a.EndTransition,c,b,d);if(a.Transitions){var h=a.Transitions,k;for(k in h)g._transitions[k]=s.parseTransitionState(h[k],c,b,d)}a.Default&&f.setCurrentState(g,!0);f._steadyStates[g._name]=
g};s.parseTransitionState=function(a){var c=a[2];if("fade"===c)c=new k(a[3],a[4],o[a[5]]);else if("syncfade"===c)c=new n(a[3],a[4],o[a[5]]);else if("frozen"===c)c=new i(a[3],a[4],o[a[5]]);else if("immediate"===c)c=new j(a[3]);else if("ignore"===c)c=new h;else return null;isNaN(a[0])||c.setStartWindow(a[0]);isNaN(a[1])||c.setEndWindow(a[1]);return c};s.parseTreeSource=function(a,c,b,d){if(a.Clip){var a=a.Clip,c=c[a.Name],f=new e(c,d);b._usedClipSources[f._clip._name]=f;s.populateClipSource(f,c,a,d);
return f}else if(a.InclusiveClip){a=a.InclusiveClip;c=c[a.Name];f=new p(c,d);b._usedClipSources[f._clip._name]=f;s.populateClipSource(f,c,a,d);a.Channels&&f.addEnabledChannels(a.Channels);if(a.JointNames){var d=d.getSkeletonPose(0).getSkeleton(),c=a.JointNames,g;for(g in c)f.addEnabledJoints(d.findJointByName(g))}a.Joints&&f.addEnabledJoints(a.Joints);return f}else if(a.ExclusiveClip)return a=a.ExclusiveClip,c=c[a.Name],f=new m(c,d),b._usedClipSources[f._clip._name]=f,s.populateClipSource(f,c,a,d),
a.Channels&&f.addDisabledChannels(a.Channels),a.Joints&&f.addDisabledJoints(a.Joints),f;else if(a.Lerp){a=a.Lerp;f=s.parseTreeSource(a.ChildA,c,b,d);g=s.parseTreeSource(a.ChildB,c,b,d);f=new q(f,g);if(a.BlendKey)f._blendKey=a.BlendKey,d._valuesStore[f._blendKey]=isNaN(a.BlendWeight)?0:a.BlendWeight;return f}else if(a.Managed){a=a.Managed;f=new v;if(a.InitFromClip)a=a.InitFromClip,f._sourceName=a.Clip,c=c[f._sourceName],a.JointNames&&f.initJointsByName(d._applyToPoses[0],c,a.JointNames),a.JointIds&&
f.initJointsById(c,a.JointIds);return f}else if(a.Frozen)return a=a.Frozen,d=s.parseTreeSource(a.Child,c,b,d),new r(d,isNaN(a.Time)?0:a.Time);console.warn("no known source type found.");return null};s.populateClipSource=function(a,c,b,e){if(b.TimeScale!==void 0)e.getClipInstance(c)._timeScale=isNaN(b.TimeScale)?1:b.TimeScale;if(b.LoopCount!==void 0)e.getClipInstance(c)._loopCount=isNaN(b.LoopCount)?1:b.LoopCount;if(b.Active!==void 0)e.getClipInstance(c)._active=b.Active===!0};s.parseLayerProperties=
function(a,c,b){if(b.BlendType){var e=null;if("lerp"===b.BlendType)e=new u,c._layerBlender=e;if(e!==null&&b.BlendKey)e._blendKey=b.BlendKey,a._valuesStore[e._blendKey]=isNaN(b.BlendWeight)?0:b.BlendWeight}};s.parseChannelTimes=function(a,c){var b=a.Times;if(b)if(c){var e=a.TimeOffsetScale;return s.parseFloatArrayFromCompressedString(b,[e[1]],[e[0]])}else return b;return null};s.parseFloatLERPValues=function(a,c){var b=a.IFCValues;if(b)if(c){var e=a.IFCOffsetScale;return s.parseFloatArrayFromCompressedString(b,
[e[1]],[e[0]])}else return b;return null};s.parseRotationSamples=function(a,c,b){return(a=a.RotationSamples)?b?(c=1-(c+1>>1),b=1/-c,s.parseFloatArrayFromCompressedString(a,[b,b,b,b],[c,c,c,c])):s.parseQuaternionSamples(a):null};s.parseTranslationSamples=function(a,c,b){var e=a.UniformTranslation;if(e){e===void 0&&console.log("asdf");for(var a=e[0],b=e[1],e=e[2],d=[],f=0;f<c;f++)d[f*3+0]=a,d[f*3+1]=b,d[f*3+2]=e;return d}return(c=a.TranslationSamples)?b?(a=a.TranslationOffsetScale,b=a[3],s.parseFloatArrayFromCompressedString(c,
[b,b,b],[a[0],a[1],a[2]])):s.parseVector3Samples(c):null};s.parseScaleSamples=function(a,c,b){var e=a.UniformScale;if(e){for(var a=e,b=a[0],e=a[1],a=a[2],d=[],f=0;f<c;f++)d[f*3+0]=b,d[f*3+1]=e,d[f*3+2]=a;return d}return(c=a.ScaleSamples)?b?(a=a.ScaleOffsetScale,b=a[0],e=a[1],d=a[2],a=a[3],s.parseFloatArrayFromCompressedString(c,[a,a,a],[b,e,d])):s.parseVector3Samples(c):null};s.parseQuaternionSamples=function(a){if(!a)return null;for(var b=[],e=new c,d=0,f=a.length;d<f;d++){var g=a[d];if(g==="*")b[d*
4+0]=e.x,b[d*4+1]=e.y,b[d*4+2]=e.z,b[d*4+3]=e.w;else if(g instanceof Array&&g.length===4)e.set(g[0],g[1],g[2],g[3]),b[d*4+0]=e.x,b[d*4+1]=e.y,b[d*4+2]=e.z,b[d*4+3]=e.w}return b};s.parseVector3Samples=function(c){if(!c)return null;for(var b=[],e=new a,d=0,f=c.length;d<f;d++){var g=c[d];if(g==="*")b[d*3+0]=e.x,b[d*3+1]=e.y,b[d*3+2]=e.z;else if(g instanceof Array&&g.length===3)e.set(g[0],g[1],g[2]),b[d*3+0]=e.x,b[d*3+1]=e.y,b[d*3+2]=e.z}return b};s.parseFloatArrayFromCompressedString=function(a,c,b){var e=
[],d=c.length,f=a.length/c.length,g,h,i,j,k;for(k=0;k<d;k++)for(j=g=0;j<f;j++)h=a.charCodeAt(j+k*f),i=j*d+k,g+=s.unzip(h),e[i]=(g+b[k])*c[k];return e};return s});
define("goo/loaders/AnimationLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/animation/state/loader/OutputStore,goo/animation/AnimationManager,goo/animation/blendtree/SimpleAnimationApplier,goo/loaders/JsonUtils,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/state/SteadyState,goo/animation/blendtree/ClipSource".split(","),function(f,
d,b,a,c,e,g,l,k,i,h,j,n,o,q,m){function r(a){if(typeof a==="undefined"||a===null)throw Error("AnimationTreeLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof e)||a.loader===null)throw Error("AnimationTreeLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}r.prototype.load=function(a,c,b){if(this._cache[a]&&this._cache[a][c._skeleton._name])return this._cache[a][c._skeleton.name];var e=new l(c);
e._applier=new k;var d=r.prototype._loadAnimation.bind(this),f=r.prototype._parseAnimation.bind(this,b),b=r.prototype._setupDefaultAnimation.bind(this,e,b),d=d(a).then(f).then(b);this._cache[a]||(this._cache[a]={});return this._cache[a][c._skeleton._name]=d};r.prototype._loadAnimation=function(a){return this._loader.load(a)};r.prototype._parseAnimation=function(a,c){typeof c==="string"&&(c=JSON.parse(c));var b,e,d=new h(a);(b=c.UseCompression||!1)&&(e=c.CompressedRange||32767);if(c.Channels)for(var f=
c.Channels,g=0,k=f.length;g<k;g++){var l=f[g],m=l.Type,a=l.Name,q=i.parseChannelTimes(l,b);if("Joint"===m)var m=l.JointName,r=l.JointIndex,C=i.parseRotationSamples(l,e,b),F=i.parseTranslationSamples(l,q.length,b),l=i.parseScaleSamples(l,q.length,b),q=new j(m,r,q,C,F,l);else if("Transform"===m)C=i.parseRotationSamples(l,e,b),F=i.parseTranslationSamples(l,q.length,b),l=i.parseScaleSamples(l,q.length,b),q=new n(a,q,C,F,l);else if("FloatLERP"===m)q=new o(a,q,i.parseFloatLERPValues(l,b));else{console.warn("Unhandled channel type: "+
m);continue}d.addChannel(q)}return d};r.prototype._setupDefaultAnimation=function(a,c,b){var e=new q(c),d=new m(b,a);e._sourceTree=d;a._layers[0]._steadyStates[e._name]=e;a.getClipInstance(b)._loopCount=-1;a.getClipInstance(b)._timeScale=1;a._layers[0].setCurrentStateByName(c,!0);return a};return r});
define("goo/loaders/AnimationTreeLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/animation/state/loader/OutputStore,goo/animation/AnimationManager,goo/animation/blendtree/SimpleAnimationApplier,goo/loaders/JsonUtils,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/loaders/AnimationLoader".split(","),function(f,
d,b,a,c,e,g,l,k,i,h,j,n,o,q){function m(a){if(typeof a==="undefined"||a===null)throw Error("AnimationTreeLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof e)||a.loader===null)throw Error("AnimationTreeLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={};this._animationLoader=new q({loader:this._loader})}m.prototype.load=function(a,c,b){if(this._cache[a]&&this._cache[a][c._skeleton._name])return this._cache[a][c._skeleton._name];
var e=new l(c);e._applier=new k;var d=a.match(/.*\//),d=d.length===1?d[0]:"",f=m.prototype._loadTree.bind(this),h=m.prototype._parseTree.bind(this),d=m.prototype._loadAndParseAnimations.bind(this,d),i=m.prototype._parseAnimationLayers.bind(this),b=m.prototype._setupDefaultAnimation.bind(this,b),j,f=f(a).then(function(a){return j=a}).then(h).then(d).then(function(a){var c=new g;return i(e,a,c,j)}).then(b);this._cache[a]||(this._cache[a]={});return this._cache[a][c._skeleton._name]=f};m.prototype._loadTree=
function(a){return this._loader.load(a)};m.prototype._parseTree=function(a){typeof a==="string"&&(a=JSON.parse(a));return!a.Clips||!a.Layers?!1:a.Clips};m.prototype._loadAndParseAnimations=function(a,c){function b(a){h[a._name]=a}for(var e=q.prototype._loadAnimation.bind(this),d,g=[],h={},i=0,j=c.length;i<j;i++)d=q.prototype._parseAnimation.bind(this,c[i].Name),g.push(e(a+c[i].URL).then(d).then(b));return f.all(g).then(function(){return h})};m.prototype._parseAnimationLayers=function(a,c,b,e){var d=
new f.Promise;i.parseAnimationLayers(a,{onSuccess:function(){d.resolve(a)},onError:function(a){d.reject(a)}},c,b,e);return d};m.prototype._setupDefaultAnimation=function(a,c){a&&c.getBaseAnimationLayer().setCurrentStateByName(a,!0);return c};return m});
define("goo/loaders/BundleLoader",["goo/loaders/Loader","goo/util/rsvp","goo/renderer/Util"],function(f,d,b){function a(a){f.call(this,a);this._bundle={}}a.prototype=Object.create(f.prototype);a.prototype.load=function(a,e,g){if(this._bundle[a]){var g=new d.Promise,a=b.clone(this._bundle[a]),l=g.then(function(a){return typeof e==="function"?e(a):a});g.resolve(a);return l}return f.prototype.load.call(this,a,e,g)};a.prototype.loadBundle=function(c){var b=a.prototype._parse.bind(this);return f.prototype.load.call(this,
c,b)};a.prototype._parse=function(a){this._bundle=JSON.parse(a)};return a});
define("goo/loaders/ShaderLoader",["goo/util/rsvp","goo/renderer/MeshData","goo/renderer/Shader","goo/loaders/Loader"],function(f,d,b,a){function c(c){if(typeof c==="undefined"||c===null)throw Error("ShaderLoader(): Argument `parameters` was undefined/null");if(typeof c.loader==="undefined"||!(c.loader instanceof a)||c.loader===null)throw Error("ShaderLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=c.loader;this._cache={}}c.prototype.load=function(a){var c=this._parse.bind(this),
b=this._loader.load(a,function(a){return c(a)});return this._cache[a]=b};c.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var c=[];if(a&&a.attributes&&a.uniforms){var d={attributes:a.attributes,uniforms:a.uniforms},k;for(k in d.uniforms){var i=d.uniforms[k];if(typeof i==="string"&&(i=i.match(/^function\s?\(([^\)]+)\)\s*\{(.*)}$/))&&i.length===3){var h=i[1].replace(" ","").split(",");d.uniforms[k]=new Function(h,i[2])}}if(a.defines)d.defines=a.defines}else d=this._getDefaultShaderDefinition();
a&&a.vshaderRef&&a.fshaderRef&&(k=this._loader.load(a.vshaderRef).then(function(a){return d.vshader=a}),c.push(k),k=this._loader.load(a.fshaderRef).then(function(a){return d.fshader=a}),c.push(k));return c.length===0?(k=new f.Promise,k.reject("Shader definition `"+a+"` does not seem to contain any shader data."),k):f.all(c).then(function(){return new b(a.name,d)})};c.prototype._getDefaultShaderDefinition=function(){return{attributes:{vertexPosition:d.POSITION,vertexNormal:d.NORMAL,vertexUV0:d.TEXCOORD0},
uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraPosition:b.CAMERA,lightPosition:b.LIGHT0,diffuseMap:b.TEXTURE0,materialAmbient:b.AMBIENT,materialDiffuse:b.DIFFUSE,materialSpecular:b.SPECULAR,materialSpecularPower:b.SPECULAR_POWER}}};return c});
define("goo/loaders/MaterialLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/loaders/ShaderLoader,goo/renderer/shaders/ShaderLib".split(","),function(f,d,b,a,c,e,g,l){function k(a){if(typeof a==="undefined"||a===null)throw Error("MaterialLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof e)||a.loader===null)throw Error("MaterialLoader(): Argument `parameters.loader` was invalid/undefined/null");
this._loader=a.loader;this._cache={};this._shaderLoader=new g({loader:this._loader})}k.prototype.load=function(a){if(this._cache[a])return this._cache[a];var b=this,e=this._loader.load(a,function(a){return b._parse(a)}).then(null,function(){return c.createMaterial(l.texturedLit,"DefaultShader")});return this._cache[a]=e};k.prototype._parse=function(b){function e(c,b){typeof b==="string"&&(b=JSON.parse(b));p[c]=(new a({loader:g._loader})).loadTexture2D(b.url)}function d(a,c){if(typeof c[0]!=="undefined"||
c[0]!==null)a[0]=c[0];if(typeof c[1]!=="undefined"||c[1]!==null)a[1]=c[1];if(typeof c[2]!=="undefined"||c[2]!==null)a[2]=c[2];if(typeof c[3]!=="undefined"||c[3]!==null)a[3]=c[3]}typeof b==="string"&&(b=JSON.parse(b));var g=this,k=[],q,m=this._getDefaultMaterialState(),r={},p=[],v=b.name||"DefaultMaterial";if(b){var u;(u=b.shaderRef)?u=this._shaderLoader.load(u).then(function(a){return q=a}):(u=new f.Promise,u.then(function(a){return q=a}),u.resolve(c.createShader(l.texturedLit),"DefaultShader"));
k.push(u);if(b.uniforms)for(var s in b.uniforms){u=b.uniforms[s];var t;(t=/^material(\w+)$/.exec(s))?(t=t[1].toLowerCase(),t==="specularpower"&&(t="shininess"),d(m[t],u)):r[s]=u}if(b.textureRefs&&b.textureRefs.length)for(s=0;s<b.textureRefs.length;s++)u=e.bind(null,s),u=this._loader.load(b.textureRefs[s]).then(u),k.push(u)}return k.length===0?(u=new f.Promise,u.reject("Material definition `"+b+"` does not seem to contain a shader definition."),u):f.all(k).then(function(){var a=new c(v);a.shader=q;
a.textures=p;a.materialState=m;a.uniforms=r;if(b){var e=function(a,c){if(c)for(var b in c)a[b]=c[b]};e(a.cullState,b.cullState);e(a.blendState,b.blendState);e(a.depthState,b.depthState);e(a.offsetState,b.offsetState);if(typeof b.renderQueue==="number"&&b.renderQueue>-1)a.renderQueue=b.renderQueue;if(typeof b.wireframe==="boolean")a.wireframe=b.wireframe}return a})};k.prototype._getDefaultMaterialState=function(){return{ambient:[0.1,0.1,0.1,1],emissive:[0,0,0,0],diffuse:[1,1,1,1],specular:[0.8,0.8,
0.8,1],shininess:16}};return k});
define("goo/loaders/SkeletonLoader",["goo/animation/Skeleton","goo/animation/SkeletonPose","goo/animation/Joint","goo/loaders/Loader","goo/loaders/JsonUtils"],function(f,d,b,a,c){function e(a){if(typeof a==="undefined"||a===null)throw Error("SkeletonLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||a.loader===null)throw Error("SkeletonLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}e.prototype.load=function(a){if(this._cache[a])return this._cache[a];
var c=e.prototype._loadSkeleton.bind(this),b=e.prototype._parseSkeleton.bind(this),d=e.prototype._createSkeletonPose.bind(this),c=c(a).then(b).then(d);return this._cache[a]=c};e.prototype._loadSkeleton=function(a){return this._loader.load(a)};e.prototype._parseSkeleton=function(a){typeof a==="string"&&(a=JSON.parse(a));for(var e=a.Name,a=a.Joints,d=[],i=0,h=a.length;i<h;i++){var j=a[i],n=new b(j.Name);n._index=Math.round(j.Index);n._parentIndex=Math.round(j.ParentIndex);n._inverseBindPose.copy(c.parseTransform(j.InverseBindPose));
n._inverseBindPose.update();d[i]=n}return new f(e,d)};e.prototype._createSkeletonPose=function(a){a=new d(a);a.setToBindPose();return a};return e});
define("goo/loaders/MeshLoader",["goo/util/rsvp","goo/loaders/JsonUtils","goo/renderer/MeshData","goo/loaders/SkeletonLoader"],function(f,d,b,a){function c(c){if(typeof c==="undefined"||c===null)throw Error("MeshLoader(): Argument `parameters` was undefined/null");if(typeof c.loader==="undefined"||c.loader===null)throw Error("MeshLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=c.loader;this._skeletonLoader=new a({loader:this._loader});this._cache={}}c.prototype.load=
function(a){if(this._cache[a])return this._cache[a];var c=this,b=this._loader.load(a,function(a){return c._parse(a)});return this._cache[a]=b};c.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var c=new f.Promise;try{if(Object.keys(a).length===0)return c.reject("Empty meshdata"),c;if(a.compression)this.useCompression=a.compression.compressed||!1,this.compressedVertsRange=a.compression.compressedVertsRange||16383,this.compressedColorsRange=a.compression.compressedColorsRange||255,
this.compressedUnitVectorRange=a.compression.compressedUnitVectorRange||1023;var d=a.type==="SkinnedMesh"?"SkinnedMesh":"Mesh",k;a.type==="SkinnedMesh"?(k=this._parseMeshData(a.data||a,4,d),k.type=b.SKINMESH):(k=this._parseMeshData(a.data||a,0,d),k.type=b.MESH);a.pose?c=this._skeletonLoader.load(a.pose).then(function(a){k.currentPose=a;return k}):c.resolve(k)}catch(i){c.reject(i)}return c};c.prototype._parseMeshData=function(a,c,f){var k=a.vertexCount;if(k===0)return null;var i=a.indexLengths?a.indexLengths[0]:
a.indices?a.indices.length:0,h={};if(a.vertices)h.POSITION=b.createAttribute(3,"Float");if(a.normals)h.NORMAL=b.createAttribute(3,"Float");if(a.tangents)h.TANGENT=b.createAttribute(4,"Float");if(a.colors)h.COLOR=b.createAttribute(4,"Float");if(c>0&&a.weights)h.WEIGHTS=b.createAttribute(4,"Float");if(c>0&&a.joints)h.JOINTIDS=b.createAttribute(4,"Short");if(a.textureCoords)for(var j in a.textureCoords)h["TEXCOORD"+j]=b.createAttribute(2,"Float");i=new b(h,k,i);if(a.vertices)this.useCompression?(j=a.vertexOffsets,
d.fillAttributeBufferFromCompressedString(a.vertices,i,b.POSITION,[a.vertexScale,a.vertexScale,a.vertexScale],[j.xOffset,j.yOffset,j.zOffset])):d.fillAttributeBuffer(a.vertices,i,b.POSITION);c>0&&a.weights&&(this.useCompression?(h=1/this.compressedVertsRange,d.fillAttributeBufferFromCompressedString(a.weights,i,b.WEIGHTS,[h],[0])):d.fillAttributeBuffer(a.weights,i,b.WEIGHTS));a.normals&&(this.useCompression?(j=1-(this.compressedUnitVectorRange+1>>1),h=1/-j,d.fillAttributeBufferFromCompressedString(a.normals,
i,b.NORMAL,[h,h,h],[j,j,j])):d.fillAttributeBuffer(a.normals,i,b.NORMAL));a.tangents&&(this.useCompression?(j=1-(this.compressedUnitVectorRange+1>>1),h=1/-j,d.fillAttributeBufferFromCompressedString(a.tangents,i,b.TANGENT,[h,h,h,h],[j,j,j,j])):d.fillAttributeBuffer(a.tangents,i,b.TANGENT));a.colors&&(this.useCompression?(j=0,h=255/(this.compressedColorsRange+1),d.fillAttributeBufferFromCompressedString(a.colors,i,b.COLOR,[h,h,h,h],[j,j,j,j])):d.fillAttributeBuffer(a.colors,i,b.COLOR));if(a.textureCoords)if(h=
a.textureCoords,this.useCompression)for(j=0;j<h.length;j++){var n=h[j];d.fillAttributeBufferFromCompressedString(n.UVs,i,"TEXCOORD"+j,n.UVScales,n.UVOffsets)}else for(j=0;j<h.length;j++)d.fillAttributeBuffer(h[j],i,"TEXCOORD"+j);if(c>0&&a.joints)if(h=i.getAttributeBuffer(b.JOINTIDS),n=this.useCompression?d.getIntBufferFromCompressedString(a.joints,32767):d.getIntBuffer(a.joints,32767),f==="SkinnedMesh"){var f=[],o=0;j=0;for(var q=n.length;j<q;j++){var m=n[j];f[m]===void 0&&(f[m]=o++);h.set([f[m]],
j)}j=[];for(m=0;m<f.length;m++)o=f[m],o!==void 0&&(j[o]=m);i.paletteMap=j;i.weightsPerVertex=c}else{j=0;for(q=n.capacity();j<q;j++)h.putCast(j,n.get(j))}a.indices&&(this.useCompression?i.getIndexBuffer().set(d.getIntBufferFromCompressedString(a.indices,k)):i.getIndexBuffer().set(d.getIntBuffer(a.indices,k)));if(a.indexModes)if(c=a.indexModes,c.length===1)i.indexModes[0]=c[0];else{k=[];for(j=0;j<c.length;j++)k[j]=c[j];i.indexModes=k}if(a.indexLengths){c=a.indexLengths;k=[];for(j=0;j<c.length;j++)k[j]=
c[j];i.indexLengths=k}if(a.boundingBox)i.boundingBox=a.boundingBox;return i};return c});
define("goo/loaders/EntityLoader","goo/entities/Entity,goo/renderer/Camera,goo/entities/components/CameraComponent,goo/entities/components/TransformComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/MeshDataComponent,goo/renderer/MeshData,goo/math/Vector3,goo/math/MathUtils,goo/renderer/bounds/BoundingBox,goo/util/rsvp,goo/loaders/MaterialLoader,goo/loaders/MeshLoader,goo/loaders/Loader".split(","),function(f,d,b,a,c,e,g,l,k,i,h,j,n,o){function q(a){if(typeof a==="undefined"||
a===null)throw Error("EntityLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof o)||a.loader===null)throw Error("EntityLoader(): Argument `parameters.loader` was invalid/undefined/null");if(typeof a.world==="undefined"||a.world===null)throw Error("EntityLoader(): Argument `parameters.world` was undefined/null");this._loader=a.loader;this._world=a.world;this._cache={};this._materialLoader=new j({loader:this._loader});this._meshLoader=new n({loader:this._loader})}
q.prototype.load=function(a){var c=this,b=this._loader.load(a,function(b){return c._parse(b,a)});return this._cache[a]=b};q.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var c=[],b=[],e=this;if(a.components){var d;(d=a.components.transform)&&b.push(this._getTransformComponent(d));(d=a.components.camera)&&b.push(this._getCameraComponent(d));if(d=a.components.meshRenderer)d=this._getMeshRendererComponent(d).then(function(a){b.push(a);return a}),c.push(d);if(d=a.components.meshData)d=
this._getMeshDataComponent(d).then(function(a){b.push(a);return a}),c.push(d)}return b.length===0&&c.length===0?(d=new h.Promise,d.reject("Entity definition `"+a+"` does not seem to contain any components."),d):h.all(c).then(function(){var c=new f(e._world,a.name),d;for(d in b)b[d].type==="TransformComponent"&&c.clearComponent("transformComponent"),c.setComponent(b[d]);if(c.meshDataComponent&&c.meshDataComponent.meshData.type===g.SKINMESH&&c.meshRendererComponent&&c.meshRendererComponent.materials.length){var h=
c.meshRendererComponent.materials,i;d=0;for(var j=h.length;d<j;d++)if((i=h[d].shader.defines)&&i.JOINT_COUNT!==void 0&&i.WEIGHTS!==void 0)i.JOINT_COUNT=c.meshDataComponent.meshData.paletteMap.length,i.WEIGHTS=c.meshDataComponent.meshData.weightsPerVertex}return c})};q.prototype._getTransformComponent=function(c){var b=new a;b.transform.translation.set(c.translation);b.transform.scale.set(c.scale);b.transform.rotation.fromAngles(k.radFromDeg(c.rotation[0]),k.radFromDeg(c.rotation[1]),k.radFromDeg(c.rotation[2]));
(c=c.parentRef)&&this._cache[c]&&this._cache[c].then(function(a){a.transformComponent.attachChild(b);return a});return b};q.prototype._getCameraComponent=function(a){a=new d(a.fov||45,a.aspect||1,a.near||1,a.far||100);return new b(a)};q.prototype._getMeshRendererComponent=function(a){var b=[],d=this._materialLoader,e;for(e in a)if(e==="materialRefs")for(var f in a[e]){var g=d.load(a[e][f]);b.push(g)}return h.all(b).then(function(b){var d=new c,e;for(e in a)d.hasOwnProperty(e)&&e!=="materials"&&(d[e]=
a[e]);for(var f in b)d.materials.push(b[f]);return d})};q.prototype._getMeshDataComponent=function(a){var c=[],b=this._meshLoader,d;for(d in a)if(d==="meshRef"){var f=b.load(a[d]);c.push(f)}return h.all(c).then(function(a){var c=new e(a[0]);if(a[0].boundingBox){var b=a[0].boundingBox.min,d=a[0].boundingBox.max,a=[d[0]-b[0],d[1]-b[1],d[2]-b[2]],b=[(d[0]+b[0])*0.5,(d[1]+b[1])*0.5,(d[2]+b[2])*0.5],d=new i;d.xExtent=a[0];d.yExtent=a[1];d.zExtent=a[2];d.center.seta(b);c.modelBound=d;c.autoCompute=!1}return c})};
return q});define("goo/util/URLTools",[],function(){function f(){}f.getDirectory=function(d){var b=/.*\//.exec(d);return!b?d+"/":b[0]};return f});
define("goo/loaders/JSONImporter","goo/renderer/MeshData,goo/loaders/JsonUtils,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/TextureCreator,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/state/loader/OutputStore,goo/util/URLTools,goo/util/SimpleResourceUtil,goo/renderer/shaders/ShaderLib,goo/renderer/Shader".split(","),function(f,
d,b,a,c,e,g,l,k,i,h,j,n,o,q,m,r,p){function v(a){this.world=a;this.materials={};this.skeletonMap={};this.poseMap={};this.slotUnitMap={diffuse:0,normal:1,ao:2,occlusion:3,specular:3};this.loadedEntities=[];this.baseTextureDir=""}function u(){this.materialName="not set";this.technique=this.profile=null;this.textureReferences={};this.textureFileNames={};this.textureMinificationFilters={};this.textureFlipSettings={};this.usesTransparency=!1;this.materialState={};this.connectedMeshes=[]}v.prototype.load=
function(a,c,b,d){var e=new XMLHttpRequest;if(typeof c==="undefined"||c===null)c=q.getDirectory(a);e.open("GET",a,!0);var f=this;e.onreadystatechange=function(){if(e.readyState===4)if(e.status>=200&&e.status<=299){var a=f.parse(e.responseText,c,d);b.onSuccess(a)}else b.onError(e.statusText)};e.send()};v.prototype.parse=function(a,c,b){this.baseTextureDir=c||"";this.loadedEntities=[];this.shaderExtractor=b;a=JSON.parse(a);if(this.useCompression=a.UseCompression||!1)this.compressedVertsRange=a.CompressedVertsRange||
16383,this.compressedColorsRange=a.CompressedColorsRange||255,this.compressedUnitVectorRange=a.CompressedUnitVectorRange||1023;this._parseMaterials(a.Materials);a.Skeletons&&this.parseSkeletons(a.Skeletons);a.SkeletonPoses&&this.parseSkeletonPoses(a.SkeletonPoses);this._parseSpatial(a.Scene);delete this.shaderExtractor;return this.loadedEntities};v.prototype._parseSpatial=function(c){var e=c.Type,g=c.Name===null?"null":c.Name,h=this.world.createEntity();h.name=g;this.loadedEntities.push(h);if(e===
"Node"){if(c.Children)for(var i in c.Children)e=this._parseSpatial(c.Children[i]),e!==null&&h.transformComponent.attachChild(e.transformComponent)}else if(e==="Mesh"){i=this._parseMeshData(c.MeshData,0,h,e);if(i===null)return null;i.type=f.MESH;h.setComponent(new b(i));e=new a;h.setComponent(e);this._parseMaterial(c,h)}else if(e==="SkinnedMesh"){i=this._parseMeshData(c.MeshData,4,h,e);if(i===null)return null;i.type=f.SKINMESH;h.setComponent(new b(i));e=new a;h.setComponent(e);this._parseMaterial(c,
h);if(c.Pose)i.currentPose=this.poseMap[c.Pose]}else return;c=d.parseTransform(c.Transform);h.transformComponent.transform=c;return h};v.prototype.parseSkeletons=function(a){for(var c=0,b=a.length;c<b;c++){for(var e=a[c],f=e.ref,h=e.Name,e=e.Joints,i=[],j=0,k=e.length;j<k;j++){var m=e[j],n=new g(m.Name);n._index=Math.round(m.Index);n._parentIndex=Math.round(m.ParentIndex);n._inverseBindPose.copy(d.parseTransform(m.InverseBindPose));n._inverseBindPose.update();i[j]=n}h=new l(h,i);this.skeletonMap[f]=
h}};v.prototype.parseSkeletonPoses=function(a){for(var c=0,b=a.length;c<b;c++){var e=a[c],d=e.ref,e=new k(this.skeletonMap[e.Skeleton]);e.setToBindPose();this.poseMap[d]=e}};v.prototype._parseMeshData=function(a,c,b,e){var g=a.VertexCount;if(g===0)return null;var b=a.IndexLengths?a.IndexLengths[0]:a.Indices?a.Indices.length:0,h={};if(a.Vertices)h.POSITION=f.createAttribute(3,"Float");if(a.Normals)h.NORMAL=f.createAttribute(3,"Float");if(a.Tangents)h.TANGENT=f.createAttribute(4,"Float");if(a.Colors)h.COLOR=
f.createAttribute(4,"Float");if(c>0&&a.Weights)h.WEIGHTS=f.createAttribute(4,"Float");if(c>0&&a.Joints)h.JOINTIDS=f.createAttribute(4,"Short");if(a.TextureCoords)for(var i in a.TextureCoords)h["TEXCOORD"+i]=f.createAttribute(2,"Float");b=new f(h,g,b);if(a.Vertices)this.useCompression?(i=a.VertexOffsets,d.fillAttributeBufferFromCompressedString(a.Vertices,b,f.POSITION,[a.VertexScale,a.VertexScale,a.VertexScale],[i.xOffset,i.yOffset,i.zOffset])):d.fillAttributeBuffer(a.Vertices,b,f.POSITION);a.Weights&&
(this.useCompression?(h=1/this.compressedVertsRange,d.fillAttributeBufferFromCompressedString(a.Weights,b,f.WEIGHTS,[h],[0])):d.fillAttributeBuffer(a.Weights,b,f.WEIGHTS));a.Normals&&(this.useCompression?(i=1-(this.compressedUnitVectorRange+1>>1),h=1/-i,d.fillAttributeBufferFromCompressedString(a.Normals,b,f.NORMAL,[h,h,h],[i,i,i])):d.fillAttributeBuffer(a.Normals,b,f.NORMAL));a.Tangents&&(this.useCompression?(i=1-(this.compressedUnitVectorRange+1>>1),h=1/-i,d.fillAttributeBufferFromCompressedString(a.Tangents,
b,f.TANGENT,[h,h,h,h],[i,i,i,i])):d.fillAttributeBuffer(a.Tangents,b,f.TANGENT));a.Colors&&(this.useCompression?(i=0,h=255/(this.compressedColorsRange+1),d.fillAttributeBufferFromCompressedString(a.Colors,b,f.COLOR,[h,h,h,h],[i,i,i,i])):d.fillAttributeBuffer(a.Colors,b,f.COLOR));if(a.TextureCoords)if(h=a.TextureCoords,this.useCompression)for(i=0;i<h.length;i++){var j=h[i];d.fillAttributeBufferFromCompressedString(j.UVs,b,"TEXCOORD"+i,j.UVScales,j.UVOffsets)}else for(i=0;i<h.length;i++)d.fillAttributeBuffer(h[i],
b,"TEXCOORD"+i);if(a.Joints)if(h=b.getAttributeBuffer(f.JOINTIDS),j=this.useCompression?d.getIntBufferFromCompressedString(a.Joints,32767):d.getIntBuffer(a.Joints,32767),e==="SkinnedMesh"){var e=[],k=0;i=0;for(var l=j.length;i<l;i++){var m=j[i];e[m]===void 0&&(e[m]=k++);h.set([e[m]],i)}i=[];for(m=0;m<e.length;m++)k=e[m],k!==void 0&&(i[k]=m);b.paletteMap=i;b.weightsPerVertex=c}else{i=0;for(l=j.capacity();i<l;i++)h.putCast(i,j.get(i))}a.Indices&&(this.useCompression?b.getIndexBuffer().set(d.getIntBufferFromCompressedString(a.Indices,
g)):b.getIndexBuffer().set(d.getIntBuffer(a.Indices,g)));if(a.IndexModes)if(c=a.IndexModes,c.length===1)b.indexModes[0]=c[0];else{g=[];for(i=0;i<c.length;i++)g[i]=c[i];b.indexModes=g}if(a.IndexLengths){a=a.IndexLengths;c=[];for(i=0;i<a.length;i++)c[i]=a[i];b.indexLengths=c}return b};v.prototype._parseMaterials=function(a){if(a)for(var c=0,b=a.length;c<b;c++){var e=a[c];if(e!==null){var d=new u;d.materialName=e.MaterialName;d.profile=e.Profile;d.technique=e.Technique;d.usesTransparency=e.UsesTransparency;
d.materialState=this._parseMaterialstate(e);if(e.TextureEntries)for(var e=e.TextureEntries,f=0,g=e.length;f<g;f++){var h=e[f],i=h.Slot,j=h.TextureReference||null,k=h.TextureSource||null,l=h.MinificationFilter||null,m="Trilinear";if(l!==null)try{m="minificationFilterStr"}catch(n){console.warn("Bad texture minification filter: "+l)}h=h.Flip!==void 0?h.Flip:!0;d.textureReferences[i]=j;d.textureFileNames[i]=k;d.textureMinificationFilters[i]=m;d.textureFlipSettings[i]=h}this.materials[d.materialName]=
d}}};v.prototype._parseMaterial=function(a,b){if(a.Material){var d=this.materials[a.Material];if(d!==void 0){var f=b.meshRendererComponent,g=b.meshDataComponent.meshData.attributeMap,h=null;if(this.shaderExtractor)if(g=this.shaderExtractor(g,d),g instanceof c)h=g;else if(g instanceof p)h=new c(d.materialName),h.shader=g;else throw Error("The extractor should return a Material or a Shader");else h=c.createMaterial(g.NORMAL&&g.TANGENT&&g.TEXCOORD0&&g.TEXCOORD1&&g.TEXCOORD2&&d.textureFileNames.diffuse&&
d.textureFileNames.normal&&d.textureFileNames.ao?r.texturedNormalAOLit:g.NORMAL&&g.TEXCOORD0&&d.textureFileNames.diffuse?r.texturedLit:g.TEXCOORD0&&d.textureFileNames.diffuse?r.textured:r.simple,d.materialName);f.materials[0]=h;h.materialState=d.materialState;for(var i in this.slotUnitMap)d.textureFileNames[i]!==void 0&&(f=d.textureFileNames[i],f=(new e).loadTexture2D(this.baseTextureDir+f),h.textures[this.slotUnitMap[i]]=f)}}};v.prototype._parseMaterialstate=function(a){var c={};c.ambient=this._parseColor(a.AmbientColor);
c.diffuse=this._parseColor(a.DiffuseColor);c.emissive=this._parseColor(a.EmissiveColor);c.specular=this._parseColor(a.SpecularColor);c.shininess=a.Shininess;return c};v.prototype._parseColor=function(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})*$/i.exec(a))?[parseInt(a[1],16)/255,parseInt(a[2],16)/255,parseInt(a[3],16)/255,a[4]!==void 0?parseInt(a[4],16)/255:1]:null};v.prototype.importAnimationTree=function(a,c,b){return this.importAnimationTreeFromJSON(a,JSON.parse(c),b)};v.prototype.importAnimationTreeFromJSON=
function(a,c,b){var e=new o;if(!c.Clips||!c.Layers){if(b)b.onSuccess(e)}else{for(var f=c.Clips,g=[],h=[],i=0,j=f.length;i<j;i++){var k=f[i];g.push(k.Name);h.push(k.URL)}m.loadTextAssets(h,g,{onSuccess:function(f){for(var h={},i=0,j=g.length;i<j;i++){var k=(new v).importAnimation(f[g[i]],g[i]);h[k._name]=k}d.parseAnimationLayers(a,b,h,e,c)},onError:function(a){console.warn("failed loading tree clips: "+a);if(b)b.onError(a)}})}};v.prototype.importAnimation=function(a,c){var b=new i(c),e=JSON.parse(a);
if(this.useCompression=e.UseCompression||!1)this.compressedAnimRange=e.CompressedRange||32767;if(e.Channels)for(var e=e.Channels,f=0,g=e.length;f<g;f++){var k=e[f],l=k.Type,m=k.Name,o=d.parseChannelTimes(k,this.useCompression);if("Joint"===l)var m=k.JointName,q=k.JointIndex,l=d.parseRotationSamples(k,this.compressedAnimRange,this.useCompression),p=d.parseTranslationSamples(k,o.length,this.useCompression),k=d.parseScaleSamples(k,o.length,this.useCompression),o=new h(m,q,o,l,p,k);else if("Transform"===
l)l=d.parseRotationSamples(k,this.compressedAnimRange,this.useCompression),p=d.parseTranslationSamples(k,o.length,this.useCompression),k=d.parseScaleSamples(k,o.length,this.useCompression),o=new j(m,o,l,p,k);else if("FloatLERP"===l)o=new n(m,o,d.parseFloatLERPValues(k,this.useCompression));else{console.warn("Unhandled channel type: "+l);continue}b.addChannel(o)}return b};return v});
define("goo/loaders/SceneLoader",["goo/loaders/Loader","goo/loaders/EntityLoader","goo/util/rsvp"],function(f,d,b){function a(a){if(typeof a==="undefined"||a===null)throw Error("SceneLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof f)||a.loader===null)throw Error("SceneLoader(): Argument `parameters.loader` was invalid/undefined/null");if(typeof a.world==="undefined"||a.world===null)throw Error("SceneLoader(): Argument `parameters.world` was undefined/null");
this._loader=a.loader;this._world=a.world}a.prototype.load=function(a){var b=this;return this._loader.load(a,function(d){return b._parse(d,a)})};a.prototype._parse=function(a,e){typeof a==="string"&&(a=JSON.parse(a));var f=[];if(a&&a.entityRefs&&a.entityRefs.length){var l=new d({world:this._world,loader:this._loader}),k;for(k in a.entityRefs){var i=l.load(a.entityRefs[k]);f.push(i)}}if(f.length===0)return i=new b.Promise,i.reject("Can't find anything to load at "+e),i;this.globals=a.globals;return b.all(f).then(function(a){return a})};
a.prototype._buildWorld=function(a){for(var b in a)a[b].addToWorld();this._world.process();return this._world};return a});
define("goo/loaders/ScriptLoader",["goo/util/rsvp","goo/loaders/Loader"],function(f,d){function b(a){if(typeof a==="undefined"||a===null)throw Error("ScriptLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof d)||a.loader===null)throw Error("ScriptLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}b.prototype.load=function(a,c){if(this._cache[a])return this._cache[a].then(function(a){return new a(c)});
var b=this._parse.bind(this),d=this._loader.load(a,function(a){return b(a)});this._cache[a]=d;return d.then(function(a){return new a(c)})};b.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));return this._loadScript(a.jsRef)};b.prototype._loadScript=function(a){var c=new f.Promise;require([this._loader.rootPath+a],function(a){c.resolve(a)});return c};return b});
define("goo/math/Matrix2x2",["goo/math/MathUtils","goo/math/Matrix"],function(f,d){function b(){d.call(this,2,2);arguments.length===0?this.setIdentity():this.set(arguments)}b.prototype=Object.create(d.prototype);b.prototype.setupAliases([["e00"],["e10"],["e01"],["e11"]]);b.IDENTITY=new b(1,0,0,1);b.add=function(a,c,d){d||(d=new b);c instanceof b?(d.e00=a.e00+c.e00,d.e10=a.e10+c.e10,d.e01=a.e01+c.e01,d.e11=a.e11+c.e11):(d.e00=a.e00+c,d.e10=a.e10+c,d.e01=a.e01+c,d.e11=a.e11+c);return d};b.prototype.add=
function(a){return b.add(this,a,this)};b.sub=function(a,c,d){d||(d=new b);c instanceof b?(d.e00=a.e00-c.e00,d.e10=a.e10-c.e10,d.e01=a.e01-c.e01,d.e11=a.e11-c.e11):(d.e00=a.e00-c,d.e10=a.e10-c,d.e01=a.e01-c,d.e11=a.e11-c);return d};b.prototype.sub=function(a){return b.sub(this,a,this)};b.mul=function(a,c,d){d||(d=new b);c instanceof b?(d.e00=a.e00*c.e00,d.e10=a.e10*c.e10,d.e01=a.e01*c.e01,d.e11=a.e11*c.e11):(d.e00=a.e00*c,d.e10=a.e10*c,d.e01=a.e01*c,d.e11=a.e11*c);return d};b.prototype.mul=function(a){return b.mul(this,
a,this)};b.div=function(a,c,d){d||(d=new b);c instanceof b?(d.e00=a.e00/c.e00,d.e10=a.e10/c.e10,d.e01=a.e01/c.e01,d.e11=a.e11/c.e11):(c=1/c,d.e00=a.e00*c,d.e10=a.e10*c,d.e01=a.e01*c,d.e11=a.e11*c);return d};b.prototype.div=function(a){return b.div(this,a,this)};b.combine=function(a,c,e){e||(e=new b);if(e===a||e===c)return d.copy(b.combine(a,c),e);e.e00=a.e00*c.e00+a.e01*c.e10;e.e10=a.e10*c.e00+a.e11*c.e10;e.e01=a.e00*c.e01+a.e01*c.e11;e.e11=a.e10*c.e01+a.e11*c.e11;return e};b.prototype.combine=function(a){return b.combine(this,
a,this)};b.transpose=function(a,c){c||(c=new b);if(c===a)return d.copy(b.transpose(a),c);c.e00=a.e00;c.e10=a.e01;c.e01=a.e10;c.e11=a.e11;return c};b.prototype.transpose=function(){return b.transpose(this,this)};b.invert=function(a,c){c||(c=new b);if(c===a)return d.copy(b.invert(a),c);var e=a.determinant();if(Math.abs(e)<f.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};e=1/e;c.e00=a.e11*e;c.e10=0-a.e10*e;c.e01=0-a.e01*e;c.e11=a.e00*e;return c};b.prototype.invert=
function(){return b.invert(this,this)};b.prototype.isOrthogonal=function(){return Math.abs(this.e00*this.e01+this.e10*this.e11)>f.EPSILON?!1:!0};b.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10;if(Math.abs(a-1)>f.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11;return Math.abs(a-1)>f.EPSILON?!1:!0};b.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};b.prototype.determinant=function(){return this.e00*this.e11-this.e01*this.e10};b.prototype.setIdentity=
function(){this.set(b.IDENTITY)};return b});
define("goo/math/Versor",["goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Vector"],function(f,d,b){function a(){b.call(this,4);this.set(arguments.length!==0?arguments:[0,0,0,1])}a.prototype=Object.create(b.prototype);a.prototype.setupAliases([["x"],["y"],["z"],["w"]]);a.IDENTITY=new a(0,0,0,1);a.combine=function(c,d,f){f||(f=new a);if(f===c||f===d)return b.copy(a.combine(c,d),f);f.data[0]=c.data[3]*d.data[0]+d.data[3]*c.data[0]+d.data[2]*c.data[1]-d.data[1]*c.data[2];f.data[1]=c.data[3]*d.data[1]+
d.data[3]*c.data[1]+d.data[0]*c.data[2]-d.data[2]*c.data[0];f.data[2]=c.data[3]*d.data[2]+d.data[3]*c.data[2]+d.data[1]*c.data[0]-d.data[0]*c.data[1];f.data[3]=c.data[3]*d.data[3]-(c.data[0]*d.data[0]+c.data[1]*d.data[1]+c.data[2]*d.data[2]);return f};a.prototype.combine=function(c){return a.combine(this,c,this)};a.invert=function(c,b){b||(b=new a);b.data[0]=0-c.data[0];b.data[1]=0-c.data[1];b.data[2]=0-c.data[2];b.data[3]=c.data[3];return b};a.prototype.invert=function(){return a.invert(this,this)};
a.fromAngleAxis=function(c,b,d){var f=Math.sin(c*0.5),c=Math.cos(c*0.5);d||(d=new a);b.normalize();d.data[0]=b.data[0]*f;d.data[1]=b.data[1]*f;d.data[2]=b.data[2]*f;d.data[3]=c;return d};a.prototype.fromAngleAxis=function(c,b){return a.fromAngleAxis(c,b,this)};a.fromAngleNormalAxis=function(c,b,d){var f=Math.sin(c*0.5),c=Math.cos(c*0.5);d||(d=new a);d.data[0]=b.data[0]*f;d.data[1]=b.data[1]*f;d.data[2]=b.data[2]*f;d.data[3]=c;return d};a.prototype.fromAngleNormalAxis=function(c,b){return a.fromAngleNormalAxis(c,
b,this)};a.toMatrix3x3=function(a,b){b||(b=new f);var d=2*a.data[0]*a.data[0],l=2*a.data[1]*a.data[1],k=2*a.data[2]*a.data[2],i=2*a.data[0]*a.data[1],h=2*a.data[0]*a.data[2],j=2*a.data[1]*a.data[2],n=2*a.data[0]*a.data[3],o=2*a.data[1]*a.data[3],q=2*a.data[2]*a.data[3];b.e00=1-(l+k);b.e10=i+q;b.e20=h-o;b.e01=i-q;b.e11=1-(d+k);b.e21=j+n;b.e02=h+o;b.e12=j-n;b.e22=1-(d+l);return b};a.prototype.toMatrix3x3=function(c){return a.toMatrix3x3(this,c)};a.toMatrix4x4=function(a,b){b||(b=new d);var f=2*a.data[0]*
a.data[0],l=2*a.data[1]*a.data[1],k=2*a.data[2]*a.data[2],i=2*a.data[0]*a.data[1],h=2*a.data[0]*a.data[2],j=2*a.data[1]*a.data[2],n=2*a.data[0]*a.data[3],o=2*a.data[1]*a.data[3],q=2*a.data[2]*a.data[3];b.e00=1-(l+k);b.e10=i+q;b.e20=h-o;b.e30=0;b.e01=i-q;b.e11=1-(f+k);b.e21=j+n;b.e31=0;b.e02=h+o;b.e12=j-n;b.e22=1-(f+l);b.e32=0;b.e03=0;b.e13=0;b.e23=0;b.e33=1;return b};a.prototype.toMatrix4x4=function(c){return a.toMatrix4x4(this,c)};return a});
define("goo/math/Transformation",["goo/math/Matrix4x4","goo/math/Vector","goo/math/Vector3","goo/math/Versor"],function(f,d,b,a){function c(c,d,l){this.translation=c||new b(0,0,0);this.rotation=d||new a(1,0,0,0);this.scale=l||new b(1,1,1);this.parentFromChild=new f;this.childFromParent=new f;this.doUpdate=!0}c.prototype.parentFromChildNormal=function(a,c){this.doUpdate&&this.update();c||(c=new b);if(c===a)return d.copy(this.parentFromChildNormal(a),c);c.x=this.childFromParent.e00*a.x+this.childFromParent.e10*
a.y+this.childFromParent.e20*a.z;c.y=this.childFromParent.e01*a.x+this.childFromParent.e11*a.y+this.childFromParent.e21*a.z;c.z=this.childFromParent.e02*a.x+this.childFromParent.e12*a.y+this.childFromParent.e22*a.z;return c};c.prototype.childFromParentNormal=function(a,c){this.doUpdate&&this.update();c||(c=new b);if(c===a)return d.copy(this.childFromParentNormal(a),c);c.x=this.parentFromChild.e00*a.x+this.parentFromChild.e10*a.y+this.parentFromChild.e20*a.z;c.y=this.parentFromChild.e01*a.x+this.parentFromChild.e11*
a.y+this.parentFromChild.e21*a.z;c.z=this.parentFromChild.e02*a.x+this.parentFromChild.e12*a.y+this.parentFromChild.e22*a.z;return c};c.prototype.parentFromChildVector=function(a,c){this.doUpdate&&this.update();c||(c=new b);if(c===a)return d.copy(this.parentFromChildVector(a),c);c.x=this.parentFromChild.e00*a.x+this.parentFromChild.e01*a.y+this.parentFromChild.e02*a.z;c.y=this.parentFromChild.e10*a.x+this.parentFromChild.e11*a.y+this.parentFromChild.e12*a.z;c.z=this.parentFromChild.e20*a.x+this.parentFromChild.e21*
a.y+this.parentFromChild.e22*a.z;return c};c.prototype.childFromParentVector=function(a,c){this.doUpdate&&this.update();c||(c=new b);if(c===a)return d.copy(this.childFromParentVector(a),c);c.x=this.childFromParent.e00*a.x+this.childFromParent.e01*a.y+this.childFromParent.e02*a.z;c.y=this.childFromParent.e10*a.x+this.childFromParent.e11*a.y+this.childFromParent.e12*a.z;c.z=this.childFromParent.e20*a.x+this.childFromParent.e21*a.y+this.childFromParent.e22*a.z;return c};c.prototype.parentFromChildVertex=
function(a,c){this.doUpdate&&this.update();c||(c=new b);if(c===a)return d.copy(this.parentFromChildVertex(a),c);c.x=this.parentFromChild.e00*a.x+this.parentFromChild.e01*a.y+this.parentFromChild.e02*a.z+this.parentFromChild.e03;c.y=this.parentFromChild.e10*a.x+this.parentFromChild.e11*a.y+this.parentFromChild.e12*a.z+this.parentFromChild.e13;c.z=this.parentFromChild.e20*a.x+this.parentFromChild.e21*a.y+this.parentFromChild.e22*a.z+this.parentFromChild.e23;return c};c.prototype.childFromParentVertex=
function(a,c){this.doUpdate&&this.update();c||(c=new b);if(c===a)return d.copy(this.childFromParentVertex(a),c);c.x=this.childFromParent.e00*a.x+this.childFromParent.e01*a.y+this.childFromParent.e02*a.z+this.childFromParent.e03;c.y=this.childFromParent.e10*a.x+this.childFromParent.e11*a.y+this.childFromParent.e12*a.z+this.childFromParent.e13;c.z=this.childFromParent.e20*a.x+this.childFromParent.e21*a.y+this.childFromParent.e22*a.z+this.childFromParent.e23;return c};c.prototype.update=function(){if(this.doUpdate){var a=
this.rotation.toMatrix3x3();this.parentFromChild.e00=a.e00*this.scale.x;this.parentFromChild.e10=a.e10*this.scale.x;this.parentFromChild.e20=a.e20*this.scale.x;this.parentFromChild.e30=0;this.parentFromChild.e01=a.e01*this.scale.y;this.parentFromChild.e11=a.e11*this.scale.y;this.parentFromChild.e21=a.e21*this.scale.y;this.parentFromChild.e31=0;this.parentFromChild.e02=a.e02*this.scale.z;this.parentFromChild.e12=a.e12*this.scale.z;this.parentFromChild.e22=a.e22*this.scale.z;this.parentFromChild.e32=
0;this.parentFromChild.e03=this.translation.x;this.parentFromChild.e13=this.translation.y;this.parentFromChild.e23=this.translation.z;this.parentFromChild.e33=1;this.childFromParent.e00=a.e00/this.scale.x;this.childFromParent.e10=a.e01/this.scale.y;this.childFromParent.e20=a.e02/this.scale.z;this.childFromParent.e30=0;this.childFromParent.e01=a.e10/this.scale.x;this.childFromParent.e11=a.e11/this.scale.y;this.childFromParent.e21=a.e12/this.scale.z;this.childFromParent.e31=0;this.childFromParent.e02=
a.e20/this.scale.x;this.childFromParent.e12=a.e21/this.scale.y;this.childFromParent.e22=a.e22/this.scale.z;this.childFromParent.e32=0;this.childFromParent.e03=0-(a.e00*this.translation.x+a.e10*this.translation.y+a.e20*this.translation.z)/this.scale.x;this.childFromParent.e13=0-(a.e01*this.translation.x+a.e11*this.translation.y+a.e21*this.translation.z)/this.scale.y;this.childFromParent.e23=0-(a.e02*this.translation.x+a.e12*this.translation.y+a.e22*this.translation.z)/this.scale.z;this.childFromParent.e33=
1;this.doUpdate=!1;return this}};return c});
define("goo/noise/Noise",["goo/math/MathUtils"],function(f){function d(){}d.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,
82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5];d.split=
function(b){var a=Math.floor(b),b=f.scurve5(b-a);return{i0:a+0,i1:a+1,f0:1-b,f1:0+b}};d.fractal1d=function(b,a,c,d,f,l){for(var k=0,i=1,h=0,j=0;j<c;j++)k+=i*l.evaluate1d(b,a),h+=i,i*=d,b*=f;return k/h};d.fractal2d=function(b,a,c,d,f,l,k){for(var i=0,h=1,j=0,n=0;n<d;n++)i+=h*k.evaluate2d(b,a,c),j+=h,h*=f,b*=l,a*=l;return i/j};d.fractal3d=function(b,a,c,d,f,l,k,i){for(var h=0,j=1,n=0,o=0;o<f;o++)h+=j*i.evaluate3d(b,a,c,d),n+=j,j*=l,b*=k,a*=k,c*=k;return h/n};d.fractal4d=function(b,a,c,d,f,l,k,i,h){for(var j=
0,n=1,o=0,q=0;q<l;q++)j+=n*h.evaluate4d(b,a,c,d,f),o+=n,n*=k,b*=i,a*=i,c*=i,d*=i;return j/o};return d});
define("goo/noise/ValueNoise",["goo/noise/Noise"],function(f){function d(){f.call(this)}d.prototype=Object.create(f.prototype);d.sources=[0,1/15,2/15,0.2,4/15,5/15,0.4,7/15,8/15,0.6,10/15,11/15,0.8,13/15,14/15,1];d.evaluate1d=function(b,a){var c=f.split(b/a),e=f.shifter[c.i1&255]&15,g=0;g+=c.f0*d.sources[f.shifter[c.i0&255]&15];g+=c.f1*d.sources[e];return g};d.evaluate2d=function(b,a,c){var b=f.split(b/c),a=f.split(a/c),c=f.shifter[f.shifter[a.i0&255]+b.i1&255]&15,e=f.shifter[f.shifter[a.i1&255]+
b.i0&255]&15,g=f.shifter[f.shifter[a.i1&255]+b.i1&255]&15,l=0;l+=a.f0*b.f0*d.sources[f.shifter[f.shifter[a.i0&255]+b.i0&255]&15];l+=a.f0*b.f1*d.sources[c];l+=a.f1*b.f0*d.sources[e];l+=a.f1*b.f1*d.sources[g];return l};d.evaluate3d=function(b,a,c,e){var b=f.split(b/e),a=f.split(a/e),c=f.split(c/e),e=f.shifter[f.shifter[f.shifter[c.i0&255]+a.i0&255]+b.i1&255]&15,g=f.shifter[f.shifter[f.shifter[c.i0&255]+a.i1&255]+b.i0&255]&15,l=f.shifter[f.shifter[f.shifter[c.i0&255]+a.i1&255]+b.i1&255]&15,k=f.shifter[f.shifter[f.shifter[c.i1&
255]+a.i0&255]+b.i0&255]&15,i=f.shifter[f.shifter[f.shifter[c.i1&255]+a.i0&255]+b.i1&255]&15,h=f.shifter[f.shifter[f.shifter[c.i1&255]+a.i1&255]+b.i0&255]&15,j=f.shifter[f.shifter[f.shifter[c.i1&255]+a.i1&255]+b.i1&255]&15,n=0;n+=c.f0*a.f0*b.f0*d.sources[f.shifter[f.shifter[f.shifter[c.i0&255]+a.i0&255]+b.i0&255]&15];n+=c.f0*a.f0*b.f1*d.sources[e];n+=c.f0*a.f1*b.f0*d.sources[g];n+=c.f0*a.f1*b.f1*d.sources[l];n+=c.f1*a.f0*b.f0*d.sources[k];n+=c.f1*a.f0*b.f1*d.sources[i];n+=c.f1*a.f1*b.f0*d.sources[h];
n+=c.f1*a.f1*b.f1*d.sources[j];return n};d.evaluate4d=function(b,a,c,e,g){var b=f.split(b/g),a=f.split(a/g),c=f.split(c/g),e=f.split(e/g),g=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+c.i0&255]+a.i0&255]+b.i1&255]&15,l=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+c.i0&255]+a.i1&255]+b.i0&255]&15,k=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+c.i0&255]+a.i1&255]+b.i1&255]&15,i=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+c.i1&255]+a.i0&255]+b.i0&255]&15,h=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&
255]+c.i1&255]+a.i0&255]+b.i1&255]&15,j=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+c.i1&255]+a.i1&255]+b.i0&255]&15,n=f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+c.i1&255]+a.i1&255]+b.i1&255]&15,o=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+c.i0&255]+a.i0&255]+b.i0&255]&15,q=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+c.i0&255]+a.i0&255]+b.i1&255]&15,m=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+c.i0&255]+a.i1&255]+b.i0&255]&15,r=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&
255]+c.i0&255]+a.i1&255]+b.i1&255]&15,p=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+c.i1&255]+a.i0&255]+b.i0&255]&15,v=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+c.i1&255]+a.i0&255]+b.i1&255]&15,u=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+c.i1&255]+a.i1&255]+b.i0&255]&15,s=f.shifter[f.shifter[f.shifter[f.shifter[e.i1&255]+c.i1&255]+a.i1&255]+b.i1&255]&15,t=0;t+=e.f0*c.f0*a.f0*b.f0*d.sources[f.shifter[f.shifter[f.shifter[f.shifter[e.i0&255]+c.i0&255]+a.i0&255]+b.i0&255]&15];t+=
e.f0*c.f0*a.f0*b.f1*d.sources[g];t+=e.f0*c.f0*a.f1*b.f0*d.sources[l];t+=e.f0*c.f0*a.f1*b.f1*d.sources[k];t+=e.f0*c.f1*a.f0*b.f0*d.sources[i];t+=e.f0*c.f1*a.f0*b.f1*d.sources[h];t+=e.f0*c.f1*a.f1*b.f0*d.sources[j];t+=e.f0*c.f1*a.f1*b.f1*d.sources[n];t+=e.f1*c.f0*a.f0*b.f0*d.sources[o];t+=e.f1*c.f0*a.f0*b.f1*d.sources[q];t+=e.f1*c.f0*a.f1*b.f0*d.sources[m];t+=e.f1*c.f0*a.f1*b.f1*d.sources[r];t+=e.f1*c.f1*a.f0*b.f0*d.sources[p];t+=e.f1*c.f1*a.f0*b.f1*d.sources[v];t+=e.f1*c.f1*a.f1*b.f0*d.sources[u];
t+=e.f1*c.f1*a.f1*b.f1*d.sources[s];return t};return d});define("goo/particles/ParticleInfluence",[],function(){return function(f){f=f||{};this.prepare=f.prepare?f.prepare:function(){};this.apply=f.apply?f.apply:function(){};this.enabled=f.enabled!==void 0?f.enabled===!0:!0}});
define("goo/picking/BoundingTree",["goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/math/Vector3"],function(f,d,b){function a(c){this.worldBound=this.localBound=this.rightTree=this.leftTree=null;this.boundType=c?c:a.BOUNDTYPE_BOX}a.BOUNDTYPE_SPHERE="sphere";a.BOUNDTYPE_BOX="box";a.MAX_PRIMITIVES_PER_LEAF=16;a.prototype.construct=function(a){if(!a.meshRendererComponent||!a.meshDataComponent||!a.transformComponent)console.warn("Entity missing required components for boundingtree construction: ",
a);else{var b=a.meshDataComponent.meshData;b.updatePrimitiveCounts();if(b.getSectionCount()===1){this.primitiveIndices=[];for(var d=0,b=b.getPrimitiveCount(0);d<b;d++)this.primitiveIndices.push(d);this.createTree(a,0,0,this.primitiveIndices.length)}else this.split(a,0,b.getSectionCount())}};a.prototype.createTree=function(c,b,d,f){var k=c.meshDataComponent.meshData;this.section=b;this.start=d;this.end=f;if(this.primitiveIndices&&(this.createBounds(),this.localBound.computeFromPrimitives(k,b,this.primitiveIndices,
d,f),!(f-d+1<=a.MAX_PRIMITIVES_PER_LEAF))){if(!this.leftTree)this.leftTree=new a(this.boundType);this.leftTree.primitiveIndices=this.primitiveIndices;this.leftTree.createTree(c,b,d,(d+f)/2);if(!this.rightTree)this.rightTree=new a(this.boundType);this.rightTree.primitiveIndices=this.primitiveIndices;this.rightTree.createTree(c,b,(d+f)/2,f)}};a.prototype.createBounds=function(){switch(this.boundType){case a.BOUNDTYPE_BOX:this.localBound=new f;this.worldBound=new f;break;case a.BOUNDTYPE_SPHERE:this.localBound=
new d,this.worldBound=new d}};a.prototype.findPick=function(a,d,f){f||(f={});var l=d.transformComponent.worldTransform;this.localBound.transform(l,this.worldBound);if(!this.worldBound.intersectsRay(a))return f;this.leftTree&&this.leftTree.findPick(a,d,f);if(this.rightTree)this.rightTree.findPick(a,d,f);else if(!this.leftTree)for(var d=d.meshDataComponent.meshData,k=null,i=this.start;i<this.end;i++){for(var k=d.getPrimitiveVertices(this.primitiveIndices[i],this.section,k),h=0;h<k.length;h++)l.matrix.applyPostPoint(k[h]);
h=new b;if(a.intersects(k,!1,h))f.distances=f.distances||[],f.distances.push(a.origin.distance(h)),f.points=f.points||[],f.points.push(h)}return f};return a});
define("goo/picking/PrimitivePickLogic",["goo/picking/BoundingTree"],function(f){function d(){}d.prototype.getPickResult=function(b,a){var c=a.meshDataComponent.meshData.__boundingTree;return!c?null:c.findPick(b,a,{})};d.prototype.added=function(b){b.meshDataComponent.meshData.__boundingTree=new f;b.meshDataComponent.meshData.__boundingTree.construct(b)};d.prototype.removed=function(b){b.meshDataComponent.meshData.__boundingTree=null};return d});
define("goo/renderer/light/Light",["goo/math/Vector3","goo/math/Vector4"],function(f,d){return function(){this.translation=new f;this.color=new d(1,1,1,1);this.intensity=1;this.shadowCaster=!1;this.shadowSettings={type:"Blur",projection:"Perspective",fov:55,size:100,near:1,far:1E3}}});define("goo/renderer/light/DirectionalLight",["goo/math/Vector3","goo/renderer/light/Light"],function(f,d){function b(){d.call(this);this.direction=new f}b.prototype=Object.create(d.prototype);return b});
define("goo/renderer/light/PointLight",["goo/math/Vector3","goo/renderer/light/Light"],function(f,d){function b(){d.call(this);this.direction=new f;this.range=100}b.prototype=Object.create(d.prototype);return b});define("goo/renderer/light/SpotLight",["goo/math/Vector3","goo/renderer/light/Light"],function(f,d){function b(){d.call(this);this.direction=new f;this.spotAngle=45}b.prototype=Object.create(d.prototype);return b});
define("goo/renderer/pass/BlurPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(f,d,b,a,c){function e(g){g=g||{};this.target=g.target!==void 0?g.target:null;var l=g.strength!==void 0?g.strength:1,k=g.kernelSize!==void 0?g.kernelSize:25,i=g.sigma!==void 0?g.sigma:4,h=g.sizeX!==void 0?g.sizeX:256,g=g.sizeY!==void 0?g.sizeY:256;this.renderTargetX=new b(h,g);this.renderTargetY=new b(h,g);this.renderable=
{meshData:d.quad,materials:[]};this.copyShader=a.clone(c.copyPure);this.copyShader.uniforms.opacity=l;this.copyMaterial=f.createMaterial(this.copyShader);this.convolutionShader=a.clone(c.convolution);this.convolutionShader.defines={KERNEL_SIZE_FLOAT:k.toFixed(1),KERNEL_SIZE_INT:k.toFixed(0)};this.convolutionShader.uniforms.uImageIncrement=e.blurX;this.convolutionShader.uniforms.cKernel=this.convolutionShader.buildKernel(i);this.convolutionMaterial=f.createMaterial(this.convolutionShader);this.enabled=
!0;this.needsSwap=this.clear=!1}e.prototype.render=function(a,c,b){this.renderable.materials[0]=this.convolutionMaterial;this.convolutionMaterial.textures[0]=b;this.convolutionShader.uniforms.uImageIncrement=e.blurX;a.render(this.renderable,d.camera,[],this.renderTargetX,!0);this.convolutionMaterial.textures[0]=this.renderTargetX;this.convolutionShader.uniforms.uImageIncrement=e.blurY;a.render(this.renderable,d.camera,[],this.renderTargetY,!0);this.renderable.materials[0]=this.copyMaterial;this.copyMaterial.textures[0]=
this.renderTargetY;this.target!==null?a.render(this.renderable,d.camera,[],this.target,this.clear):a.render(this.renderable,d.camera,[],b,this.clear)};e.blurX=[0.001953125,0];e.blurY=[0,0.001953125];return e});define("goo/renderer/pass/BloomPass",["goo/renderer/pass/BlurPass"],function(f){function d(b){f.call(this,b);this.copyMaterial.blendState.blending="AdditiveBlending"}d.prototype=Object.create(f.prototype);return d});
define("goo/renderer/pass/Composer",["goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/renderer/shaders/ShaderLib"],function(f,d,b){function a(a){this.renderTarget1=a;if(this.renderTarget1===void 0)this.renderTarget1=new f(window.innerWidth||1,window.innerHeight||1);this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=new d(b.copy)}a.prototype.swapBuffers=function(){var a=this.readBuffer;
this.readBuffer=this.writeBuffer;this.writeBuffer=a};a.prototype.addPass=function(a){this.passes.push(a)};a.prototype.render=function(a,b){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var d,f,k=this.passes.length;for(f=0;f<k;f++)d=this.passes[f],d.enabled&&(d.render(a,this.writeBuffer,this.readBuffer,b,!1),d.needsSwap&&this.swapBuffers())};return a});
define("goo/renderer/pass/RenderPass",["goo/renderer/Renderer","goo/math/Vector4"],function(f,d){function b(a){this.renderList=a;this.clearColor=new d(0,0,0,0);this.oldClearColor=new d;this.renderToScreen=!1;this.overrideMaterial=null;this.clear=this.enabled=!0;this.needsSwap=!1}b.prototype.render=function(a,c,b){this.clearColor&&(this.oldClearColor.setv(a.clearColor),a.setClearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a));a.overrideMaterial=this.overrideMaterial;
this.renderToScreen?a.render(this.renderList,f.mainCamera,[]):a.render(this.renderList,f.mainCamera,[],b,this.clear);a.overrideMaterial=null;this.clearColor&&a.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)};return b});
define("goo/renderer/pass/DepthPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass".split(","),function(f,d,b,a,c,e,g,l){function k(a,c){this.depthPass=new e(a);this.depthPass.overrideMaterial=f.createMaterial(i);this.blurTarget=new d(256,256);this.blurPass=new l({target:this.blurTarget});this.outPass=new g(c||h);this.outPass.useReadBuffer=
!1;this.depthTarget=new d(window.innerWidth||1,window.innerHeight||1);this.enabled=!0;this.clear=!1;this.needsSwap=!0}k.prototype.render=function(a,c,b,d){this.depthPass.render(a,null,this.depthTarget,d);this.blurPass.render(a,c,b,d);this.outPass.material.textures[0]=this.depthTarget;this.outPass.material.textures[1]=b;this.outPass.material.textures[2]=this.blurTarget;this.outPass.render(a,c,b,d)};var i={attributes:{vertexPosition:b.POSITION},uniforms:{viewMatrix:a.VIEW_MATRIX,projectionMatrix:a.PROJECTION_MATRIX,
worldMatrix:a.WORLD_MATRIX,farPlane:a.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",fshader:["precision mediump float;\nuniform float farPlane;",c.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(length(vPosition), farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")},
h={attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:a.VIEW_MATRIX,projectionMatrix:a.PROJECTION_MATRIX,worldMatrix:a.WORLD_MATRIX,depthMap:a.TEXTURE0,diffuseMap:a.TEXTURE1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:["precision mediump float;\nuniform sampler2D depthMap;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;",c.methods.unpackDepth,"void main(void)\n{\n\tvec4 depthCol = texture2D(depthMap, texCoord0);\n\tvec4 diffuseCol = texture2D(diffuseMap, texCoord0);\n\tfloat depth = unpackDepth(depthCol);\n\tgl_FragColor = diffuseCol * vec4(depth);\n}"].join("\n")};return k});
define("goo/renderer/pass/DoGPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(f,d,b,a,c){function e(e){e=e||{};this.target=e.target!==void 0?e.target:null;var l=e.width!==void 0?e.width:512,k=e.height!==void 0?e.height:512,i=e.sigma!==void 0?e.sigma:0.6,e=e.threshold!==void 0?e.threshold:0.005;i>2.5&&(i=2.5);this.renderTargetX=new b(l,k);this.gaussian1=new b(l,k);this.gaussian2=new b(l,
k);this.renderable={meshData:d.quad,materials:[]};this.convolutionShader1=a.clone(c.convolution);this.convolutionShader2=a.clone(c.convolution);this.differenceShader=a.clone(c.differenceOfGaussians);this.differenceShader.uniforms.threshold=e;this.differenceMaterial=f.createMaterial(this.differenceShader);var e=this.convolutionShader1.buildKernel(i),i=this.convolutionShader2.buildKernel(1.6*i),h=e.length;this.convolutionShader1.defines={KERNEL_SIZE_FLOAT:h.toFixed(1),KERNEL_SIZE_INT:h.toFixed(0)};
h=i.length;this.convolutionShader2.defines={KERNEL_SIZE_FLOAT:h.toFixed(1),KERNEL_SIZE_INT:h.toFixed(0)};this.convolutionShader1.uniforms.cKernel=e;this.convolutionShader2.uniforms.cKernel=i;this.blurX=[0.5/l,0];this.blurY=[0,0.5/k];this.convolutionMaterial1=f.createMaterial(this.convolutionShader1);this.convolutionMaterial2=f.createMaterial(this.convolutionShader2);this.enabled=!0;this.needsSwap=this.clear=!1}e.prototype.render=function(a,c,b){this.renderable.materials[0]=this.convolutionMaterial1;
this.convolutionMaterial1.textures[0]=b;this.convolutionShader1.uniforms.uImageIncrement=this.blurX;a.render(this.renderable,d.camera,[],this.renderTargetX,!0);this.convolutionMaterial1.textures[0]=this.renderTargetX;this.convolutionShader1.uniforms.uImageIncrement=this.blurY;a.render(this.renderable,d.camera,[],this.gaussian1,!0);this.renderable.materials[0]=this.convolutionMaterial2;this.convolutionMaterial2.textures[0]=b;this.convolutionShader2.uniforms.uImageIncrement=this.blurX;a.render(this.renderable,
d.camera,[],this.renderTargetX,!0);this.convolutionMaterial2.textures[0]=this.renderTargetX;this.convolutionShader2.uniforms.uImageIncrement=this.blurY;a.render(this.renderable,d.camera,[],this.gaussian2,!0);this.renderable.materials[0]=this.differenceMaterial;this.differenceMaterial.textures[0]=this.gaussian1;this.differenceMaterial.textures[1]=this.gaussian2;this.differenceMaterial.textures[2]=b;this.target!==null?a.render(this.renderable,d.camera,[],this.target,this.clear):a.render(this.renderable,
d.camera,[],b,this.clear)};return e});
define("goo/renderer/pass/NesPass",["goo/renderer/TextureCreator","goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(f,d,b,a){function c(a){this.material=d.createMaterial(e);this.renderToScreen=!1;this.renderable={meshData:b.quad,materials:[this.material]};this.mapping=(new f).loadTexture2D(a);this.mapping.minFilter="NearestNeighborNoMipMaps";this.mapping.magFilter="NearestNeighbor";this.mapping.generateMipmaps=!1;this.enabled=!0;this.clear=!1;this.needsSwap=
!0}c.prototype.render=function(a,c,d){this.material.textures[0]=d;this.material.textures[1]=this.mapping;this.renderToScreen?a.render(this.renderable,b.camera,[],null,this.clear):a.render(this.renderable,b.camera,[],c,this.clear)};var e={attributes:a.copy.attributes,uniforms:{diffuse:0,mapping:1,$link:a.copy.uniforms},vshader:a.copy.vshader,fshader:"precision mediump float;\nuniform sampler2D diffuse;\nuniform sampler2D mapping;\nvarying vec2 texCoord0;\nvoid main() {\n\tvec4 texCol = texture2D( diffuse, texCoord0 );\n\tfloat r = floor(texCol.r * 31.0);\n\tfloat g = floor(texCol.g * 31.0);\n\tfloat b = floor(texCol.b * 31.0);\n\tvec4 texPalette = texture2D( mapping, vec2((r * 32.0 + g)/1024.0, b / 32.0) );\n\tgl_FragColor = vec4( texPalette.rgb, 1.0 );\n}"};
return c});
define("goo/renderer/pass/SSAOPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/Util,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass,goo/renderer/shaders/ShaderLib".split(","),function(f,d,b,a,c,e,g,l,k,i){function h(a){this.depthPass=new g(a);this.depthPass.clearColor.set(1,1,1,1);this.depthPass.overrideMaterial=f.createMaterial(j);var a=window.innerWidth/4,
c=window.innerHeight/4,e=b.clone(i.ssao);e.uniforms.size=[a,c];this.outPass=new l(e);this.outPass.useReadBuffer=!1;this.blurPass=new k({sizeX:a,sizeY:c});this.depthTarget=new d(a,c,{magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"});this.enabled=!0;this.clear=!1;this.needsSwap=!0}h.prototype.render=function(a,c,b,d){this.depthPass.render(a,null,this.depthTarget,d);this.outPass.material.textures[0]=b;this.outPass.material.textures[1]=this.depthTarget;this.outPass.render(a,c,b,d)};var j=
{attributes:{vertexPosition:a.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:["precision mediump float;",e.methods.packDepth,"void main(void) {\n\tgl_FragColor = packDepth(gl_FragCoord.z);\n}"].join("\n")};
return h});define("goo/renderer/shaders/ShaderBuilder",[],function(){return function(){}});
define("goo/scripts/BasicControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(f,d){function b(a){this.domElement=a===void 0?document:a.domElement||a;this.name="BasicControlScript";this.movementSpeed=10;this.rollSpeed=2;this.movementSpeedMultiplier=1;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new f(0,0,0);this.rotationVector=new f(0,0,0);this.multiplier=new f(1,1,1);this.rotationMatrix=
new d;this.tmpVec=new f;this.handleEvent=function(a){if(typeof this[a.type]==="function")this[a.type](a)};this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;
break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=
0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};var c,b;this.mousedown=function(a){this.domElement!==document&&this.domElement.focus();a.preventDefault();a=a.touches&&a.touches.length===1?a.touches[0]:a;this.mouseDownX=a.pageX;this.mouseDownY=a.pageY;
this.mouseStatus=1;c=this.mousemove.bind(this);b=this.mouseup.bind(this);document.addEventListener("mousemove",c,!1);document.addEventListener("mouseup",b,!1);document.addEventListener("touchmove",c,!1);document.addEventListener("touchend",b,!1)};this.mousemove=function(a){if(this.mouseStatus>0)a=a.touches&&a.touches.length===1?a.touches[0]:a,this.moveState.yawLeft=a.pageX-this.mouseDownX,this.moveState.pitchDown=a.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=a.pageX,this.mouseDownY=
a.pageY};this.mouseup=function(a){if(this.mouseStatus)a.preventDefault(),this.mouseStatus=0,this.moveState.yawLeft=this.moveState.pitchDown=0,this.updateRotationVector(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",b),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",b)};this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;
this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-a+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,
this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};a=this.mousedown.bind(this);this.domElement.addEventListener("mousedown",a,!1);this.domElement.addEventListener("touchstart",a,!1);this.domElement.addEventListener("keydown",this.keydown.bind(this),!1);this.domElement.addEventListener("keyup",this.keyup.bind(this),!1);this.updateMovementVector();this.updateRotationVector()}b.prototype.externals=function(){return[{variable:"movementSpeed",type:"number"},{variable:"rollSpeed",
type:"number"}]};b.prototype.run=function(a){var c=a.transformComponent,b=c.transform,d=a._world.tpf,a=d*this.movementSpeed*this.movementSpeedMultiplier,d=d*this.rollSpeed*this.movementSpeedMultiplier;if(!this.moveVector.equals(f.ZERO)||!this.rotationVector.equals(f.ZERO)||this.mouseStatus>0){b.translation.x+=this.moveVector.x*a;b.translation.y+=this.moveVector.y*a;b.translation.z+=this.moveVector.z*a;b.rotation.toAngles(this.tmpVec);this.tmpVec.x+=-this.rotationVector.x*d*this.multiplier.x;this.tmpVec.y+=
this.rotationVector.y*d*this.multiplier.y;this.tmpVec.z+=this.rotationVector.z*d*this.multiplier.z;b.rotation.fromAngles(this.tmpVec.x,this.tmpVec.y,this.tmpVec.z);if(this.mouseStatus>0)this.moveState.yawLeft=0,this.moveState.pitchDown=0,this.updateRotationVector();c.setUpdated()}};return b});
define("goo/scripts/FlyControlScript",["goo/math/Vector3"],function(f){function d(b){this.domElement=b!==void 0?b:document;b&&this.domElement.setAttribute("tabindex",-1);this.name="FlyControlScript";this.movementSpeed=10;this.rollSpeed=2;this.movementSpeedMultiplier=1;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new f(0,0,0);this.rotationVector=new f(0,0,0);this.handleEvent=function(a){if(typeof this[a.type]===
"function")this[a.type](a)};this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=
1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=
0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};var a,c;this.mousedown=function(b){this.domElement!==document&&this.domElement.focus();b.preventDefault();this.mouseDownX=b.pageX;this.mouseDownY=b.pageY;this.mouseStatus++;a=this.mousemove.bind(this);c=this.mouseup.bind(this);document.addEventListener("mousemove",a,!1);document.addEventListener("mouseup",
c,!1);document.addEventListener("touchmove",a,!1);document.addEventListener("touchend",c,!1)};this.mousemove=function(a){if(this.mouseStatus>0)this.moveState.yawLeft=a.pageX-this.mouseDownX,this.moveState.pitchDown=a.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=a.pageX,this.mouseDownY=a.pageY};this.mouseup=function(b){b.preventDefault();this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0;this.updateRotationVector();document.removeEventListener("mousemove",a);
document.removeEventListener("mouseup",c);document.removeEventListener("touchmove",a);document.removeEventListener("touchend",c)};this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-a+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;
this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};b=this.mousedown.bind(this);this.domElement.addEventListener("mousedown",b,!1);this.domElement.addEventListener("touchstart",
b,!1);this.domElement.addEventListener("keydown",this.keydown.bind(this),!1);this.domElement.addEventListener("keyup",this.keyup.bind(this),!1);this.updateMovementVector();this.updateRotationVector()}d.prototype.run=function(b){var a=new f;this.moveVector.z===1?a.add(b._direction):this.moveVector.z===-1&&a.sub(b._direction);this.moveVector.x===1?a.add(b._left):this.moveVector.x===-1&&a.sub(b._left);a.y=0;a.normalize();b.onFrameChange();if(this.mouseStatus>0)this.moveState.yawLeft=0,this.moveState.pitchDown=
0,this.updateRotationVector()};return d});
define("goo/scripts/MouseLookControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(f,d){function b(a){a=a||{};this.name="MouseLookControlScript";this.domElement=a.domElement||document;this.turnSpeedHorizontal=!isNaN(a.turnSpeedHorizontal)?a.turnSpeed:0.01;this.turnSpeedVertical=!isNaN(a.turnSpeedVertical)?a.turnSpeed:0.01;this.dragOnly=a.dragOnly!==void 0?a.dragOnly===!0:!0;this.dragButton=!isNaN(a.dragButton)?a.dragButton:-1;this.worldUpVector=a.worldUpVector||new f(0,1,0);this.localLeftVector=
a.localLeftVector||new f(-1,0,0);this.onRun=a.onRun;this.calcVector=new f;this.calcMat1=new d;this.calcMat2=new d;this.resetMouseState();this.setupMouseControls()}b.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN,dX:0,dY:0}};b.prototype.updateButtonState=function(a,c){this.domElement!==document&&this.domElement.focus();if(this.dragOnly&&(this.dragButton===-1||this.dragButton===a.button))this.mouseState.buttonDown=c,a.preventDefault()};b.prototype.updateDeltas=
function(a){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0):(this.mouseState.dX=a.clientX-this.mouseState.lastX,this.mouseState.dY=a.clientY-this.mouseState.lastY);this.mouseState.lastX=a.clientX;this.mouseState.lastY=a.clientY};var a,c,e,g=function(a){this.resetMouseState();this.updateButtonState(a,!0);c=l.bind(this);e=k.bind(this);document.addEventListener("mousemove",c,!1);document.addEventListener("mouseup",e,!1)},l=function(a){this.updateDeltas(a)},
k=function(a){this.updateButtonState(a,!1);document.removeEventListener("mousemove",c);document.removeEventListener("mouseup",e)};b.prototype.setupMouseControls=function(){a=g.bind(this);this.domElement.addEventListener("mousedown",a,!1)};b.prototype.run=function(a){if(a=a.transformComponent){var c=a.transform;if(!(this.dragOnly&&!this.mouseState.buttonDown||this.mouseState.dX===0&&this.mouseState.dY===0)){var b=this.turnSpeedHorizontal,e=this.turnSpeedVertical;this.mouseState.dX!==0&&(this.calcMat1.fromAngleNormalAxis(b*
-this.mouseState.dX,this.worldUpVector.x,this.worldUpVector.y,this.worldUpVector.z),d.combine(this.calcMat1,c.rotation,this.calcMat2),c.rotation.set(this.calcMat2));this.mouseState.dY!==0&&(this.calcMat1.fromAngleNormalAxis(e*this.mouseState.dY,this.localLeftVector.x,this.localLeftVector.y,this.localLeftVector.z),d.combine(c.rotation,this.calcMat1,this.calcMat2),c.rotation.set(this.calcMat2));a.setUpdated()}this.mouseState.dX=0;this.mouseState.dY=0}};return b});
define("goo/scripts/OrbitCamControlScript",["goo/math/Vector2","goo/math/Vector3","goo/math/MathUtils"],function(f,d,b){function a(a){var a=a||{},b;for(b in c)this[b]=typeof c[b]==="boolean"?a[b]!==void 0?a[b]===!0:c[b]:isNaN(c[b])?c[b]instanceof d?a[b]||(new d).copy(c[b]):a[b]||c[b]:!isNaN(a[b])?a[b]:c[b];this.name="OrbitCamControlScript";this.timeSamples=[0,0,0,0,0];this.xSamples=[0,0,0,0,0];this.ySamples=[0,0,0,0,0];this.sample=0;this.velocity=new f;this.targetSpherical=new d(this.spherical);this.cartesian=
new d;this.dirty=!0;this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN};this.setupMouseControls()}var c={domElement:document,turnSpeedHorizontal:0.005,turnSpeedVertical:0.005,zoomSpeed:0.2,dragOnly:!0,dragButton:-1,worldUpVector:new d(0,1,0),baseDistance:15,minZoomDistance:1,maxZoomDistance:1E3,minAscent:-89.95*b.DEG_TO_RAD,maxAscent:89.95*b.DEG_TO_RAD,clampAzimuth:!1,minAzimuth:90*b.DEG_TO_RAD,maxAzimuth:270*b.DEG_TO_RAD,releaseVelocity:!0,invertedX:!1,invertedY:!1,invertedWheel:!0,mouseUpOnOut:!1,
drag:5,maxSampleTimeMS:200,lookAtPoint:new d(0,0,0),spherical:new d(15,0,0),interpolationSpeed:7,onRun:null};a.prototype.updateButtonState=function(a,c){this.domElement!==document&&this.domElement.focus();if(this.dragOnly&&(this.dragButton===-1||this.dragButton===a))(this.mouseState.buttonDown=c)?(this.mouseState.lastX=NaN,this.mouseState.lastY=NaN,this.velocity.set(0,0),this.spherical.y=b.moduloPositive(this.spherical.y,b.TWO_PI),this.targetSpherical.copy(this.spherical)):this.applyReleaseDrift()};
a.prototype.updateDeltas=function(a,c){var b=0,d=0;!isNaN(this.mouseState.lastX)&&!isNaN(this.mouseState.lastY)&&(b=-(a-this.mouseState.lastX),d=c-this.mouseState.lastY);this.mouseState.lastX=a;this.mouseState.lastY=c;if(!(this.dragOnly&&!this.mouseState.buttonDown||b===0&&d===0)){this.timeSamples[this.sample]=Date.now();this.xSamples[this.sample]=b;this.ySamples[this.sample]=d;this.sample++;if(this.sample>this.timeSamples.length-1)this.sample=0;this.velocity.set(0,0);this.move(this.turnSpeedHorizontal*
b,this.turnSpeedVertical*d)}};a.prototype.move=function(a,c){var d=this.invertedX?-a:a,f=this.invertedY?-c:c;if(this.clampAzimuth){var i=this.targetSpherical,d=this.targetSpherical.y-d,h=this.minAzimuth,j=this.maxAzimuth,n=(h+j)/2+(j>h?Math.PI:0),o=b.moduloPositive(d-n,b.TWO_PI),q=b.moduloPositive(h-n,b.TWO_PI),n=b.moduloPositive(j-n,b.TWO_PI);d<0&&h>0?h-=b.TWO_PI:d>0&&h<0&&(h+=b.TWO_PI);d>b.TWO_PI&&j<b.TWO_PI&&(j+=b.TWO_PI);i.y=o<q?h:o>n?j:d}else this.targetSpherical.y-=d;this.targetSpherical.z=
b.clamp(this.targetSpherical.z+f,this.minAscent,this.maxAscent);this.dirty=!0};a.prototype.applyWheel=function(a){this.zoom(this.zoomSpeed*(this.invertedWheel?-1:1)*Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)))};a.prototype.zoom=function(a){this.targetSpherical.x=b.clamp(this.targetSpherical.x+a*this.baseDistance,this.minZoomDistance,this.maxZoomDistance);this.dirty=!0};a.prototype.applyReleaseDrift=function(){for(var a=Date.now(),c=0,b=0,d=!1,f=0,h=this.timeSamples.length;f<h;f++)a-this.timeSamples[f]<
this.maxSampleTimeMS&&(c+=this.xSamples[f],b+=this.ySamples[f],d=!0);d?this.velocity.set(c*this.turnSpeedHorizontal/this.timeSamples.length,b*this.turnSpeedVertical/this.timeSamples.length):this.velocity.set(0,0)};a.prototype.setupMouseControls=function(){var a=this;this.domElement.addEventListener("mousedown",function(c){a.updateButtonState(c.button,!0)},!1);document.addEventListener("mouseup",function(c){a.updateButtonState(c.button,!1)},!1);this.mouseUpOnOut&&this.domElement.addEventListener("mouseout",
function(c){a.updateButtonState(c.button,!1)},!1);document.addEventListener("mousemove",function(c){a.updateDeltas(c.clientX,c.clientY)},!1);this.domElement.addEventListener("mousewheel",function(c){a.applyWheel(c)},!1);this.domElement.addEventListener("DOMMouseScroll",function(c){a.applyWheel(c)},!1);if(typeof window.Hammer!=="undefined")window.Hammer(this.domElement,{transform_always_block:!0,transform_min_scale:1}).on("touch drag transform release",function(c){switch(c.type){case "transform":c=
c.gesture.scale;c<1?a.zoom(a.zoomSpeed*1):c>1&&a.zoom(a.zoomSpeed*-1);break;case "touch":a.updateButtonState(0,!0);break;case "release":a.updateButtonState(0,!1);break;case "drag":a.updateDeltas(c.gesture.center.pageX,c.gesture.center.pageY)}})};a.prototype.updateVelocity=function(a){this.velocity.lengthSquared()>1.0E-6?(this.move(this.velocity.x,this.velocity.y),this.velocity.mul(b.clamp(b.lerp(a,1,1-this.drag),0,1)),this.dirty=!0):this.velocity.set(0,0,0)};a.prototype.run=function(a){var c=a.transformComponent;
if(c){var d=c.transform;this.releaseVelocity&&this.updateVelocity(a._world.tpf);if(this.dirty){a=this.interpolationSpeed*a._world.tpf;this.spherical.y=b.lerp(a,this.spherical.y,this.targetSpherical.y);this.spherical.x=b.lerp(a,this.spherical.x,this.targetSpherical.x);this.spherical.z=b.lerp(a,this.spherical.z,this.targetSpherical.z);b.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian);d.translation.set(this.cartesian.add(this.lookAtPoint));d.translation.equals(this.lookAtPoint)||
d.lookAt(this.lookAtPoint,this.worldUpVector);if(this.spherical.distanceSquared(this.targetSpherical)<1.0E-6)this.dirty=!1,this.spherical.y=b.moduloPositive(this.spherical.y,b.TWO_PI),this.targetSpherical.copy(this.spherical);c.setUpdated()}}};return a});
define("goo/scripts/RotationControlScript",["goo/math/Matrix3x3"],function(f){function d(a){this.bindings={attach:b.bind(this),update:null,remove:null};this.element=a;this.name="RotationControlScript";this.states={dirty:!1,x:null,y:null,dx:null,dy:null};this.element.addEventListener("mousedown",this.bindings.attach,!1);this.element.addEventListener("touchstart",this.bindings.attach,!1)}var b=function(b){b=b.touches&&b.touches.length===1?b.touches[0]:b;this.states.dx=0;this.states.dy=0;this.states.x=
b.pageX;this.states.y=b.pageY;this.bindings.update=a.bind(this);this.bindings.remove=c.bind(this);document.addEventListener("mousemove",this.bindings.update,!1);document.addEventListener("touchmove",this.bindings.update,!1);document.addEventListener("mouseup",this.bindings.remove,!1);document.addEventListener("touchend",this.bindings.remove,!1)},a=function(a){a=a.touches&&a.touches.length===1?a.touches[0]:a;this.states.dirty=!0;this.states.dx+=a.pageX-this.states.x;this.states.dy+=a.pageY-this.states.y;
this.states.x=a.pageX;this.states.y=a.pageY},c=function(){document.removeEventListener("mousemove",this.bindings.update);document.removeEventListener("touchmove",this.bindings.update);document.removeEventListener("mouseup",this.bindings.remove);document.removeEventListener("touchend",this.bindings.remove)};d.prototype.run=function(a){if(this.states.dirty){var c=Math.PI*this.states.dy/this.element.clientHeight,b=Math.PI*this.states.dx/this.element.clientWidth,d=Math.cos(c),c=Math.sin(c),i=Math.cos(b),
b=Math.sin(b),d=new f(i,c*b,0-d*b,0,d,c,b,0-c*i,d*i);f.combine(d,a.transformComponent.transform.rotation,a.transformComponent.transform.rotation);a.transformComponent.setUpdated();this.states.dirty=!1;this.states.dx=0;this.states.dy=0}};return d});
define("goo/scripts/SplineInterpolator",["goo/math/Matrix4x4","goo/math/Vector4"],function(f,d){function b(a){a=a||{};this.controlPoint=0;this.controlPoints=a.controlPoints||[];this.elapsedTime=0;this.enabled=a.enabled||!0;this.firstIteration=!0;this.tolerance=a.tolerance||0.01;this.beforeFunction=a.beforeFunction||function(a){return a.transformComponent.transform.translation.clone().data};this.updateFunction=a.updateFunction||function(a,b){a.transformComponent.transform.translation.set(b);a.transformComponent.setUpdated()};
this.afterFunction=a.afterFunction||function(){}}b.CATMULL_ROM=new f(-0.5,1,-0.5,0,1.5,-2.5,0,1,-1.5,2,0.5,0,0.5,-0.5,0,0);b.UNIFORM_CUBIC=new f(-0.16667,0.5,-0.5,0.16667,0.5,-1,0,0.66667,-0.5,0.5,0.5,0.16667,0.16667,0,0,0);b.prototype.run=function(a,c){if(this.firstIteration){this.firstIteration=!1;try{this.controlPoints.unshift({time:0,value:this.beforeFunction(a)})}catch(e){this.enabled=!1;return}}for(var f=Math.min(Math.max(this.controlPoint-1,0),this.controlPoints.length-1),l=Math.min(Math.max(this.controlPoint+
0,0),this.controlPoints.length-1),k=Math.min(Math.max(this.controlPoint+1,0),this.controlPoints.length-1),i=Math.min(Math.max(this.controlPoint+2,0),this.controlPoints.length-1),h=this.controlPoints[k].time>this.controlPoints[l].time?(this.elapsedTime-this.controlPoints[l].time)/(this.controlPoints[k].time-this.controlPoints[l].time):0,h=b.CATMULL_ROM.applyPre(new d(h*h*h,h*h,h,1)),j=Array(this.controlPoints[0].value.length),n=0,o=0;o<j.length;o++)j[o]=0,j[o]+=this.controlPoints[f].value[o]*h[0],
j[o]+=this.controlPoints[l].value[o]*h[1],j[o]+=this.controlPoints[k].value[o]*h[2],j[o]+=this.controlPoints[i].value[o]*h[3],n+=Math.abs(this.controlPoints[this.controlPoints.length-1].value[o]-j[o]);try{this.updateFunction(a,j)}catch(q){this.enabled=!1;return}this.elapsedTime+=c;this.elapsedTime>=this.controlPoints[k].time&&this.controlPoint++;if(this.controlPoint>=this.controlPoints.length||n<this.tolerance){try{this.afterFunction(a)}catch(m){}this.enabled=!1}};return b});
define("goo/scripts/WASDControlScript",["goo/math/Vector","goo/math/Vector3"],function(f,d){function b(a){a=a||{};this.name="WASDControlScript";this.domElement=a.domElement||document;a.domElement&&this.domElement.setAttribute("tabindex",-1);this.walkSpeed=!isNaN(a.walkSpeed)?a.walkSpeed:100;this.crawlSpeed=!isNaN(a.crawlSpeed)?a.crawlSpeed:10;this.fwdVector=a.fwdVector||new d(0,0,-1);this.leftVector=a.leftVector||new d(-1,0,0);this.crawlKey=!isNaN(a.crawlKey)?a.crawlKey:16;this.forwardKey=!isNaN(a.forwardKey)?
a.forwardKey:87;this.backKey=!isNaN(a.backKey)?a.backKey:83;this.strafeLeftKey=!isNaN(a.strafeLeftKey)?a.strafeLeftKey:65;this.strafeRightKey=!isNaN(a.strafeRightKey)?a.strafeRightKey:68;this.onRun=a.onRun;this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1};this.moveVector=new d(0,0,0);this.calcVector=new d;this.setupKeyControls()}b.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight;this.moveVector.z=this.moveState.forward-
this.moveState.back};b.prototype.updateKeys=function(a,c){if(!a.altKey){var b=!1;switch(a.keyCode){case this.crawlKey:this.moveState.crawling=c;break;case this.forwardKey:this.moveState.forward=c?1:0;b=!0;break;case this.backKey:this.moveState.back=c?1:0;b=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=c?1:0;b=!0;break;case this.strafeRightKey:this.moveState.strafeRight=c?1:0,b=!0}b&&this.updateMovementVector()}};b.prototype.setupKeyControls=function(){var a=this;this.domElement.addEventListener("keydown",
function(c){a.updateKeys(c,!0)},!1);this.domElement.addEventListener("keyup",function(c){a.updateKeys(c,!1)},!1)};b.prototype.run=function(a){var c=a.transformComponent;if(c){var b=c.transform;f.equals(this.moveVector,d.ZERO)||(this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize(),this.calcVector.mul(a._world.tpf*
(this.moveState.crawling?this.crawlSpeed:this.walkSpeed)),b.rotation.applyPost(this.calcVector),b.translation.add(this.calcVector),c.setUpdated())}};return b});
define("goo/shapes/ProjectedGrid","goo/renderer/MeshData,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/renderer/Camera,goo/math/MathUtils".split(","),function(f,d,b,a,c,e,g){function l(g,i){this.densityX=g!==void 0?g:20;this.densityY=i!==void 0?i:20;this.projectorCamera=new e(45,1,0.1,2E3);this.mainCamera=new e(45,1,0.1,2E3);this.freezeProjector=!1;this.upperBound=20;this.origin=new a;this.direction=new a;this.source=new d;this.rangeMatrix=new c;this.intersectBottomLeft=
new a;this.intersectTopLeft=new a;this.intersectTopRight=new a;this.intersectBottomRight=new a;this.planeIntersection=new b;this.freezeProjector=!1;this.projectorMinHeight=50;this.intersections=[];for(var h=0;h<24;h++)this.intersections.push(new b);this.connections=[0,3,1,2,0,4,1,5,2,6,3,7,4,7,5,6];var h=this.densityX*this.densityY,j=(this.densityX-1)*(this.densityY-1)*6,l=f.defaultMap([f.POSITION,f.TEXCOORD0]);f.call(this,l,h,j);this.rebuild()}l.prototype=Object.create(f.prototype);l.prototype.update=
function(d){var e=this.upperBound,f=this.mainCamera;this.freezeProjector||f.copy(d);d=f.translation;d.y>0&&d.y<e+f.near?f.translation.setd(d.x,e+f.near,d.z):d.y<0&&d.y>-e-f.near&&f.translation.setd(d.x,-e-f.near,d.z);for(var j=f.calculateFrustumCorners(),l=0,o=new b,q=0;q<8;q++){var d=this.connections[q*2],m=this.connections[q*2+1];(j[d].y>e&&j[m].y<e||j[d].y<e&&j[m].y>e)&&this.getWorldIntersectionSimple(e,j[d],j[m],this.intersections[l++],o);(j[d].y>-e&&j[m].y<-e||j[d].y<-e&&j[m].y>-e)&&this.getWorldIntersectionSimple(-e,
j[d],j[m],this.intersections[l++],o)}for(q=0;q<8;q++)j[q].y<e&&j[q].y>-e&&this.intersections[l++].set(j[q]);if(l===0)return!1;e=this.projectorCamera;e.copy(f);if(e.translation.y>0&&e._direction.y>0||e.translation.y<0&&e._direction.y<0)e._direction.y=-e._direction.y,d=new b,d.setv(e._direction).cross(e._left).normalize(),e._up.setv(d);d=this.source;q=this.planeIntersection;d.set(0.5,0.5);this.getWorldIntersection(0,d,e.getViewProjectionInverseMatrix(),q);f=e.translation;f.y>0&&f.y<this.projectorMinHeight*
2?(j=(this.projectorMinHeight*2-f.y)/(this.projectorMinHeight*2),e.translation.setd(f.x,this.projectorMinHeight*2-this.projectorMinHeight*j,f.z)):f.y<0&&f.y>-this.projectorMinHeight*2&&(j=(-this.projectorMinHeight*2-f.y)/(-this.projectorMinHeight*2),e.translation.setd(f.x,-this.projectorMinHeight*2+this.projectorMinHeight*j,f.z));q.subv(e.translation);q.y=0;f=q.length();if(f>Math.abs(e.translation.y))q.normalize(),q.mul(Math.abs(e.translation.y));else if(f<g.EPSILON)q.addv(e._up),q.y=0,q.normalize(),
q.mul(0.1);q.addv(e.translation);q.y=0;e.lookAt(q,b.UNIT_Y);j=e.getViewProjectionMatrix();o=new a;f=this.intersections;for(q=0;q<l;q++)o.set(f[q].x,0,this.intersections[q].z,1),j.applyPost(o),f[q].set(o.x,o.y,0),f[q].div(o.w);for(var j=Number.MAX_VALUE,o=-Number.MAX_VALUE,m=Number.MAX_VALUE,r=-Number.MAX_VALUE,q=0;q<l;q++){if(f[q].x<j)j=f[q].x;if(f[q].x>o)o=f[q].x;if(f[q].y<m)m=f[q].y;if(f[q].y>r)r=f[q].y}l=this.rangeMatrix;l.setIdentity();l.e00=o-j;l.e11=r-m;l.e03=j;l.e13=m;e=e.getViewProjectionInverseMatrix();
c.combine(e,l,l);d.set(0.5,0.5);this.getWorldIntersectionHomogenous(0,d,l,this.intersectBottomLeft);d.set(0.5,1);this.getWorldIntersectionHomogenous(0,d,l,this.intersectTopLeft);d.set(1,1);this.getWorldIntersectionHomogenous(0,d,l,this.intersectTopRight);d.set(1,0.5);this.getWorldIntersectionHomogenous(0,d,l,this.intersectBottomRight);return!0};l.prototype.getWorldIntersectionHomogenous=function(a,c,b,d){this.calculateIntersection(a,c,b);d.setv(this.origin)};l.prototype.getWorldIntersection=function(a,
c,b,d){this.calculateIntersection(a,c,b);d.setd(this.origin.x,this.origin.y,this.origin.z).div(this.origin.w)};l.prototype.getWorldIntersectionSimple=function(a,c,b,d,e){c=d.setv(c);b=e.setv(b).sub(c);a=(a-c.y)/b.y;b.mul(a);c.addv(b);return a>=0&&a<=1};l.prototype.calculateIntersection=function(a,c,b){this.origin.setd(c.x*2-1,c.y*2-1,-1,1);this.direction.setd(c.x*2-1,c.y*2-1,1,1);b.applyPost(this.origin);b.applyPost(this.direction);this.direction.sub(this.origin);Math.abs(this.direction.y)>g.EPSILON?
this.direction.mul((a-this.origin.y)/this.direction.y):(this.direction.normalize(),this.direction.mul(this.mainCamera._frustumFar));this.origin.add(this.direction)};l.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(f.POSITION),c=this.getAttributeBuffer(f.TEXCOORD0),b=this.getIndexBuffer(),d=this.densityX,e=this.densityY,g=0;g<d;g++)for(var l=0;l<e;l++)a[(g+l*d)*3+0]=g,a[(g+l*d)*3+1]=0,a[(g+l*d)*3+2]=l,c[(g+l*d)*2+0]=g/(d-1),c[(g+l*d)*2+1]=l/(e-1);for(c=a=0;c<d*(e-1);c++)c%(d*(Math.floor(c/
d)+1)-1)===0&&c!==0||(b[a++]=c,b[a++]=1+d+c,b[a++]=1+c,b[a++]=c,b[a++]=d+c,b[a++]=1+d+c);return this};return l});
define("goo/shapes/SimpleBox",["goo/renderer/MeshData"],function(f){function d(b,a,c){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=c!==void 0?c*0.5:0.5;b=f.defaultMap([f.POSITION]);f.call(this,b,8,36);this.rebuild()}d.prototype=Object.create(f.prototype);d.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,c=this.zExtent;this.getAttributeBuffer(f.POSITION).set([-b,-a,-c,b,-a,-c,b,a,-c,-b,a,-c,-b,-a,c,b,-a,c,b,a,c,-b,a,c]);this.getIndexBuffer().set([0,
1,2,2,3,0,7,6,5,5,4,7,0,3,7,7,4,0,1,2,6,6,5,1,3,2,6,6,7,3,0,1,5,5,4,0]);return this};return d});define("goo/util/DebugDraw",[],function(){function f(){}f.prototype.countDown=function(){};return f});
define("goo/util/Promise",[],function(){function f(){this._state="pending";this._resolved=[];this._rejected=[];this._always=[]}f.prototype.then=function(d,b){d&&d!==null&&this._resolved.push(d);b&&b!==null&&this._rejected.push(b);return this};f.prototype.done=function(d){this._state==="pending"?this.then(d):this._state==="resolved"&&d(this._data);return this};f.prototype.fail=function(d){this._state==="pending"?this.then(null,d):this._state==="rejected"&&d(this._data);return this};f.prototype.always=
function(d){typeof d!=="undefined"&&d!==null&&(this._state==="pending"?this._always.push(d):d(this._data));return this};return f});
define("goo/util/Deferred",["goo/util/Promise"],function(f){function d(b){this._promise=b||new f}d.prototype.promise=function(){return this._promise};d.prototype.resolve=function(b){if(this._promise._state==="pending")this._promise._data=b,this._promise._resolved.every(function(a){a(b);return!0}),this._promise._always.every(function(a){a(b);return!0}),this._promise._state="resolved";return this._promise};d.prototype.reject=function(b){if(this._promise._state==="pending")this._promise._data=b,this._promise._rejected.every(function(a){if(b instanceof
Error)throw b;a(b);return!0}),this._promise._always.every(function(a){a(b);return!0}),this._promise._state="rejected";return this._promise};d.prototype.then=function(b,a){return this._promise.then(b,a)};d.prototype.done=function(b){return this._promise.done(b)};d.prototype.fail=function(b){return this._promise.fail(b)};d.prototype.always=function(b){return this._promise.always(b)};d.when=function(){var b=Array.prototype.slice.call(arguments),a=b.length,c=a,e=new d,f=[],l=function(a,b){return function(d){b[a]=
d;--c<=0&&e.resolve(b)}};if(a>0){var a=function(a){e.reject(a)},k;for(k in b)b[k]&&Object.prototype.toString.call(b[k].constructor)==="[object Function]"?b[k].done(l(k,f)).fail(a):--c}c||e.resolve(f);return e.promise()};return d});
define("goo/util/FastBuilder",["goo/renderer/MeshData","goo/math/Vector3"],function(f,d){function b(a,b,d){if(a.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);this.callback=d||{progress:function(){},done:function(){}};this.meshDatas=[];this.dataCounter=0;for(d=b;;){var l=Math.floor(65535/a.vertexCount),l=Math.min(l,b),k=a.vertexCount*l,i=a.indexCount*l,h={},j;for(j in a.attributeMap){var n=a.attributeMap[j];h[j]={count:n.count,type:n.type,
stride:n.stride,offset:n.offset,normalized:n.normalized}}k=new f(h,k,i);d-=l;this.meshDatas.push(k);if(d<=0)break}this.indexCounter=this.vertexCounter=0;this.callback.progress(0)}var a=new d;b.prototype.addMeshData=function(b,d){if(b.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+b.vertexCount);else if(this.vertexCounter+b.vertexCount>=65536)this.dataCounter++,this.vertexData={},this.indexData=[],this.indexCounter=this.vertexCounter=0,this.callback.progress(this.dataCounter/
(this.meshDatas.length-1));var g=this.meshDatas[this.dataCounter],l=b.attributeMap,k;for(k in l){var i=this.vertexCounter*l[k].count,h=b.getAttributeBuffer(k),j=h.length,n=g.getAttributeBuffer(k);if(k===f.POSITION)for(var o=0;o<j;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),d.matrix.applyPostPoint(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else if(k===f.NORMAL)for(o=0;o<j;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),d.rotation.applyPost(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else if(k===
f.TANGENT)for(o=0;o<j;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),d.rotation.applyPost(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else for(o=0;o<j;o++)n[i+o]=h[o]}l=b.getIndexBuffer();n=g.getIndexBuffer();o=0;for(g=b.indexCount;o<g;o++)n[this.indexCounter+o]=l[o]+this.vertexCounter;this.vertexCounter+=b.vertexCount;this.indexCounter+=b.indexCount};b.prototype.build=function(){this.callback.done();return this.meshDatas};return b});
define("goo/util/Latch2",[],function(){function f(d,b){this.count=d;this.callback=b}f.prototype.countDown=function(){this.count--;this.isDone()&&this.callback.done?this.callback.done():this.callback.progress&&this.callback.progress(this.count)};f.prototype.isDone=function(){return this.count===0};return f});
define("goo/util/MeshBuilder",["goo/renderer/MeshData","goo/math/Vector3","goo/entities/EntityUtils"],function(f,d,b){function a(){this.meshDatas=[];this.vertexData={};this.indexData=[];this.indexCounter=this.vertexCounter=0}a.prototype.addEntity=function(a){b.traverse(a,function(){a.transformComponent._dirty&&a.transformComponent.updateTransform()});b.traverse(a,function(){a.transformComponent._dirty&&b.updateWorldTransform(a.transformComponent)});b.traverse(a,function(){a.meshDataComponent&&this.addMeshData(a.meshDataComponent.meshData,
a.transformComponent.worldTransform)})};var c=new d;a.prototype.addMeshData=function(a,b){if(a.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);else this.vertexCounter+a.vertexCount>=65536&&(console.log("Mesh size limit reached, creating new mesh"),this._generateMesh());var d=a.attributeMap,k;for(k in d){var i=d[k],h=this.vertexData[k];if(!h)this.vertexData[k]={},h=this.vertexData[k],h.array=[],h.map={count:i.count,type:i.type,stride:i.stride,
offset:i.offset,normalized:i.normalized};var j=a.getAttributeBuffer(k),n=j.length,o=h.array;if(k===f.POSITION)for(h=0;h<n;h+=3)c.setd(j[h+0],j[h+1],j[h+2]),b.matrix.applyPostPoint(c),o[this.vertexCounter*i.count+h+0]=c[0],o[this.vertexCounter*i.count+h+1]=c[1],o[this.vertexCounter*i.count+h+2]=c[2];else if(k===f.NORMAL)for(h=0;h<n;h+=3)c.setd(j[h+0],j[h+1],j[h+2]),b.rotation.applyPost(c),o[this.vertexCounter*i.count+h+0]=c[0],o[this.vertexCounter*i.count+h+1]=c[1],o[this.vertexCounter*i.count+h+2]=
c[2];else if(k===f.TANGENT)for(h=0;h<n;h+=3)c.setd(j[h+0],j[h+1],j[h+2]),b.rotation.applyPost(c),o[this.vertexCounter*i.count+h+0]=c[0],o[this.vertexCounter*i.count+h+1]=c[1],o[this.vertexCounter*i.count+h+2]=c[2];else for(h=0;h<n;h++)o[this.vertexCounter*i.count+h]=j[h]}d=a.getIndexBuffer();h=0;for(k=a.indexCount;h<k;h++)this.indexData[this.indexCounter+h]=d[h]+this.vertexCounter;this.vertexCounter+=a.vertexCount;this.indexCounter+=a.indexCount};a.prototype._generateMesh=function(){var a={},b;for(b in this.vertexData){var c=
this.vertexData[b];a[b]=c.map}a=new f(a,this.vertexCounter,this.indexCounter);for(b in this.vertexData)c=this.vertexData[b].array,a.getAttributeBuffer(b).set(c);a.getIndexBuffer().set(this.indexData);this.meshDatas.push(a);this.vertexData={};this.indexData=[];this.indexCounter=this.vertexCounter=0};a.prototype.build=function(){this.vertexCounter>0&&this._generateMesh();return this.meshDatas};return a});
define("goo/util/Rc4Random",[],function(){return function(f){var d=[],b=0,a=0;(function(a){for(var b=0;b<256;b++)d[b]=b;for(var f=0,b=0;b<256;b++){var f=(f+d[b]+a.charCodeAt(b%a.length))%256,l=d[b];d[b]=d[f];d[f]=l}})(f);this.getRandomNumber=function(){for(var c=0,e=1,f=0;f<8;f++){b=(b+1)%256;a=(a+d[b])%256;var l=d[b];d[b]=d[a];d[a]=l;c+=d[(d[b]+d[a])%256]*e;e*=256}return c/1.8446744073709552E19}}});
define("goo/util/TangentGenerator",["goo/math/Vector2","goo/math/Vector3","goo/renderer/MeshData"],function(f,d,b){function a(){}a.addTangentBuffer=function(a,e){function g(a){for(var b=[],c=0;c<a.length;c+=3)b.push(new d(a[c+0],a[c+1],a[c+2]));return b}var e=e||0,l=a.getAttributeBuffer(b.POSITION);if(!l)throw Error("Vertex buffer is null!");var k=a.getAttributeBuffer(b.NORMAL);if(!k)throw Error("Normal buffer is null!");var i=a.getAttributeBuffer("TEXCOORD"+e);!i&&e!==0&&(i=a.getAttributeBuffer(b.TEXCOORD0));
if(!i)throw Error("Texture buffer is null!");var h=a.getIndexBuffer();if(!h)throw Error("Index buffer is null!");for(var j=a.vertexCount,n=a.indexCount/3,o=[],q=[],m=0;m<j;m++)o[m]=new d,q[m]=new d;l=g(l);k=g(k);m=function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(new f(a[c+0],a[c+1]));return b}(i);for(i=0;i<n;i++){var r=h[i*3],p=h[i*3+1],v=h[i*3+2],u=l[r],s=l[p],t=l[v],w=m[r],z=m[p],y=m[v],A=s.x-u.x,x=t.x-u.x,D=s.y-u.y,E=t.y-u.y,s=s.z-u.z,u=t.z-u.z,t=z.x-w.x,C=y.x-w.x,z=z.y-w.y,y=y.y-w.y,w=1/(t*
y-C*z);isFinite(w)!==!1&&(y=new d((y*A-z*x)*w,(y*D-z*E)*w,(y*s-z*u)*w),A=new d((t*x-C*A)*w,(t*E-C*D)*w,(t*u-C*s)*w),o[r].add(y),o[p].add(y),o[v].add(y),q[r].add(A),q[p].add(A),q[v].add(A))}a.attributeMap[b.TANGENT]=b.createAttribute(4,"Float");a.rebuildData(a.vertexCount,a.indexCount,!0);h=a.getAttributeBuffer(b.TANGENT);n=new d;l=new d;for(i=0;i<j;i++)m=k[i],r=o[i],p=m.dot(r),n.copy(r).sub(l.copy(m).mul(p)).normalize(),h[i*4+0]=n.x,h[i*4+1]=n.y,h[i*4+2]=n.z,p=n.copy(m).cross(r).dot(q[i]),h[i*4+3]=
p<0?-1:1;return h};return a});require("goo/addons/box2d/components/Box2DComponent,goo/addons/box2d/systems/Box2DSystem,goo/addons/cannon/components/CannonjsComponent,goo/addons/cannon/systems/CannonjsSystem,goo/addons/soundmanager2/components/SoundManager2Component,goo/addons/soundmanager2/systems/SoundManager2System,goo/addons/terrain/Terrain,goo/addons/water/FlatWaterRenderer,goo/addons/water/ProjectedGridWaterRenderer,goo/animation/AnimationManager,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/animation/blendtree/AbstractTwoPartSource,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/ClipSource,goo/animation/blendtree/ExclusiveClipSource,goo/animation/blendtree/FrozenClipSource,goo/animation/blendtree/InclusiveClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/blendtree/SimpleAnimationApplier,goo/animation/clip/AbstractAnimationChannel,goo/animation/clip/AnimationClip,goo/animation/clip/AnimationClipInstance,goo/animation/clip/GuaranteedTriggerChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/clip/JointChannel,goo/animation/clip/JointData,goo/animation/clip/TransformChannel,goo/animation/clip/TransformData,goo/animation/clip/TriggerChannel,goo/animation/clip/TriggerData,goo/animation/layer/AnimationLayer,goo/animation/layer/LayerLERPBlender,goo/animation/state/AbstractFiniteState,goo/animation/state/AbstractTransitionState,goo/animation/state/AbstractTwoStateLerpTransition,goo/animation/state/FadeTransitionState,goo/animation/state/FrozenTransitionState,goo/animation/state/IgnoreTransitionState,goo/animation/state/ImmediateTransitionState,goo/animation/state/StateBlendType,goo/animation/state/SteadyState,goo/animation/state/SyncFadeTransitionState,goo/animation/state/loader/OutputStore,goo/entities/Entity,goo/entities/EntityUtils,goo/entities/EventHandler,goo/entities/GooRunner,goo/entities/World,goo/entities/components/CSSTransformComponent,goo/entities/components/CameraComponent,goo/entities/components/Component,goo/entities/components/LightComponent,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/ParticleComponent,goo/entities/components/ScriptComponent,goo/entities/components/TransformComponent,goo/entities/managers/DebugManager,goo/entities/managers/EntityManager,goo/entities/managers/LightManager,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/CSSTransformSystem,goo/entities/systems/CameraSystem,goo/entities/systems/LightingSystem,goo/entities/systems/ParticlesSystem,goo/entities/systems/PickingSystem,goo/entities/systems/RenderSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/System,goo/entities/systems/TransformSystem,goo/loaders/AnimationLoader,goo/loaders/AnimationTreeLoader,goo/loaders/BundleLoader,goo/loaders/EntityLoader,goo/loaders/JSONImporter,goo/loaders/JsonUtils,goo/loaders/Loader,goo/loaders/MaterialLoader,goo/loaders/MeshLoader,goo/loaders/SceneLoader,goo/loaders/ScriptLoader,goo/loaders/ShaderLoader,goo/loaders/SkeletonLoader,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/math/MathUtils,goo/math/Matrix,goo/math/Matrix2x2,goo/math/Matrix3x3,goo/math/Matrix4x4,goo/math/Plane,goo/math/Quaternion,goo/math/Ray,goo/math/Transform,goo/math/Transformation,goo/math/Vector,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4,goo/math/Versor,goo/noise/Noise,goo/noise/ValueNoise,goo/particles/Particle,goo/particles/ParticleEmitter,goo/particles/ParticleInfluence,goo/particles/ParticleUtils,goo/picking/BoundingTree,goo/picking/PrimitivePickLogic,goo/renderer/BufferData,goo/renderer/BufferUtils,goo/renderer/Camera,goo/renderer/Material,goo/renderer/MeshData,goo/renderer/RenderQueue,goo/renderer/Renderer,goo/renderer/RendererRecord,goo/renderer/Shader,goo/renderer/ShaderCall,goo/renderer/SimplePartitioner,goo/renderer/Texture,goo/renderer/TextureCreator,goo/renderer/Util,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/renderer/bounds/BoundingVolume,goo/renderer/light/DirectionalLight,goo/renderer/light/Light,goo/renderer/light/PointLight,goo/renderer/light/SpotLight,goo/renderer/pass/BloomPass,goo/renderer/pass/BlurPass,goo/renderer/pass/Composer,goo/renderer/pass/DepthPass,goo/renderer/pass/DoGPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/FullscreenUtil,goo/renderer/pass/NesPass,goo/renderer/pass/RenderPass,goo/renderer/pass/RenderTarget,goo/renderer/pass/SSAOPass,goo/renderer/shaders/ShaderBuilder,goo/renderer/shaders/ShaderFragment,goo/renderer/shaders/ShaderLib,goo/renderer/shadow/ShadowHandler,goo/scripts/BasicControlScript,goo/scripts/FlyControlScript,goo/scripts/MouseLookControlScript,goo/scripts/OrbitCamControlScript,goo/scripts/RotationControlScript,goo/scripts/SplineInterpolator,goo/scripts/WASDControlScript,goo/shapes/Box,goo/shapes/ProjectedGrid,goo/shapes/Quad,goo/shapes/ShapeCreator,goo/shapes/SimpleBox,goo/shapes/Sphere,goo/shapes/Torus,goo/util/Ajax,goo/util/DebugDraw,goo/util/Deferred,goo/util/Enum,goo/util/FastBuilder,goo/util/GameUtils,goo/util/Handy,goo/util/Latch,goo/util/Latch2,goo/util/MeshBuilder,goo/util/Promise,goo/util/Rc4Random,goo/util/SimpleResourceUtil,goo/util/Stats,goo/util/TangentGenerator,goo/util/URLTools,goo/util/rsvp".split(","));
define("req_temp",function(){});
